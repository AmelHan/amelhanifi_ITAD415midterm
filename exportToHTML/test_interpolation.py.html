<html>
<head>
<title>test_interpolation.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_interpolation.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">numpy</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(assert_</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">,</span>
                           <span class="s1">assert_array_almost_equal</span><span class="s0">, </span><span class="s1">assert_allclose</span><span class="s0">,</span>
                           <span class="s1">suppress_warnings)</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>
<span class="s0">import </span><span class="s1">scipy.ndimage </span><span class="s0">as </span><span class="s1">ndimage</span>

<span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">types</span>

<span class="s1">eps = </span><span class="s2">1e-12</span>

<span class="s1">ndimage_to_numpy_mode = {</span>
    <span class="s3">'mirror'</span><span class="s1">: </span><span class="s3">'reflect'</span><span class="s0">,</span>
    <span class="s3">'reflect'</span><span class="s1">: </span><span class="s3">'symmetric'</span><span class="s0">,</span>
    <span class="s3">'grid-mirror'</span><span class="s1">: </span><span class="s3">'symmetric'</span><span class="s0">,</span>
    <span class="s3">'grid-wrap'</span><span class="s1">: </span><span class="s3">'wrap'</span><span class="s0">,</span>
    <span class="s3">'nearest'</span><span class="s1">: </span><span class="s3">'edge'</span><span class="s0">,</span>
    <span class="s3">'grid-constant'</span><span class="s1">: </span><span class="s3">'constant'</span><span class="s0">,</span>
<span class="s1">}</span>


<span class="s0">class </span><span class="s1">TestNdimageInterpolation:</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">'mode, expected_value'</span><span class="s0">,</span>
        <span class="s1">[(</span><span class="s3">'nearest'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'wrap'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'mirror'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'constant'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">])]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_boundaries(self</span><span class="s0">, </span><span class="s1">mode</span><span class="s0">, </span><span class="s1">expected_value):</span>
        <span class="s0">def </span><span class="s1">shift(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] + </span><span class="s2">0.5</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">expected_value</span><span class="s0">,</span>
            <span class="s1">ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">cval=-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">,</span>
                                        <span class="s1">output_shape=(</span><span class="s2">7</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s2">1</span><span class="s1">))</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">'mode, expected_value'</span><span class="s0">,</span>
        <span class="s1">[(</span><span class="s3">'nearest'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'wrap'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'mirror'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'constant'</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_boundaries2(self</span><span class="s0">, </span><span class="s1">mode</span><span class="s0">, </span><span class="s1">expected_value):</span>
        <span class="s0">def </span><span class="s1">shift(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">0.9</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">expected_value</span><span class="s0">,</span>
            <span class="s1">ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">cval=-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">,</span>
                                        <span class="s1">output_shape=(</span><span class="s2">4</span><span class="s0">,</span><span class="s1">)))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'mirror'</span><span class="s0">, </span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s3">'grid-mirror'</span><span class="s0">,</span>
                                      <span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s3">'grid-constant'</span><span class="s0">,</span>
                                      <span class="s3">'nearest'</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_boundary_spline_accuracy(self</span><span class="s0">, </span><span class="s1">mode</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s4">&quot;&quot;&quot;Tests based on examples from gh-2640&quot;&quot;&quot;</span>
        <span class="s1">data = numpy.arange(-</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s1">dtype=float)</span>
        <span class="s1">x = numpy.linspace(-</span><span class="s2">8</span><span class="s0">, </span><span class="s2">15</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">1000</span><span class="s1">)</span>
        <span class="s1">y = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">[x]</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">, </span><span class="s1">mode=mode)</span>

        <span class="s5"># compute expected value using explicit padding via numpy.pad</span>
        <span class="s1">npad = </span><span class="s2">32</span>
        <span class="s1">pad_mode = ndimage_to_numpy_mode.get(mode)</span>
        <span class="s1">padded = numpy.pad(data</span><span class="s0">, </span><span class="s1">npad</span><span class="s0">, </span><span class="s1">mode=pad_mode)</span>
        <span class="s1">expected = ndimage.map_coordinates(padded</span><span class="s0">, </span><span class="s1">[npad + x]</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">,</span>
                                           <span class="s1">mode=mode)</span>

        <span class="s1">atol = </span><span class="s2">1e-5 </span><span class="s0">if </span><span class="s1">mode == </span><span class="s3">'grid-constant' </span><span class="s0">else </span><span class="s2">1e-12</span>
        <span class="s1">assert_allclose(y</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">rtol=</span><span class="s2">1e-7</span><span class="s0">, </span><span class="s1">atol=atol)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">types)</span>
    <span class="s0">def </span><span class="s1">test_spline01(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([]</span><span class="s0">, </span><span class="s1">dtype)</span>
        <span class="s1">out = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">types)</span>
    <span class="s0">def </span><span class="s1">test_spline02(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype)</span>
        <span class="s1">out = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">types)</span>
    <span class="s0">def </span><span class="s1">test_spline03(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([]</span><span class="s0">, </span><span class="s1">dtype)</span>
        <span class="s1">out = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">output=dtype)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">types)</span>
    <span class="s0">def </span><span class="s1">test_spline04(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype)</span>
        <span class="s1">out = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">types)</span>
    <span class="s0">def </span><span class="s1">test_spline05(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype)</span>
        <span class="s1">out = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform01(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform02(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform03(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform04(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform05(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected -= </span><span class="s2">1j </span><span class="s1">* expected</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform06(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform07(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform08(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform10(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s0">if </span><span class="s1">(order &gt; </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">filtered = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">filtered = data</span>
        <span class="s1">out = ndimage.geometric_transform(filtered</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                          <span class="s1">order=order</span><span class="s0">, </span><span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform13(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">numpy.float64)</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] // </span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform14(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(</span><span class="s2">2 </span><span class="s1">* x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform15(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] / </span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">[</span><span class="s2">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform16(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9.0</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] * </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">11</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform17(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform18(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] * </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform19(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] / </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[...</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform20(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] / </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s0">, </span><span class="s1">...]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform21(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] / </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] / </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform22(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">numpy.float64)</span>

        <span class="s0">def </span><span class="s1">mapping1(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] / </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] / </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s0">def </span><span class="s1">mapping2(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">1</span><span class="s1">] * </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping1</span><span class="s0">,</span>
                                          <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out = ndimage.geometric_transform(out</span><span class="s0">, </span><span class="s1">mapping2</span><span class="s0">,</span>
                                          <span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform23(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">0</span><span class="s1">] * </span><span class="s2">2</span><span class="s1">)</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out = out.astype(numpy.int32)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform24(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>

        <span class="s0">def </span><span class="s1">mapping(x</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b):</span>
            <span class="s0">return </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">0</span><span class="s1">] * b)</span>

        <span class="s1">out = ndimage.geometric_transform(</span>
            <span class="s1">data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">, </span><span class="s1">extra_arguments=(</span><span class="s2">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">extra_keywords={</span><span class="s3">'b'</span><span class="s1">: </span><span class="s2">2</span><span class="s1">})</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_geometric_transform_grid_constant_order1(self):</span>
        <span class="s5"># verify interpolation outside the original bounds</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=float)</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(x[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">0.5</span><span class="s1">)</span>

        <span class="s1">expected_result = numpy.array([[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.75</span><span class="s0">, </span><span class="s2">1.25</span><span class="s1">]</span><span class="s0">,</span>
                                       <span class="s1">[</span><span class="s2">1.25</span><span class="s0">, </span><span class="s2">3.00</span><span class="s0">, </span><span class="s2">4.00</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.geometric_transform(x</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'grid-constant'</span><span class="s0">,</span>
                                        <span class="s1">order=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">expected_result</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s3">'nearest'</span><span class="s0">,</span>
                                      <span class="s3">'mirror'</span><span class="s0">, </span><span class="s3">'reflect'</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_geometric_transform_vs_padded(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s1">x = numpy.arange(</span><span class="s2">144</span><span class="s0">, </span><span class="s1">dtype=float).reshape(</span><span class="s2">12</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">(x[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(x[</span><span class="s2">1</span><span class="s1">] + </span><span class="s2">2.3</span><span class="s1">)</span>

        <span class="s5"># Manually pad and then extract center after the transform to get the</span>
        <span class="s5"># expected result.</span>
        <span class="s1">npad = </span><span class="s2">24</span>
        <span class="s1">pad_mode = ndimage_to_numpy_mode.get(mode)</span>
        <span class="s1">xp = numpy.pad(x</span><span class="s0">, </span><span class="s1">npad</span><span class="s0">, </span><span class="s1">mode=pad_mode)</span>
        <span class="s1">center_slice = tuple([slice(npad</span><span class="s0">, </span><span class="s1">-npad)] * x.ndim)</span>
        <span class="s1">expected_result = ndimage.geometric_transform(</span>
            <span class="s1">xp</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">order=order)[center_slice]</span>

        <span class="s1">assert_allclose(</span>
            <span class="s1">ndimage.geometric_transform(x</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">,</span>
                                        <span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">expected_result</span><span class="s0">,</span>
            <span class="s1">rtol=</span><span class="s2">1e-7</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_geometric_transform_endianness_with_output_parameter(self):</span>
        <span class="s5"># geometric transform given output ndarray or dtype with</span>
        <span class="s5"># non-native endianness. see issue #4127</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s0">for </span><span class="s1">out </span><span class="s0">in </span><span class="s1">[data.dtype</span><span class="s0">, </span><span class="s1">data.dtype.newbyteorder()</span><span class="s0">,</span>
                    <span class="s1">numpy.empty_like(data)</span><span class="s0">,</span>
                    <span class="s1">numpy.empty_like(data).astype(data.dtype.newbyteorder())]:</span>
            <span class="s1">returned = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">data.shape</span><span class="s0">,</span>
                                                   <span class="s1">output=out)</span>
            <span class="s1">result = out </span><span class="s0">if </span><span class="s1">returned </span><span class="s0">is None else </span><span class="s1">returned</span>
            <span class="s1">assert_array_almost_equal(result</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_geometric_transform_with_string_output(self):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s0">def </span><span class="s1">mapping(x):</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">out = ndimage.geometric_transform(data</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">output=</span><span class="s3">'f'</span><span class="s1">)</span>
        <span class="s1">assert_(out.dtype </span><span class="s0">is </span><span class="s1">numpy.dtype(</span><span class="s3">'f'</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_map_coordinates01(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data = data - </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected = expected - </span><span class="s2">1j </span><span class="s1">* expected</span>

        <span class="s1">idx = numpy.indices(data.shape)</span>
        <span class="s1">idx -= </span><span class="s2">1</span>

        <span class="s1">out = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_map_coordinates02(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">idx = numpy.indices(data.shape</span><span class="s0">, </span><span class="s1">numpy.float64)</span>
        <span class="s1">idx -= </span><span class="s2">0.5</span>

        <span class="s1">out1 = ndimage.shift(data</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out2 = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out1</span><span class="s0">, </span><span class="s1">out2)</span>

    <span class="s0">def </span><span class="s1">test_map_coordinates03(self):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">order=</span><span class="s3">'F'</span><span class="s1">)</span>
        <span class="s1">idx = numpy.indices(data.shape) - </span><span class="s2">1</span>
        <span class="s1">out = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">idx)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">ndimage.shift(data</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)))</span>
        <span class="s1">idx = numpy.indices(data[::</span><span class="s2">2</span><span class="s1">].shape) - </span><span class="s2">1</span>
        <span class="s1">out = ndimage.map_coordinates(data[::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">idx)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">ndimage.shift(data[::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)))</span>
        <span class="s1">idx = numpy.indices(data[:</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">].shape) - </span><span class="s2">1</span>
        <span class="s1">out = ndimage.map_coordinates(data[:</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">idx)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">ndimage.shift(data[:</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_map_coordinates_endianness_with_output_parameter(self):</span>
        <span class="s5"># output parameter given as array or dtype with either endianness</span>
        <span class="s5"># see issue #4127</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">idx = numpy.indices(data.shape)</span>
        <span class="s1">idx -= </span><span class="s2">1</span>
        <span class="s0">for </span><span class="s1">out </span><span class="s0">in </span><span class="s1">[</span>
            <span class="s1">data.dtype</span><span class="s0">,</span>
            <span class="s1">data.dtype.newbyteorder()</span><span class="s0">,</span>
            <span class="s1">numpy.empty_like(expected)</span><span class="s0">,</span>
            <span class="s1">numpy.empty_like(expected).astype(expected.dtype.newbyteorder())</span>
        <span class="s1">]:</span>
            <span class="s1">returned = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">output=out)</span>
            <span class="s1">result = out </span><span class="s0">if </span><span class="s1">returned </span><span class="s0">is None else </span><span class="s1">returned</span>
            <span class="s1">assert_array_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_map_coordinates_with_string_output(self):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">idx = numpy.indices(data.shape)</span>
        <span class="s1">out = ndimage.map_coordinates(data</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">output=</span><span class="s3">'f'</span><span class="s1">)</span>
        <span class="s1">assert_(out.dtype </span><span class="s0">is </span><span class="s1">numpy.dtype(</span><span class="s3">'f'</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s3">'win32' </span><span class="s0">in </span><span class="s1">sys.platform </span><span class="s0">or </span><span class="s1">numpy.intp(</span><span class="s2">0</span><span class="s1">).itemsize &lt; </span><span class="s2">8</span><span class="s0">,</span>
                        <span class="s1">reason=</span><span class="s3">'do not run on 32 bit or windows '</span>
                               <span class="s3">'(no sparse memory)'</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_map_coordinates_large_data(self):</span>
        <span class="s5"># check crash on large data</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">n = </span><span class="s2">30000</span>
            <span class="s1">a = numpy.empty(n**</span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float32).reshape(n</span><span class="s0">, </span><span class="s1">n)</span>
            <span class="s5"># fill the part we might read</span>
            <span class="s1">a[n - </span><span class="s2">3</span><span class="s1">:</span><span class="s0">, </span><span class="s1">n - </span><span class="s2">3</span><span class="s1">:] = </span><span class="s2">0</span>
            <span class="s1">ndimage.map_coordinates(a</span><span class="s0">, </span><span class="s1">[[n - </span><span class="s2">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[n - </span><span class="s2">1.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">order=</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s0">except </span><span class="s1">MemoryError </span><span class="s0">as </span><span class="s1">e:</span>
            <span class="s0">raise </span><span class="s1">pytest.skip(</span><span class="s3">'Not enough memory available'</span><span class="s1">) </span><span class="s0">from </span><span class="s1">e</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform01(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform02(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform03(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform04(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_affine_transform05(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected -= </span><span class="s2">1j </span><span class="s1">* expected</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
                                       <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform06(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
                                       <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform07(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
                                       <span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform08(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
                                       <span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform09(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s0">if </span><span class="s1">(order &gt; </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">filtered = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">filtered = data</span>
        <span class="s1">out = ndimage.affine_transform(filtered</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
                                       <span class="s1">[-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">,</span>
                                       <span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform10(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">numpy.float64)</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">output_shape=(</span><span class="s2">4</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform11(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform12(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform13(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9.0</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">11</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform14(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform15(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform16(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                       <span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[...</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform17(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                       <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s0">, </span><span class="s1">...]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform18(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                       <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform19(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">numpy.float64)</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                       <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out = ndimage.affine_transform(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                       <span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform20(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform21(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">9</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform22(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># shift and offset interaction; see issue #1547</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform23(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># shift and offset interaction; see issue #1547</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                       <span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform24(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># consistency between diagonal and non-diagonal case; see issue #1547</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">suppress_warnings() </span><span class="s0">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s0">,</span>
                       <span class="s3">'The behavior of affine_transform with a 1-D array .* '</span>
                       <span class="s3">'has changed'</span><span class="s1">)</span>
            <span class="s1">out1 = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out2 = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out1</span><span class="s0">, </span><span class="s1">out2)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform25(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># consistency between diagonal and non-diagonal case; see issue #1547</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">suppress_warnings() </span><span class="s0">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s0">,</span>
                       <span class="s3">'The behavior of affine_transform with a 1-D array .* '</span>
                       <span class="s3">'has changed'</span><span class="s1">)</span>
            <span class="s1">out1 = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">out2 = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out1</span><span class="s0">, </span><span class="s1">out2)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform26(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># test homogeneous coordinates</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s0">if </span><span class="s1">(order &gt; </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">filtered = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">filtered = data</span>
        <span class="s1">tform_original = numpy.eye(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">offset_original = -numpy.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">tform_h1 = numpy.hstack((tform_original</span><span class="s0">, </span><span class="s1">offset_original))</span>
        <span class="s1">tform_h2 = numpy.vstack((tform_h1</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]))</span>
        <span class="s1">out1 = ndimage.affine_transform(filtered</span><span class="s0">, </span><span class="s1">tform_original</span><span class="s0">,</span>
                                        <span class="s1">offset_original.ravel()</span><span class="s0">,</span>
                                        <span class="s1">order=order</span><span class="s0">, </span><span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">out2 = ndimage.affine_transform(filtered</span><span class="s0">, </span><span class="s1">tform_h1</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">,</span>
                                        <span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">out3 = ndimage.affine_transform(filtered</span><span class="s0">, </span><span class="s1">tform_h2</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">,</span>
                                        <span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">out </span><span class="s0">in </span><span class="s1">[out1</span><span class="s0">, </span><span class="s1">out2</span><span class="s0">, </span><span class="s1">out3]:</span>
            <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_affine_transform27(self):</span>
        <span class="s5"># test valid homogeneous transformation matrix</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">tform_h1 = numpy.hstack((numpy.eye(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">-numpy.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))))</span>
        <span class="s1">tform_h2 = numpy.vstack((tform_h1</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">ndimage.affine_transform</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">tform_h2)</span>

    <span class="s0">def </span><span class="s1">test_affine_transform_1d_endianness_with_output_parameter(self):</span>
        <span class="s5"># 1d affine transform given output ndarray or dtype with</span>
        <span class="s5"># either endianness. see issue #7388</span>
        <span class="s1">data = numpy.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">out </span><span class="s0">in </span><span class="s1">[numpy.empty_like(data)</span><span class="s0">,</span>
                    <span class="s1">numpy.empty_like(data).astype(data.dtype.newbyteorder())</span><span class="s0">,</span>
                    <span class="s1">data.dtype</span><span class="s0">, </span><span class="s1">data.dtype.newbyteorder()]:</span>
            <span class="s0">with </span><span class="s1">suppress_warnings() </span><span class="s0">as </span><span class="s1">sup:</span>
                <span class="s1">sup.filter(UserWarning</span><span class="s0">,</span>
                           <span class="s3">'The behavior of affine_transform with a 1-D array '</span>
                           <span class="s3">'.* has changed'</span><span class="s1">)</span>
                <span class="s1">returned = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">output=out)</span>
            <span class="s1">result = out </span><span class="s0">if </span><span class="s1">returned </span><span class="s0">is None else </span><span class="s1">returned</span>
            <span class="s1">assert_array_almost_equal(result</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_affine_transform_multi_d_endianness_with_output_parameter(self):</span>
        <span class="s5"># affine transform given output ndarray or dtype with either endianness</span>
        <span class="s5"># see issue #4127</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s0">for </span><span class="s1">out </span><span class="s0">in </span><span class="s1">[data.dtype</span><span class="s0">, </span><span class="s1">data.dtype.newbyteorder()</span><span class="s0">,</span>
                    <span class="s1">numpy.empty_like(data)</span><span class="s0">,</span>
                    <span class="s1">numpy.empty_like(data).astype(data.dtype.newbyteorder())]:</span>
            <span class="s1">returned = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">output=out)</span>
            <span class="s1">result = out </span><span class="s0">if </span><span class="s1">returned </span><span class="s0">is None else </span><span class="s1">returned</span>
            <span class="s1">assert_array_almost_equal(result</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_affine_transform_output_shape(self):</span>
        <span class="s5"># don't require output_shape when out of a different size is given</span>
        <span class="s1">data = numpy.arange(</span><span class="s2">8</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = numpy.ones((</span><span class="s2">16</span><span class="s0">,</span><span class="s1">))</span>

        <span class="s1">ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">output=out)</span>
        <span class="s1">assert_array_almost_equal(out[:</span><span class="s2">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

        <span class="s5"># mismatched output shape raises an error</span>
        <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError):</span>
            <span class="s1">ndimage.affine_transform(</span>
                <span class="s1">data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">output=out</span><span class="s0">, </span><span class="s1">output_shape=(</span><span class="s2">12</span><span class="s0">,</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_affine_transform_with_string_output(self):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">output=</span><span class="s3">'f'</span><span class="s1">)</span>
        <span class="s1">assert_(out.dtype </span><span class="s0">is </span><span class="s1">numpy.dtype(</span><span class="s3">'f'</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'shift'</span><span class="s0">,</span>
                             <span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform_shift_via_grid_wrap(self</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># For mode 'grid-wrap', integer shifts should match numpy.roll</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">affine = numpy.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">affine[:</span><span class="s2">2</span><span class="s0">, </span><span class="s1">:</span><span class="s2">2</span><span class="s1">] = numpy.eye(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">affine[:</span><span class="s0">, </span><span class="s2">2</span><span class="s1">] = shift</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.affine_transform(x</span><span class="s0">, </span><span class="s1">affine</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">numpy.roll(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">axis=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_affine_transform_shift_reflect(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># shift by x.shape results in reflection</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>
        <span class="s1">affine = numpy.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">affine[:</span><span class="s2">2</span><span class="s0">, </span><span class="s1">:</span><span class="s2">2</span><span class="s1">] = numpy.eye(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">affine[:</span><span class="s0">, </span><span class="s2">2</span><span class="s1">] = x.shape</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.affine_transform(x</span><span class="s0">, </span><span class="s1">affine</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">x[::-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">::-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift01(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift02(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift03(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.ones([</span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift04(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_shift05(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected -= </span><span class="s2">1j </span><span class="s1">* expected</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'constant'</span><span class="s0">, </span><span class="s3">'grid-constant'</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_shift_with_nonzero_cval(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">mode</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>

        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>

        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected -= </span><span class="s2">1j </span><span class="s1">* expected</span>
        <span class="s1">cval = </span><span class="s2">5.0</span>
        <span class="s1">expected[:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] = cval  </span><span class="s5"># specific to shift of [0, 1] used below</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">cval=cval)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift06(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift07(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift08(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s1">out = ndimage.shift(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift09(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
        <span class="s0">if </span><span class="s1">(order &gt; </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">filtered = ndimage.spline_filter(data</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">filtered = data</span>
        <span class="s1">out = ndimage.shift(filtered</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">, </span><span class="s1">prefilter=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'shift'</span><span class="s0">,</span>
                             <span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift_grid_wrap(self</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># For mode 'grid-wrap', integer shifts should match numpy.roll</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">numpy.roll(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">axis=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'shift'</span><span class="s0">,</span>
                             <span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift_grid_constant1(self</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># For integer shifts, 'constant' and 'grid-constant' should be equal</span>
        <span class="s1">x = numpy.arange(</span><span class="s2">20</span><span class="s1">).reshape((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'constant'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_shift_grid_constant_order1(self):</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=float)</span>
        <span class="s1">expected_result = numpy.array([[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.75</span><span class="s0">, </span><span class="s2">1.25</span><span class="s1">]</span><span class="s0">,</span>
                                       <span class="s1">[</span><span class="s2">1.25</span><span class="s0">, </span><span class="s2">3.00</span><span class="s0">, </span><span class="s2">4.00</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s1">order=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">expected_result</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift_reflect(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s5"># shift by x.shape results in reflection</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">x.shape</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">x[::-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">::-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'prefilter'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_shift_nearest_boundary(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">prefilter):</span>
        <span class="s5"># verify that shifting at least order // 2 beyond the end of the array</span>
        <span class="s5"># gives a value equal to the edge value.</span>
        <span class="s1">x = numpy.arange(</span><span class="s2">16</span><span class="s1">)</span>
        <span class="s1">kwargs = dict(mode=</span><span class="s3">'nearest'</span><span class="s0">, </span><span class="s1">order=order</span><span class="s0">, </span><span class="s1">prefilter=prefilter)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">order // </span><span class="s2">2 </span><span class="s1">+ </span><span class="s2">1</span><span class="s0">, </span><span class="s1">**kwargs)[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">-order // </span><span class="s2">2 </span><span class="s1">- </span><span class="s2">1</span><span class="s0">, </span><span class="s1">**kwargs)[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'grid-constant'</span><span class="s0">, </span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s3">'nearest'</span><span class="s0">,</span>
                                      <span class="s3">'mirror'</span><span class="s0">, </span><span class="s3">'reflect'</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_shift_vs_padded(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s1">x = numpy.arange(</span><span class="s2">144</span><span class="s0">, </span><span class="s1">dtype=float).reshape(</span><span class="s2">12</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)</span>
        <span class="s1">shift = (</span><span class="s2">0.4</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2.3</span><span class="s1">)</span>

        <span class="s5"># manually pad and then extract center to get expected result</span>
        <span class="s1">npad = </span><span class="s2">32</span>
        <span class="s1">pad_mode = ndimage_to_numpy_mode.get(mode)</span>
        <span class="s1">xp = numpy.pad(x</span><span class="s0">, </span><span class="s1">npad</span><span class="s0">, </span><span class="s1">mode=pad_mode)</span>
        <span class="s1">center_slice = tuple([slice(npad</span><span class="s0">, </span><span class="s1">-npad)] * x.ndim)</span>
        <span class="s1">expected_result = ndimage.shift(</span>
            <span class="s1">xp</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">order=order)[center_slice]</span>

        <span class="s1">assert_allclose(</span>
            <span class="s1">ndimage.shift(x</span><span class="s0">, </span><span class="s1">shift</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">order=order)</span><span class="s0">,</span>
            <span class="s1">expected_result</span><span class="s0">,</span>
            <span class="s1">rtol=</span><span class="s2">1e-7</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_zoom1(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s0">for </span><span class="s1">z </span><span class="s0">in </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]:</span>
            <span class="s1">arr = numpy.array(list(range(</span><span class="s2">25</span><span class="s1">))).reshape((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)).astype(float)</span>
            <span class="s1">arr = ndimage.zoom(arr</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">order=order)</span>
            <span class="s1">assert_equal(arr.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
            <span class="s1">assert_(numpy.all(arr[-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:] != </span><span class="s2">0</span><span class="s1">))</span>
            <span class="s1">assert_(numpy.all(arr[-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:] &gt;= (</span><span class="s2">20 </span><span class="s1">- eps)))</span>
            <span class="s1">assert_(numpy.all(arr[</span><span class="s2">0</span><span class="s0">, </span><span class="s1">:] &lt;= (</span><span class="s2">5 </span><span class="s1">+ eps)))</span>
            <span class="s1">assert_(numpy.all(arr &gt;= (</span><span class="s2">0 </span><span class="s1">- eps)))</span>
            <span class="s1">assert_(numpy.all(arr &lt;= (</span><span class="s2">24 </span><span class="s1">+ eps)))</span>

    <span class="s0">def </span><span class="s1">test_zoom2(self):</span>
        <span class="s1">arr = numpy.arange(</span><span class="s2">12</span><span class="s1">).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
        <span class="s1">out = ndimage.zoom(ndimage.zoom(arr</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(out</span><span class="s0">, </span><span class="s1">arr)</span>

    <span class="s0">def </span><span class="s1">test_zoom3(self):</span>
        <span class="s1">arr = numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">out1 = ndimage.zoom(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">out2 = ndimage.zoom(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>

        <span class="s1">assert_array_almost_equal(out1</span><span class="s0">, </span><span class="s1">numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]))</span>
        <span class="s1">assert_array_almost_equal(out2</span><span class="s0">, </span><span class="s1">numpy.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_zoom_affine01(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.asarray([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
        <span class="s0">with </span><span class="s1">suppress_warnings() </span><span class="s0">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s0">,</span>
                       <span class="s3">'The behavior of affine_transform with a 1-D array .* '</span>
                       <span class="s3">'has changed'</span><span class="s1">)</span>
            <span class="s1">out = ndimage.affine_transform(data</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s0">,</span>
                                           <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out[::</span><span class="s2">2</span><span class="s0">, </span><span class="s1">::</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s0">def </span><span class="s1">test_zoom_infinity(self):</span>
        <span class="s5"># Ticket #1419 regression test</span>
        <span class="s1">dim = </span><span class="s2">8</span>
        <span class="s1">ndimage.zoom(numpy.zeros((dim</span><span class="s0">, </span><span class="s1">dim))</span><span class="s0">, </span><span class="s2">1. </span><span class="s1">/ dim</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">'nearest'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zoom_zoomfactor_one(self):</span>
        <span class="s5"># Ticket #1122 regression test</span>
        <span class="s1">arr = numpy.zeros((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">zoom = (</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">)</span>

        <span class="s1">out = ndimage.zoom(arr</span><span class="s0">, </span><span class="s1">zoom</span><span class="s0">, </span><span class="s1">cval=</span><span class="s2">7</span><span class="s1">)</span>
        <span class="s1">ref = numpy.zeros((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">ref)</span>

    <span class="s0">def </span><span class="s1">test_zoom_output_shape_roundoff(self):</span>
        <span class="s1">arr = numpy.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">25</span><span class="s1">))</span>
        <span class="s1">zoom = (</span><span class="s2">4.0 </span><span class="s1">/ </span><span class="s2">3</span><span class="s0">, </span><span class="s2">15.0 </span><span class="s1">/ </span><span class="s2">11</span><span class="s0">, </span><span class="s2">29.0 </span><span class="s1">/ </span><span class="s2">25</span><span class="s1">)</span>
        <span class="s1">out = ndimage.zoom(arr</span><span class="s0">, </span><span class="s1">zoom)</span>
        <span class="s1">assert_array_equal(out.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">15</span><span class="s0">, </span><span class="s2">29</span><span class="s1">))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'zoom'</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'nearest'</span><span class="s0">, </span><span class="s3">'constant'</span><span class="s0">, </span><span class="s3">'wrap'</span><span class="s0">, </span><span class="s3">'reflect'</span><span class="s0">,</span>
                                      <span class="s3">'mirror'</span><span class="s0">, </span><span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s3">'grid-mirror'</span><span class="s0">,</span>
                                      <span class="s3">'grid-constant'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_zoom_by_int_order0(self</span><span class="s0">, </span><span class="s1">zoom</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s5"># order 0 zoom should be the same as replication via numpy.kron</span>
        <span class="s5"># Note: This is not True for general x shapes when grid_mode is False,</span>
        <span class="s5">#       but works here for all modes because the size ratio happens to</span>
        <span class="s5">#       always be an integer when x.shape = (2, 2).</span>
        <span class="s1">x = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=float)</span>
        <span class="s5"># x = numpy.arange(16, dtype=float).reshape(4, 4)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.zoom(x</span><span class="s0">, </span><span class="s1">zoom</span><span class="s0">, </span><span class="s1">order=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mode=mode)</span><span class="s0">,</span>
            <span class="s1">numpy.kron(x</span><span class="s0">, </span><span class="s1">numpy.ones(zoom))</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'shape'</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'zoom'</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'nearest'</span><span class="s0">, </span><span class="s3">'reflect'</span><span class="s0">, </span><span class="s3">'mirror'</span><span class="s0">,</span>
                                      <span class="s3">'grid-wrap'</span><span class="s0">, </span><span class="s3">'grid-constant'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_zoom_grid_by_int_order0(self</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">zoom</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s5"># When grid_mode is True,  order 0 zoom should be the same as</span>
        <span class="s5"># replication via numpy.kron. The only exceptions to this are the</span>
        <span class="s5"># non-grid modes 'constant' and 'wrap'.</span>
        <span class="s1">x = numpy.arange(numpy.prod(shape)</span><span class="s0">, </span><span class="s1">dtype=float).reshape(shape)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">ndimage.zoom(x</span><span class="s0">, </span><span class="s1">zoom</span><span class="s0">, </span><span class="s1">order=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">grid_mode=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">numpy.kron(x</span><span class="s0">, </span><span class="s1">numpy.ones(zoom))</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'mode'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'constant'</span><span class="s0">, </span><span class="s3">'wrap'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_zoom_grid_mode_warnings(self</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s5"># Warn on use of non-grid modes when grid_mode is True</span>
        <span class="s1">x = numpy.arange(</span><span class="s2">9</span><span class="s0">, </span><span class="s1">dtype=float).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                          <span class="s1">match=</span><span class="s3">&quot;It is recommended to use mode&quot;</span><span class="s1">):</span>
            <span class="s1">ndimage.zoom(x</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">grid_mode=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate01(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">data)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate02(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'dtype'</span><span class="s0">, </span><span class="s1">[numpy.float64</span><span class="s0">, </span><span class="s1">numpy.complex128])</span>
    <span class="s0">def </span><span class="s1">test_rotate03(self</span><span class="s0">, </span><span class="s1">order</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">if </span><span class="s1">data.dtype.kind == </span><span class="s3">'c'</span><span class="s1">:</span>
            <span class="s1">data -= </span><span class="s2">1j </span><span class="s1">* data</span>
            <span class="s1">expected -= </span><span class="s2">1j </span><span class="s1">* expected</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate04(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">reshape=</span><span class="s0">False, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate05(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.empty((</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
            <span class="s1">data[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">i] = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
            <span class="s1">assert_array_almost_equal(out[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">i]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate06(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
            <span class="s1">data[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">i] = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
            <span class="s1">assert_array_almost_equal(out[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">i]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate07(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">data = data.transpose()</span>
        <span class="s1">expected = numpy.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = expected.transpose([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">axes=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'order'</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_rotate08(self</span><span class="s0">, </span><span class="s1">order):</span>
        <span class="s1">data = numpy.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">data = data.transpose()</span>
        <span class="s1">expected = numpy.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s1">expected = expected.transpose()</span>
        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">axes=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">reshape=</span><span class="s0">False, </span><span class="s1">order=order)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_rotate09(self):</span>
        <span class="s1">data = numpy.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]] * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">dtype=numpy.float64)</span>
        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">ndimage.rotate(data</span><span class="s0">, </span><span class="s2">90</span><span class="s0">, </span><span class="s1">axes=(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">data.ndim))</span>

    <span class="s0">def </span><span class="s1">test_rotate10(self):</span>
        <span class="s1">data = numpy.arange(</span><span class="s2">45</span><span class="s0">, </span><span class="s1">dtype=numpy.float64).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>

        <span class="s5"># The output of ndimage.rotate before refactoring</span>
        <span class="s1">expected = numpy.array([[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">6.54914793</span><span class="s0">, </span><span class="s2">7.54914793</span><span class="s0">, </span><span class="s2">8.54914793</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">10.84520162</span><span class="s0">, </span><span class="s2">11.84520162</span><span class="s0">, </span><span class="s2">12.84520162</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]]</span><span class="s0">,</span>
                                <span class="s1">[[</span><span class="s2">6.19286575</span><span class="s0">, </span><span class="s2">7.19286575</span><span class="s0">, </span><span class="s2">8.19286575</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">13.4730712</span><span class="s0">, </span><span class="s2">14.4730712</span><span class="s0">, </span><span class="s2">15.4730712</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">21.0</span><span class="s0">, </span><span class="s2">22.0</span><span class="s0">, </span><span class="s2">23.0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">28.5269288</span><span class="s0">, </span><span class="s2">29.5269288</span><span class="s0">, </span><span class="s2">30.5269288</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">35.80713425</span><span class="s0">, </span><span class="s2">36.80713425</span><span class="s0">, </span><span class="s2">37.80713425</span><span class="s1">]]</span><span class="s0">,</span>
                                <span class="s1">[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">31.15479838</span><span class="s0">, </span><span class="s2">32.15479838</span><span class="s0">, </span><span class="s2">33.15479838</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">35.45085207</span><span class="s0">, </span><span class="s2">36.45085207</span><span class="s0">, </span><span class="s2">37.45085207</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]]])</span>

        <span class="s1">out = ndimage.rotate(data</span><span class="s0">, </span><span class="s1">angle=</span><span class="s2">12</span><span class="s0">, </span><span class="s1">reshape=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(out</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_rotate_exact_180(self):</span>
        <span class="s1">a = numpy.tile(numpy.arange(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">b = ndimage.rotate(ndimage.rotate(a</span><span class="s0">, </span><span class="s2">180</span><span class="s1">)</span><span class="s0">, </span><span class="s1">-</span><span class="s2">180</span><span class="s1">)</span>
        <span class="s1">assert_equal(a</span><span class="s0">, </span><span class="s1">b)</span>


<span class="s0">def </span><span class="s1">test_zoom_output_shape():</span>
    <span class="s4">&quot;&quot;&quot;Ticket #643&quot;&quot;&quot;</span>
    <span class="s1">x = numpy.arange(</span><span class="s2">12</span><span class="s1">).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s1">ndimage.zoom(x</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">output=numpy.zeros((</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)))</span>
</pre>
</body>
</html>
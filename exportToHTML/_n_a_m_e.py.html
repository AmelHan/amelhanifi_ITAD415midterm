<html>
<head>
<title>_n_a_m_e.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #a5c261;}
.s5 { color: #6897bb;}
.s6 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_n_a_m_e.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">from </span><span class="s1">fontTools.misc </span><span class="s2">import </span><span class="s1">sstruct</span>
<span class="s2">from </span><span class="s1">fontTools.misc.textTools </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">bytechr</span><span class="s2">,</span>
    <span class="s1">byteord</span><span class="s2">,</span>
    <span class="s1">bytesjoin</span><span class="s2">,</span>
    <span class="s1">strjoin</span><span class="s2">,</span>
    <span class="s1">tobytes</span><span class="s2">,</span>
    <span class="s1">tostr</span><span class="s2">,</span>
    <span class="s1">safeEval</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">fontTools.misc.encodingTools </span><span class="s2">import </span><span class="s1">getEncoding</span>
<span class="s2">from </span><span class="s1">fontTools.ttLib </span><span class="s2">import </span><span class="s1">newTable</span>
<span class="s2">from </span><span class="s1">fontTools.ttLib.ttVisitor </span><span class="s2">import </span><span class="s1">TTVisitor</span>
<span class="s2">from </span><span class="s1">fontTools </span><span class="s2">import </span><span class="s1">ttLib</span>
<span class="s2">import </span><span class="s1">fontTools.ttLib.tables.otTables </span><span class="s2">as </span><span class="s1">otTables</span>
<span class="s2">from </span><span class="s1">fontTools.ttLib.tables </span><span class="s2">import </span><span class="s1">C_P_A_L_</span>
<span class="s2">from </span><span class="s1">. </span><span class="s2">import </span><span class="s1">DefaultTable</span>
<span class="s2">import </span><span class="s1">struct</span>
<span class="s2">import </span><span class="s1">logging</span>


<span class="s1">log = logging.getLogger(__name__)</span>

<span class="s1">nameRecordFormat = </span><span class="s3">&quot;&quot;&quot; 
        &gt;   # big endian 
        platformID: H 
        platEncID:  H 
        langID:     H 
        nameID:     H 
        length:     H 
        offset:     H 
&quot;&quot;&quot;</span>

<span class="s1">nameRecordSize = sstruct.calcsize(nameRecordFormat)</span>


<span class="s2">class </span><span class="s1">table__n_a_m_e(DefaultTable.DefaultTable):</span>
    <span class="s1">dependencies = [</span><span class="s3">&quot;ltag&quot;</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">decompile(self</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s1">format</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">stringOffset = struct.unpack(</span><span class="s4">b&quot;&gt;HHH&quot;</span><span class="s2">, </span><span class="s1">data[:</span><span class="s5">6</span><span class="s1">])</span>
        <span class="s1">expectedStringOffset = </span><span class="s5">6 </span><span class="s1">+ n * nameRecordSize</span>
        <span class="s2">if </span><span class="s1">stringOffset != expectedStringOffset:</span>
            <span class="s1">log.error(</span>
                <span class="s3">&quot;'name' table stringOffset incorrect. Expected: %s; Actual: %s&quot;</span><span class="s2">,</span>
                <span class="s1">expectedStringOffset</span><span class="s2">,</span>
                <span class="s1">stringOffset</span><span class="s2">,</span>
            <span class="s1">)</span>
        <span class="s1">stringData = data[stringOffset:]</span>
        <span class="s1">data = data[</span><span class="s5">6</span><span class="s1">:]</span>
        <span class="s1">self.names = []</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(n):</span>
            <span class="s2">if </span><span class="s1">len(data) &lt; </span><span class="s5">12</span><span class="s1">:</span>
                <span class="s1">log.error(</span><span class="s3">&quot;skipping malformed name record #%d&quot;</span><span class="s2">, </span><span class="s1">i)</span>
                <span class="s2">continue</span>
            <span class="s1">name</span><span class="s2">, </span><span class="s1">data = sstruct.unpack2(nameRecordFormat</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">NameRecord())</span>
            <span class="s1">name.string = stringData[name.offset : name.offset + name.length]</span>
            <span class="s2">if </span><span class="s1">name.offset + name.length &gt; len(stringData):</span>
                <span class="s1">log.error(</span><span class="s3">&quot;skipping malformed name record #%d&quot;</span><span class="s2">, </span><span class="s1">i)</span>
                <span class="s2">continue</span>
            <span class="s2">assert </span><span class="s1">len(name.string) == name.length</span>
            <span class="s0"># if (name.platEncID, name.platformID) in ((0, 0), (1, 3)):</span>
            <span class="s0">#   if len(name.string) % 2:</span>
            <span class="s0">#       print &quot;2-byte string doesn't have even length!&quot;</span>
            <span class="s0">#       print name.__dict__</span>
            <span class="s2">del </span><span class="s1">name.offset</span><span class="s2">, </span><span class="s1">name.length</span>
            <span class="s1">self.names.append(name)</span>

    <span class="s2">def </span><span class="s1">compile(self</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s1">):</span>
            <span class="s0"># only happens when there are NO name table entries read</span>
            <span class="s0"># from the TTX file</span>
            <span class="s1">self.names = []</span>
        <span class="s1">names = self.names</span>
        <span class="s1">names.sort()  </span><span class="s0"># sort according to the spec; see NameRecord.__lt__()</span>
        <span class="s1">stringData = </span><span class="s4">b&quot;&quot;</span>
        <span class="s1">format = </span><span class="s5">0</span>
        <span class="s1">n = len(names)</span>
        <span class="s1">stringOffset = </span><span class="s5">6 </span><span class="s1">+ n * sstruct.calcsize(nameRecordFormat)</span>
        <span class="s1">data = struct.pack(</span><span class="s4">b&quot;&gt;HHH&quot;</span><span class="s2">, </span><span class="s1">format</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">stringOffset)</span>
        <span class="s1">lastoffset = </span><span class="s5">0</span>
        <span class="s1">done = {}  </span><span class="s0"># remember the data so we can reuse the &quot;pointers&quot;</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">names:</span>
            <span class="s1">string = name.toBytes()</span>
            <span class="s2">if </span><span class="s1">string </span><span class="s2">in </span><span class="s1">done:</span>
                <span class="s1">name.offset</span><span class="s2">, </span><span class="s1">name.length = done[string]</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">name.offset</span><span class="s2">, </span><span class="s1">name.length = done[string] = len(stringData)</span><span class="s2">, </span><span class="s1">len(string)</span>
                <span class="s1">stringData = bytesjoin([stringData</span><span class="s2">, </span><span class="s1">string])</span>
            <span class="s1">data = data + sstruct.pack(nameRecordFormat</span><span class="s2">, </span><span class="s1">name)</span>
        <span class="s2">return </span><span class="s1">data + stringData</span>

    <span class="s2">def </span><span class="s1">toXML(self</span><span class="s2">, </span><span class="s1">writer</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">self.names:</span>
            <span class="s1">name.toXML(writer</span><span class="s2">, </span><span class="s1">ttFont)</span>

    <span class="s2">def </span><span class="s1">fromXML(self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">attrs</span><span class="s2">, </span><span class="s1">content</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s2">if </span><span class="s1">name != </span><span class="s3">&quot;namerecord&quot;</span><span class="s1">:</span>
            <span class="s2">return  </span><span class="s0"># ignore unknown tags</span>
        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s1">):</span>
            <span class="s1">self.names = []</span>
        <span class="s1">name = NameRecord()</span>
        <span class="s1">self.names.append(name)</span>
        <span class="s1">name.fromXML(name</span><span class="s2">, </span><span class="s1">attrs</span><span class="s2">, </span><span class="s1">content</span><span class="s2">, </span><span class="s1">ttFont)</span>

    <span class="s2">def </span><span class="s1">getName(self</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s2">for </span><span class="s1">namerecord </span><span class="s2">in </span><span class="s1">self.names:</span>
            <span class="s2">if </span><span class="s1">(</span>
                <span class="s1">namerecord.nameID == nameID</span>
                <span class="s2">and </span><span class="s1">namerecord.platformID == platformID</span>
                <span class="s2">and </span><span class="s1">namerecord.platEncID == platEncID</span>
            <span class="s1">):</span>
                <span class="s2">if </span><span class="s1">langID </span><span class="s2">is None or </span><span class="s1">namerecord.langID == langID:</span>
                    <span class="s2">return </span><span class="s1">namerecord</span>
        <span class="s2">return None  </span><span class="s0"># not found</span>

    <span class="s2">def </span><span class="s1">getDebugName(self</span><span class="s2">, </span><span class="s1">nameID):</span>
        <span class="s1">englishName = someName = </span><span class="s2">None</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">self.names:</span>
            <span class="s2">if </span><span class="s1">name.nameID != nameID:</span>
                <span class="s2">continue</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">unistr = name.toUnicode()</span>
            <span class="s2">except </span><span class="s1">UnicodeDecodeError:</span>
                <span class="s2">continue</span>

            <span class="s1">someName = unistr</span>
            <span class="s2">if </span><span class="s1">(name.platformID</span><span class="s2">, </span><span class="s1">name.langID) </span><span class="s2">in </span><span class="s1">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0x409</span><span class="s1">)):</span>
                <span class="s1">englishName = unistr</span>
                <span class="s2">break</span>
        <span class="s2">if </span><span class="s1">englishName:</span>
            <span class="s2">return </span><span class="s1">englishName</span>
        <span class="s2">elif </span><span class="s1">someName:</span>
            <span class="s2">return </span><span class="s1">someName</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return None</span>

    <span class="s2">def </span><span class="s1">getFirstDebugName(self</span><span class="s2">, </span><span class="s1">nameIDs):</span>
        <span class="s2">for </span><span class="s1">nameID </span><span class="s2">in </span><span class="s1">nameIDs:</span>
            <span class="s1">name = self.getDebugName(nameID)</span>
            <span class="s2">if </span><span class="s1">name </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s2">return </span><span class="s1">name</span>
        <span class="s2">return None</span>

    <span class="s2">def </span><span class="s1">getBestFamilyName(self):</span>
        <span class="s0"># 21 = WWS Family Name</span>
        <span class="s0"># 16 = Typographic Family Name</span>
        <span class="s0"># 1 = Family Name</span>
        <span class="s2">return </span><span class="s1">self.getFirstDebugName((</span><span class="s5">21</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">1</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">getBestSubFamilyName(self):</span>
        <span class="s0"># 22 = WWS SubFamily Name</span>
        <span class="s0"># 17 = Typographic SubFamily Name</span>
        <span class="s0"># 2 = SubFamily Name</span>
        <span class="s2">return </span><span class="s1">self.getFirstDebugName((</span><span class="s5">22</span><span class="s2">, </span><span class="s5">17</span><span class="s2">, </span><span class="s5">2</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">getBestFullName(self):</span>
        <span class="s0"># 4 = Full Name</span>
        <span class="s0"># 6 = PostScript Name</span>
        <span class="s2">for </span><span class="s1">nameIDs </span><span class="s2">in </span><span class="s1">((</span><span class="s5">21</span><span class="s2">, </span><span class="s5">22</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">16</span><span class="s2">, </span><span class="s5">17</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">4</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">6</span><span class="s2">,</span><span class="s1">)):</span>
            <span class="s2">if </span><span class="s1">len(nameIDs) == </span><span class="s5">2</span><span class="s1">:</span>
                <span class="s1">name_fam = self.getDebugName(nameIDs[</span><span class="s5">0</span><span class="s1">])</span>
                <span class="s1">name_subfam = self.getDebugName(nameIDs[</span><span class="s5">1</span><span class="s1">])</span>
                <span class="s2">if None in </span><span class="s1">[name_fam</span><span class="s2">, </span><span class="s1">name_subfam]:</span>
                    <span class="s2">continue  </span><span class="s0"># if any is None, skip</span>
                <span class="s1">name = </span><span class="s3">f&quot;</span><span class="s2">{</span><span class="s1">name_fam</span><span class="s2">} {</span><span class="s1">name_subfam</span><span class="s2">}</span><span class="s3">&quot;</span>
                <span class="s2">if </span><span class="s1">name_subfam.lower() == </span><span class="s3">&quot;regular&quot;</span><span class="s1">:</span>
                    <span class="s1">name = </span><span class="s3">f&quot;</span><span class="s2">{</span><span class="s1">name_fam</span><span class="s2">}</span><span class="s3">&quot;</span>
                <span class="s2">return </span><span class="s1">name</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">name = self.getDebugName(nameIDs[</span><span class="s5">0</span><span class="s1">])</span>
                <span class="s2">if </span><span class="s1">name </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s2">return </span><span class="s1">name</span>
        <span class="s2">return None</span>

    <span class="s2">def </span><span class="s1">setName(self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID):</span>
        <span class="s6">&quot;&quot;&quot;Set the 'string' for the name record identified by 'nameID', 'platformID', 
        'platEncID' and 'langID'. If a record with that nameID doesn't exist, create it 
        and append to the name table. 
 
        'string' can be of type `str` (`unicode` in PY2) or `bytes`. In the latter case, 
        it is assumed to be already encoded with the correct plaform-specific encoding 
        identified by the (platformID, platEncID, langID) triplet. A warning is issued 
        to prevent unexpected results. 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s1">):</span>
            <span class="s1">self.names = []</span>
        <span class="s2">if not </span><span class="s1">isinstance(string</span><span class="s2">, </span><span class="s1">str):</span>
            <span class="s2">if </span><span class="s1">isinstance(string</span><span class="s2">, </span><span class="s1">bytes):</span>
                <span class="s1">log.warning(</span>
                    <span class="s3">&quot;name string is bytes, ensure it's correctly encoded: %r&quot;</span><span class="s2">, </span><span class="s1">string</span>
                <span class="s1">)</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">TypeError(</span>
                    <span class="s3">&quot;expected unicode or bytes, found %s: %r&quot;</span>
                    <span class="s1">% (type(string).__name__</span><span class="s2">, </span><span class="s1">string)</span>
                <span class="s1">)</span>
        <span class="s1">namerecord = self.getName(nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID)</span>
        <span class="s2">if </span><span class="s1">namerecord:</span>
            <span class="s1">namerecord.string = string</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.names.append(makeName(string</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID))</span>

    <span class="s2">def </span><span class="s1">removeNames(self</span><span class="s2">, </span><span class="s1">nameID=</span><span class="s2">None, </span><span class="s1">platformID=</span><span class="s2">None, </span><span class="s1">platEncID=</span><span class="s2">None, </span><span class="s1">langID=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Remove any name records identified by the given combination of 'nameID', 
        'platformID', 'platEncID' and 'langID'. 
        &quot;&quot;&quot;</span>
        <span class="s1">args = {</span>
            <span class="s1">argName: argValue</span>
            <span class="s2">for </span><span class="s1">argName</span><span class="s2">, </span><span class="s1">argValue </span><span class="s2">in </span><span class="s1">(</span>
                <span class="s1">(</span><span class="s3">&quot;nameID&quot;</span><span class="s2">, </span><span class="s1">nameID)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s3">&quot;platformID&quot;</span><span class="s2">, </span><span class="s1">platformID)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s3">&quot;platEncID&quot;</span><span class="s2">, </span><span class="s1">platEncID)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s3">&quot;langID&quot;</span><span class="s2">, </span><span class="s1">langID)</span><span class="s2">,</span>
            <span class="s1">)</span>
            <span class="s2">if </span><span class="s1">argValue </span><span class="s2">is not None</span>
        <span class="s1">}</span>
        <span class="s2">if not </span><span class="s1">args:</span>
            <span class="s0"># no arguments, nothing to do</span>
            <span class="s2">return</span>
        <span class="s1">self.names = [</span>
            <span class="s1">rec</span>
            <span class="s2">for </span><span class="s1">rec </span><span class="s2">in </span><span class="s1">self.names</span>
            <span class="s2">if </span><span class="s1">any(</span>
                <span class="s1">argValue != getattr(rec</span><span class="s2">, </span><span class="s1">argName) </span><span class="s2">for </span><span class="s1">argName</span><span class="s2">, </span><span class="s1">argValue </span><span class="s2">in </span><span class="s1">args.items()</span>
            <span class="s1">)</span>
        <span class="s1">]</span>

    <span class="s1">@staticmethod</span>
    <span class="s2">def </span><span class="s1">removeUnusedNames(ttFont):</span>
        <span class="s6">&quot;&quot;&quot;Remove any name records which are not in NameID range 0-255 and not utilized 
        within the font itself.&quot;&quot;&quot;</span>
        <span class="s1">visitor = NameRecordVisitor()</span>
        <span class="s1">visitor.visit(ttFont)</span>
        <span class="s1">toDelete = set()</span>
        <span class="s2">for </span><span class="s1">record </span><span class="s2">in </span><span class="s1">ttFont[</span><span class="s3">&quot;name&quot;</span><span class="s1">].names:</span>
            <span class="s0"># Name IDs 26 to 255, inclusive, are reserved for future standard names.</span>
            <span class="s0"># https://learn.microsoft.com/en-us/typography/opentype/spec/name#name-ids</span>
            <span class="s2">if </span><span class="s1">record.nameID &lt; </span><span class="s5">256</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s2">if </span><span class="s1">record.nameID </span><span class="s2">not in </span><span class="s1">visitor.seen:</span>
                <span class="s1">toDelete.add(record.nameID)</span>

        <span class="s2">for </span><span class="s1">nameID </span><span class="s2">in </span><span class="s1">toDelete:</span>
            <span class="s1">ttFont[</span><span class="s3">&quot;name&quot;</span><span class="s1">].removeNames(nameID)</span>
        <span class="s2">return </span><span class="s1">toDelete</span>

    <span class="s2">def </span><span class="s1">_findUnusedNameID(self</span><span class="s2">, </span><span class="s1">minNameID=</span><span class="s5">256</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Finds an unused name id. 
 
        The nameID is assigned in the range between 'minNameID' and 32767 (inclusive), 
        following the last nameID in the name table. 
        &quot;&quot;&quot;</span>
        <span class="s1">names = getattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s1">nameID = </span><span class="s5">1 </span><span class="s1">+ max([n.nameID </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">names] + [minNameID - </span><span class="s5">1</span><span class="s1">])</span>
        <span class="s2">if </span><span class="s1">nameID &gt; </span><span class="s5">32767</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;nameID must be less than 32768&quot;</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">nameID</span>

    <span class="s2">def </span><span class="s1">findMultilingualName(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">names</span><span class="s2">, </span><span class="s1">windows=</span><span class="s2">True, </span><span class="s1">mac=</span><span class="s2">True, </span><span class="s1">minNameID=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ttFont=</span><span class="s2">None</span>
    <span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Return the name ID of an existing multilingual name that 
        matches the 'names' dictionary, or None if not found. 
 
        'names' is a dictionary with the name in multiple languages, 
        such as {'en': 'Pale', 'de': 'Blaß', 'de-CH': 'Blass'}. 
        The keys can be arbitrary IETF BCP 47 language codes; 
        the values are Unicode strings. 
 
        If 'windows' is True, the returned name ID is guaranteed 
        exist for all requested languages for platformID=3 and 
        platEncID=1. 
        If 'mac' is True, the returned name ID is guaranteed to exist 
        for all requested languages for platformID=1 and platEncID=0. 
 
        The returned name ID will not be less than the 'minNameID' 
        argument. 
        &quot;&quot;&quot;</span>
        <span class="s0"># Gather the set of requested</span>
        <span class="s0">#   (string, platformID, platEncID, langID)</span>
        <span class="s0"># tuples</span>
        <span class="s1">reqNameSet = set()</span>
        <span class="s2">for </span><span class="s1">lang</span><span class="s2">, </span><span class="s1">name </span><span class="s2">in </span><span class="s1">sorted(names.items()):</span>
            <span class="s2">if </span><span class="s1">windows:</span>
                <span class="s1">windowsName = _makeWindowsName(name</span><span class="s2">, None, </span><span class="s1">lang)</span>
                <span class="s2">if </span><span class="s1">windowsName </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">reqNameSet.add(</span>
                        <span class="s1">(</span>
                            <span class="s1">windowsName.string</span><span class="s2">,</span>
                            <span class="s1">windowsName.platformID</span><span class="s2">,</span>
                            <span class="s1">windowsName.platEncID</span><span class="s2">,</span>
                            <span class="s1">windowsName.langID</span><span class="s2">,</span>
                        <span class="s1">)</span>
                    <span class="s1">)</span>
            <span class="s2">if </span><span class="s1">mac:</span>
                <span class="s1">macName = _makeMacName(name</span><span class="s2">, None, </span><span class="s1">lang</span><span class="s2">, </span><span class="s1">ttFont)</span>
                <span class="s2">if </span><span class="s1">macName </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">reqNameSet.add(</span>
                        <span class="s1">(</span>
                            <span class="s1">macName.string</span><span class="s2">,</span>
                            <span class="s1">macName.platformID</span><span class="s2">,</span>
                            <span class="s1">macName.platEncID</span><span class="s2">,</span>
                            <span class="s1">macName.langID</span><span class="s2">,</span>
                        <span class="s1">)</span>
                    <span class="s1">)</span>

        <span class="s0"># Collect matching name IDs</span>
        <span class="s1">matchingNames = dict()</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">self.names:</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">key = (name.toUnicode()</span><span class="s2">, </span><span class="s1">name.platformID</span><span class="s2">, </span><span class="s1">name.platEncID</span><span class="s2">, </span><span class="s1">name.langID)</span>
            <span class="s2">except </span><span class="s1">UnicodeDecodeError:</span>
                <span class="s2">continue</span>
            <span class="s2">if </span><span class="s1">key </span><span class="s2">in </span><span class="s1">reqNameSet </span><span class="s2">and </span><span class="s1">name.nameID &gt;= minNameID:</span>
                <span class="s1">nameSet = matchingNames.setdefault(name.nameID</span><span class="s2">, </span><span class="s1">set())</span>
                <span class="s1">nameSet.add(key)</span>

        <span class="s0"># Return the first name ID that defines all requested strings</span>
        <span class="s2">for </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">nameSet </span><span class="s2">in </span><span class="s1">sorted(matchingNames.items()):</span>
            <span class="s2">if </span><span class="s1">nameSet == reqNameSet:</span>
                <span class="s2">return </span><span class="s1">nameID</span>

        <span class="s2">return None  </span><span class="s0"># not found</span>

    <span class="s2">def </span><span class="s1">addMultilingualName(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">names</span><span class="s2">, </span><span class="s1">ttFont=</span><span class="s2">None, </span><span class="s1">nameID=</span><span class="s2">None, </span><span class="s1">windows=</span><span class="s2">True, </span><span class="s1">mac=</span><span class="s2">True, </span><span class="s1">minNameID=</span><span class="s5">0</span>
    <span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Add a multilingual name, returning its name ID 
 
        'names' is a dictionary with the name in multiple languages, 
        such as {'en': 'Pale', 'de': 'Blaß', 'de-CH': 'Blass'}. 
        The keys can be arbitrary IETF BCP 47 language codes; 
        the values are Unicode strings. 
 
        'ttFont' is the TTFont to which the names are added, or None. 
        If present, the font's 'ltag' table can get populated 
        to store exotic language codes, which allows encoding 
        names that otherwise cannot get encoded at all. 
 
        'nameID' is the name ID to be used, or None to let the library 
        find an existing set of name records that match, or pick an 
        unused name ID. 
 
        If 'windows' is True, a platformID=3 name record will be added. 
        If 'mac' is True, a platformID=1 name record will be added. 
 
        If the 'nameID' argument is None, the created nameID will not 
        be less than the 'minNameID' argument. 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s1">):</span>
            <span class="s1">self.names = []</span>
        <span class="s2">if </span><span class="s1">nameID </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s0"># Reuse nameID if possible</span>
            <span class="s1">nameID = self.findMultilingualName(</span>
                <span class="s1">names</span><span class="s2">, </span><span class="s1">windows=windows</span><span class="s2">, </span><span class="s1">mac=mac</span><span class="s2">, </span><span class="s1">minNameID=minNameID</span><span class="s2">, </span><span class="s1">ttFont=ttFont</span>
            <span class="s1">)</span>
            <span class="s2">if </span><span class="s1">nameID </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s2">return </span><span class="s1">nameID</span>
            <span class="s1">nameID = self._findUnusedNameID()</span>
        <span class="s0"># TODO: Should minimize BCP 47 language codes.</span>
        <span class="s0"># https://github.com/fonttools/fonttools/issues/930</span>
        <span class="s2">for </span><span class="s1">lang</span><span class="s2">, </span><span class="s1">name </span><span class="s2">in </span><span class="s1">sorted(names.items()):</span>
            <span class="s2">if </span><span class="s1">windows:</span>
                <span class="s1">windowsName = _makeWindowsName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">lang)</span>
                <span class="s2">if </span><span class="s1">windowsName </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">self.names.append(windowsName)</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s0"># We cannot not make a Windows name: make sure we add a</span>
                    <span class="s0"># Mac name as a fallback. This can happen for exotic</span>
                    <span class="s0"># BCP47 language tags that have no Windows language code.</span>
                    <span class="s1">mac = </span><span class="s2">True</span>
            <span class="s2">if </span><span class="s1">mac:</span>
                <span class="s1">macName = _makeMacName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">lang</span><span class="s2">, </span><span class="s1">ttFont)</span>
                <span class="s2">if </span><span class="s1">macName </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">self.names.append(macName)</span>
        <span class="s2">return </span><span class="s1">nameID</span>

    <span class="s2">def </span><span class="s1">addName(self</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">platforms=((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0x409</span><span class="s1">))</span><span class="s2">, </span><span class="s1">minNameID=</span><span class="s5">255</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Add a new name record containing 'string' for each (platformID, platEncID, 
        langID) tuple specified in the 'platforms' list. 
 
        The nameID is assigned in the range between 'minNameID'+1 and 32767 (inclusive), 
        following the last nameID in the name table. 
        If no 'platforms' are specified, two English name records are added, one for the 
        Macintosh (platformID=0), and one for the Windows platform (3). 
 
        The 'string' must be a Unicode string, so it can be encoded with different, 
        platform-specific encodings. 
 
        Return the new nameID. 
        &quot;&quot;&quot;</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">len(platforms) &gt; </span><span class="s5">0</span>
        <span class="s1">)</span><span class="s2">, </span><span class="s3">&quot;'platforms' must contain at least one (platformID, platEncID, langID) tuple&quot;</span>
        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;names&quot;</span><span class="s1">):</span>
            <span class="s1">self.names = []</span>
        <span class="s2">if not </span><span class="s1">isinstance(string</span><span class="s2">, </span><span class="s1">str):</span>
            <span class="s2">raise </span><span class="s1">TypeError(</span>
                <span class="s3">&quot;expected str, found %s: %r&quot; </span><span class="s1">% (type(string).__name__</span><span class="s2">, </span><span class="s1">string)</span>
            <span class="s1">)</span>
        <span class="s1">nameID = self._findUnusedNameID(minNameID + </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID </span><span class="s2">in </span><span class="s1">platforms:</span>
            <span class="s1">self.names.append(makeName(string</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID))</span>
        <span class="s2">return </span><span class="s1">nameID</span>


<span class="s2">def </span><span class="s1">makeName(string</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">platformID</span><span class="s2">, </span><span class="s1">platEncID</span><span class="s2">, </span><span class="s1">langID):</span>
    <span class="s1">name = NameRecord()</span>
    <span class="s1">name.string</span><span class="s2">, </span><span class="s1">name.nameID</span><span class="s2">, </span><span class="s1">name.platformID</span><span class="s2">, </span><span class="s1">name.platEncID</span><span class="s2">, </span><span class="s1">name.langID = (</span>
        <span class="s1">string</span><span class="s2">,</span>
        <span class="s1">nameID</span><span class="s2">,</span>
        <span class="s1">platformID</span><span class="s2">,</span>
        <span class="s1">platEncID</span><span class="s2">,</span>
        <span class="s1">langID</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">return </span><span class="s1">name</span>


<span class="s2">def </span><span class="s1">_makeWindowsName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">language):</span>
    <span class="s6">&quot;&quot;&quot;Create a NameRecord for the Microsoft Windows platform 
 
    'language' is an arbitrary IETF BCP 47 language identifier such 
    as 'en', 'de-CH', 'de-AT-1901', or 'fa-Latn'. If Microsoft Windows 
    does not support the desired language, the result will be None. 
    Future versions of fonttools might return a NameRecord for the 
    OpenType 'name' table format 1, but this is not implemented yet. 
    &quot;&quot;&quot;</span>
    <span class="s1">langID = _WINDOWS_LANGUAGE_CODES.get(language.lower())</span>
    <span class="s2">if </span><span class="s1">langID </span><span class="s2">is not None</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">makeName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">langID)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">log.warning(</span>
            <span class="s3">&quot;cannot add Windows name in language %s &quot;</span>
            <span class="s3">&quot;because fonttools does not yet support &quot;</span>
            <span class="s3">&quot;name table format 1&quot; </span><span class="s1">% language</span>
        <span class="s1">)</span>
        <span class="s2">return None</span>


<span class="s2">def </span><span class="s1">_makeMacName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s1">language</span><span class="s2">, </span><span class="s1">font=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s6">&quot;&quot;&quot;Create a NameRecord for Apple platforms 
 
    'language' is an arbitrary IETF BCP 47 language identifier such 
    as 'en', 'de-CH', 'de-AT-1901', or 'fa-Latn'. When possible, we 
    create a Macintosh NameRecord that is understood by old applications 
    (platform ID 1 and an old-style Macintosh language enum). If this 
    is not possible, we create a Unicode NameRecord (platform ID 0) 
    whose language points to the font’s 'ltag' table. The latter 
    can encode any string in any language, but legacy applications 
    might not recognize the format (in which case they will ignore 
    those names). 
 
    'font' should be the TTFont for which you want to create a name. 
    If 'font' is None, we only return NameRecords for legacy Macintosh; 
    in that case, the result will be None for names that need to 
    be encoded with an 'ltag' table. 
 
    See the section “The language identifier” in Apple’s specification: 
    https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6name.html 
    &quot;&quot;&quot;</span>
    <span class="s1">macLang = _MAC_LANGUAGE_CODES.get(language.lower())</span>
    <span class="s1">macScript = _MAC_LANGUAGE_TO_SCRIPT.get(macLang)</span>
    <span class="s2">if </span><span class="s1">macLang </span><span class="s2">is not None and </span><span class="s1">macScript </span><span class="s2">is not None</span><span class="s1">:</span>
        <span class="s1">encoding = getEncoding(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">macScript</span><span class="s2">, </span><span class="s1">macLang</span><span class="s2">, </span><span class="s1">default=</span><span class="s3">&quot;ascii&quot;</span><span class="s1">)</span>
        <span class="s0"># Check if we can actually encode this name. If we can't,</span>
        <span class="s0"># for example because we have no support for the legacy</span>
        <span class="s0"># encoding, or because the name string contains Unicode</span>
        <span class="s0"># characters that the legacy encoding cannot represent,</span>
        <span class="s0"># we fall back to encoding the name in Unicode and put</span>
        <span class="s0"># the language tag into the ltag table.</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">_ = tobytes(name</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">, </span><span class="s1">errors=</span><span class="s3">&quot;strict&quot;</span><span class="s1">)</span>
            <span class="s2">return </span><span class="s1">makeName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">macScript</span><span class="s2">, </span><span class="s1">macLang)</span>
        <span class="s2">except </span><span class="s1">UnicodeEncodeError:</span>
            <span class="s2">pass</span>
    <span class="s2">if </span><span class="s1">font </span><span class="s2">is not None</span><span class="s1">:</span>
        <span class="s1">ltag = font.tables.get(</span><span class="s3">&quot;ltag&quot;</span><span class="s1">)</span>
        <span class="s2">if </span><span class="s1">ltag </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">ltag = font[</span><span class="s3">&quot;ltag&quot;</span><span class="s1">] = newTable(</span><span class="s3">&quot;ltag&quot;</span><span class="s1">)</span>
        <span class="s0"># 0 = Unicode; 4 = “Unicode 2.0 or later semantics (non-BMP characters allowed)”</span>
        <span class="s0"># “The preferred platform-specific code for Unicode would be 3 or 4.”</span>
        <span class="s0"># https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6name.html</span>
        <span class="s2">return </span><span class="s1">makeName(name</span><span class="s2">, </span><span class="s1">nameID</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">ltag.addTag(language))</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">log.warning(</span>
            <span class="s3">&quot;cannot store language %s into 'ltag' table &quot;</span>
            <span class="s3">&quot;without having access to the TTFont object&quot; </span><span class="s1">% language</span>
        <span class="s1">)</span>
        <span class="s2">return None</span>


<span class="s2">class </span><span class="s1">NameRecord(object):</span>
    <span class="s2">def </span><span class="s1">getEncoding(self</span><span class="s2">, </span><span class="s1">default=</span><span class="s3">&quot;ascii&quot;</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;Returns the Python encoding name for this name entry based on its platformID, 
        platEncID, and langID.  If encoding for these values is not known, by default 
        'ascii' is returned.  That can be overriden by passing a value to the default 
        argument. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">getEncoding(self.platformID</span><span class="s2">, </span><span class="s1">self.platEncID</span><span class="s2">, </span><span class="s1">self.langID</span><span class="s2">, </span><span class="s1">default)</span>

    <span class="s2">def </span><span class="s1">encodingIsUnicodeCompatible(self):</span>
        <span class="s2">return </span><span class="s1">self.getEncoding(</span><span class="s2">None</span><span class="s1">) </span><span class="s2">in </span><span class="s1">[</span><span class="s3">&quot;utf_16_be&quot;</span><span class="s2">, </span><span class="s3">&quot;ucs2be&quot;</span><span class="s2">, </span><span class="s3">&quot;ascii&quot;</span><span class="s2">, </span><span class="s3">&quot;latin1&quot;</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">__str__(self):</span>
        <span class="s2">return </span><span class="s1">self.toStr(errors=</span><span class="s3">&quot;backslashreplace&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">isUnicode(self):</span>
        <span class="s2">return </span><span class="s1">self.platformID == </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">(</span>
            <span class="s1">self.platformID == </span><span class="s5">3 </span><span class="s2">and </span><span class="s1">self.platEncID </span><span class="s2">in </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s1">]</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">toUnicode(self</span><span class="s2">, </span><span class="s1">errors=</span><span class="s3">&quot;strict&quot;</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot; 
        If self.string is a Unicode string, return it; otherwise try decoding the 
        bytes in self.string to a Unicode string using the encoding of this 
        entry as returned by self.getEncoding(); Note that  self.getEncoding() 
        returns 'ascii' if the encoding is unknown to the library. 
 
        Certain heuristics are performed to recover data from bytes that are 
        ill-formed in the chosen encoding, or that otherwise look misencoded 
        (mostly around bad UTF-16BE encoded bytes, or bytes that look like UTF-16BE 
        but marked otherwise).  If the bytes are ill-formed and the heuristics fail, 
        the error is handled according to the errors parameter to this function, which is 
        passed to the underlying decode() function; by default it throws a 
        UnicodeDecodeError exception. 
 
        Note: The mentioned heuristics mean that roundtripping a font to XML and back 
        to binary might recover some misencoded data whereas just loading the font 
        and saving it back will not change them. 
        &quot;&quot;&quot;</span>

        <span class="s2">def </span><span class="s1">isascii(b):</span>
            <span class="s2">return </span><span class="s1">(b &gt;= </span><span class="s5">0x20 </span><span class="s2">and </span><span class="s1">b &lt;= </span><span class="s5">0x7E</span><span class="s1">) </span><span class="s2">or </span><span class="s1">b </span><span class="s2">in </span><span class="s1">[</span><span class="s5">0x09</span><span class="s2">, </span><span class="s5">0x0A</span><span class="s2">, </span><span class="s5">0x0D</span><span class="s1">]</span>

        <span class="s1">encoding = self.getEncoding()</span>
        <span class="s1">string = self.string</span>

        <span class="s2">if </span><span class="s1">(</span>
            <span class="s1">isinstance(string</span><span class="s2">, </span><span class="s1">bytes)</span>
            <span class="s2">and </span><span class="s1">encoding == </span><span class="s3">&quot;utf_16_be&quot;</span>
            <span class="s2">and </span><span class="s1">len(string) % </span><span class="s5">2 </span><span class="s1">== </span><span class="s5">1</span>
        <span class="s1">):</span>
            <span class="s0"># Recover badly encoded UTF-16 strings that have an odd number of bytes:</span>
            <span class="s0"># - If the last byte is zero, drop it.  Otherwise,</span>
            <span class="s0"># - If all the odd bytes are zero and all the even bytes are ASCII,</span>
            <span class="s0">#   prepend one zero byte.  Otherwise,</span>
            <span class="s0"># - If first byte is zero and all other bytes are ASCII, insert zero</span>
            <span class="s0">#   bytes between consecutive ASCII bytes.</span>
            <span class="s0">#</span>
            <span class="s0"># (Yes, I've seen all of these in the wild... sigh)</span>
            <span class="s2">if </span><span class="s1">byteord(string[-</span><span class="s5">1</span><span class="s1">]) == </span><span class="s5">0</span><span class="s1">:</span>
                <span class="s1">string = string[:-</span><span class="s5">1</span><span class="s1">]</span>
            <span class="s2">elif </span><span class="s1">all(</span>
                <span class="s1">byteord(b) == </span><span class="s5">0 </span><span class="s2">if </span><span class="s1">i % </span><span class="s5">2 </span><span class="s2">else </span><span class="s1">isascii(byteord(b))</span>
                <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">b </span><span class="s2">in </span><span class="s1">enumerate(string)</span>
            <span class="s1">):</span>
                <span class="s1">string = </span><span class="s4">b&quot;</span><span class="s2">\0</span><span class="s4">&quot; </span><span class="s1">+ string</span>
            <span class="s2">elif </span><span class="s1">byteord(string[</span><span class="s5">0</span><span class="s1">]) == </span><span class="s5">0 </span><span class="s2">and </span><span class="s1">all(</span>
                <span class="s1">isascii(byteord(b)) </span><span class="s2">for </span><span class="s1">b </span><span class="s2">in </span><span class="s1">string[</span><span class="s5">1</span><span class="s1">:]</span>
            <span class="s1">):</span>
                <span class="s1">string = bytesjoin(</span><span class="s4">b&quot;</span><span class="s2">\0</span><span class="s4">&quot; </span><span class="s1">+ bytechr(byteord(b)) </span><span class="s2">for </span><span class="s1">b </span><span class="s2">in </span><span class="s1">string[</span><span class="s5">1</span><span class="s1">:])</span>

        <span class="s1">string = tostr(string</span><span class="s2">, </span><span class="s1">encoding=encoding</span><span class="s2">, </span><span class="s1">errors=errors)</span>

        <span class="s0"># If decoded strings still looks like UTF-16BE, it suggests a double-encoding.</span>
        <span class="s0"># Fix it up.</span>
        <span class="s2">if </span><span class="s1">all(</span>
            <span class="s1">ord(c) == </span><span class="s5">0 </span><span class="s2">if </span><span class="s1">i % </span><span class="s5">2 </span><span class="s1">== </span><span class="s5">0 </span><span class="s2">else </span><span class="s1">isascii(ord(c)) </span><span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">c </span><span class="s2">in </span><span class="s1">enumerate(string)</span>
        <span class="s1">):</span>
            <span class="s0"># If string claims to be Mac encoding, but looks like UTF-16BE with ASCII text,</span>
            <span class="s0"># narrow it down.</span>
            <span class="s1">string = </span><span class="s3">&quot;&quot;</span><span class="s1">.join(c </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">string[</span><span class="s5">1</span><span class="s1">::</span><span class="s5">2</span><span class="s1">])</span>

        <span class="s2">return </span><span class="s1">string</span>

    <span class="s2">def </span><span class="s1">toBytes(self</span><span class="s2">, </span><span class="s1">errors=</span><span class="s3">&quot;strict&quot;</span><span class="s1">):</span>
        <span class="s6">&quot;&quot;&quot;If self.string is a bytes object, return it; otherwise try encoding 
        the Unicode string in self.string to bytes using the encoding of this 
        entry as returned by self.getEncoding(); Note that self.getEncoding() 
        returns 'ascii' if the encoding is unknown to the library. 
 
        If the Unicode string cannot be encoded to bytes in the chosen encoding, 
        the error is handled according to the errors parameter to this function, 
        which is passed to the underlying encode() function; by default it throws a 
        UnicodeEncodeError exception. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">tobytes(self.string</span><span class="s2">, </span><span class="s1">encoding=self.getEncoding()</span><span class="s2">, </span><span class="s1">errors=errors)</span>

    <span class="s1">toStr = toUnicode</span>

    <span class="s2">def </span><span class="s1">toXML(self</span><span class="s2">, </span><span class="s1">writer</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">unistr = self.toUnicode()</span>
        <span class="s2">except </span><span class="s1">UnicodeDecodeError:</span>
            <span class="s1">unistr = </span><span class="s2">None</span>
        <span class="s1">attrs = [</span>
            <span class="s1">(</span><span class="s3">&quot;nameID&quot;</span><span class="s2">, </span><span class="s1">self.nameID)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">&quot;platformID&quot;</span><span class="s2">, </span><span class="s1">self.platformID)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">&quot;platEncID&quot;</span><span class="s2">, </span><span class="s1">self.platEncID)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">&quot;langID&quot;</span><span class="s2">, </span><span class="s1">hex(self.langID))</span><span class="s2">,</span>
        <span class="s1">]</span>

        <span class="s2">if </span><span class="s1">unistr </span><span class="s2">is None or not </span><span class="s1">self.encodingIsUnicodeCompatible():</span>
            <span class="s1">attrs.append((</span><span class="s3">&quot;unicode&quot;</span><span class="s2">, </span><span class="s1">unistr </span><span class="s2">is not None</span><span class="s1">))</span>

        <span class="s1">writer.begintag(</span><span class="s3">&quot;namerecord&quot;</span><span class="s2">, </span><span class="s1">attrs)</span>
        <span class="s1">writer.newline()</span>
        <span class="s2">if </span><span class="s1">unistr </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s1">writer.write(unistr)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">writer.write8bit(self.string)</span>
        <span class="s1">writer.newline()</span>
        <span class="s1">writer.endtag(</span><span class="s3">&quot;namerecord&quot;</span><span class="s1">)</span>
        <span class="s1">writer.newline()</span>

    <span class="s2">def </span><span class="s1">fromXML(self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">attrs</span><span class="s2">, </span><span class="s1">content</span><span class="s2">, </span><span class="s1">ttFont):</span>
        <span class="s1">self.nameID = safeEval(attrs[</span><span class="s3">&quot;nameID&quot;</span><span class="s1">])</span>
        <span class="s1">self.platformID = safeEval(attrs[</span><span class="s3">&quot;platformID&quot;</span><span class="s1">])</span>
        <span class="s1">self.platEncID = safeEval(attrs[</span><span class="s3">&quot;platEncID&quot;</span><span class="s1">])</span>
        <span class="s1">self.langID = safeEval(attrs[</span><span class="s3">&quot;langID&quot;</span><span class="s1">])</span>
        <span class="s1">s = strjoin(content).strip()</span>
        <span class="s1">encoding = self.getEncoding()</span>
        <span class="s2">if </span><span class="s1">self.encodingIsUnicodeCompatible() </span><span class="s2">or </span><span class="s1">safeEval(</span>
            <span class="s1">attrs.get(</span><span class="s3">&quot;unicode&quot;</span><span class="s2">, </span><span class="s3">&quot;False&quot;</span><span class="s1">)</span>
        <span class="s1">):</span>
            <span class="s1">self.string = s.encode(encoding)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s0"># This is the inverse of write8bit...</span>
            <span class="s1">self.string = s.encode(</span><span class="s3">&quot;latin1&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">__lt__(self</span><span class="s2">, </span><span class="s1">other):</span>
        <span class="s2">if </span><span class="s1">type(self) != type(other):</span>
            <span class="s2">return </span><span class="s1">NotImplemented</span>

        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">selfTuple = (</span>
                <span class="s1">self.platformID</span><span class="s2">,</span>
                <span class="s1">self.platEncID</span><span class="s2">,</span>
                <span class="s1">self.langID</span><span class="s2">,</span>
                <span class="s1">self.nameID</span><span class="s2">,</span>
            <span class="s1">)</span>
            <span class="s1">otherTuple = (</span>
                <span class="s1">other.platformID</span><span class="s2">,</span>
                <span class="s1">other.platEncID</span><span class="s2">,</span>
                <span class="s1">other.langID</span><span class="s2">,</span>
                <span class="s1">other.nameID</span><span class="s2">,</span>
            <span class="s1">)</span>
        <span class="s2">except </span><span class="s1">AttributeError:</span>
            <span class="s0"># This can only happen for</span>
            <span class="s0"># 1) an object that is not a NameRecord, or</span>
            <span class="s0"># 2) an unlikely incomplete NameRecord object which has not been</span>
            <span class="s0">#    fully populated</span>
            <span class="s2">return </span><span class="s1">NotImplemented</span>

        <span class="s2">try</span><span class="s1">:</span>
            <span class="s0"># Include the actual NameRecord string in the comparison tuples</span>
            <span class="s1">selfTuple = selfTuple + (self.toBytes()</span><span class="s2">,</span><span class="s1">)</span>
            <span class="s1">otherTuple = otherTuple + (other.toBytes()</span><span class="s2">,</span><span class="s1">)</span>
        <span class="s2">except </span><span class="s1">UnicodeEncodeError </span><span class="s2">as </span><span class="s1">e:</span>
            <span class="s0"># toBytes caused an encoding error in either of the two, so content</span>
            <span class="s0"># to sorting based on IDs only</span>
            <span class="s1">log.error(</span><span class="s3">&quot;NameRecord sorting failed to encode: %s&quot; </span><span class="s1">% e)</span>

        <span class="s0"># Implemented so that list.sort() sorts according to the spec by using</span>
        <span class="s0"># the order of the tuple items and their comparison</span>
        <span class="s2">return </span><span class="s1">selfTuple &lt; otherTuple</span>

    <span class="s2">def </span><span class="s1">__repr__(self):</span>
        <span class="s2">return </span><span class="s3">&quot;&lt;NameRecord NameID=%d; PlatformID=%d; LanguageID=%d&gt;&quot; </span><span class="s1">% (</span>
            <span class="s1">self.nameID</span><span class="s2">,</span>
            <span class="s1">self.platformID</span><span class="s2">,</span>
            <span class="s1">self.langID</span><span class="s2">,</span>
        <span class="s1">)</span>


<span class="s0"># Windows language ID → IETF BCP-47 language tag</span>
<span class="s0">#</span>
<span class="s0"># While Microsoft indicates a region/country for all its language</span>
<span class="s0"># IDs, we follow Unicode practice by omitting “most likely subtags”</span>
<span class="s0"># as per Unicode CLDR. For example, English is simply “en” and not</span>
<span class="s0"># “en-Latn” because according to Unicode, the default script</span>
<span class="s0"># for English is Latin.</span>
<span class="s0">#</span>
<span class="s0"># http://www.unicode.org/cldr/charts/latest/supplemental/likely_subtags.html</span>
<span class="s0"># http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry</span>
<span class="s1">_WINDOWS_LANGUAGES = {</span>
    <span class="s5">0x0436</span><span class="s1">: </span><span class="s3">&quot;af&quot;</span><span class="s2">,</span>
    <span class="s5">0x041C</span><span class="s1">: </span><span class="s3">&quot;sq&quot;</span><span class="s2">,</span>
    <span class="s5">0x0484</span><span class="s1">: </span><span class="s3">&quot;gsw&quot;</span><span class="s2">,</span>
    <span class="s5">0x045E</span><span class="s1">: </span><span class="s3">&quot;am&quot;</span><span class="s2">,</span>
    <span class="s5">0x1401</span><span class="s1">: </span><span class="s3">&quot;ar-DZ&quot;</span><span class="s2">,</span>
    <span class="s5">0x3C01</span><span class="s1">: </span><span class="s3">&quot;ar-BH&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C01</span><span class="s1">: </span><span class="s3">&quot;ar&quot;</span><span class="s2">,</span>
    <span class="s5">0x0801</span><span class="s1">: </span><span class="s3">&quot;ar-IQ&quot;</span><span class="s2">,</span>
    <span class="s5">0x2C01</span><span class="s1">: </span><span class="s3">&quot;ar-JO&quot;</span><span class="s2">,</span>
    <span class="s5">0x3401</span><span class="s1">: </span><span class="s3">&quot;ar-KW&quot;</span><span class="s2">,</span>
    <span class="s5">0x3001</span><span class="s1">: </span><span class="s3">&quot;ar-LB&quot;</span><span class="s2">,</span>
    <span class="s5">0x1001</span><span class="s1">: </span><span class="s3">&quot;ar-LY&quot;</span><span class="s2">,</span>
    <span class="s5">0x1801</span><span class="s1">: </span><span class="s3">&quot;ary&quot;</span><span class="s2">,</span>
    <span class="s5">0x2001</span><span class="s1">: </span><span class="s3">&quot;ar-OM&quot;</span><span class="s2">,</span>
    <span class="s5">0x4001</span><span class="s1">: </span><span class="s3">&quot;ar-QA&quot;</span><span class="s2">,</span>
    <span class="s5">0x0401</span><span class="s1">: </span><span class="s3">&quot;ar-SA&quot;</span><span class="s2">,</span>
    <span class="s5">0x2801</span><span class="s1">: </span><span class="s3">&quot;ar-SY&quot;</span><span class="s2">,</span>
    <span class="s5">0x1C01</span><span class="s1">: </span><span class="s3">&quot;aeb&quot;</span><span class="s2">,</span>
    <span class="s5">0x3801</span><span class="s1">: </span><span class="s3">&quot;ar-AE&quot;</span><span class="s2">,</span>
    <span class="s5">0x2401</span><span class="s1">: </span><span class="s3">&quot;ar-YE&quot;</span><span class="s2">,</span>
    <span class="s5">0x042B</span><span class="s1">: </span><span class="s3">&quot;hy&quot;</span><span class="s2">,</span>
    <span class="s5">0x044D</span><span class="s1">: </span><span class="s3">&quot;as&quot;</span><span class="s2">,</span>
    <span class="s5">0x082C</span><span class="s1">: </span><span class="s3">&quot;az-Cyrl&quot;</span><span class="s2">,</span>
    <span class="s5">0x042C</span><span class="s1">: </span><span class="s3">&quot;az&quot;</span><span class="s2">,</span>
    <span class="s5">0x046D</span><span class="s1">: </span><span class="s3">&quot;ba&quot;</span><span class="s2">,</span>
    <span class="s5">0x042D</span><span class="s1">: </span><span class="s3">&quot;eu&quot;</span><span class="s2">,</span>
    <span class="s5">0x0423</span><span class="s1">: </span><span class="s3">&quot;be&quot;</span><span class="s2">,</span>
    <span class="s5">0x0845</span><span class="s1">: </span><span class="s3">&quot;bn&quot;</span><span class="s2">,</span>
    <span class="s5">0x0445</span><span class="s1">: </span><span class="s3">&quot;bn-IN&quot;</span><span class="s2">,</span>
    <span class="s5">0x201A</span><span class="s1">: </span><span class="s3">&quot;bs-Cyrl&quot;</span><span class="s2">,</span>
    <span class="s5">0x141A</span><span class="s1">: </span><span class="s3">&quot;bs&quot;</span><span class="s2">,</span>
    <span class="s5">0x047E</span><span class="s1">: </span><span class="s3">&quot;br&quot;</span><span class="s2">,</span>
    <span class="s5">0x0402</span><span class="s1">: </span><span class="s3">&quot;bg&quot;</span><span class="s2">,</span>
    <span class="s5">0x0403</span><span class="s1">: </span><span class="s3">&quot;ca&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C04</span><span class="s1">: </span><span class="s3">&quot;zh-HK&quot;</span><span class="s2">,</span>
    <span class="s5">0x1404</span><span class="s1">: </span><span class="s3">&quot;zh-MO&quot;</span><span class="s2">,</span>
    <span class="s5">0x0804</span><span class="s1">: </span><span class="s3">&quot;zh&quot;</span><span class="s2">,</span>
    <span class="s5">0x1004</span><span class="s1">: </span><span class="s3">&quot;zh-SG&quot;</span><span class="s2">,</span>
    <span class="s5">0x0404</span><span class="s1">: </span><span class="s3">&quot;zh-TW&quot;</span><span class="s2">,</span>
    <span class="s5">0x0483</span><span class="s1">: </span><span class="s3">&quot;co&quot;</span><span class="s2">,</span>
    <span class="s5">0x041A</span><span class="s1">: </span><span class="s3">&quot;hr&quot;</span><span class="s2">,</span>
    <span class="s5">0x101A</span><span class="s1">: </span><span class="s3">&quot;hr-BA&quot;</span><span class="s2">,</span>
    <span class="s5">0x0405</span><span class="s1">: </span><span class="s3">&quot;cs&quot;</span><span class="s2">,</span>
    <span class="s5">0x0406</span><span class="s1">: </span><span class="s3">&quot;da&quot;</span><span class="s2">,</span>
    <span class="s5">0x048C</span><span class="s1">: </span><span class="s3">&quot;prs&quot;</span><span class="s2">,</span>
    <span class="s5">0x0465</span><span class="s1">: </span><span class="s3">&quot;dv&quot;</span><span class="s2">,</span>
    <span class="s5">0x0813</span><span class="s1">: </span><span class="s3">&quot;nl-BE&quot;</span><span class="s2">,</span>
    <span class="s5">0x0413</span><span class="s1">: </span><span class="s3">&quot;nl&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C09</span><span class="s1">: </span><span class="s3">&quot;en-AU&quot;</span><span class="s2">,</span>
    <span class="s5">0x2809</span><span class="s1">: </span><span class="s3">&quot;en-BZ&quot;</span><span class="s2">,</span>
    <span class="s5">0x1009</span><span class="s1">: </span><span class="s3">&quot;en-CA&quot;</span><span class="s2">,</span>
    <span class="s5">0x2409</span><span class="s1">: </span><span class="s3">&quot;en-029&quot;</span><span class="s2">,</span>
    <span class="s5">0x4009</span><span class="s1">: </span><span class="s3">&quot;en-IN&quot;</span><span class="s2">,</span>
    <span class="s5">0x1809</span><span class="s1">: </span><span class="s3">&quot;en-IE&quot;</span><span class="s2">,</span>
    <span class="s5">0x2009</span><span class="s1">: </span><span class="s3">&quot;en-JM&quot;</span><span class="s2">,</span>
    <span class="s5">0x4409</span><span class="s1">: </span><span class="s3">&quot;en-MY&quot;</span><span class="s2">,</span>
    <span class="s5">0x1409</span><span class="s1">: </span><span class="s3">&quot;en-NZ&quot;</span><span class="s2">,</span>
    <span class="s5">0x3409</span><span class="s1">: </span><span class="s3">&quot;en-PH&quot;</span><span class="s2">,</span>
    <span class="s5">0x4809</span><span class="s1">: </span><span class="s3">&quot;en-SG&quot;</span><span class="s2">,</span>
    <span class="s5">0x1C09</span><span class="s1">: </span><span class="s3">&quot;en-ZA&quot;</span><span class="s2">,</span>
    <span class="s5">0x2C09</span><span class="s1">: </span><span class="s3">&quot;en-TT&quot;</span><span class="s2">,</span>
    <span class="s5">0x0809</span><span class="s1">: </span><span class="s3">&quot;en-GB&quot;</span><span class="s2">,</span>
    <span class="s5">0x0409</span><span class="s1">: </span><span class="s3">&quot;en&quot;</span><span class="s2">,</span>
    <span class="s5">0x3009</span><span class="s1">: </span><span class="s3">&quot;en-ZW&quot;</span><span class="s2">,</span>
    <span class="s5">0x0425</span><span class="s1">: </span><span class="s3">&quot;et&quot;</span><span class="s2">,</span>
    <span class="s5">0x0438</span><span class="s1">: </span><span class="s3">&quot;fo&quot;</span><span class="s2">,</span>
    <span class="s5">0x0464</span><span class="s1">: </span><span class="s3">&quot;fil&quot;</span><span class="s2">,</span>
    <span class="s5">0x040B</span><span class="s1">: </span><span class="s3">&quot;fi&quot;</span><span class="s2">,</span>
    <span class="s5">0x080C</span><span class="s1">: </span><span class="s3">&quot;fr-BE&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C0C</span><span class="s1">: </span><span class="s3">&quot;fr-CA&quot;</span><span class="s2">,</span>
    <span class="s5">0x040C</span><span class="s1">: </span><span class="s3">&quot;fr&quot;</span><span class="s2">,</span>
    <span class="s5">0x140C</span><span class="s1">: </span><span class="s3">&quot;fr-LU&quot;</span><span class="s2">,</span>
    <span class="s5">0x180C</span><span class="s1">: </span><span class="s3">&quot;fr-MC&quot;</span><span class="s2">,</span>
    <span class="s5">0x100C</span><span class="s1">: </span><span class="s3">&quot;fr-CH&quot;</span><span class="s2">,</span>
    <span class="s5">0x0462</span><span class="s1">: </span><span class="s3">&quot;fy&quot;</span><span class="s2">,</span>
    <span class="s5">0x0456</span><span class="s1">: </span><span class="s3">&quot;gl&quot;</span><span class="s2">,</span>
    <span class="s5">0x0437</span><span class="s1">: </span><span class="s3">&quot;ka&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C07</span><span class="s1">: </span><span class="s3">&quot;de-AT&quot;</span><span class="s2">,</span>
    <span class="s5">0x0407</span><span class="s1">: </span><span class="s3">&quot;de&quot;</span><span class="s2">,</span>
    <span class="s5">0x1407</span><span class="s1">: </span><span class="s3">&quot;de-LI&quot;</span><span class="s2">,</span>
    <span class="s5">0x1007</span><span class="s1">: </span><span class="s3">&quot;de-LU&quot;</span><span class="s2">,</span>
    <span class="s5">0x0807</span><span class="s1">: </span><span class="s3">&quot;de-CH&quot;</span><span class="s2">,</span>
    <span class="s5">0x0408</span><span class="s1">: </span><span class="s3">&quot;el&quot;</span><span class="s2">,</span>
    <span class="s5">0x046F</span><span class="s1">: </span><span class="s3">&quot;kl&quot;</span><span class="s2">,</span>
    <span class="s5">0x0447</span><span class="s1">: </span><span class="s3">&quot;gu&quot;</span><span class="s2">,</span>
    <span class="s5">0x0468</span><span class="s1">: </span><span class="s3">&quot;ha&quot;</span><span class="s2">,</span>
    <span class="s5">0x040D</span><span class="s1">: </span><span class="s3">&quot;he&quot;</span><span class="s2">,</span>
    <span class="s5">0x0439</span><span class="s1">: </span><span class="s3">&quot;hi&quot;</span><span class="s2">,</span>
    <span class="s5">0x040E</span><span class="s1">: </span><span class="s3">&quot;hu&quot;</span><span class="s2">,</span>
    <span class="s5">0x040F</span><span class="s1">: </span><span class="s3">&quot;is&quot;</span><span class="s2">,</span>
    <span class="s5">0x0470</span><span class="s1">: </span><span class="s3">&quot;ig&quot;</span><span class="s2">,</span>
    <span class="s5">0x0421</span><span class="s1">: </span><span class="s3">&quot;id&quot;</span><span class="s2">,</span>
    <span class="s5">0x045D</span><span class="s1">: </span><span class="s3">&quot;iu&quot;</span><span class="s2">,</span>
    <span class="s5">0x085D</span><span class="s1">: </span><span class="s3">&quot;iu-Latn&quot;</span><span class="s2">,</span>
    <span class="s5">0x083C</span><span class="s1">: </span><span class="s3">&quot;ga&quot;</span><span class="s2">,</span>
    <span class="s5">0x0434</span><span class="s1">: </span><span class="s3">&quot;xh&quot;</span><span class="s2">,</span>
    <span class="s5">0x0435</span><span class="s1">: </span><span class="s3">&quot;zu&quot;</span><span class="s2">,</span>
    <span class="s5">0x0410</span><span class="s1">: </span><span class="s3">&quot;it&quot;</span><span class="s2">,</span>
    <span class="s5">0x0810</span><span class="s1">: </span><span class="s3">&quot;it-CH&quot;</span><span class="s2">,</span>
    <span class="s5">0x0411</span><span class="s1">: </span><span class="s3">&quot;ja&quot;</span><span class="s2">,</span>
    <span class="s5">0x044B</span><span class="s1">: </span><span class="s3">&quot;kn&quot;</span><span class="s2">,</span>
    <span class="s5">0x043F</span><span class="s1">: </span><span class="s3">&quot;kk&quot;</span><span class="s2">,</span>
    <span class="s5">0x0453</span><span class="s1">: </span><span class="s3">&quot;km&quot;</span><span class="s2">,</span>
    <span class="s5">0x0486</span><span class="s1">: </span><span class="s3">&quot;quc&quot;</span><span class="s2">,</span>
    <span class="s5">0x0487</span><span class="s1">: </span><span class="s3">&quot;rw&quot;</span><span class="s2">,</span>
    <span class="s5">0x0441</span><span class="s1">: </span><span class="s3">&quot;sw&quot;</span><span class="s2">,</span>
    <span class="s5">0x0457</span><span class="s1">: </span><span class="s3">&quot;kok&quot;</span><span class="s2">,</span>
    <span class="s5">0x0412</span><span class="s1">: </span><span class="s3">&quot;ko&quot;</span><span class="s2">,</span>
    <span class="s5">0x0440</span><span class="s1">: </span><span class="s3">&quot;ky&quot;</span><span class="s2">,</span>
    <span class="s5">0x0454</span><span class="s1">: </span><span class="s3">&quot;lo&quot;</span><span class="s2">,</span>
    <span class="s5">0x0426</span><span class="s1">: </span><span class="s3">&quot;lv&quot;</span><span class="s2">,</span>
    <span class="s5">0x0427</span><span class="s1">: </span><span class="s3">&quot;lt&quot;</span><span class="s2">,</span>
    <span class="s5">0x082E</span><span class="s1">: </span><span class="s3">&quot;dsb&quot;</span><span class="s2">,</span>
    <span class="s5">0x046E</span><span class="s1">: </span><span class="s3">&quot;lb&quot;</span><span class="s2">,</span>
    <span class="s5">0x042F</span><span class="s1">: </span><span class="s3">&quot;mk&quot;</span><span class="s2">,</span>
    <span class="s5">0x083E</span><span class="s1">: </span><span class="s3">&quot;ms-BN&quot;</span><span class="s2">,</span>
    <span class="s5">0x043E</span><span class="s1">: </span><span class="s3">&quot;ms&quot;</span><span class="s2">,</span>
    <span class="s5">0x044C</span><span class="s1">: </span><span class="s3">&quot;ml&quot;</span><span class="s2">,</span>
    <span class="s5">0x043A</span><span class="s1">: </span><span class="s3">&quot;mt&quot;</span><span class="s2">,</span>
    <span class="s5">0x0481</span><span class="s1">: </span><span class="s3">&quot;mi&quot;</span><span class="s2">,</span>
    <span class="s5">0x047A</span><span class="s1">: </span><span class="s3">&quot;arn&quot;</span><span class="s2">,</span>
    <span class="s5">0x044E</span><span class="s1">: </span><span class="s3">&quot;mr&quot;</span><span class="s2">,</span>
    <span class="s5">0x047C</span><span class="s1">: </span><span class="s3">&quot;moh&quot;</span><span class="s2">,</span>
    <span class="s5">0x0450</span><span class="s1">: </span><span class="s3">&quot;mn&quot;</span><span class="s2">,</span>
    <span class="s5">0x0850</span><span class="s1">: </span><span class="s3">&quot;mn-CN&quot;</span><span class="s2">,</span>
    <span class="s5">0x0461</span><span class="s1">: </span><span class="s3">&quot;ne&quot;</span><span class="s2">,</span>
    <span class="s5">0x0414</span><span class="s1">: </span><span class="s3">&quot;nb&quot;</span><span class="s2">,</span>
    <span class="s5">0x0814</span><span class="s1">: </span><span class="s3">&quot;nn&quot;</span><span class="s2">,</span>
    <span class="s5">0x0482</span><span class="s1">: </span><span class="s3">&quot;oc&quot;</span><span class="s2">,</span>
    <span class="s5">0x0448</span><span class="s1">: </span><span class="s3">&quot;or&quot;</span><span class="s2">,</span>
    <span class="s5">0x0463</span><span class="s1">: </span><span class="s3">&quot;ps&quot;</span><span class="s2">,</span>
    <span class="s5">0x0415</span><span class="s1">: </span><span class="s3">&quot;pl&quot;</span><span class="s2">,</span>
    <span class="s5">0x0416</span><span class="s1">: </span><span class="s3">&quot;pt&quot;</span><span class="s2">,</span>
    <span class="s5">0x0816</span><span class="s1">: </span><span class="s3">&quot;pt-PT&quot;</span><span class="s2">,</span>
    <span class="s5">0x0446</span><span class="s1">: </span><span class="s3">&quot;pa&quot;</span><span class="s2">,</span>
    <span class="s5">0x046B</span><span class="s1">: </span><span class="s3">&quot;qu-BO&quot;</span><span class="s2">,</span>
    <span class="s5">0x086B</span><span class="s1">: </span><span class="s3">&quot;qu-EC&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C6B</span><span class="s1">: </span><span class="s3">&quot;qu&quot;</span><span class="s2">,</span>
    <span class="s5">0x0418</span><span class="s1">: </span><span class="s3">&quot;ro&quot;</span><span class="s2">,</span>
    <span class="s5">0x0417</span><span class="s1">: </span><span class="s3">&quot;rm&quot;</span><span class="s2">,</span>
    <span class="s5">0x0419</span><span class="s1">: </span><span class="s3">&quot;ru&quot;</span><span class="s2">,</span>
    <span class="s5">0x243B</span><span class="s1">: </span><span class="s3">&quot;smn&quot;</span><span class="s2">,</span>
    <span class="s5">0x103B</span><span class="s1">: </span><span class="s3">&quot;smj-NO&quot;</span><span class="s2">,</span>
    <span class="s5">0x143B</span><span class="s1">: </span><span class="s3">&quot;smj&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C3B</span><span class="s1">: </span><span class="s3">&quot;se-FI&quot;</span><span class="s2">,</span>
    <span class="s5">0x043B</span><span class="s1">: </span><span class="s3">&quot;se&quot;</span><span class="s2">,</span>
    <span class="s5">0x083B</span><span class="s1">: </span><span class="s3">&quot;se-SE&quot;</span><span class="s2">,</span>
    <span class="s5">0x203B</span><span class="s1">: </span><span class="s3">&quot;sms&quot;</span><span class="s2">,</span>
    <span class="s5">0x183B</span><span class="s1">: </span><span class="s3">&quot;sma-NO&quot;</span><span class="s2">,</span>
    <span class="s5">0x1C3B</span><span class="s1">: </span><span class="s3">&quot;sms&quot;</span><span class="s2">,</span>
    <span class="s5">0x044F</span><span class="s1">: </span><span class="s3">&quot;sa&quot;</span><span class="s2">,</span>
    <span class="s5">0x1C1A</span><span class="s1">: </span><span class="s3">&quot;sr-Cyrl-BA&quot;</span><span class="s2">,</span>
    <span class="s5">0x0C1A</span><span class="s1">: </span><span class="s3">&quot;sr&quot;</span><span class="s2">,</span>
    <span class="s5">0x181A</span><span class="s1">: </span><span class="s3">&quot;sr-Latn-BA&quot;</span><span class="s2">,</span>
    <span class="s5">0x081A</span><span class="s1">: </span><span class="s3">&quot;sr-Latn&quot;</span><span class="s2">,</span>
    <span class="s5">0x046C</span><span class="s1">: </span><span class="s3">&quot;nso&quot;</span><span class="s2">,</span>
    <span class="s5">0x0432</span><span class="s1">: </span><span class="s3">&quot;tn&quot;</span><span class="s2">,</span>
    <span class="s5">0x045B</span><span class="s1">: </span><span class="s3">&quot;si&quot;</span><span class="s2">,</span>
    <span class="s5">0x041B</span><span class="s1">: </span><span class="s3">&quot;sk&quot;</span><span class="s2">,</span>
    <span class="s5">0x0424</span><span class="s1">: </span><span class="s3">&quot;sl&quot;</span><span class="s2">,</span>
    <span class="s5">0x2C0A</span><span class="s1">: </span><span class="s3">&quot;es-AR&quot;</span><span class="s2">,</span>
    <span class="s5">0x400A</span><span class="s1">: </span><span class="s3">&quot;es-BO&quot;</span><span class="s2">,</span>
    <span class="s5">0x340A</span><span class="s1">: </span><span class="s3">&quot;es-CL&quot;</span><span class="s2">,</span>
    <span class="s5">0x240A</span><span class="s1">: </span><span class="s3">&quot;es-CO&quot;</span><span class="s2">,</span>
    <span class="s5">0x140A</span><span class="s1">: </span><span class="s3">&quot;es-CR&quot;</span><span class="s2">,</span>
    <span class="s5">0x1C0A</span><span class="s1">: </span><span class="s3">&quot;es-DO&quot;</span><span class="s2">,</span>
    <span class="s5">0x300A</span><span class="s1">: </span><span class="s3">&quot;es-EC&quot;</span><span class="s2">,</span>
    <span class="s5">0x440A</span><span class="s1">: </span><span class="s3">&quot;es-SV&quot;</span><span class="s2">,</span>
    <span class="s5">0x100A</span><span class="s1">: </span><span class="s3">&quot;es-GT&quot;</span><span class="s2">,</span>
    <span class="s5">0x480A</span><span class="s1">: </span><span class="s3">&quot;es-HN&quot;</span><span class="s2">,</span>
    <span class="s5">0x080A</span><span class="s1">: </span><span class="s3">&quot;es-MX&quot;</span><span class="s2">,</span>
    <span class="s5">0x4C0A</span><span class="s1">: </span><span class="s3">&quot;es-NI&quot;</span><span class="s2">,</span>
    <span class="s5">0x180A</span><span class="s1">: </span><span class="s3">&quot;es-PA&quot;</span><span class="s2">,</span>
    <span class="s5">0x3C0A</span><span class="s1">: </span><span class="s3">&quot;es-PY&quot;</span><span class="s2">,</span>
    <span class="s5">0x280A</span><span class="s1">: </span><span class="s3">&quot;es-PE&quot;</span><span class="s2">,</span>
    <span class="s5">0x500A</span><span class="s1">: </span><span class="s3">&quot;es-PR&quot;</span><span class="s2">,</span>
    <span class="s0"># Microsoft has defined two different language codes for</span>
    <span class="s0"># “Spanish with modern sorting” and “Spanish with traditional</span>
    <span class="s0"># sorting”. This makes sense for collation APIs, and it would be</span>
    <span class="s0"># possible to express this in BCP 47 language tags via Unicode</span>
    <span class="s0"># extensions (eg., “es-u-co-trad” is “Spanish with traditional</span>
    <span class="s0"># sorting”). However, for storing names in fonts, this distinction</span>
    <span class="s0"># does not make sense, so we use “es” in both cases.</span>
    <span class="s5">0x0C0A</span><span class="s1">: </span><span class="s3">&quot;es&quot;</span><span class="s2">,</span>
    <span class="s5">0x040A</span><span class="s1">: </span><span class="s3">&quot;es&quot;</span><span class="s2">,</span>
    <span class="s5">0x540A</span><span class="s1">: </span><span class="s3">&quot;es-US&quot;</span><span class="s2">,</span>
    <span class="s5">0x380A</span><span class="s1">: </span><span class="s3">&quot;es-UY&quot;</span><span class="s2">,</span>
    <span class="s5">0x200A</span><span class="s1">: </span><span class="s3">&quot;es-VE&quot;</span><span class="s2">,</span>
    <span class="s5">0x081D</span><span class="s1">: </span><span class="s3">&quot;sv-FI&quot;</span><span class="s2">,</span>
    <span class="s5">0x041D</span><span class="s1">: </span><span class="s3">&quot;sv&quot;</span><span class="s2">,</span>
    <span class="s5">0x045A</span><span class="s1">: </span><span class="s3">&quot;syr&quot;</span><span class="s2">,</span>
    <span class="s5">0x0428</span><span class="s1">: </span><span class="s3">&quot;tg&quot;</span><span class="s2">,</span>
    <span class="s5">0x085F</span><span class="s1">: </span><span class="s3">&quot;tzm&quot;</span><span class="s2">,</span>
    <span class="s5">0x0449</span><span class="s1">: </span><span class="s3">&quot;ta&quot;</span><span class="s2">,</span>
    <span class="s5">0x0444</span><span class="s1">: </span><span class="s3">&quot;tt&quot;</span><span class="s2">,</span>
    <span class="s5">0x044A</span><span class="s1">: </span><span class="s3">&quot;te&quot;</span><span class="s2">,</span>
    <span class="s5">0x041E</span><span class="s1">: </span><span class="s3">&quot;th&quot;</span><span class="s2">,</span>
    <span class="s5">0x0451</span><span class="s1">: </span><span class="s3">&quot;bo&quot;</span><span class="s2">,</span>
    <span class="s5">0x041F</span><span class="s1">: </span><span class="s3">&quot;tr&quot;</span><span class="s2">,</span>
    <span class="s5">0x0442</span><span class="s1">: </span><span class="s3">&quot;tk&quot;</span><span class="s2">,</span>
    <span class="s5">0x0480</span><span class="s1">: </span><span class="s3">&quot;ug&quot;</span><span class="s2">,</span>
    <span class="s5">0x0422</span><span class="s1">: </span><span class="s3">&quot;uk&quot;</span><span class="s2">,</span>
    <span class="s5">0x042E</span><span class="s1">: </span><span class="s3">&quot;hsb&quot;</span><span class="s2">,</span>
    <span class="s5">0x0420</span><span class="s1">: </span><span class="s3">&quot;ur&quot;</span><span class="s2">,</span>
    <span class="s5">0x0843</span><span class="s1">: </span><span class="s3">&quot;uz-Cyrl&quot;</span><span class="s2">,</span>
    <span class="s5">0x0443</span><span class="s1">: </span><span class="s3">&quot;uz&quot;</span><span class="s2">,</span>
    <span class="s5">0x042A</span><span class="s1">: </span><span class="s3">&quot;vi&quot;</span><span class="s2">,</span>
    <span class="s5">0x0452</span><span class="s1">: </span><span class="s3">&quot;cy&quot;</span><span class="s2">,</span>
    <span class="s5">0x0488</span><span class="s1">: </span><span class="s3">&quot;wo&quot;</span><span class="s2">,</span>
    <span class="s5">0x0485</span><span class="s1">: </span><span class="s3">&quot;sah&quot;</span><span class="s2">,</span>
    <span class="s5">0x0478</span><span class="s1">: </span><span class="s3">&quot;ii&quot;</span><span class="s2">,</span>
    <span class="s5">0x046A</span><span class="s1">: </span><span class="s3">&quot;yo&quot;</span><span class="s2">,</span>
<span class="s1">}</span>


<span class="s1">_MAC_LANGUAGES = {</span>
    <span class="s5">0</span><span class="s1">: </span><span class="s3">&quot;en&quot;</span><span class="s2">,</span>
    <span class="s5">1</span><span class="s1">: </span><span class="s3">&quot;fr&quot;</span><span class="s2">,</span>
    <span class="s5">2</span><span class="s1">: </span><span class="s3">&quot;de&quot;</span><span class="s2">,</span>
    <span class="s5">3</span><span class="s1">: </span><span class="s3">&quot;it&quot;</span><span class="s2">,</span>
    <span class="s5">4</span><span class="s1">: </span><span class="s3">&quot;nl&quot;</span><span class="s2">,</span>
    <span class="s5">5</span><span class="s1">: </span><span class="s3">&quot;sv&quot;</span><span class="s2">,</span>
    <span class="s5">6</span><span class="s1">: </span><span class="s3">&quot;es&quot;</span><span class="s2">,</span>
    <span class="s5">7</span><span class="s1">: </span><span class="s3">&quot;da&quot;</span><span class="s2">,</span>
    <span class="s5">8</span><span class="s1">: </span><span class="s3">&quot;pt&quot;</span><span class="s2">,</span>
    <span class="s5">9</span><span class="s1">: </span><span class="s3">&quot;no&quot;</span><span class="s2">,</span>
    <span class="s5">10</span><span class="s1">: </span><span class="s3">&quot;he&quot;</span><span class="s2">,</span>
    <span class="s5">11</span><span class="s1">: </span><span class="s3">&quot;ja&quot;</span><span class="s2">,</span>
    <span class="s5">12</span><span class="s1">: </span><span class="s3">&quot;ar&quot;</span><span class="s2">,</span>
    <span class="s5">13</span><span class="s1">: </span><span class="s3">&quot;fi&quot;</span><span class="s2">,</span>
    <span class="s5">14</span><span class="s1">: </span><span class="s3">&quot;el&quot;</span><span class="s2">,</span>
    <span class="s5">15</span><span class="s1">: </span><span class="s3">&quot;is&quot;</span><span class="s2">,</span>
    <span class="s5">16</span><span class="s1">: </span><span class="s3">&quot;mt&quot;</span><span class="s2">,</span>
    <span class="s5">17</span><span class="s1">: </span><span class="s3">&quot;tr&quot;</span><span class="s2">,</span>
    <span class="s5">18</span><span class="s1">: </span><span class="s3">&quot;hr&quot;</span><span class="s2">,</span>
    <span class="s5">19</span><span class="s1">: </span><span class="s3">&quot;zh-Hant&quot;</span><span class="s2">,</span>
    <span class="s5">20</span><span class="s1">: </span><span class="s3">&quot;ur&quot;</span><span class="s2">,</span>
    <span class="s5">21</span><span class="s1">: </span><span class="s3">&quot;hi&quot;</span><span class="s2">,</span>
    <span class="s5">22</span><span class="s1">: </span><span class="s3">&quot;th&quot;</span><span class="s2">,</span>
    <span class="s5">23</span><span class="s1">: </span><span class="s3">&quot;ko&quot;</span><span class="s2">,</span>
    <span class="s5">24</span><span class="s1">: </span><span class="s3">&quot;lt&quot;</span><span class="s2">,</span>
    <span class="s5">25</span><span class="s1">: </span><span class="s3">&quot;pl&quot;</span><span class="s2">,</span>
    <span class="s5">26</span><span class="s1">: </span><span class="s3">&quot;hu&quot;</span><span class="s2">,</span>
    <span class="s5">27</span><span class="s1">: </span><span class="s3">&quot;es&quot;</span><span class="s2">,</span>
    <span class="s5">28</span><span class="s1">: </span><span class="s3">&quot;lv&quot;</span><span class="s2">,</span>
    <span class="s5">29</span><span class="s1">: </span><span class="s3">&quot;se&quot;</span><span class="s2">,</span>
    <span class="s5">30</span><span class="s1">: </span><span class="s3">&quot;fo&quot;</span><span class="s2">,</span>
    <span class="s5">31</span><span class="s1">: </span><span class="s3">&quot;fa&quot;</span><span class="s2">,</span>
    <span class="s5">32</span><span class="s1">: </span><span class="s3">&quot;ru&quot;</span><span class="s2">,</span>
    <span class="s5">33</span><span class="s1">: </span><span class="s3">&quot;zh&quot;</span><span class="s2">,</span>
    <span class="s5">34</span><span class="s1">: </span><span class="s3">&quot;nl-BE&quot;</span><span class="s2">,</span>
    <span class="s5">35</span><span class="s1">: </span><span class="s3">&quot;ga&quot;</span><span class="s2">,</span>
    <span class="s5">36</span><span class="s1">: </span><span class="s3">&quot;sq&quot;</span><span class="s2">,</span>
    <span class="s5">37</span><span class="s1">: </span><span class="s3">&quot;ro&quot;</span><span class="s2">,</span>
    <span class="s5">38</span><span class="s1">: </span><span class="s3">&quot;cz&quot;</span><span class="s2">,</span>
    <span class="s5">39</span><span class="s1">: </span><span class="s3">&quot;sk&quot;</span><span class="s2">,</span>
    <span class="s5">40</span><span class="s1">: </span><span class="s3">&quot;sl&quot;</span><span class="s2">,</span>
    <span class="s5">41</span><span class="s1">: </span><span class="s3">&quot;yi&quot;</span><span class="s2">,</span>
    <span class="s5">42</span><span class="s1">: </span><span class="s3">&quot;sr&quot;</span><span class="s2">,</span>
    <span class="s5">43</span><span class="s1">: </span><span class="s3">&quot;mk&quot;</span><span class="s2">,</span>
    <span class="s5">44</span><span class="s1">: </span><span class="s3">&quot;bg&quot;</span><span class="s2">,</span>
    <span class="s5">45</span><span class="s1">: </span><span class="s3">&quot;uk&quot;</span><span class="s2">,</span>
    <span class="s5">46</span><span class="s1">: </span><span class="s3">&quot;be&quot;</span><span class="s2">,</span>
    <span class="s5">47</span><span class="s1">: </span><span class="s3">&quot;uz&quot;</span><span class="s2">,</span>
    <span class="s5">48</span><span class="s1">: </span><span class="s3">&quot;kk&quot;</span><span class="s2">,</span>
    <span class="s5">49</span><span class="s1">: </span><span class="s3">&quot;az-Cyrl&quot;</span><span class="s2">,</span>
    <span class="s5">50</span><span class="s1">: </span><span class="s3">&quot;az-Arab&quot;</span><span class="s2">,</span>
    <span class="s5">51</span><span class="s1">: </span><span class="s3">&quot;hy&quot;</span><span class="s2">,</span>
    <span class="s5">52</span><span class="s1">: </span><span class="s3">&quot;ka&quot;</span><span class="s2">,</span>
    <span class="s5">53</span><span class="s1">: </span><span class="s3">&quot;mo&quot;</span><span class="s2">,</span>
    <span class="s5">54</span><span class="s1">: </span><span class="s3">&quot;ky&quot;</span><span class="s2">,</span>
    <span class="s5">55</span><span class="s1">: </span><span class="s3">&quot;tg&quot;</span><span class="s2">,</span>
    <span class="s5">56</span><span class="s1">: </span><span class="s3">&quot;tk&quot;</span><span class="s2">,</span>
    <span class="s5">57</span><span class="s1">: </span><span class="s3">&quot;mn-CN&quot;</span><span class="s2">,</span>
    <span class="s5">58</span><span class="s1">: </span><span class="s3">&quot;mn&quot;</span><span class="s2">,</span>
    <span class="s5">59</span><span class="s1">: </span><span class="s3">&quot;ps&quot;</span><span class="s2">,</span>
    <span class="s5">60</span><span class="s1">: </span><span class="s3">&quot;ks&quot;</span><span class="s2">,</span>
    <span class="s5">61</span><span class="s1">: </span><span class="s3">&quot;ku&quot;</span><span class="s2">,</span>
    <span class="s5">62</span><span class="s1">: </span><span class="s3">&quot;sd&quot;</span><span class="s2">,</span>
    <span class="s5">63</span><span class="s1">: </span><span class="s3">&quot;bo&quot;</span><span class="s2">,</span>
    <span class="s5">64</span><span class="s1">: </span><span class="s3">&quot;ne&quot;</span><span class="s2">,</span>
    <span class="s5">65</span><span class="s1">: </span><span class="s3">&quot;sa&quot;</span><span class="s2">,</span>
    <span class="s5">66</span><span class="s1">: </span><span class="s3">&quot;mr&quot;</span><span class="s2">,</span>
    <span class="s5">67</span><span class="s1">: </span><span class="s3">&quot;bn&quot;</span><span class="s2">,</span>
    <span class="s5">68</span><span class="s1">: </span><span class="s3">&quot;as&quot;</span><span class="s2">,</span>
    <span class="s5">69</span><span class="s1">: </span><span class="s3">&quot;gu&quot;</span><span class="s2">,</span>
    <span class="s5">70</span><span class="s1">: </span><span class="s3">&quot;pa&quot;</span><span class="s2">,</span>
    <span class="s5">71</span><span class="s1">: </span><span class="s3">&quot;or&quot;</span><span class="s2">,</span>
    <span class="s5">72</span><span class="s1">: </span><span class="s3">&quot;ml&quot;</span><span class="s2">,</span>
    <span class="s5">73</span><span class="s1">: </span><span class="s3">&quot;kn&quot;</span><span class="s2">,</span>
    <span class="s5">74</span><span class="s1">: </span><span class="s3">&quot;ta&quot;</span><span class="s2">,</span>
    <span class="s5">75</span><span class="s1">: </span><span class="s3">&quot;te&quot;</span><span class="s2">,</span>
    <span class="s5">76</span><span class="s1">: </span><span class="s3">&quot;si&quot;</span><span class="s2">,</span>
    <span class="s5">77</span><span class="s1">: </span><span class="s3">&quot;my&quot;</span><span class="s2">,</span>
    <span class="s5">78</span><span class="s1">: </span><span class="s3">&quot;km&quot;</span><span class="s2">,</span>
    <span class="s5">79</span><span class="s1">: </span><span class="s3">&quot;lo&quot;</span><span class="s2">,</span>
    <span class="s5">80</span><span class="s1">: </span><span class="s3">&quot;vi&quot;</span><span class="s2">,</span>
    <span class="s5">81</span><span class="s1">: </span><span class="s3">&quot;id&quot;</span><span class="s2">,</span>
    <span class="s5">82</span><span class="s1">: </span><span class="s3">&quot;tl&quot;</span><span class="s2">,</span>
    <span class="s5">83</span><span class="s1">: </span><span class="s3">&quot;ms&quot;</span><span class="s2">,</span>
    <span class="s5">84</span><span class="s1">: </span><span class="s3">&quot;ms-Arab&quot;</span><span class="s2">,</span>
    <span class="s5">85</span><span class="s1">: </span><span class="s3">&quot;am&quot;</span><span class="s2">,</span>
    <span class="s5">86</span><span class="s1">: </span><span class="s3">&quot;ti&quot;</span><span class="s2">,</span>
    <span class="s5">87</span><span class="s1">: </span><span class="s3">&quot;om&quot;</span><span class="s2">,</span>
    <span class="s5">88</span><span class="s1">: </span><span class="s3">&quot;so&quot;</span><span class="s2">,</span>
    <span class="s5">89</span><span class="s1">: </span><span class="s3">&quot;sw&quot;</span><span class="s2">,</span>
    <span class="s5">90</span><span class="s1">: </span><span class="s3">&quot;rw&quot;</span><span class="s2">,</span>
    <span class="s5">91</span><span class="s1">: </span><span class="s3">&quot;rn&quot;</span><span class="s2">,</span>
    <span class="s5">92</span><span class="s1">: </span><span class="s3">&quot;ny&quot;</span><span class="s2">,</span>
    <span class="s5">93</span><span class="s1">: </span><span class="s3">&quot;mg&quot;</span><span class="s2">,</span>
    <span class="s5">94</span><span class="s1">: </span><span class="s3">&quot;eo&quot;</span><span class="s2">,</span>
    <span class="s5">128</span><span class="s1">: </span><span class="s3">&quot;cy&quot;</span><span class="s2">,</span>
    <span class="s5">129</span><span class="s1">: </span><span class="s3">&quot;eu&quot;</span><span class="s2">,</span>
    <span class="s5">130</span><span class="s1">: </span><span class="s3">&quot;ca&quot;</span><span class="s2">,</span>
    <span class="s5">131</span><span class="s1">: </span><span class="s3">&quot;la&quot;</span><span class="s2">,</span>
    <span class="s5">132</span><span class="s1">: </span><span class="s3">&quot;qu&quot;</span><span class="s2">,</span>
    <span class="s5">133</span><span class="s1">: </span><span class="s3">&quot;gn&quot;</span><span class="s2">,</span>
    <span class="s5">134</span><span class="s1">: </span><span class="s3">&quot;ay&quot;</span><span class="s2">,</span>
    <span class="s5">135</span><span class="s1">: </span><span class="s3">&quot;tt&quot;</span><span class="s2">,</span>
    <span class="s5">136</span><span class="s1">: </span><span class="s3">&quot;ug&quot;</span><span class="s2">,</span>
    <span class="s5">137</span><span class="s1">: </span><span class="s3">&quot;dz&quot;</span><span class="s2">,</span>
    <span class="s5">138</span><span class="s1">: </span><span class="s3">&quot;jv&quot;</span><span class="s2">,</span>
    <span class="s5">139</span><span class="s1">: </span><span class="s3">&quot;su&quot;</span><span class="s2">,</span>
    <span class="s5">140</span><span class="s1">: </span><span class="s3">&quot;gl&quot;</span><span class="s2">,</span>
    <span class="s5">141</span><span class="s1">: </span><span class="s3">&quot;af&quot;</span><span class="s2">,</span>
    <span class="s5">142</span><span class="s1">: </span><span class="s3">&quot;br&quot;</span><span class="s2">,</span>
    <span class="s5">143</span><span class="s1">: </span><span class="s3">&quot;iu&quot;</span><span class="s2">,</span>
    <span class="s5">144</span><span class="s1">: </span><span class="s3">&quot;gd&quot;</span><span class="s2">,</span>
    <span class="s5">145</span><span class="s1">: </span><span class="s3">&quot;gv&quot;</span><span class="s2">,</span>
    <span class="s5">146</span><span class="s1">: </span><span class="s3">&quot;ga&quot;</span><span class="s2">,</span>
    <span class="s5">147</span><span class="s1">: </span><span class="s3">&quot;to&quot;</span><span class="s2">,</span>
    <span class="s5">148</span><span class="s1">: </span><span class="s3">&quot;el-polyton&quot;</span><span class="s2">,</span>
    <span class="s5">149</span><span class="s1">: </span><span class="s3">&quot;kl&quot;</span><span class="s2">,</span>
    <span class="s5">150</span><span class="s1">: </span><span class="s3">&quot;az&quot;</span><span class="s2">,</span>
    <span class="s5">151</span><span class="s1">: </span><span class="s3">&quot;nn&quot;</span><span class="s2">,</span>
<span class="s1">}</span>


<span class="s1">_WINDOWS_LANGUAGE_CODES = {</span>
    <span class="s1">lang.lower(): code </span><span class="s2">for </span><span class="s1">code</span><span class="s2">, </span><span class="s1">lang </span><span class="s2">in </span><span class="s1">_WINDOWS_LANGUAGES.items()</span>
<span class="s1">}</span>
<span class="s1">_MAC_LANGUAGE_CODES = {lang.lower(): code </span><span class="s2">for </span><span class="s1">code</span><span class="s2">, </span><span class="s1">lang </span><span class="s2">in </span><span class="s1">_MAC_LANGUAGES.items()}</span>


<span class="s0"># MacOS language ID → MacOS script ID</span>
<span class="s0">#</span>
<span class="s0"># Note that the script ID is not sufficient to determine what encoding</span>
<span class="s0"># to use in TrueType files. For some languages, MacOS used a modification</span>
<span class="s0"># of a mainstream script. For example, an Icelandic name would be stored</span>
<span class="s0"># with smRoman in the TrueType naming table, but the actual encoding</span>
<span class="s0"># is a special Icelandic version of the normal Macintosh Roman encoding.</span>
<span class="s0"># As another example, Inuktitut uses an 8-bit encoding for Canadian Aboriginal</span>
<span class="s0"># Syllables but MacOS had run out of available script codes, so this was</span>
<span class="s0"># done as a (pretty radical) “modification” of Ethiopic.</span>
<span class="s0">#</span>
<span class="s0"># http://unicode.org/Public/MAPPINGS/VENDORS/APPLE/Readme.txt</span>
<span class="s1">_MAC_LANGUAGE_TO_SCRIPT = {</span>
    <span class="s5">0</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langEnglish → smRoman</span>
    <span class="s5">1</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langFrench → smRoman</span>
    <span class="s5">2</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langGerman → smRoman</span>
    <span class="s5">3</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langItalian → smRoman</span>
    <span class="s5">4</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langDutch → smRoman</span>
    <span class="s5">5</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSwedish → smRoman</span>
    <span class="s5">6</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSpanish → smRoman</span>
    <span class="s5">7</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langDanish → smRoman</span>
    <span class="s5">8</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langPortuguese → smRoman</span>
    <span class="s5">9</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langNorwegian → smRoman</span>
    <span class="s5">10</span><span class="s1">: </span><span class="s5">5</span><span class="s2">,  </span><span class="s0"># langHebrew → smHebrew</span>
    <span class="s5">11</span><span class="s1">: </span><span class="s5">1</span><span class="s2">,  </span><span class="s0"># langJapanese → smJapanese</span>
    <span class="s5">12</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langArabic → smArabic</span>
    <span class="s5">13</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langFinnish → smRoman</span>
    <span class="s5">14</span><span class="s1">: </span><span class="s5">6</span><span class="s2">,  </span><span class="s0"># langGreek → smGreek</span>
    <span class="s5">15</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langIcelandic → smRoman (modified)</span>
    <span class="s5">16</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langMaltese → smRoman</span>
    <span class="s5">17</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langTurkish → smRoman (modified)</span>
    <span class="s5">18</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langCroatian → smRoman (modified)</span>
    <span class="s5">19</span><span class="s1">: </span><span class="s5">2</span><span class="s2">,  </span><span class="s0"># langTradChinese → smTradChinese</span>
    <span class="s5">20</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langUrdu → smArabic</span>
    <span class="s5">21</span><span class="s1">: </span><span class="s5">9</span><span class="s2">,  </span><span class="s0"># langHindi → smDevanagari</span>
    <span class="s5">22</span><span class="s1">: </span><span class="s5">21</span><span class="s2">,  </span><span class="s0"># langThai → smThai</span>
    <span class="s5">23</span><span class="s1">: </span><span class="s5">3</span><span class="s2">,  </span><span class="s0"># langKorean → smKorean</span>
    <span class="s5">24</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langLithuanian → smCentralEuroRoman</span>
    <span class="s5">25</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langPolish → smCentralEuroRoman</span>
    <span class="s5">26</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langHungarian → smCentralEuroRoman</span>
    <span class="s5">27</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langEstonian → smCentralEuroRoman</span>
    <span class="s5">28</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langLatvian → smCentralEuroRoman</span>
    <span class="s5">29</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSami → smRoman</span>
    <span class="s5">30</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langFaroese → smRoman (modified)</span>
    <span class="s5">31</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langFarsi → smArabic (modified)</span>
    <span class="s5">32</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langRussian → smCyrillic</span>
    <span class="s5">33</span><span class="s1">: </span><span class="s5">25</span><span class="s2">,  </span><span class="s0"># langSimpChinese → smSimpChinese</span>
    <span class="s5">34</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langFlemish → smRoman</span>
    <span class="s5">35</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langIrishGaelic → smRoman (modified)</span>
    <span class="s5">36</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langAlbanian → smRoman</span>
    <span class="s5">37</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langRomanian → smRoman (modified)</span>
    <span class="s5">38</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langCzech → smCentralEuroRoman</span>
    <span class="s5">39</span><span class="s1">: </span><span class="s5">29</span><span class="s2">,  </span><span class="s0"># langSlovak → smCentralEuroRoman</span>
    <span class="s5">40</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSlovenian → smRoman (modified)</span>
    <span class="s5">41</span><span class="s1">: </span><span class="s5">5</span><span class="s2">,  </span><span class="s0"># langYiddish → smHebrew</span>
    <span class="s5">42</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langSerbian → smCyrillic</span>
    <span class="s5">43</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langMacedonian → smCyrillic</span>
    <span class="s5">44</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langBulgarian → smCyrillic</span>
    <span class="s5">45</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langUkrainian → smCyrillic (modified)</span>
    <span class="s5">46</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langByelorussian → smCyrillic</span>
    <span class="s5">47</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langUzbek → smCyrillic</span>
    <span class="s5">48</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langKazakh → smCyrillic</span>
    <span class="s5">49</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langAzerbaijani → smCyrillic</span>
    <span class="s5">50</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langAzerbaijanAr → smArabic</span>
    <span class="s5">51</span><span class="s1">: </span><span class="s5">24</span><span class="s2">,  </span><span class="s0"># langArmenian → smArmenian</span>
    <span class="s5">52</span><span class="s1">: </span><span class="s5">23</span><span class="s2">,  </span><span class="s0"># langGeorgian → smGeorgian</span>
    <span class="s5">53</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langMoldavian → smCyrillic</span>
    <span class="s5">54</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langKirghiz → smCyrillic</span>
    <span class="s5">55</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langTajiki → smCyrillic</span>
    <span class="s5">56</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langTurkmen → smCyrillic</span>
    <span class="s5">57</span><span class="s1">: </span><span class="s5">27</span><span class="s2">,  </span><span class="s0"># langMongolian → smMongolian</span>
    <span class="s5">58</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langMongolianCyr → smCyrillic</span>
    <span class="s5">59</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langPashto → smArabic</span>
    <span class="s5">60</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langKurdish → smArabic</span>
    <span class="s5">61</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langKashmiri → smArabic</span>
    <span class="s5">62</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langSindhi → smArabic</span>
    <span class="s5">63</span><span class="s1">: </span><span class="s5">26</span><span class="s2">,  </span><span class="s0"># langTibetan → smTibetan</span>
    <span class="s5">64</span><span class="s1">: </span><span class="s5">9</span><span class="s2">,  </span><span class="s0"># langNepali → smDevanagari</span>
    <span class="s5">65</span><span class="s1">: </span><span class="s5">9</span><span class="s2">,  </span><span class="s0"># langSanskrit → smDevanagari</span>
    <span class="s5">66</span><span class="s1">: </span><span class="s5">9</span><span class="s2">,  </span><span class="s0"># langMarathi → smDevanagari</span>
    <span class="s5">67</span><span class="s1">: </span><span class="s5">13</span><span class="s2">,  </span><span class="s0"># langBengali → smBengali</span>
    <span class="s5">68</span><span class="s1">: </span><span class="s5">13</span><span class="s2">,  </span><span class="s0"># langAssamese → smBengali</span>
    <span class="s5">69</span><span class="s1">: </span><span class="s5">11</span><span class="s2">,  </span><span class="s0"># langGujarati → smGujarati</span>
    <span class="s5">70</span><span class="s1">: </span><span class="s5">10</span><span class="s2">,  </span><span class="s0"># langPunjabi → smGurmukhi</span>
    <span class="s5">71</span><span class="s1">: </span><span class="s5">12</span><span class="s2">,  </span><span class="s0"># langOriya → smOriya</span>
    <span class="s5">72</span><span class="s1">: </span><span class="s5">17</span><span class="s2">,  </span><span class="s0"># langMalayalam → smMalayalam</span>
    <span class="s5">73</span><span class="s1">: </span><span class="s5">16</span><span class="s2">,  </span><span class="s0"># langKannada → smKannada</span>
    <span class="s5">74</span><span class="s1">: </span><span class="s5">14</span><span class="s2">,  </span><span class="s0"># langTamil → smTamil</span>
    <span class="s5">75</span><span class="s1">: </span><span class="s5">15</span><span class="s2">,  </span><span class="s0"># langTelugu → smTelugu</span>
    <span class="s5">76</span><span class="s1">: </span><span class="s5">18</span><span class="s2">,  </span><span class="s0"># langSinhalese → smSinhalese</span>
    <span class="s5">77</span><span class="s1">: </span><span class="s5">19</span><span class="s2">,  </span><span class="s0"># langBurmese → smBurmese</span>
    <span class="s5">78</span><span class="s1">: </span><span class="s5">20</span><span class="s2">,  </span><span class="s0"># langKhmer → smKhmer</span>
    <span class="s5">79</span><span class="s1">: </span><span class="s5">22</span><span class="s2">,  </span><span class="s0"># langLao → smLao</span>
    <span class="s5">80</span><span class="s1">: </span><span class="s5">30</span><span class="s2">,  </span><span class="s0"># langVietnamese → smVietnamese</span>
    <span class="s5">81</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langIndonesian → smRoman</span>
    <span class="s5">82</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langTagalog → smRoman</span>
    <span class="s5">83</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langMalayRoman → smRoman</span>
    <span class="s5">84</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langMalayArabic → smArabic</span>
    <span class="s5">85</span><span class="s1">: </span><span class="s5">28</span><span class="s2">,  </span><span class="s0"># langAmharic → smEthiopic</span>
    <span class="s5">86</span><span class="s1">: </span><span class="s5">28</span><span class="s2">,  </span><span class="s0"># langTigrinya → smEthiopic</span>
    <span class="s5">87</span><span class="s1">: </span><span class="s5">28</span><span class="s2">,  </span><span class="s0"># langOromo → smEthiopic</span>
    <span class="s5">88</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSomali → smRoman</span>
    <span class="s5">89</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSwahili → smRoman</span>
    <span class="s5">90</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langKinyarwanda → smRoman</span>
    <span class="s5">91</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langRundi → smRoman</span>
    <span class="s5">92</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langNyanja → smRoman</span>
    <span class="s5">93</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langMalagasy → smRoman</span>
    <span class="s5">94</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langEsperanto → smRoman</span>
    <span class="s5">128</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langWelsh → smRoman (modified)</span>
    <span class="s5">129</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langBasque → smRoman</span>
    <span class="s5">130</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langCatalan → smRoman</span>
    <span class="s5">131</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langLatin → smRoman</span>
    <span class="s5">132</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langQuechua → smRoman</span>
    <span class="s5">133</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langGuarani → smRoman</span>
    <span class="s5">134</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langAymara → smRoman</span>
    <span class="s5">135</span><span class="s1">: </span><span class="s5">7</span><span class="s2">,  </span><span class="s0"># langTatar → smCyrillic</span>
    <span class="s5">136</span><span class="s1">: </span><span class="s5">4</span><span class="s2">,  </span><span class="s0"># langUighur → smArabic</span>
    <span class="s5">137</span><span class="s1">: </span><span class="s5">26</span><span class="s2">,  </span><span class="s0"># langDzongkha → smTibetan</span>
    <span class="s5">138</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langJavaneseRom → smRoman</span>
    <span class="s5">139</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langSundaneseRom → smRoman</span>
    <span class="s5">140</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langGalician → smRoman</span>
    <span class="s5">141</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langAfrikaans → smRoman</span>
    <span class="s5">142</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langBreton → smRoman (modified)</span>
    <span class="s5">143</span><span class="s1">: </span><span class="s5">28</span><span class="s2">,  </span><span class="s0"># langInuktitut → smEthiopic (modified)</span>
    <span class="s5">144</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langScottishGaelic → smRoman (modified)</span>
    <span class="s5">145</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langManxGaelic → smRoman (modified)</span>
    <span class="s5">146</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langIrishGaelicScript → smRoman (modified)</span>
    <span class="s5">147</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langTongan → smRoman</span>
    <span class="s5">148</span><span class="s1">: </span><span class="s5">6</span><span class="s2">,  </span><span class="s0"># langGreekAncient → smRoman</span>
    <span class="s5">149</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langGreenlandic → smRoman</span>
    <span class="s5">150</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langAzerbaijanRoman → smRoman</span>
    <span class="s5">151</span><span class="s1">: </span><span class="s5">0</span><span class="s2">,  </span><span class="s0"># langNynorsk → smRoman</span>
<span class="s1">}</span>


<span class="s2">class </span><span class="s1">NameRecordVisitor(TTVisitor):</span>
    <span class="s0"># Font tables that have NameIDs we need to collect.</span>
    <span class="s1">TABLES = (</span><span class="s3">&quot;GSUB&quot;</span><span class="s2">, </span><span class="s3">&quot;GPOS&quot;</span><span class="s2">, </span><span class="s3">&quot;fvar&quot;</span><span class="s2">, </span><span class="s3">&quot;CPAL&quot;</span><span class="s2">, </span><span class="s3">&quot;STAT&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">__init__(self):</span>
        <span class="s1">self.seen = set()</span>


<span class="s1">@NameRecordVisitor.register_attrs(</span>
    <span class="s1">(</span>
        <span class="s1">(otTables.FeatureParamsSize</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;SubfamilyID&quot;</span><span class="s2">, </span><span class="s3">&quot;SubfamilyNameID&quot;</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(otTables.FeatureParamsStylisticSet</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;UINameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(</span>
            <span class="s1">otTables.FeatureParamsCharacterVariants</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s3">&quot;FeatUILabelNameID&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;FeatUITooltipTextNameID&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;SampleTextNameID&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;FirstParamUILabelNameID&quot;</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(otTables.STAT</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;ElidedFallbackNameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(otTables.AxisRecord</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;AxisNameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(otTables.AxisValue</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;ValueNameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(otTables.FeatureName</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;FeatureNameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">(otTables.Setting</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;SettingNameID&quot;</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
    <span class="s1">)</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">visit(visitor</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">attr</span><span class="s2">, </span><span class="s1">value):</span>
    <span class="s1">visitor.seen.add(value)</span>


<span class="s1">@NameRecordVisitor.register(ttLib.getTableClass(</span><span class="s3">&quot;fvar&quot;</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">visit(visitor</span><span class="s2">, </span><span class="s1">obj):</span>
    <span class="s2">for </span><span class="s1">inst </span><span class="s2">in </span><span class="s1">obj.instances:</span>
        <span class="s2">if </span><span class="s1">inst.postscriptNameID != </span><span class="s5">0xFFFF</span><span class="s1">:</span>
            <span class="s1">visitor.seen.add(inst.postscriptNameID)</span>
        <span class="s1">visitor.seen.add(inst.subfamilyNameID)</span>

    <span class="s2">for </span><span class="s1">axis </span><span class="s2">in </span><span class="s1">obj.axes:</span>
        <span class="s1">visitor.seen.add(axis.axisNameID)</span>


<span class="s1">@NameRecordVisitor.register(ttLib.getTableClass(</span><span class="s3">&quot;CPAL&quot;</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">visit(visitor</span><span class="s2">, </span><span class="s1">obj):</span>
    <span class="s2">if </span><span class="s1">obj.version == </span><span class="s5">1</span><span class="s1">:</span>
        <span class="s1">visitor.seen.update(obj.paletteLabels)</span>
        <span class="s1">visitor.seen.update(obj.paletteEntryLabels)</span>


<span class="s1">@NameRecordVisitor.register(ttLib.TTFont)</span>
<span class="s2">def </span><span class="s1">visit(visitor</span><span class="s2">, </span><span class="s1">font</span><span class="s2">, </span><span class="s1">*args</span><span class="s2">, </span><span class="s1">**kwargs):</span>
    <span class="s2">if </span><span class="s1">hasattr(visitor</span><span class="s2">, </span><span class="s3">&quot;font&quot;</span><span class="s1">):</span>
        <span class="s2">return False</span>

    <span class="s1">visitor.font = font</span>
    <span class="s2">for </span><span class="s1">tag </span><span class="s2">in </span><span class="s1">visitor.TABLES:</span>
        <span class="s2">if </span><span class="s1">tag </span><span class="s2">in </span><span class="s1">font:</span>
            <span class="s1">visitor.visit(font[tag]</span><span class="s2">, </span><span class="s1">*args</span><span class="s2">, </span><span class="s1">**kwargs)</span>
    <span class="s2">del </span><span class="s1">visitor.font</span>
    <span class="s2">return False</span>
</pre>
</body>
</html>
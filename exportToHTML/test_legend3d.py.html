<html>
<head>
<title>test_legend3d.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_legend3d.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.colors </span><span class="s0">import </span><span class="s1">same_color</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">mpl_toolkits.mplot3d </span><span class="s0">import </span><span class="s1">art3d</span>


<span class="s2"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s3">'legend_plot.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=(</span><span class="s3">'mpl20'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_legend_plot():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s4">5 </span><span class="s1">- x</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'z=1'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">x - </span><span class="s4">5</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'z=-1'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s2"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s3">'legend_bar.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=(</span><span class="s3">'mpl20'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_legend_bar():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">b1 = ax.bar(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'edge'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'m'</span><span class="s1">)</span>
    <span class="s1">b2 = ax.bar(x</span><span class="s0">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'edge'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'g'</span><span class="s1">)</span>
    <span class="s1">ax.legend([b1[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">b2[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'up'</span><span class="s0">, </span><span class="s3">'down'</span><span class="s1">])</span>


<span class="s2"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s3">'fancy.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=(</span><span class="s3">'mpl20'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_fancy():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.full(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.full(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'o--'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'line'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.errorbar(np.full(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.full(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">xerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">zerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'errorbar'</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s3">'lower left'</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">title=</span><span class="s3">'My legend'</span><span class="s0">, </span><span class="s1">numpoints=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_linecollection_scaled_dashes():</span>
    <span class="s1">lines1 = [[(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">.2</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">)]]</span>
    <span class="s1">lines2 = [[[</span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.8</span><span class="s0">, </span><span class="s4">.4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.1</span><span class="s1">]]]</span>
    <span class="s1">lines3 = [[[</span><span class="s4">0.6</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.8</span><span class="s0">, </span><span class="s4">.4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.1</span><span class="s1">]]]</span>
    <span class="s1">lc1 = art3d.Line3DCollection(lines1</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s3">&quot;--&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">lc2 = art3d.Line3DCollection(lines2</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s3">&quot;-.&quot;</span><span class="s1">)</span>
    <span class="s1">lc3 = art3d.Line3DCollection(lines3</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s3">&quot;:&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">.5</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">ax.add_collection(lc1)</span>
    <span class="s1">ax.add_collection(lc2)</span>
    <span class="s1">ax.add_collection(lc3)</span>

    <span class="s1">leg = ax.legend([lc1</span><span class="s0">, </span><span class="s1">lc2</span><span class="s0">, </span><span class="s1">lc3]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'line1'</span><span class="s0">, </span><span class="s3">'line2'</span><span class="s0">, </span><span class="s3">'line 3'</span><span class="s1">])</span>
    <span class="s1">h1</span><span class="s0">, </span><span class="s1">h2</span><span class="s0">, </span><span class="s1">h3 = leg.legend_handles</span>

    <span class="s0">for </span><span class="s1">oh</span><span class="s0">, </span><span class="s1">lh </span><span class="s0">in </span><span class="s1">zip((lc1</span><span class="s0">, </span><span class="s1">lc2</span><span class="s0">, </span><span class="s1">lc3)</span><span class="s0">, </span><span class="s1">(h1</span><span class="s0">, </span><span class="s1">h2</span><span class="s0">, </span><span class="s1">h3)):</span>
        <span class="s0">assert </span><span class="s1">oh.get_linestyles()[</span><span class="s4">0</span><span class="s1">] == lh._dash_pattern</span>


<span class="s0">def </span><span class="s1">test_handlerline3d():</span>
    <span class="s2"># Test marker consistency for monolithic Line3D legend handler.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">ax.scatter([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">&quot;v&quot;</span><span class="s1">)</span>
    <span class="s1">handles = [art3d.Line3D([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">&quot;v&quot;</span><span class="s1">)]</span>
    <span class="s1">leg = ax.legend(handles</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;Aardvark&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">numpoints=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">handles[</span><span class="s4">0</span><span class="s1">].get_marker() == leg.legend_handles[</span><span class="s4">0</span><span class="s1">].get_marker()</span>


<span class="s0">def </span><span class="s1">test_contour_legend_elements():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.mgrid[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">h = x * y</span>
    <span class="s1">colors = [</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'#00FF00'</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">cs = ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">h</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">, </span><span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>

    <span class="s1">artists</span><span class="s0">, </span><span class="s1">labels = cs.legend_elements()</span>
    <span class="s0">assert </span><span class="s1">labels == [</span><span class="s3">'$x = 10.0$'</span><span class="s0">, </span><span class="s3">'$x = 30.0$'</span><span class="s0">, </span><span class="s3">'$x = 50.0$'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">all(isinstance(a</span><span class="s0">, </span><span class="s1">mpl.lines.Line2D) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists)</span>
    <span class="s0">assert </span><span class="s1">all(same_color(a.get_color()</span><span class="s0">, </span><span class="s1">c)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip(artists</span><span class="s0">, </span><span class="s1">colors))</span>


<span class="s0">def </span><span class="s1">test_contourf_legend_elements():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.mgrid[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">h = x * y</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s3">'3d'</span><span class="s1">))</span>
    <span class="s1">cs = ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">h</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">50</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">colors=[</span><span class="s3">'#FFFF00'</span><span class="s0">, </span><span class="s3">'#FF00FF'</span><span class="s0">, </span><span class="s3">'#00FFFF'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s1">cs.cmap.set_over(</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">cs.cmap.set_under(</span><span class="s3">'blue'</span><span class="s1">)</span>
    <span class="s1">cs.changed()</span>
    <span class="s1">artists</span><span class="s0">, </span><span class="s1">labels = cs.legend_elements()</span>
    <span class="s0">assert </span><span class="s1">labels == [</span><span class="s3">'$x </span><span class="s0">\\</span><span class="s3">leq -1e+250s$'</span><span class="s0">,</span>
                      <span class="s3">'$10.0 &lt; x </span><span class="s0">\\</span><span class="s3">leq 30.0$'</span><span class="s0">,</span>
                      <span class="s3">'$30.0 &lt; x </span><span class="s0">\\</span><span class="s3">leq 50.0$'</span><span class="s0">,</span>
                      <span class="s3">'$x &gt; 1e+250s$'</span><span class="s1">]</span>
    <span class="s1">expected_colors = (</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'#FFFF00'</span><span class="s0">, </span><span class="s3">'#FF00FF'</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">all(isinstance(a</span><span class="s0">, </span><span class="s1">mpl.patches.Rectangle) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists)</span>
    <span class="s0">assert </span><span class="s1">all(same_color(a.get_facecolor()</span><span class="s0">, </span><span class="s1">c)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip(artists</span><span class="s0">, </span><span class="s1">expected_colors))</span>


<span class="s0">def </span><span class="s1">test_legend_Poly3dCollection():</span>

    <span class="s1">verts = np.asarray([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s1">mesh = art3d.Poly3DCollection([verts]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;surface&quot;</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s3">&quot;projection&quot;</span><span class="s1">: </span><span class="s3">&quot;3d&quot;</span><span class="s1">})</span>
    <span class="s1">mesh.set_edgecolor(</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">handle = ax.add_collection3d(mesh)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">assert </span><span class="s1">(leg.legend_handles[</span><span class="s4">0</span><span class="s1">].get_facecolor()</span>
            <span class="s1">== handle.get_facecolor()).all()</span>
</pre>
</body>
</html>
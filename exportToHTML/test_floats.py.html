<html>
<head>
<title>test_floats.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_floats.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">RangeIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">def </span><span class="s1">gen_obj(klass</span><span class="s0">, </span><span class="s1">index):</span>
    <span class="s0">if </span><span class="s1">klass </span><span class="s0">is </span><span class="s1">Series:</span>
        <span class="s1">obj = Series(np.arange(len(index))</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">obj = DataFrame(</span>
            <span class="s1">np.random.default_rng(</span><span class="s2">2</span><span class="s1">).standard_normal((len(index)</span><span class="s0">, </span><span class="s1">len(index)))</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
            <span class="s1">columns=index</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">return </span><span class="s1">obj</span>


<span class="s0">class </span><span class="s1">TestFloatIndexers:</span>
    <span class="s0">def </span><span class="s1">check(self</span><span class="s0">, </span><span class="s1">result</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">indexer</span><span class="s0">, </span><span class="s1">getitem):</span>
        <span class="s3">&quot;&quot;&quot; 
        comparator for results 
        we need to take care if we are indexing on a 
        Series or a frame 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">isinstance(original</span><span class="s0">, </span><span class="s1">Series):</span>
            <span class="s1">expected = original.iloc[indexer]</span>
        <span class="s0">elif </span><span class="s1">getitem:</span>
            <span class="s1">expected = original.iloc[:</span><span class="s0">, </span><span class="s1">indexer]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">expected = original.iloc[indexer]</span>

        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;index_func&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">tm.makeStringIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeCategoricalIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeDateIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeTimedeltaIndex</span><span class="s0">,</span>
            <span class="s1">tm.makePeriodIndex</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_scalar_non_numeric(self</span><span class="s0">, </span><span class="s1">index_func</span><span class="s0">, </span><span class="s1">frame_or_series</span><span class="s0">, </span><span class="s1">indexer_sl):</span>
        <span class="s5"># GH 4892</span>
        <span class="s5"># float_indexers should raise exceptions</span>
        <span class="s5"># on appropriate Index types &amp; accessors</span>

        <span class="s1">i = index_func(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">s = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">i)</span>

        <span class="s5"># getting</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;^3.0$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s)[</span><span class="s2">3.0</span><span class="s1">]</span>

        <span class="s5"># contains</span>
        <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">not in </span><span class="s1">s</span>

        <span class="s1">s2 = s.copy()</span>
        <span class="s1">indexer_sl(s2)[</span><span class="s2">3.0</span><span class="s1">] = </span><span class="s2">10</span>

        <span class="s0">if </span><span class="s1">indexer_sl </span><span class="s0">is </span><span class="s1">tm.setitem:</span>
            <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">in </span><span class="s1">s2.axes[-</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s0">elif </span><span class="s1">indexer_sl </span><span class="s0">is </span><span class="s1">tm.loc:</span>
            <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">in </span><span class="s1">s2.axes[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">not in </span><span class="s1">s2.axes[</span><span class="s2">0</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">not in </span><span class="s1">s2.axes[-</span><span class="s2">1</span><span class="s1">]</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;index_func&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">tm.makeStringIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeCategoricalIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeDateIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeTimedeltaIndex</span><span class="s0">,</span>
            <span class="s1">tm.makePeriodIndex</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_scalar_non_numeric_series_fallback(self</span><span class="s0">, </span><span class="s1">index_func):</span>
        <span class="s5"># fallsback to position selection, series only</span>
        <span class="s1">i = index_func(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">s = Series(np.arange(len(i))</span><span class="s0">, </span><span class="s1">index=i)</span>

        <span class="s1">msg = </span><span class="s4">&quot;Series.__getitem__ treating keys as positions is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s[</span><span class="s2">3</span><span class="s1">]</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;^3.0$&quot;</span><span class="s1">):</span>
            <span class="s1">s[</span><span class="s2">3.0</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_scalar_with_mixed(self</span><span class="s0">, </span><span class="s1">indexer_sl):</span>
        <span class="s1">s2 = Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">s3 = Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">])</span>

        <span class="s5"># lookup in a pure string index with an invalid indexer</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;^1.0$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s2)[</span><span class="s2">1.0</span><span class="s1">]</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">r&quot;^1\.0$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s2)[</span><span class="s2">1.0</span><span class="s1">]</span>

        <span class="s1">result = indexer_sl(s2)[</span><span class="s4">&quot;b&quot;</span><span class="s1">]</span>
        <span class="s1">expected = </span><span class="s2">2</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s5"># mixed index so we have label</span>
        <span class="s5"># indexing</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;^1.0$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s3)[</span><span class="s2">1.0</span><span class="s1">]</span>

        <span class="s0">if </span><span class="s1">indexer_sl </span><span class="s0">is not </span><span class="s1">tm.loc:</span>
            <span class="s5"># __getitem__ falls back to positional</span>
            <span class="s1">msg = </span><span class="s4">&quot;Series.__getitem__ treating keys as positions is deprecated&quot;</span>
            <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">result = s3[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s1">expected = </span><span class="s2">2</span>
            <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">r&quot;^1\.0$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s3)[</span><span class="s2">1.0</span><span class="s1">]</span>

        <span class="s1">result = indexer_sl(s3)[</span><span class="s2">1.5</span><span class="s1">]</span>
        <span class="s1">expected = </span><span class="s2">3</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;index_func&quot;</span><span class="s0">, </span><span class="s1">[tm.makeIntIndex</span><span class="s0">, </span><span class="s1">tm.makeRangeIndex])</span>
    <span class="s0">def </span><span class="s1">test_scalar_integer(self</span><span class="s0">, </span><span class="s1">index_func</span><span class="s0">, </span><span class="s1">frame_or_series</span><span class="s0">, </span><span class="s1">indexer_sl):</span>
        <span class="s1">getitem = indexer_sl </span><span class="s0">is not </span><span class="s1">tm.loc</span>

        <span class="s5"># test how scalar float indexers work on int indexes</span>

        <span class="s5"># integer index</span>
        <span class="s1">i = index_func(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">obj = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">i)</span>

        <span class="s5"># coerce to equal int</span>

        <span class="s1">result = indexer_sl(obj)[</span><span class="s2">3.0</span><span class="s1">]</span>
        <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">getitem)</span>

        <span class="s0">if </span><span class="s1">isinstance(obj</span><span class="s0">, </span><span class="s1">Series):</span>

            <span class="s0">def </span><span class="s1">compare(x</span><span class="s0">, </span><span class="s1">y):</span>
                <span class="s0">assert </span><span class="s1">x == y</span>

            <span class="s1">expected = </span><span class="s2">100</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">compare = tm.assert_series_equal</span>
            <span class="s0">if </span><span class="s1">getitem:</span>
                <span class="s1">expected = Series(</span><span class="s2">100</span><span class="s0">, </span><span class="s1">index=range(len(obj))</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">3</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">expected = Series(</span><span class="s2">100.0</span><span class="s0">, </span><span class="s1">index=range(len(obj))</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">3</span><span class="s1">)</span>

        <span class="s1">s2 = obj.copy()</span>
        <span class="s1">indexer_sl(s2)[</span><span class="s2">3.0</span><span class="s1">] = </span><span class="s2">100</span>

        <span class="s1">result = indexer_sl(s2)[</span><span class="s2">3.0</span><span class="s1">]</span>
        <span class="s1">compare(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = indexer_sl(s2)[</span><span class="s2">3</span><span class="s1">]</span>
        <span class="s1">compare(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;index_func&quot;</span><span class="s0">, </span><span class="s1">[tm.makeIntIndex</span><span class="s0">, </span><span class="s1">tm.makeRangeIndex])</span>
    <span class="s0">def </span><span class="s1">test_scalar_integer_contains_float(self</span><span class="s0">, </span><span class="s1">index_func</span><span class="s0">, </span><span class="s1">frame_or_series):</span>
        <span class="s5"># contains</span>
        <span class="s5"># integer index</span>
        <span class="s1">index = index_func(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">obj = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">index)</span>

        <span class="s5"># coerce to equal int</span>
        <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">in </span><span class="s1">obj</span>

    <span class="s0">def </span><span class="s1">test_scalar_float(self</span><span class="s0">, </span><span class="s1">frame_or_series):</span>
        <span class="s5"># scalar float indexers work on a float index</span>
        <span class="s1">index = Index(np.arange(</span><span class="s2">5.0</span><span class="s1">))</span>
        <span class="s1">s = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">index)</span>

        <span class="s5"># assert all operations except for iloc are ok</span>
        <span class="s1">indexer = index[</span><span class="s2">3</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">idxr </span><span class="s0">in </span><span class="s1">[tm.loc</span><span class="s0">, </span><span class="s1">tm.setitem]:</span>
            <span class="s1">getitem = idxr </span><span class="s0">is not </span><span class="s1">tm.loc</span>

            <span class="s5"># getting</span>
            <span class="s1">result = idxr(s)[indexer]</span>
            <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">getitem)</span>

            <span class="s5"># setting</span>
            <span class="s1">s2 = s.copy()</span>

            <span class="s1">result = idxr(s2)[indexer]</span>
            <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">getitem)</span>

            <span class="s5"># random float is a KeyError</span>
            <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">r&quot;^3\.5$&quot;</span><span class="s1">):</span>
                <span class="s1">idxr(s)[</span><span class="s2">3.5</span><span class="s1">]</span>

        <span class="s5"># contains</span>
        <span class="s0">assert </span><span class="s2">3.0 </span><span class="s0">in </span><span class="s1">s</span>

        <span class="s5"># iloc succeeds with an integer</span>
        <span class="s1">expected = s.iloc[</span><span class="s2">3</span><span class="s1">]</span>
        <span class="s1">s2 = s.copy()</span>

        <span class="s1">s2.iloc[</span><span class="s2">3</span><span class="s1">] = expected</span>
        <span class="s1">result = s2.iloc[</span><span class="s2">3</span><span class="s1">]</span>
        <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, False</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;index_func&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">tm.makeStringIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeDateIndex</span><span class="s0">,</span>
            <span class="s1">tm.makeTimedeltaIndex</span><span class="s0">,</span>
            <span class="s1">tm.makePeriodIndex</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_slice_non_numeric(self</span><span class="s0">, </span><span class="s1">index_func</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">frame_or_series</span><span class="s0">, </span><span class="s1">indexer_sli):</span>
        <span class="s5"># GH 4892</span>
        <span class="s5"># float_indexers should raise exceptions</span>
        <span class="s5"># on appropriate Index types &amp; accessors</span>

        <span class="s1">index = index_func(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">s = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">index)</span>

        <span class="s5"># getitem</span>
        <span class="s0">if </span><span class="s1">indexer_sli </span><span class="s0">is </span><span class="s1">tm.iloc:</span>
            <span class="s1">msg = (</span>
                <span class="s4">&quot;cannot do positional indexing &quot;</span>
                <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[(3|4)\.0\] of &quot;</span>
                <span class="s4">&quot;type float&quot;</span>
            <span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">msg = (</span>
                <span class="s4">&quot;cannot do slice indexing &quot;</span>
                <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers &quot;</span>
                <span class="s4">r&quot;\[(3|4)(\.0)?\] &quot;</span>
                <span class="s4">r&quot;of type (float|int)&quot;</span>
            <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">indexer_sli(s)[idx]</span>

        <span class="s5"># setitem</span>
        <span class="s0">if </span><span class="s1">indexer_sli </span><span class="s0">is </span><span class="s1">tm.iloc:</span>
            <span class="s5"># otherwise we keep the same message as above</span>
            <span class="s1">msg = </span><span class="s4">&quot;slice indices must be integers or None or have an __index__ method&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">indexer_sli(s)[idx] = </span><span class="s2">0</span>

    <span class="s0">def </span><span class="s1">test_slice_integer(self):</span>
        <span class="s5"># same as above, but for Integer based indexes</span>
        <span class="s5"># these coerce to a like integer</span>
        <span class="s5"># oob indicates if we are out of bounds</span>
        <span class="s5"># of positional indexing</span>
        <span class="s0">for </span><span class="s1">index</span><span class="s0">, </span><span class="s1">oob </span><span class="s0">in </span><span class="s1">[</span>
            <span class="s1">(Index(np.arange(</span><span class="s2">5</span><span class="s0">, </span><span class="s1">dtype=np.int64))</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(RangeIndex(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(Index(np.arange(</span><span class="s2">5</span><span class="s0">, </span><span class="s1">dtype=np.int64) + </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]:</span>
            <span class="s5"># s is an in-range index</span>
            <span class="s1">s = Series(range(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>

            <span class="s5"># getitem</span>
            <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">[slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)]:</span>
                <span class="s1">result = s.loc[idx]</span>

                <span class="s5"># these are all label indexing</span>
                <span class="s5"># except getitem which is positional</span>
                <span class="s5"># empty</span>
                <span class="s0">if </span><span class="s1">oob:</span>
                    <span class="s1">indexer = slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">indexer = slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
                <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">indexer</span><span class="s0">, False</span><span class="s1">)</span>

            <span class="s5"># getitem out-of-bounds</span>
            <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">[slice(-</span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(-</span><span class="s2">6.0</span><span class="s0">, </span><span class="s2">6.0</span><span class="s1">)]:</span>
                <span class="s1">result = s.loc[idx]</span>

                <span class="s5"># these are all label indexing</span>
                <span class="s5"># except getitem which is positional</span>
                <span class="s5"># empty</span>
                <span class="s0">if </span><span class="s1">oob:</span>
                    <span class="s1">indexer = slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">indexer = slice(-</span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span>
                <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">indexer</span><span class="s0">, False</span><span class="s1">)</span>

            <span class="s5"># positional indexing</span>
            <span class="s1">msg = (</span>
                <span class="s4">&quot;cannot do slice indexing &quot;</span>
                <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[-6\.0\] of &quot;</span>
                <span class="s4">&quot;type float&quot;</span>
            <span class="s1">)</span>
            <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">s[slice(-</span><span class="s2">6.0</span><span class="s0">, </span><span class="s2">6.0</span><span class="s1">)]</span>

            <span class="s5"># getitem odd floats</span>
            <span class="s0">for </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">res1 </span><span class="s0">in </span><span class="s1">[</span>
                <span class="s1">(slice(</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s1">(slice(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s1">(slice(</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">3.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">]:</span>
                <span class="s1">result = s.loc[idx]</span>
                <span class="s0">if </span><span class="s1">oob:</span>
                    <span class="s1">res = slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">res = res1</span>

                <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">res</span><span class="s0">, False</span><span class="s1">)</span>

                <span class="s5"># positional indexing</span>
                <span class="s1">msg = (</span>
                    <span class="s4">&quot;cannot do slice indexing &quot;</span>
                    <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[(2|3)\.5\] of &quot;</span>
                    <span class="s4">&quot;type float&quot;</span>
                <span class="s1">)</span>
                <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                    <span class="s1">s[idx]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[slice(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_integer_positional_indexing(self</span><span class="s0">, </span><span class="s1">idx):</span>
        <span class="s3">&quot;&quot;&quot;make sure that we are raising on positional indexing 
        w.r.t. an integer index 
        &quot;&quot;&quot;</span>
        <span class="s1">s = Series(range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>

        <span class="s1">result = s[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">4</span><span class="s1">]</span>
        <span class="s1">expected = s.iloc[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">4</span><span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">klass = RangeIndex</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;cannot do (slice|positional) indexing &quot;</span>
            <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">klass.__name__</span><span class="s0">} </span><span class="s4">with these indexers \[(2|4)\.0\] of &quot;</span>
            <span class="s4">&quot;type float&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s[idx]</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s.iloc[idx]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;index_func&quot;</span><span class="s0">, </span><span class="s1">[tm.makeIntIndex</span><span class="s0">, </span><span class="s1">tm.makeRangeIndex])</span>
    <span class="s0">def </span><span class="s1">test_slice_integer_frame_getitem(self</span><span class="s0">, </span><span class="s1">index_func):</span>
        <span class="s5"># similar to above, but on the getitem dim (of a DataFrame)</span>
        <span class="s1">index = index_func(</span><span class="s2">5</span><span class="s1">)</span>

        <span class="s1">s = DataFrame(np.random.default_rng(</span><span class="s2">2</span><span class="s1">).standard_normal((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">index=index)</span>

        <span class="s5"># getitem</span>
        <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">[slice(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">)]:</span>
            <span class="s1">result = s.loc[idx]</span>
            <span class="s1">indexer = slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
            <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">indexer</span><span class="s0">, False</span><span class="s1">)</span>

            <span class="s5"># positional indexing</span>
            <span class="s1">msg = (</span>
                <span class="s4">&quot;cannot do slice indexing &quot;</span>
                <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[(0|1)\.0\] of &quot;</span>
                <span class="s4">&quot;type float&quot;</span>
            <span class="s1">)</span>
            <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">s[idx]</span>

        <span class="s5"># getitem out-of-bounds</span>
        <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">[slice(-</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(-</span><span class="s2">10.0</span><span class="s0">, </span><span class="s2">10.0</span><span class="s1">)]:</span>
            <span class="s1">result = s.loc[idx]</span>
            <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">slice(-</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, True</span><span class="s1">)</span>

        <span class="s5"># positional indexing</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;cannot do slice indexing &quot;</span>
            <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[-10\.0\] of &quot;</span>
            <span class="s4">&quot;type float&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s[slice(-</span><span class="s2">10.0</span><span class="s0">, </span><span class="s2">10.0</span><span class="s1">)]</span>

        <span class="s5"># getitem odd floats</span>
        <span class="s0">for </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">res </span><span class="s0">in </span><span class="s1">[</span>
            <span class="s1">(slice(</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">(slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">(slice(</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">]:</span>
            <span class="s1">result = s.loc[idx]</span>
            <span class="s1">self.check(result</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">res</span><span class="s0">, False</span><span class="s1">)</span>

            <span class="s5"># positional indexing</span>
            <span class="s1">msg = (</span>
                <span class="s4">&quot;cannot do slice indexing &quot;</span>
                <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[0\.5\] of &quot;</span>
                <span class="s4">&quot;type float&quot;</span>
            <span class="s1">)</span>
            <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">s[idx]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;index_func&quot;</span><span class="s0">, </span><span class="s1">[tm.makeIntIndex</span><span class="s0">, </span><span class="s1">tm.makeRangeIndex])</span>
    <span class="s0">def </span><span class="s1">test_float_slice_getitem_with_integer_index_raises(self</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">index_func):</span>
        <span class="s5"># similar to above, but on the getitem dim (of a DataFrame)</span>
        <span class="s1">index = index_func(</span><span class="s2">5</span><span class="s1">)</span>

        <span class="s1">s = DataFrame(np.random.default_rng(</span><span class="s2">2</span><span class="s1">).standard_normal((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">index=index)</span>

        <span class="s5"># setitem</span>
        <span class="s1">sc = s.copy()</span>
        <span class="s1">sc.loc[idx] = </span><span class="s2">0</span>
        <span class="s1">result = sc.loc[idx].values.ravel()</span>
        <span class="s0">assert </span><span class="s1">(result == </span><span class="s2">0</span><span class="s1">).all()</span>

        <span class="s5"># positional indexing</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;cannot do slice indexing &quot;</span>
            <span class="s4">rf&quot;on </span><span class="s0">{</span><span class="s1">type(index).__name__</span><span class="s0">} </span><span class="s4">with these indexers \[(3|4)\.0\] of &quot;</span>
            <span class="s4">&quot;type float&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s[idx] = </span><span class="s2">0</span>

        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s[idx]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_slice_float(self</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">frame_or_series</span><span class="s0">, </span><span class="s1">indexer_sl):</span>
        <span class="s5"># same as above, but for floats</span>
        <span class="s1">index = Index(np.arange(</span><span class="s2">5.0</span><span class="s1">)) + </span><span class="s2">0.1</span>
        <span class="s1">s = gen_obj(frame_or_series</span><span class="s0">, </span><span class="s1">index)</span>

        <span class="s1">expected = s.iloc[</span><span class="s2">3</span><span class="s1">:</span><span class="s2">4</span><span class="s1">]</span>

        <span class="s5"># getitem</span>
        <span class="s1">result = indexer_sl(s)[idx]</span>
        <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">type(s))</span>
        <span class="s1">tm.assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s5"># setitem</span>
        <span class="s1">s2 = s.copy()</span>
        <span class="s1">indexer_sl(s2)[idx] = </span><span class="s2">0</span>
        <span class="s1">result = indexer_sl(s2)[idx].values.ravel()</span>
        <span class="s0">assert </span><span class="s1">(result == </span><span class="s2">0</span><span class="s1">).all()</span>

    <span class="s0">def </span><span class="s1">test_floating_index_doc_example(self):</span>
        <span class="s1">index = Index([</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4.5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">])</span>
        <span class="s1">s = Series(range(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s0">assert </span><span class="s1">s[</span><span class="s2">3</span><span class="s1">] == </span><span class="s2">2</span>
        <span class="s0">assert </span><span class="s1">s.loc[</span><span class="s2">3</span><span class="s1">] == </span><span class="s2">2</span>
        <span class="s0">assert </span><span class="s1">s.iloc[</span><span class="s2">3</span><span class="s1">] == </span><span class="s2">3</span>

    <span class="s0">def </span><span class="s1">test_floating_misc(self</span><span class="s0">, </span><span class="s1">indexer_sl):</span>
        <span class="s5"># related 236</span>
        <span class="s5"># scalar/slicing of a float index</span>
        <span class="s1">s = Series(np.arange(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=np.arange(</span><span class="s2">5</span><span class="s1">) * </span><span class="s2">2.5</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>

        <span class="s5"># label based slicing</span>
        <span class="s1">result = indexer_sl(s)[</span><span class="s2">1.0</span><span class="s1">:</span><span class="s2">3.0</span><span class="s1">]</span>
        <span class="s1">expected = Series(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">2.5</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s5"># exact indexing when found</span>

        <span class="s1">result = indexer_sl(s)[</span><span class="s2">5.0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">result == </span><span class="s2">2</span>

        <span class="s1">result = indexer_sl(s)[</span><span class="s2">5</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">result == </span><span class="s2">2</span>

        <span class="s5"># value not found (and no fallbacking at all)</span>

        <span class="s5"># scalar integers</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">r&quot;^4$&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s)[</span><span class="s2">4</span><span class="s1">]</span>

        <span class="s5"># fancy floats/integers create the correct entry (as nan)</span>
        <span class="s5"># fancy tests</span>
        <span class="s1">expected = Series([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=Index([</span><span class="s2">5.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float64))</span>
        <span class="s0">for </span><span class="s1">fancy_idx </span><span class="s0">in </span><span class="s1">[[</span><span class="s2">5.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">5.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">])]:  </span><span class="s5"># float</span>
            <span class="s1">tm.assert_series_equal(indexer_sl(s)[fancy_idx]</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = Series([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=Index([</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;float64&quot;</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">fancy_idx </span><span class="s0">in </span><span class="s1">[[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])]:</span>
            <span class="s1">tm.assert_series_equal(indexer_sl(s)[fancy_idx]</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">warn = FutureWarning </span><span class="s0">if </span><span class="s1">indexer_sl </span><span class="s0">is </span><span class="s1">tm.setitem </span><span class="s0">else None</span>
        <span class="s1">msg = </span><span class="s4">r&quot;The behavior of obj\[i:j\] with a float-dtype index&quot;</span>

        <span class="s5"># all should return the same as we are slicing 'the same'</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(warn</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">result1 = indexer_sl(s)[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">5</span><span class="s1">]</span>
        <span class="s1">result2 = indexer_sl(s)[</span><span class="s2">2.0</span><span class="s1">:</span><span class="s2">5.0</span><span class="s1">]</span>
        <span class="s1">result3 = indexer_sl(s)[</span><span class="s2">2.0</span><span class="s1">:</span><span class="s2">5</span><span class="s1">]</span>
        <span class="s1">result4 = indexer_sl(s)[</span><span class="s2">2.1</span><span class="s1">:</span><span class="s2">5</span><span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">result2)</span>
        <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">result3)</span>
        <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">result4)</span>

        <span class="s1">expected = Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">5.0</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(warn</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">result = indexer_sl(s)[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">5</span><span class="s1">]</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s5"># list selection</span>
        <span class="s1">result1 = indexer_sl(s)[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]]</span>
        <span class="s1">result2 = s.iloc[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span>
        <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">result2)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;not in index&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s)[[</span><span class="s2">1.6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]]</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;not in index&quot;</span><span class="s1">):</span>
            <span class="s1">indexer_sl(s)[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span>

        <span class="s1">result = indexer_sl(s)[[</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">5.0</span><span class="s1">]))</span>

        <span class="s1">result = indexer_sl(s)[[</span><span class="s2">2.5</span><span class="s1">]]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series([</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">2.5</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_floatindex_slicing_bug(self</span><span class="s0">, </span><span class="s1">float_numpy_dtype):</span>
        <span class="s5"># GH 5557, related to slicing a float index</span>
        <span class="s1">dtype = float_numpy_dtype</span>
        <span class="s1">ser = {</span>
            <span class="s2">256</span><span class="s1">: </span><span class="s2">2321.0</span><span class="s0">,</span>
            <span class="s2">1</span><span class="s1">: </span><span class="s2">78.0</span><span class="s0">,</span>
            <span class="s2">2</span><span class="s1">: </span><span class="s2">2716.0</span><span class="s0">,</span>
            <span class="s2">3</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">4</span><span class="s1">: </span><span class="s2">369.0</span><span class="s0">,</span>
            <span class="s2">5</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">6</span><span class="s1">: </span><span class="s2">269.0</span><span class="s0">,</span>
            <span class="s2">7</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">8</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">9</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">10</span><span class="s1">: </span><span class="s2">3536.0</span><span class="s0">,</span>
            <span class="s2">11</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">12</span><span class="s1">: </span><span class="s2">24.0</span><span class="s0">,</span>
            <span class="s2">13</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">14</span><span class="s1">: </span><span class="s2">931.0</span><span class="s0">,</span>
            <span class="s2">15</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">16</span><span class="s1">: </span><span class="s2">101.0</span><span class="s0">,</span>
            <span class="s2">17</span><span class="s1">: </span><span class="s2">78.0</span><span class="s0">,</span>
            <span class="s2">18</span><span class="s1">: </span><span class="s2">9643.0</span><span class="s0">,</span>
            <span class="s2">19</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">20</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">21</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">22</span><span class="s1">: </span><span class="s2">63761.0</span><span class="s0">,</span>
            <span class="s2">23</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">24</span><span class="s1">: </span><span class="s2">446.0</span><span class="s0">,</span>
            <span class="s2">25</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">26</span><span class="s1">: </span><span class="s2">34773.0</span><span class="s0">,</span>
            <span class="s2">27</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">28</span><span class="s1">: </span><span class="s2">729.0</span><span class="s0">,</span>
            <span class="s2">29</span><span class="s1">: </span><span class="s2">78.0</span><span class="s0">,</span>
            <span class="s2">30</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">31</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">32</span><span class="s1">: </span><span class="s2">3374.0</span><span class="s0">,</span>
            <span class="s2">33</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">34</span><span class="s1">: </span><span class="s2">1391.0</span><span class="s0">,</span>
            <span class="s2">35</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">36</span><span class="s1">: </span><span class="s2">361.0</span><span class="s0">,</span>
            <span class="s2">37</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">38</span><span class="s1">: </span><span class="s2">61808.0</span><span class="s0">,</span>
            <span class="s2">39</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">40</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">41</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">42</span><span class="s1">: </span><span class="s2">6677.0</span><span class="s0">,</span>
            <span class="s2">43</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">44</span><span class="s1">: </span><span class="s2">802.0</span><span class="s0">,</span>
            <span class="s2">45</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">46</span><span class="s1">: </span><span class="s2">2691.0</span><span class="s0">,</span>
            <span class="s2">47</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">48</span><span class="s1">: </span><span class="s2">3582.0</span><span class="s0">,</span>
            <span class="s2">49</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">50</span><span class="s1">: </span><span class="s2">734.0</span><span class="s0">,</span>
            <span class="s2">51</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">52</span><span class="s1">: </span><span class="s2">627.0</span><span class="s0">,</span>
            <span class="s2">53</span><span class="s1">: </span><span class="s2">70.0</span><span class="s0">,</span>
            <span class="s2">54</span><span class="s1">: </span><span class="s2">2584.0</span><span class="s0">,</span>
            <span class="s2">55</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">56</span><span class="s1">: </span><span class="s2">324.0</span><span class="s0">,</span>
            <span class="s2">57</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">58</span><span class="s1">: </span><span class="s2">605.0</span><span class="s0">,</span>
            <span class="s2">59</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">60</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">61</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">62</span><span class="s1">: </span><span class="s2">3989.0</span><span class="s0">,</span>
            <span class="s2">63</span><span class="s1">: </span><span class="s2">10.0</span><span class="s0">,</span>
            <span class="s2">64</span><span class="s1">: </span><span class="s2">42.0</span><span class="s0">,</span>
            <span class="s2">65</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">66</span><span class="s1">: </span><span class="s2">904.0</span><span class="s0">,</span>
            <span class="s2">67</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">68</span><span class="s1">: </span><span class="s2">88.0</span><span class="s0">,</span>
            <span class="s2">69</span><span class="s1">: </span><span class="s2">70.0</span><span class="s0">,</span>
            <span class="s2">70</span><span class="s1">: </span><span class="s2">8172.0</span><span class="s0">,</span>
            <span class="s2">71</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">72</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">73</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">74</span><span class="s1">: </span><span class="s2">64902.0</span><span class="s0">,</span>
            <span class="s2">75</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">76</span><span class="s1">: </span><span class="s2">347.0</span><span class="s0">,</span>
            <span class="s2">77</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">78</span><span class="s1">: </span><span class="s2">36605.0</span><span class="s0">,</span>
            <span class="s2">79</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">80</span><span class="s1">: </span><span class="s2">379.0</span><span class="s0">,</span>
            <span class="s2">81</span><span class="s1">: </span><span class="s2">70.0</span><span class="s0">,</span>
            <span class="s2">82</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">83</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">84</span><span class="s1">: </span><span class="s2">3001.0</span><span class="s0">,</span>
            <span class="s2">85</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">86</span><span class="s1">: </span><span class="s2">1630.0</span><span class="s0">,</span>
            <span class="s2">87</span><span class="s1">: </span><span class="s2">7.0</span><span class="s0">,</span>
            <span class="s2">88</span><span class="s1">: </span><span class="s2">364.0</span><span class="s0">,</span>
            <span class="s2">89</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">90</span><span class="s1">: </span><span class="s2">67404.0</span><span class="s0">,</span>
            <span class="s2">91</span><span class="s1">: </span><span class="s2">9.0</span><span class="s0">,</span>
            <span class="s2">92</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">93</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">94</span><span class="s1">: </span><span class="s2">7685.0</span><span class="s0">,</span>
            <span class="s2">95</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">96</span><span class="s1">: </span><span class="s2">1017.0</span><span class="s0">,</span>
            <span class="s2">97</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">98</span><span class="s1">: </span><span class="s2">2831.0</span><span class="s0">,</span>
            <span class="s2">99</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">100</span><span class="s1">: </span><span class="s2">2963.0</span><span class="s0">,</span>
            <span class="s2">101</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">102</span><span class="s1">: </span><span class="s2">854.0</span><span class="s0">,</span>
            <span class="s2">103</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">104</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">105</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">106</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">107</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">108</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">109</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">110</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">111</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">112</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">113</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">114</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">115</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">116</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">117</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">118</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">119</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">120</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">121</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">122</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">123</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">124</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">125</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">126</span><span class="s1">: </span><span class="s2">67744.0</span><span class="s0">,</span>
            <span class="s2">127</span><span class="s1">: </span><span class="s2">22.0</span><span class="s0">,</span>
            <span class="s2">128</span><span class="s1">: </span><span class="s2">264.0</span><span class="s0">,</span>
            <span class="s2">129</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">260</span><span class="s1">: </span><span class="s2">197.0</span><span class="s0">,</span>
            <span class="s2">268</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">265</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">269</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">261</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">266</span><span class="s1">: </span><span class="s2">1198.0</span><span class="s0">,</span>
            <span class="s2">267</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">262</span><span class="s1">: </span><span class="s2">2629.0</span><span class="s0">,</span>
            <span class="s2">258</span><span class="s1">: </span><span class="s2">775.0</span><span class="s0">,</span>
            <span class="s2">257</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">263</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">259</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">264</span><span class="s1">: </span><span class="s2">163.0</span><span class="s0">,</span>
            <span class="s2">250</span><span class="s1">: </span><span class="s2">10326.0</span><span class="s0">,</span>
            <span class="s2">251</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">252</span><span class="s1">: </span><span class="s2">1228.0</span><span class="s0">,</span>
            <span class="s2">253</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
            <span class="s2">254</span><span class="s1">: </span><span class="s2">2769.0</span><span class="s0">,</span>
            <span class="s2">255</span><span class="s1">: </span><span class="s2">0.0</span><span class="s0">,</span>
        <span class="s1">}</span>

        <span class="s5"># smoke test for the repr</span>
        <span class="s1">s = Series(ser</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">result = s.value_counts()</span>
        <span class="s0">assert </span><span class="s1">result.index.dtype == dtype</span>
        <span class="s1">str(result)</span>
</pre>
</body>
</html>
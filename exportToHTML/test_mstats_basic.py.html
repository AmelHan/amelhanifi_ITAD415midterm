<html>
<head>
<title>test_mstats_basic.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_mstats_basic.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for the stats.mstats module (support for masked arrays) 
&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">import </span><span class="s1">platform</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">nan</span>
<span class="s2">import </span><span class="s1">numpy.ma </span><span class="s2">as </span><span class="s1">ma</span>
<span class="s2">from </span><span class="s1">numpy.ma </span><span class="s2">import </span><span class="s1">masked</span><span class="s2">, </span><span class="s1">nomask</span>

<span class="s2">import </span><span class="s1">scipy.stats.mstats </span><span class="s2">as </span><span class="s1">mstats</span>
<span class="s2">from </span><span class="s1">scipy </span><span class="s2">import </span><span class="s1">stats</span>
<span class="s2">from </span><span class="s1">.common_tests </span><span class="s2">import </span><span class="s1">check_named_results</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>
<span class="s2">from </span><span class="s1">numpy.ma.testutils </span><span class="s2">import </span><span class="s1">(assert_equal</span><span class="s2">, </span><span class="s1">assert_almost_equal</span><span class="s2">,</span>
                                <span class="s1">assert_array_almost_equal</span><span class="s2">,</span>
                                <span class="s1">assert_array_almost_equal_nulp</span><span class="s2">, </span><span class="s1">assert_</span><span class="s2">,</span>
                                <span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_array_equal)</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">suppress_warnings</span>
<span class="s2">from </span><span class="s1">scipy.stats </span><span class="s2">import </span><span class="s1">_mstats_basic</span>


<span class="s2">class </span><span class="s1">TestMquantiles:</span>
    <span class="s2">def </span><span class="s1">test_mquantiles_limit_keyword(self):</span>
        <span class="s3"># Regression test for Trac ticket #867</span>
        <span class="s1">data = np.array([[</span><span class="s4">6.</span><span class="s2">, </span><span class="s4">7.</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">47.</span><span class="s2">, </span><span class="s4">15.</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">49.</span><span class="s2">, </span><span class="s4">36.</span><span class="s2">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">15.</span><span class="s2">, </span><span class="s4">39.</span><span class="s2">, </span><span class="s4">4.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">42.</span><span class="s2">, </span><span class="s4">40.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">41.</span><span class="s2">, </span><span class="s4">41.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">7.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">39.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">43.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">40.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">36.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">999.</span><span class="s1">]])</span>
        <span class="s1">desired = [[</span><span class="s4">19.2</span><span class="s2">, </span><span class="s4">14.6</span><span class="s2">, </span><span class="s4">1.45</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s4">40.0</span><span class="s2">, </span><span class="s4">37.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s4">42.8</span><span class="s2">, </span><span class="s4">40.05</span><span class="s2">, </span><span class="s4">3.55</span><span class="s1">]]</span>
        <span class="s1">quants = mstats.mquantiles(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">limit=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">50</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(quants</span><span class="s2">, </span><span class="s1">desired)</span>


<span class="s2">def </span><span class="s1">check_equal_gmean(array_like</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">dtype=</span><span class="s2">None, </span><span class="s1">rtol=</span><span class="s4">1e-7</span><span class="s1">):</span>
    <span class="s3"># Note this doesn't test when axis is not specified</span>
    <span class="s1">x = mstats.gmean(array_like</span><span class="s2">, </span><span class="s1">axis=axis</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">assert_allclose(x</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">rtol=rtol)</span>
    <span class="s1">assert_equal(x.dtype</span><span class="s2">, </span><span class="s1">dtype)</span>


<span class="s2">def </span><span class="s1">check_equal_hmean(array_like</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">dtype=</span><span class="s2">None, </span><span class="s1">rtol=</span><span class="s4">1e-7</span><span class="s1">):</span>
    <span class="s1">x = stats.hmean(array_like</span><span class="s2">, </span><span class="s1">axis=axis</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">assert_allclose(x</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">rtol=rtol)</span>
    <span class="s1">assert_equal(x.dtype</span><span class="s2">, </span><span class="s1">dtype)</span>


<span class="s2">class </span><span class="s1">TestGeoMean:</span>
    <span class="s2">def </span><span class="s1">test_1d(self):</span>
        <span class="s1">a = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span>
        <span class="s1">desired = np.power(</span><span class="s4">1</span><span class="s1">*</span><span class="s4">2</span><span class="s1">*</span><span class="s4">3</span><span class="s1">*</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">4.</span><span class="s1">)</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_1d_ma(self):</span>
        <span class="s3">#  Test a 1d masked array</span>
        <span class="s1">a = ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">45.2872868812</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

        <span class="s1">a = ma.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired = np.power(</span><span class="s4">1</span><span class="s1">*</span><span class="s4">2</span><span class="s1">*</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_1d_ma_value(self):</span>
        <span class="s3">#  Test a 1d masked array with a masked value</span>
        <span class="s1">a = np.ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">41.4716627439</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

    <span class="s2">def </span><span class="s1">test_1d_ma0(self):</span>
        <span class="s3">#  Test a 1d masked array with zero element</span>
        <span class="s1">a = np.ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">0</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

    <span class="s2">def </span><span class="s1">test_1d_ma_inf(self):</span>
        <span class="s3">#  Test a 1d masked array with negative element</span>
        <span class="s1">a = np.ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired = np.nan</span>
        <span class="s2">with </span><span class="s1">np.errstate(invalid=</span><span class="s5">'ignore'</span><span class="s1">):</span>
            <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">hasattr(np</span><span class="s2">, </span><span class="s5">'float96'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">reason=</span><span class="s5">'cannot find float96 so skipping'</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_1d_float96(self):</span>
        <span class="s1">a = ma.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired_dt = np.power(</span><span class="s4">1</span><span class="s1">*</span><span class="s4">2</span><span class="s1">*</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3.</span><span class="s1">).astype(np.float96)</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired_dt</span><span class="s2">, </span><span class="s1">dtype=np.float96</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_2d_ma(self):</span>
        <span class="s1">a = ma.array([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]]</span><span class="s2">,</span>
                     <span class="s1">mask=[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">desired = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s1">desired = ma.array([np.power(</span><span class="s4">1</span><span class="s1">*</span><span class="s4">2</span><span class="s1">*</span><span class="s4">3</span><span class="s1">*</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">4.</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">np.power(</span><span class="s4">2</span><span class="s1">*</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">2.</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">np.power(</span><span class="s4">1</span><span class="s1">*</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">2.</span><span class="s1">)])</span>
        <span class="s1">check_equal_gmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s3">#  Test a 2d masked array</span>
        <span class="s1">a = [[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">110</span><span class="s2">, </span><span class="s4">120</span><span class="s1">]]</span>
        <span class="s1">desired = </span><span class="s4">52.8885199</span>
        <span class="s1">check_equal_gmean(np.ma.array(a)</span><span class="s2">, </span><span class="s1">desired)</span>


<span class="s2">class </span><span class="s1">TestHarMean:</span>
    <span class="s2">def </span><span class="s1">test_1d(self):</span>
        <span class="s1">a = ma.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">3. </span><span class="s1">/ (</span><span class="s4">1.</span><span class="s1">/</span><span class="s4">1 </span><span class="s1">+ </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s1">a = np.ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">34.1417152147</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

        <span class="s1">a = np.ma.array([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired = </span><span class="s4">31.8137186141</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired)</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">hasattr(np</span><span class="s2">, </span><span class="s5">'float96'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">reason=</span><span class="s5">'cannot find float96 so skipping'</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_1d_float96(self):</span>
        <span class="s1">a = ma.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">desired_dt = np.asarray(</span><span class="s4">3. </span><span class="s1">/ (</span><span class="s4">1.</span><span class="s1">/</span><span class="s4">1 </span><span class="s1">+ </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.float96)</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired_dt</span><span class="s2">, </span><span class="s1">dtype=np.float96)</span>

    <span class="s2">def </span><span class="s1">test_2d(self):</span>
        <span class="s1">a = ma.array([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]]</span><span class="s2">,</span>
                     <span class="s1">mask=[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">desired = ma.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s1">desired = [</span><span class="s4">4.</span><span class="s1">/(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">1.</span><span class="s1">+</span><span class="s4">1</span><span class="s1">/</span><span class="s4">2.</span><span class="s1">+</span><span class="s4">1</span><span class="s1">/</span><span class="s4">3.</span><span class="s1">+</span><span class="s4">1</span><span class="s1">/</span><span class="s4">4.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">/(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">2.</span><span class="s1">+</span><span class="s4">1</span><span class="s1">/</span><span class="s4">3.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">/(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">1.</span><span class="s1">+</span><span class="s4">1</span><span class="s1">/</span><span class="s4">4.</span><span class="s1">)]</span>
        <span class="s1">check_equal_hmean(a</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s1">a = [[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">50</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">80</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">90</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">110</span><span class="s2">, </span><span class="s4">120</span><span class="s1">]]</span>
        <span class="s1">desired = </span><span class="s4">38.6696271841</span>
        <span class="s1">check_equal_hmean(np.ma.array(a)</span><span class="s2">, </span><span class="s1">desired)</span>


<span class="s2">class </span><span class="s1">TestRanking:</span>
    <span class="s2">def </span><span class="s1">test_ranking(self):</span>
        <span class="s1">x = ma.array([</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">10</span><span class="s1">])</span>
        <span class="s1">x[[</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s1">]] = masked</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2.5</span><span class="s2">,</span><span class="s4">2.5</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">8</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x</span><span class="s2">, </span><span class="s1">use_missing=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2.5</span><span class="s2">,</span><span class="s4">2.5</span><span class="s2">,</span><span class="s4">4.5</span><span class="s2">,</span><span class="s4">4.5</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">8</span><span class="s1">])</span>
        <span class="s1">x = ma.array([</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">10</span><span class="s1">])</span>
        <span class="s1">x = ma.array([[</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s1">]])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x)</span><span class="s2">,</span>
                            <span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">10</span><span class="s1">]])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3.5</span><span class="s2">,</span><span class="s4">3.5</span><span class="s2">,</span><span class="s4">5</span><span class="s1">]])</span>
        <span class="s1">assert_almost_equal(mstats.rankdata(x</span><span class="s2">,</span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s1">]])</span>


<span class="s2">class </span><span class="s1">TestCorr:</span>
    <span class="s2">def </span><span class="s1">test_pearsonr(self):</span>
        <span class="s3"># Tests some computations of Pearson's r</span>
        <span class="s1">x = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s3"># The tests in this context are edge cases, with perfect</span>
            <span class="s3"># correlation or anticorrelation, or totally masked data.</span>
            <span class="s3"># None of these should trigger a RuntimeWarning.</span>
            <span class="s1">warnings.simplefilter(</span><span class="s5">&quot;error&quot;</span><span class="s2">, </span><span class="s1">RuntimeWarning)</span>

            <span class="s1">assert_almost_equal(mstats.pearsonr(x</span><span class="s2">, </span><span class="s1">x)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(mstats.pearsonr(x</span><span class="s2">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">])[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s1">)</span>

            <span class="s1">x = ma.array(x</span><span class="s2">, </span><span class="s1">mask=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">pr = mstats.pearsonr(x</span><span class="s2">, </span><span class="s1">x)</span>
            <span class="s1">assert_(pr[</span><span class="s4">0</span><span class="s1">] </span><span class="s2">is </span><span class="s1">masked)</span>
            <span class="s1">assert_(pr[</span><span class="s4">1</span><span class="s1">] </span><span class="s2">is </span><span class="s1">masked)</span>

        <span class="s1">x1 = ma.array([-</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">])</span>
        <span class="s1">y1 = ma.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = mstats.pearsonr(x1</span><span class="s2">, </span><span class="s1">y1)</span>
        <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">np.sqrt(</span><span class="s4">3</span><span class="s1">)/</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>

        <span class="s3"># (x2, y2) have the same unmasked data as (x1, y1).</span>
        <span class="s1">mask = [</span><span class="s2">False, False, False, True</span><span class="s1">]</span>
        <span class="s1">x2 = ma.array([-</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">99.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">y2 = ma.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = mstats.pearsonr(x2</span><span class="s2">, </span><span class="s1">y2)</span>
        <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">np.sqrt(</span><span class="s4">3</span><span class="s1">)/</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_pearsonr_misaligned_mask(self):</span>
        <span class="s1">mx = np.ma.masked_array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">my = np.ma.masked_array([</span><span class="s4">9</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">x = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s4">9</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">9</span><span class="s1">])</span>
        <span class="s1">mr</span><span class="s2">, </span><span class="s1">mp = mstats.pearsonr(mx</span><span class="s2">, </span><span class="s1">my)</span>
        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = stats.pearsonr(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">assert_equal(mr</span><span class="s2">, </span><span class="s1">r)</span>
        <span class="s1">assert_equal(mp</span><span class="s2">, </span><span class="s1">p)</span>

    <span class="s2">def </span><span class="s1">test_spearmanr(self):</span>
        <span class="s3"># Tests some computations of Spearman's rho</span>
        <span class="s1">(x</span><span class="s2">, </span><span class="s1">y) = ([</span><span class="s4">5.05</span><span class="s2">,</span><span class="s4">6.75</span><span class="s2">,</span><span class="s4">3.21</span><span class="s2">,</span><span class="s4">2.66</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1.65</span><span class="s2">,</span><span class="s4">2.64</span><span class="s2">,</span><span class="s4">2.64</span><span class="s2">,</span><span class="s4">6.95</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.spearmanr(x</span><span class="s2">,</span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.6324555</span><span class="s1">)</span>
        <span class="s1">(x</span><span class="s2">, </span><span class="s1">y) = ([</span><span class="s4">5.05</span><span class="s2">,</span><span class="s4">6.75</span><span class="s2">,</span><span class="s4">3.21</span><span class="s2">,</span><span class="s4">2.66</span><span class="s2">,</span><span class="s1">np.nan]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1.65</span><span class="s2">,</span><span class="s4">2.64</span><span class="s2">,</span><span class="s4">2.64</span><span class="s2">,</span><span class="s4">6.95</span><span class="s2">,</span><span class="s1">np.nan])</span>
        <span class="s1">(x</span><span class="s2">, </span><span class="s1">y) = (ma.fix_invalid(x)</span><span class="s2">, </span><span class="s1">ma.fix_invalid(y))</span>
        <span class="s1">assert_almost_equal(mstats.spearmanr(x</span><span class="s2">,</span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.6324555</span><span class="s1">)</span>

        <span class="s1">x = [</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">47.4</span><span class="s2">, </span><span class="s4">42.0</span><span class="s2">, </span><span class="s4">10.8</span><span class="s2">, </span><span class="s4">60.1</span><span class="s2">, </span><span class="s4">1.7</span><span class="s2">, </span><span class="s4">64.0</span><span class="s2">, </span><span class="s4">63.1</span><span class="s2">,</span>
             <span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">, </span><span class="s4">7.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">3.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">6.7</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s4">22.6</span><span class="s2">, </span><span class="s4">8.3</span><span class="s2">, </span><span class="s4">44.4</span><span class="s2">, </span><span class="s4">11.9</span><span class="s2">, </span><span class="s4">24.6</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">5.7</span><span class="s2">, </span><span class="s4">41.6</span><span class="s2">,</span>
             <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">6.7</span><span class="s2">, </span><span class="s4">3.8</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.4</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(mstats.spearmanr(x</span><span class="s2">,</span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.6887299</span><span class="s1">)</span>
        <span class="s1">x = [</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">47.4</span><span class="s2">, </span><span class="s4">42.0</span><span class="s2">, </span><span class="s4">10.8</span><span class="s2">, </span><span class="s4">60.1</span><span class="s2">, </span><span class="s4">1.7</span><span class="s2">, </span><span class="s4">64.0</span><span class="s2">, </span><span class="s4">63.1</span><span class="s2">,</span>
             <span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">, </span><span class="s4">7.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">3.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">6.7</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">y = [</span><span class="s4">22.6</span><span class="s2">, </span><span class="s4">8.3</span><span class="s2">, </span><span class="s4">44.4</span><span class="s2">, </span><span class="s4">11.9</span><span class="s2">, </span><span class="s4">24.6</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">5.7</span><span class="s2">, </span><span class="s4">41.6</span><span class="s2">,</span>
             <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">6.7</span><span class="s2">, </span><span class="s4">3.8</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">(x</span><span class="s2">, </span><span class="s1">y) = (ma.fix_invalid(x)</span><span class="s2">, </span><span class="s1">ma.fix_invalid(y))</span>
        <span class="s1">assert_almost_equal(mstats.spearmanr(x</span><span class="s2">,</span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.6887299</span><span class="s1">)</span>
        <span class="s3"># Next test is to make sure calculation uses sufficient precision.</span>
        <span class="s3"># The denominator's value is ~n^3 and used to be represented as an</span>
        <span class="s3"># int. 2000**3 &gt; 2**32 so these arrays would cause overflow on</span>
        <span class="s3"># some machines.</span>
        <span class="s1">x = list(range(</span><span class="s4">2000</span><span class="s1">))</span>
        <span class="s1">y = list(range(</span><span class="s4">2000</span><span class="s1">))</span>
        <span class="s1">y[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">9</span><span class="s1">] = y[</span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">10</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">434</span><span class="s1">] = y[</span><span class="s4">434</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">10</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">435</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">1509</span><span class="s1">] = y[</span><span class="s4">1509</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s4">435</span><span class="s1">]</span>
        <span class="s3"># rho = 1 - 6 * (2 * (9^2 + 424^2 + 1074^2))/(2000 * (2000^2 - 1))</span>
        <span class="s3">#     = 1 - (1 / 500)</span>
        <span class="s3">#     = 0.998</span>
        <span class="s1">assert_almost_equal(mstats.spearmanr(x</span><span class="s2">,</span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.998</span><span class="s1">)</span>

        <span class="s3"># test for namedtuple attributes</span>
        <span class="s1">res = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">attributes = (</span><span class="s5">'correlation'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spearmanr_alternative(self):</span>
        <span class="s3"># check against R</span>
        <span class="s3"># options(digits=16)</span>
        <span class="s3"># cor.test(c(2.0, 47.4, 42.0, 10.8, 60.1, 1.7, 64.0, 63.1,</span>
        <span class="s3">#            1.0, 1.4, 7.9, 0.3, 3.9, 0.3, 6.7),</span>
        <span class="s3">#          c(22.6, 8.3, 44.4, 11.9, 24.6, 0.6, 5.7, 41.6,</span>
        <span class="s3">#            0.0, 0.6, 6.7, 3.8, 1.0, 1.2, 1.4),</span>
        <span class="s3">#          alternative='two.sided', method='spearman')</span>
        <span class="s1">x = [</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">47.4</span><span class="s2">, </span><span class="s4">42.0</span><span class="s2">, </span><span class="s4">10.8</span><span class="s2">, </span><span class="s4">60.1</span><span class="s2">, </span><span class="s4">1.7</span><span class="s2">, </span><span class="s4">64.0</span><span class="s2">, </span><span class="s4">63.1</span><span class="s2">,</span>
             <span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">, </span><span class="s4">7.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">3.9</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">6.7</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s4">22.6</span><span class="s2">, </span><span class="s4">8.3</span><span class="s2">, </span><span class="s4">44.4</span><span class="s2">, </span><span class="s4">11.9</span><span class="s2">, </span><span class="s4">24.6</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">5.7</span><span class="s2">, </span><span class="s4">41.6</span><span class="s2">,</span>
             <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">6.7</span><span class="s2">, </span><span class="s4">3.8</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.4</span><span class="s1">]</span>

        <span class="s1">r_exp = </span><span class="s4">0.6887298747763864  </span><span class="s3"># from cor.test</span>

        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">r_exp)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s4">0.004519192910756</span><span class="s1">)</span>

        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'greater'</span><span class="s1">)</span>
        <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">r_exp)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s4">0.002259596455378</span><span class="s1">)</span>

        <span class="s1">r</span><span class="s2">, </span><span class="s1">p = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'less'</span><span class="s1">)</span>
        <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">r_exp)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s4">0.9977404035446</span><span class="s1">)</span>

        <span class="s3"># intuitive test (with obvious positive correlation)</span>
        <span class="s1">n = </span><span class="s4">100</span>
        <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">n)</span>
        <span class="s1">y = </span><span class="s4">0.1</span><span class="s1">*x + np.random.rand(n)  </span><span class="s3"># y is positively correlated w/ x</span>

        <span class="s1">stat1</span><span class="s2">, </span><span class="s1">p1 = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y)</span>

        <span class="s1">stat2</span><span class="s2">, </span><span class="s1">p2 = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">&quot;greater&quot;</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p2</span><span class="s2">, </span><span class="s1">p1 / </span><span class="s4">2</span><span class="s1">)  </span><span class="s3"># positive correlation -&gt; small p</span>

        <span class="s1">stat3</span><span class="s2">, </span><span class="s1">p3 = mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">&quot;less&quot;</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p3</span><span class="s2">, </span><span class="s4">1 </span><span class="s1">- p1 / </span><span class="s4">2</span><span class="s1">)  </span><span class="s3"># positive correlation -&gt; large p</span>

        <span class="s2">assert </span><span class="s1">stat1 == stat2 == stat3</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s5">&quot;alternative must be 'less'...&quot;</span><span class="s1">):</span>
            <span class="s1">mstats.spearmanr(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">&quot;ekki-ekki&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.skipif(platform.machine() == </span><span class="s5">'ppc64le'</span><span class="s2">,</span>
                        <span class="s1">reason=</span><span class="s5">&quot;fails/crashes on ppc64le&quot;</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_kendalltau(self):</span>
        <span class="s3"># check case with maximum disorder and p=1</span>
        <span class="s1">x = ma.array(np.array([</span><span class="s4">9</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]))</span>
        <span class="s1">y = ma.array(np.array([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">11</span><span class="s1">]))</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># simple case without ties</span>
        <span class="s1">x = ma.array(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">y = ma.array(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">5.511463844797e-07</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># check exception in case of invalid method keyword</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.kendalltau</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">method=</span><span class="s5">'banana'</span><span class="s1">)</span>

        <span class="s3"># swap a couple of values</span>
        <span class="s1">b = y[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">1</span><span class="s1">] = y[</span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">2</span><span class="s1">] = b</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [</span><span class="s4">0.9555555555555556</span><span class="s2">, </span><span class="s4">5.511463844797e-06</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># swap a couple more</span>
        <span class="s1">b = y[</span><span class="s4">5</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">5</span><span class="s1">] = y[</span><span class="s4">6</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">6</span><span class="s1">] = b</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [</span><span class="s4">0.9111111111111111</span><span class="s2">, </span><span class="s4">2.976190476190e-05</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># same in opposite direction</span>
        <span class="s1">x = ma.array(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">y = ma.array(np.arange(</span><span class="s4">10</span><span class="s1">)[::-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [-</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">5.511463844797e-07</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># swap a couple of values</span>
        <span class="s1">b = y[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">1</span><span class="s1">] = y[</span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">2</span><span class="s1">] = b</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [-</span><span class="s4">0.9555555555555556</span><span class="s2">, </span><span class="s4">5.511463844797e-06</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># swap a couple more</span>
        <span class="s1">b = y[</span><span class="s4">5</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">5</span><span class="s1">] = y[</span><span class="s4">6</span><span class="s1">]</span>
        <span class="s1">y[</span><span class="s4">6</span><span class="s1">] = b</span>
        <span class="s3"># Cross-check with exact result from R:</span>
        <span class="s3"># cor.test(x,y,method=&quot;kendall&quot;,exact=1)</span>
        <span class="s1">expected = [-</span><span class="s4">0.9111111111111111</span><span class="s2">, </span><span class="s4">2.976190476190e-05</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># Tests some computations of Kendall's tau</span>
        <span class="s1">x = ma.fix_invalid([</span><span class="s4">5.05</span><span class="s2">, </span><span class="s4">6.75</span><span class="s2">, </span><span class="s4">3.21</span><span class="s2">, </span><span class="s4">2.66</span><span class="s2">, </span><span class="s1">np.nan])</span>
        <span class="s1">y = ma.fix_invalid([</span><span class="s4">1.65</span><span class="s2">, </span><span class="s4">26.5</span><span class="s2">, </span><span class="s1">-</span><span class="s4">5.93</span><span class="s2">, </span><span class="s4">7.96</span><span class="s2">, </span><span class="s1">np.nan])</span>
        <span class="s1">z = ma.fix_invalid([</span><span class="s4">1.65</span><span class="s2">, </span><span class="s4">2.64</span><span class="s2">, </span><span class="s4">2.64</span><span class="s2">, </span><span class="s4">6.95</span><span class="s2">, </span><span class="s1">np.nan])</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y))</span><span class="s2">,</span>
                            <span class="s1">[+</span><span class="s4">0.3333333</span><span class="s2">, </span><span class="s4">0.75</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">method=</span><span class="s5">'asymptotic'</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s1">[+</span><span class="s4">0.3333333</span><span class="s2">, </span><span class="s4">0.4969059</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(np.asarray(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">z))</span><span class="s2">,</span>
                            <span class="s1">[-</span><span class="s4">0.5477226</span><span class="s2">, </span><span class="s4">0.2785987</span><span class="s1">])</span>
        <span class="s3">#</span>
        <span class="s1">x = ma.fix_invalid([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">,</span>
                            <span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">np.nan])</span>
        <span class="s1">y = ma.fix_invalid([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">33</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">67</span><span class="s2">, </span><span class="s4">27</span><span class="s2">,</span>
                            <span class="s4">25</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">45</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">result = mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">assert_almost_equal(np.asarray(result)</span><span class="s2">, </span><span class="s1">[-</span><span class="s4">0.1585188</span><span class="s2">, </span><span class="s4">0.4128009</span><span class="s1">])</span>

        <span class="s3"># test for namedtuple attributes</span>
        <span class="s1">attributes = (</span><span class="s5">'correlation'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(result</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.skipif(platform.machine() == </span><span class="s5">'ppc64le'</span><span class="s2">,</span>
                        <span class="s1">reason=</span><span class="s5">&quot;fails/crashes on ppc64le&quot;</span><span class="s1">)</span>
    <span class="s1">@pytest.mark.slow</span>
    <span class="s2">def </span><span class="s1">test_kendalltau_large(self):</span>
        <span class="s3"># make sure internal variable use correct precision with</span>
        <span class="s3"># larger arrays</span>
        <span class="s1">x = np.arange(</span><span class="s4">2000</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">x = ma.masked_greater(x</span><span class="s2">, </span><span class="s4">1995</span><span class="s1">)</span>
        <span class="s1">y = np.arange(</span><span class="s4">2000</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">y = np.concatenate((y[</span><span class="s4">1000</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">y[:</span><span class="s4">1000</span><span class="s1">]))</span>
        <span class="s1">assert_(np.isfinite(mstats.kendalltau(x</span><span class="s2">, </span><span class="s1">y)[</span><span class="s4">1</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_kendalltau_seasonal(self):</span>
        <span class="s3"># Tests the seasonal Kendall tau.</span>
        <span class="s1">x = [[nan</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">26</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">nan]</span><span class="s2">,</span>
             <span class="s1">[nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s1">x = ma.fix_invalid(x).T</span>
        <span class="s1">output = mstats.kendalltau_seasonal(x)</span>
        <span class="s1">assert_almost_equal(output[</span><span class="s5">'global p-value (indep)'</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.008</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(output[</span><span class="s5">'seasonal p-value'</span><span class="s1">].round(</span><span class="s4">2</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">0.18</span><span class="s2">,</span><span class="s4">0.53</span><span class="s2">,</span><span class="s4">0.20</span><span class="s2">,</span><span class="s4">0.04</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;method&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s5">&quot;exact&quot;</span><span class="s2">, </span><span class="s5">&quot;asymptotic&quot;</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;alternative&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s5">&quot;two-sided&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s2">, </span><span class="s5">&quot;less&quot;</span><span class="s1">))</span>
    <span class="s2">def </span><span class="s1">test_kendalltau_mstats_vs_stats(self</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">alternative):</span>
        <span class="s3"># Test that mstats.kendalltau and stats.kendalltau with</span>
        <span class="s3"># nan_policy='omit' matches behavior of stats.kendalltau</span>
        <span class="s3"># Accuracy of the alternatives is tested in stats/tests/test_stats.py</span>

        <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">n = </span><span class="s4">50</span>
        <span class="s1">x = np.random.rand(n)</span>
        <span class="s1">y = np.random.rand(n)</span>
        <span class="s1">mask = np.random.rand(n) &gt; </span><span class="s4">0.5</span>

        <span class="s1">x_masked = ma.array(x</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">y_masked = ma.array(y</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">res_masked = mstats.kendalltau(</span>
            <span class="s1">x_masked</span><span class="s2">, </span><span class="s1">y_masked</span><span class="s2">, </span><span class="s1">method=method</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>

        <span class="s1">x_compressed = x_masked.compressed()</span>
        <span class="s1">y_compressed = y_masked.compressed()</span>
        <span class="s1">res_compressed = stats.kendalltau(</span>
            <span class="s1">x_compressed</span><span class="s2">, </span><span class="s1">y_compressed</span><span class="s2">, </span><span class="s1">method=method</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>

        <span class="s1">x[mask] = np.nan</span>
        <span class="s1">y[mask] = np.nan</span>
        <span class="s1">res_nan = stats.kendalltau(</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">method=method</span><span class="s2">, </span><span class="s1">nan_policy=</span><span class="s5">'omit'</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>

        <span class="s1">assert_allclose(res_masked</span><span class="s2">, </span><span class="s1">res_compressed)</span>
        <span class="s1">assert_allclose(res_nan</span><span class="s2">, </span><span class="s1">res_compressed)</span>

    <span class="s2">def </span><span class="s1">test_kendall_p_exact_medium(self):</span>
        <span class="s3"># Test for the exact method with medium samples (some n &gt;= 171)</span>
        <span class="s3"># expected values generated using SymPy</span>
        <span class="s1">expectations = {(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">2393</span><span class="s1">): </span><span class="s4">0.62822615287956040664</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">101</span><span class="s2">, </span><span class="s4">2436</span><span class="s1">): </span><span class="s4">0.60439525773513602669</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">170</span><span class="s2">, </span><span class="s4">0</span><span class="s1">): </span><span class="s4">2.755801935583541e-307</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">171</span><span class="s2">, </span><span class="s4">0</span><span class="s1">): </span><span class="s4">0.0</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">171</span><span class="s2">, </span><span class="s4">1</span><span class="s1">): </span><span class="s4">2.755801935583541e-307</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">172</span><span class="s2">, </span><span class="s4">1</span><span class="s1">): </span><span class="s4">0.0</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">9797</span><span class="s1">): </span><span class="s4">0.74753983745929675209</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">201</span><span class="s2">, </span><span class="s4">9656</span><span class="s1">): </span><span class="s4">0.40959218958120363618</span><span class="s1">}</span>
        <span class="s2">for </span><span class="s1">nc</span><span class="s2">, </span><span class="s1">expected </span><span class="s2">in </span><span class="s1">expectations.items():</span>
            <span class="s1">res = _mstats_basic._kendall_p_exact(nc[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">nc[</span><span class="s4">1</span><span class="s1">])</span>
            <span class="s1">assert_almost_equal(res</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.xslow</span>
    <span class="s2">def </span><span class="s1">test_kendall_p_exact_large(self):</span>
        <span class="s3"># Test for the exact method with large samples (n &gt;= 171)</span>
        <span class="s3"># expected values generated using SymPy</span>
        <span class="s1">expectations = {(</span><span class="s4">400</span><span class="s2">, </span><span class="s4">38965</span><span class="s1">): </span><span class="s4">0.48444283672113314099</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">401</span><span class="s2">, </span><span class="s4">39516</span><span class="s1">): </span><span class="s4">0.66363159823474837662</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">800</span><span class="s2">, </span><span class="s4">156772</span><span class="s1">): </span><span class="s4">0.42265448483120932055</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">801</span><span class="s2">, </span><span class="s4">157849</span><span class="s1">): </span><span class="s4">0.53437553412194416236</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">1600</span><span class="s2">, </span><span class="s4">637472</span><span class="s1">): </span><span class="s4">0.84200727400323538419</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s4">1601</span><span class="s2">, </span><span class="s4">630304</span><span class="s1">): </span><span class="s4">0.34465255088058593946</span><span class="s1">}</span>

        <span class="s2">for </span><span class="s1">nc</span><span class="s2">, </span><span class="s1">expected </span><span class="s2">in </span><span class="s1">expectations.items():</span>
            <span class="s1">res = _mstats_basic._kendall_p_exact(nc[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">nc[</span><span class="s4">1</span><span class="s1">])</span>
            <span class="s1">assert_almost_equal(res</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pointbiserial(self):</span>
        <span class="s1">x = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
             <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s4">14.8</span><span class="s2">, </span><span class="s4">13.8</span><span class="s2">, </span><span class="s4">12.4</span><span class="s2">, </span><span class="s4">10.1</span><span class="s2">, </span><span class="s4">7.1</span><span class="s2">, </span><span class="s4">6.1</span><span class="s2">, </span><span class="s4">5.8</span><span class="s2">, </span><span class="s4">4.6</span><span class="s2">, </span><span class="s4">4.3</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">, </span><span class="s4">3.2</span><span class="s2">,</span>
             <span class="s4">3.0</span><span class="s2">, </span><span class="s4">2.8</span><span class="s2">, </span><span class="s4">2.8</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">2.4</span><span class="s2">, </span><span class="s4">2.3</span><span class="s2">, </span><span class="s4">2.1</span><span class="s2">, </span><span class="s4">1.7</span><span class="s2">, </span><span class="s4">1.7</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">1.3</span><span class="s2">, </span><span class="s4">1.3</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">,</span>
             <span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">assert_almost_equal(mstats.pointbiserialr(x</span><span class="s2">, </span><span class="s1">y)[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.36149</span><span class="s2">, </span><span class="s4">5</span><span class="s1">)</span>

        <span class="s3"># test for namedtuple attributes</span>
        <span class="s1">res = mstats.pointbiserialr(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">attributes = (</span><span class="s5">'correlation'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestTrimming:</span>

    <span class="s2">def </span><span class="s1">test_trim(self):</span>
        <span class="s1">a = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trim(a)</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,</span><span class="s4">8</span><span class="s2">,</span><span class="s4">9</span><span class="s1">])</span>
        <span class="s1">a = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trim(a</span><span class="s2">,</span><span class="s1">(</span><span class="s4">2</span><span class="s2">,</span><span class="s4">8</span><span class="s1">))</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None,None,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,</span><span class="s4">8</span><span class="s2">,None</span><span class="s1">])</span>
        <span class="s1">a = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trim(a</span><span class="s2">,</span><span class="s1">limits=(</span><span class="s4">2</span><span class="s2">,</span><span class="s4">8</span><span class="s1">)</span><span class="s2">,</span><span class="s1">inclusive=(</span><span class="s2">False,False</span><span class="s1">))</span><span class="s2">,</span>
                     <span class="s1">[</span><span class="s2">None,None,None,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,None,None</span><span class="s1">])</span>
        <span class="s1">a = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trim(a</span><span class="s2">,</span><span class="s1">limits=(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">,</span><span class="s1">relative=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">[</span><span class="s2">None,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s2">,None,None</span><span class="s1">])</span>

        <span class="s1">a = ma.arange(</span><span class="s4">12</span><span class="s1">)</span>
        <span class="s1">a[[</span><span class="s4">0</span><span class="s2">,</span><span class="s1">-</span><span class="s4">1</span><span class="s1">]] = a[</span><span class="s4">5</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(mstats.trim(a</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">,</span><span class="s4">8</span><span class="s1">))</span><span class="s2">,</span>
                     <span class="s1">[</span><span class="s2">None, None, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, None, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, None, None, None</span><span class="s1">])</span>

        <span class="s1">x = ma.arange(</span><span class="s4">100</span><span class="s1">).reshape(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">expected = [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">10 </span><span class="s1">+ [</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">70 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">20</span>
        <span class="s1">trimx = mstats.trim(x</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">trimx = mstats.trim(x</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">trimx = mstats.trim(x</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask.T.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s3"># same as above, but with an extra masked row inserted</span>
        <span class="s1">x = ma.arange(</span><span class="s4">110</span><span class="s1">).reshape(</span><span class="s4">11</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">expected = [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">20 </span><span class="s1">+ [</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">70 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">20</span>
        <span class="s1">trimx = mstats.trim(x</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">trimx = mstats.trim(x</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">trimx = mstats.trim(x.T</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">relative=</span><span class="s2">True, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx.T._mask.ravel()</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_trim_old(self):</span>
        <span class="s1">x = ma.arange(</span><span class="s4">100</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trimboth(x).count()</span><span class="s2">, </span><span class="s4">60</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trimtail(x</span><span class="s2">,</span><span class="s1">tail=</span><span class="s5">'r'</span><span class="s1">).count()</span><span class="s2">, </span><span class="s4">80</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s4">50</span><span class="s1">:</span><span class="s4">70</span><span class="s1">] = masked</span>
        <span class="s1">trimx = mstats.trimboth(x)</span>
        <span class="s1">assert_equal(trimx.count()</span><span class="s2">, </span><span class="s4">48</span><span class="s1">)</span>
        <span class="s1">assert_equal(trimx._mask</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">16 </span><span class="s1">+ [</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">34 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">20 </span><span class="s1">+ [</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">14 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">16</span><span class="s1">)</span>
        <span class="s1">x._mask = nomask</span>
        <span class="s1">x.shape = (</span><span class="s4">10</span><span class="s2">,</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trimboth(x).count()</span><span class="s2">, </span><span class="s4">60</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.trimtail(x).count()</span><span class="s2">, </span><span class="s4">80</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_trimr(self):</span>
        <span class="s1">x = ma.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">result = mstats.trimr(x</span><span class="s2">, </span><span class="s1">limits=(</span><span class="s4">0.15</span><span class="s2">, </span><span class="s4">0.14</span><span class="s1">)</span><span class="s2">, </span><span class="s1">inclusive=(</span><span class="s2">False, False</span><span class="s1">))</span>
        <span class="s1">expected = ma.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">mask=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">assert_equal(result.mask</span><span class="s2">, </span><span class="s1">expected.mask)</span>

    <span class="s2">def </span><span class="s1">test_trimmedmean(self):</span>
        <span class="s1">data = ma.array([</span><span class="s4">77</span><span class="s2">, </span><span class="s4">87</span><span class="s2">, </span><span class="s4">88</span><span class="s2">,</span><span class="s4">114</span><span class="s2">,</span><span class="s4">151</span><span class="s2">,</span><span class="s4">210</span><span class="s2">,</span><span class="s4">219</span><span class="s2">,</span><span class="s4">246</span><span class="s2">,</span><span class="s4">253</span><span class="s2">,</span><span class="s4">262</span><span class="s2">,</span>
                         <span class="s4">296</span><span class="s2">,</span><span class="s4">299</span><span class="s2">,</span><span class="s4">306</span><span class="s2">,</span><span class="s4">376</span><span class="s2">,</span><span class="s4">428</span><span class="s2">,</span><span class="s4">515</span><span class="s2">,</span><span class="s4">666</span><span class="s2">,</span><span class="s4">1310</span><span class="s2">,</span><span class="s4">2611</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.trimmed_mean(data</span><span class="s2">,</span><span class="s4">0.1</span><span class="s1">)</span><span class="s2">, </span><span class="s4">343</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(mstats.trimmed_mean(data</span><span class="s2">,</span><span class="s1">(</span><span class="s4">0.1</span><span class="s2">,</span><span class="s4">0.1</span><span class="s1">))</span><span class="s2">, </span><span class="s4">343</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(mstats.trimmed_mean(data</span><span class="s2">,</span><span class="s1">(</span><span class="s4">0.2</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">))</span><span class="s2">, </span><span class="s4">283</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_trimmedvar(self):</span>
        <span class="s3"># Basic test. Additional tests of all arguments, edge cases,</span>
        <span class="s3"># input validation, and proper treatment of masked arrays are needed.</span>
        <span class="s1">rng = np.random.default_rng(</span><span class="s4">3262323289434724460</span><span class="s1">)</span>
        <span class="s1">data_orig = rng.random(size=</span><span class="s4">20</span><span class="s1">)</span>
        <span class="s1">data = np.sort(data_orig)</span>
        <span class="s1">data = ma.array(data</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                    <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_allclose(mstats.trimmed_var(data_orig</span><span class="s2">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">data.var())</span>

    <span class="s2">def </span><span class="s1">test_trimmedstd(self):</span>
        <span class="s3"># Basic test. Additional tests of all arguments, edge cases,</span>
        <span class="s3"># input validation, and proper treatment of masked arrays are needed.</span>
        <span class="s1">rng = np.random.default_rng(</span><span class="s4">7121029245207162780</span><span class="s1">)</span>
        <span class="s1">data_orig = rng.random(size=</span><span class="s4">20</span><span class="s1">)</span>
        <span class="s1">data = np.sort(data_orig)</span>
        <span class="s1">data = ma.array(data</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                    <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_allclose(mstats.trimmed_std(data_orig</span><span class="s2">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">data.std())</span>

    <span class="s2">def </span><span class="s1">test_trimmed_stde(self):</span>
        <span class="s1">data = ma.array([</span><span class="s4">77</span><span class="s2">, </span><span class="s4">87</span><span class="s2">, </span><span class="s4">88</span><span class="s2">,</span><span class="s4">114</span><span class="s2">,</span><span class="s4">151</span><span class="s2">,</span><span class="s4">210</span><span class="s2">,</span><span class="s4">219</span><span class="s2">,</span><span class="s4">246</span><span class="s2">,</span><span class="s4">253</span><span class="s2">,</span><span class="s4">262</span><span class="s2">,</span>
                         <span class="s4">296</span><span class="s2">,</span><span class="s4">299</span><span class="s2">,</span><span class="s4">306</span><span class="s2">,</span><span class="s4">376</span><span class="s2">,</span><span class="s4">428</span><span class="s2">,</span><span class="s4">515</span><span class="s2">,</span><span class="s4">666</span><span class="s2">,</span><span class="s4">1310</span><span class="s2">,</span><span class="s4">2611</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.trimmed_stde(data</span><span class="s2">,</span><span class="s1">(</span><span class="s4">0.2</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">))</span><span class="s2">, </span><span class="s4">56.13193</span><span class="s2">, </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(mstats.trimmed_stde(data</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">56.13193</span><span class="s2">, </span><span class="s4">5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_winsorization(self):</span>
        <span class="s1">data = ma.array([</span><span class="s4">77</span><span class="s2">, </span><span class="s4">87</span><span class="s2">, </span><span class="s4">88</span><span class="s2">,</span><span class="s4">114</span><span class="s2">,</span><span class="s4">151</span><span class="s2">,</span><span class="s4">210</span><span class="s2">,</span><span class="s4">219</span><span class="s2">,</span><span class="s4">246</span><span class="s2">,</span><span class="s4">253</span><span class="s2">,</span><span class="s4">262</span><span class="s2">,</span>
                         <span class="s4">296</span><span class="s2">,</span><span class="s4">299</span><span class="s2">,</span><span class="s4">306</span><span class="s2">,</span><span class="s4">376</span><span class="s2">,</span><span class="s4">428</span><span class="s2">,</span><span class="s4">515</span><span class="s2">,</span><span class="s4">666</span><span class="s2">,</span><span class="s4">1310</span><span class="s2">,</span><span class="s4">2611</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(mstats.winsorize(data</span><span class="s2">,</span><span class="s1">(</span><span class="s4">0.2</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)).var(ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s4">21551.4</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">mstats.winsorize(data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.2</span><span class="s2">,</span><span class="s4">0.2</span><span class="s1">)</span><span class="s2">,</span><span class="s1">(</span><span class="s2">False,False</span><span class="s1">)).var(ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s4">11887.3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">data[</span><span class="s4">5</span><span class="s1">] = masked</span>
        <span class="s1">winsorized = mstats.winsorize(data)</span>
        <span class="s1">assert_equal(winsorized.mask</span><span class="s2">, </span><span class="s1">data.mask)</span>

    <span class="s2">def </span><span class="s1">test_winsorization_nan(self):</span>
        <span class="s1">data = ma.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.winsorize</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.05</span><span class="s1">)</span><span class="s2">,</span>
                      <span class="s1">nan_policy=</span><span class="s5">'raise'</span><span class="s1">)</span>
        <span class="s3"># Testing propagate (default behavior)</span>
        <span class="s1">assert_equal(mstats.winsorize(data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.4</span><span class="s1">))</span><span class="s2">,</span>
                     <span class="s1">ma.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]))</span>
        <span class="s1">assert_equal(mstats.winsorize(data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.8</span><span class="s1">))</span><span class="s2">,</span>
                     <span class="s1">ma.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan]))</span>
        <span class="s1">assert_equal(mstats.winsorize(data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nan_policy=</span><span class="s5">'omit'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">ma.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]))</span>
        <span class="s1">assert_equal(mstats.winsorize(data</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.8</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nan_policy=</span><span class="s5">'omit'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">ma.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]))</span>


<span class="s2">class </span><span class="s1">TestMoments:</span>
    <span class="s3"># Comparison numbers are found using R v.1.5.1</span>
    <span class="s3"># note that length(testcase) = 4</span>
    <span class="s3"># testmathworks comes from documentation for the</span>
    <span class="s3"># Statistics Toolbox for Matlab and can be found at both</span>
    <span class="s3"># https://www.mathworks.com/help/stats/kurtosis.html</span>
    <span class="s3"># https://www.mathworks.com/help/stats/skewness.html</span>
    <span class="s3"># Note that both test cases came from here.</span>
    <span class="s1">testcase = [</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">testmathworks = ma.fix_invalid([</span><span class="s4">1.165</span><span class="s2">, </span><span class="s4">0.6268</span><span class="s2">, </span><span class="s4">0.0751</span><span class="s2">, </span><span class="s4">0.3516</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.6965</span><span class="s2">,</span>
                                    <span class="s1">np.nan])</span>
    <span class="s1">testcase_2d = ma.array(</span>
        <span class="s1">np.array([[</span><span class="s4">0.05245846</span><span class="s2">, </span><span class="s4">0.50344235</span><span class="s2">, </span><span class="s4">0.86589117</span><span class="s2">, </span><span class="s4">0.36936353</span><span class="s2">, </span><span class="s4">0.46961149</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s4">0.11574073</span><span class="s2">, </span><span class="s4">0.31299969</span><span class="s2">, </span><span class="s4">0.45925772</span><span class="s2">, </span><span class="s4">0.72618805</span><span class="s2">, </span><span class="s4">0.75194407</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s4">0.67696689</span><span class="s2">, </span><span class="s4">0.91878127</span><span class="s2">, </span><span class="s4">0.09769044</span><span class="s2">, </span><span class="s4">0.04645137</span><span class="s2">, </span><span class="s4">0.37615733</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s4">0.05903624</span><span class="s2">, </span><span class="s4">0.29908861</span><span class="s2">, </span><span class="s4">0.34088298</span><span class="s2">, </span><span class="s4">0.66216337</span><span class="s2">, </span><span class="s4">0.83160998</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s4">0.64619526</span><span class="s2">, </span><span class="s4">0.94894632</span><span class="s2">, </span><span class="s4">0.27855892</span><span class="s2">, </span><span class="s4">0.0706151</span><span class="s2">, </span><span class="s4">0.39962917</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">mask=np.array([[</span><span class="s2">True, False, False, True, False</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s2">True, True, True, False, True</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s2">False, False, False, False, False</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s2">True, True, True, True, True</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s2">False, False, True, False, False</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">dtype=bool))</span>

    <span class="s2">def </span><span class="s1">_assert_equal(self</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">, </span><span class="s1">*</span><span class="s2">, </span><span class="s1">shape=</span><span class="s2">None, </span><span class="s1">dtype=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s1">expect = np.asarray(expect)</span>
        <span class="s2">if </span><span class="s1">shape </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s1">expect = np.broadcast_to(expect</span><span class="s2">, </span><span class="s1">shape)</span>
        <span class="s1">assert_array_equal(actual</span><span class="s2">, </span><span class="s1">expect)</span>
        <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">dtype = expect.dtype</span>
        <span class="s2">assert </span><span class="s1">actual.dtype == dtype</span>

    <span class="s2">def </span><span class="s1">test_moment(self):</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">,</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">0.0</span><span class="s2">,</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">,</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">1.25</span><span class="s1">)</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">,</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">0.0</span><span class="s1">)</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">,</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">2.5625</span><span class="s1">)</span>

        <span class="s3"># check array_like input for moment</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">assert_allclose(y</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.25</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2.5625</span><span class="s1">])</span>

        <span class="s3"># check moment input consists only of integers</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">)</span>
        <span class="s1">assert_allclose(y</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.moment</span><span class="s2">, </span><span class="s1">self.testcase</span><span class="s2">, </span><span class="s4">1.2</span><span class="s1">)</span>
        <span class="s1">y = mstats.moment(self.testcase</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">])</span>
        <span class="s1">assert_allclose(y</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.25</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2.5625</span><span class="s1">])</span>

        <span class="s3"># test empty input</span>
        <span class="s1">y = mstats.moment([])</span>
        <span class="s1">self._assert_equal(y</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s1">y = mstats.moment(np.array([]</span><span class="s2">, </span><span class="s1">dtype=np.float32))</span>
        <span class="s1">self._assert_equal(y</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">y = mstats.moment(np.zeros((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self._assert_equal(y</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s4">0</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s1">y = mstats.moment([[]]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self._assert_equal(y</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s1">y = mstats.moment([[]]</span><span class="s2">, </span><span class="s1">moment=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self._assert_equal(y</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span>

        <span class="s1">x = np.arange(</span><span class="s4">10.</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s4">9</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_equal(mstats.moment(x</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ma.masked)  </span><span class="s3"># NaN value is ignored</span>

    <span class="s2">def </span><span class="s1">test_variation(self):</span>
        <span class="s1">y = mstats.variation(self.testcase)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">0.44721359549996</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_variation_ddof(self):</span>
        <span class="s3"># test variation with delta degrees of freedom</span>
        <span class="s3"># regression test for gh-13341</span>
        <span class="s1">a = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">y = mstats.variation(a</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">, </span><span class="s4">0.5270462766947299</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_skewness(self):</span>
        <span class="s1">y = mstats.skew(self.testmathworks)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s1">-</span><span class="s4">0.29322304336607</span><span class="s2">,</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = mstats.skew(self.testmathworks</span><span class="s2">,</span><span class="s1">bias=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s1">-</span><span class="s4">0.437111105023940</span><span class="s2">,</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = mstats.skew(self.testcase)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">,</span><span class="s4">0.0</span><span class="s2">,</span><span class="s4">10</span><span class="s1">)</span>

        <span class="s3"># test that skew works on multidimensional masked arrays</span>
        <span class="s1">correct_2d = ma.array(</span>
            <span class="s1">np.array([</span><span class="s4">0.6882870394455785</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.2665647526856708</span><span class="s2">,</span>
                      <span class="s4">0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.05211472114254485</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">mask=np.array([</span><span class="s2">False, False, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">)</span>
        <span class="s1">assert_allclose(mstats.skew(self.testcase_2d</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">correct_2d)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">row </span><span class="s2">in </span><span class="s1">enumerate(self.testcase_2d):</span>
            <span class="s1">assert_almost_equal(mstats.skew(row)</span><span class="s2">, </span><span class="s1">correct_2d[i])</span>

        <span class="s1">correct_2d_bias_corrected = ma.array(</span>
            <span class="s1">np.array([</span><span class="s4">1.685952043212545</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.3973712716070531</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                      <span class="s1">-</span><span class="s4">0.09026534484117164</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">mask=np.array([</span><span class="s2">False, False, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">)</span>
        <span class="s1">assert_allclose(mstats.skew(self.testcase_2d</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">bias=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">correct_2d_bias_corrected)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">row </span><span class="s2">in </span><span class="s1">enumerate(self.testcase_2d):</span>
            <span class="s1">assert_almost_equal(mstats.skew(row</span><span class="s2">, </span><span class="s1">bias=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">correct_2d_bias_corrected[i])</span>

        <span class="s3"># Check consistency between stats and mstats implementations</span>
        <span class="s1">assert_allclose(mstats.skew(self.testcase_2d[</span><span class="s4">2</span><span class="s2">, </span><span class="s1">:])</span><span class="s2">,</span>
                        <span class="s1">stats.skew(self.testcase_2d[</span><span class="s4">2</span><span class="s2">, </span><span class="s1">:]))</span>

    <span class="s2">def </span><span class="s1">test_kurtosis(self):</span>
        <span class="s3"># Set flags for axis = 0 and fisher=0 (Pearson's definition of kurtosis</span>
        <span class="s3"># for compatibility with Matlab)</span>
        <span class="s1">y = mstats.kurtosis(self.testmathworks</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">fisher=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">bias=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">, </span><span class="s4">2.1658856802973</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s3"># Note that MATLAB has confusing docs for the following case</span>
        <span class="s3">#  kurtosis(x,0) gives an unbiased estimate of Pearson's skewness</span>
        <span class="s3">#  kurtosis(x) gives a biased estimate of Fisher's skewness (Pearson-3)</span>
        <span class="s3">#  The MATLAB docs imply that both should give Fisher's</span>
        <span class="s1">y = mstats.kurtosis(self.testmathworks</span><span class="s2">, </span><span class="s1">fisher=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">bias=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">, </span><span class="s4">3.663542721189047</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = mstats.kurtosis(self.testcase</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">, </span><span class="s4">1.64</span><span class="s1">)</span>

        <span class="s3"># test that kurtosis works on multidimensional masked arrays</span>
        <span class="s1">correct_2d = ma.array(np.array([-</span><span class="s4">1.5</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1.47247052385</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">,</span>
                                        <span class="s1">-</span><span class="s4">1.26979517952</span><span class="s1">])</span><span class="s2">,</span>
                              <span class="s1">mask=np.array([</span><span class="s2">False, False, False, True,</span>
                                             <span class="s2">False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool))</span>
        <span class="s1">assert_array_almost_equal(mstats.kurtosis(self.testcase_2d</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">correct_2d)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">row </span><span class="s2">in </span><span class="s1">enumerate(self.testcase_2d):</span>
            <span class="s1">assert_almost_equal(mstats.kurtosis(row)</span><span class="s2">, </span><span class="s1">correct_2d[i])</span>

        <span class="s1">correct_2d_bias_corrected = ma.array(</span>
            <span class="s1">np.array([-</span><span class="s4">1.5</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1.88988209538</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.5234638463918877</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">mask=np.array([</span><span class="s2">False, False, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool))</span>
        <span class="s1">assert_array_almost_equal(mstats.kurtosis(self.testcase_2d</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
                                                  <span class="s1">bias=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">correct_2d_bias_corrected)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">row </span><span class="s2">in </span><span class="s1">enumerate(self.testcase_2d):</span>
            <span class="s1">assert_almost_equal(mstats.kurtosis(row</span><span class="s2">, </span><span class="s1">bias=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">correct_2d_bias_corrected[i])</span>

        <span class="s3"># Check consistency between stats and mstats implementations</span>
        <span class="s1">assert_array_almost_equal_nulp(mstats.kurtosis(self.testcase_2d[</span><span class="s4">2</span><span class="s2">, </span><span class="s1">:])</span><span class="s2">,</span>
                                       <span class="s1">stats.kurtosis(self.testcase_2d[</span><span class="s4">2</span><span class="s2">, </span><span class="s1">:])</span><span class="s2">,</span>
                                       <span class="s1">nulp=</span><span class="s4">4</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestMode:</span>
    <span class="s2">def </span><span class="s1">test_mode(self):</span>
        <span class="s1">a1 = [</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s2">,</span><span class="s4">7</span><span class="s1">]</span>
        <span class="s1">a2 = np.reshape(a1</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">,</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">a3 = np.array([</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s4">5</span><span class="s2">,</span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">a4 = np.reshape(a3</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">,</span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">ma1 = ma.masked_where(ma.array(a1) &gt; </span><span class="s4">2</span><span class="s2">, </span><span class="s1">a1)</span>
        <span class="s1">ma2 = ma.masked_where(a2 &gt; </span><span class="s4">2</span><span class="s2">, </span><span class="s1">a2)</span>
        <span class="s1">ma3 = ma.masked_where(a3 &lt; </span><span class="s4">2</span><span class="s2">, </span><span class="s1">a3)</span>
        <span class="s1">ma4 = ma.masked_where(ma.array(a4) &lt; </span><span class="s4">2</span><span class="s2">, </span><span class="s1">a4)</span>
        <span class="s1">assert_equal(mstats.mode(a1</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(a1</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(ma1</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(a2</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(ma2</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0</span><span class="s2">,</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(a3</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(ma3</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">,</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(mstats.mode(a2</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(mstats.mode(ma2</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(mstats.mode(a2</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(mstats.mode(ma2</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">0</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">0</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(mstats.mode(ma4</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">3</span><span class="s2">,</span><span class="s4">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s2">,</span><span class="s4">1</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(mstats.mode(ma4</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">([[</span><span class="s4">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s4">1</span><span class="s1">]]))</span>

        <span class="s1">a1_res = mstats.mode(a1</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>

        <span class="s3"># test for namedtuple attributes</span>
        <span class="s1">attributes = (</span><span class="s5">'mode'</span><span class="s2">, </span><span class="s5">'count'</span><span class="s1">)</span>
        <span class="s1">check_named_results(a1_res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_mode_modifies_input(self):</span>
        <span class="s3"># regression test for gh-6428: mode(..., axis=None) may not modify</span>
        <span class="s3"># the input array</span>
        <span class="s1">im = np.zeros((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s1">))</span>
        <span class="s1">im[:</span><span class="s4">50</span><span class="s2">, </span><span class="s1">:] += </span><span class="s4">1</span>
        <span class="s1">im[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">50</span><span class="s1">] += </span><span class="s4">1</span>
        <span class="s1">cp = im.copy()</span>
        <span class="s1">mstats.mode(im</span><span class="s2">, None</span><span class="s1">)</span>
        <span class="s1">assert_equal(im</span><span class="s2">, </span><span class="s1">cp)</span>


<span class="s2">class </span><span class="s1">TestPercentile:</span>
    <span class="s2">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.a1 = [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span>
        <span class="s1">self.a2 = [</span><span class="s4">3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">6</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">self.a3 = [</span><span class="s4">3.</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">5</span><span class="s2">, </span><span class="s1">-</span><span class="s4">6</span><span class="s2">, </span><span class="s4">7.0</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">test_percentile(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">8</span><span class="s1">) * </span><span class="s4">0.5</span>
        <span class="s1">assert_equal(mstats.scoreatpercentile(x</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">0.</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.scoreatpercentile(x</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span><span class="s2">, </span><span class="s4">3.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mstats.scoreatpercentile(x</span><span class="s2">, </span><span class="s4">50</span><span class="s1">)</span><span class="s2">, </span><span class="s4">1.75</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_2D(self):</span>
        <span class="s1">x = ma.array([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mstats.scoreatpercentile(x</span><span class="s2">, </span><span class="s4">50</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>


<span class="s2">class </span><span class="s1">TestVariability:</span>
    <span class="s0">&quot;&quot;&quot;  Comparison numbers are found using R v.1.5.1 
         note that length(testcase) = 4 
    &quot;&quot;&quot;</span>
    <span class="s1">testcase = ma.fix_invalid([</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s2">,</span><span class="s4">4</span><span class="s2">,</span><span class="s1">np.nan])</span>

    <span class="s2">def </span><span class="s1">test_sem(self):</span>
        <span class="s3"># This is not in R, so used: sqrt(var(testcase)*3/4) / sqrt(3)</span>
        <span class="s1">y = mstats.sem(self.testcase)</span>
        <span class="s1">assert_almost_equal(y</span><span class="s2">, </span><span class="s4">0.6454972244</span><span class="s1">)</span>
        <span class="s1">n = self.testcase.count()</span>
        <span class="s1">assert_allclose(mstats.sem(self.testcase</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">) * np.sqrt(n/(n-</span><span class="s4">2</span><span class="s1">))</span><span class="s2">,</span>
                        <span class="s1">mstats.sem(self.testcase</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">2</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_zmap(self):</span>
        <span class="s3"># This is not in R, so tested by using:</span>
        <span class="s3">#    (testcase[i]-mean(testcase,axis=0)) / sqrt(var(testcase)*3/4)</span>
        <span class="s1">y = mstats.zmap(self.testcase</span><span class="s2">, </span><span class="s1">self.testcase)</span>
        <span class="s1">desired_unmaskedvals = ([-</span><span class="s4">1.3416407864999</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.44721359549996</span><span class="s2">,</span>
                                 <span class="s4">0.44721359549996</span><span class="s2">, </span><span class="s4">1.3416407864999</span><span class="s1">])</span>
        <span class="s1">assert_array_almost_equal(desired_unmaskedvals</span><span class="s2">,</span>
                                  <span class="s1">y.data[y.mask == </span><span class="s2">False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)  </span><span class="s3"># noqa: E712</span>

    <span class="s2">def </span><span class="s1">test_zscore(self):</span>
        <span class="s3"># This is not in R, so tested by using:</span>
        <span class="s3">#     (testcase[i]-mean(testcase,axis=0)) / sqrt(var(testcase)*3/4)</span>
        <span class="s1">y = mstats.zscore(self.testcase)</span>
        <span class="s1">desired = ma.fix_invalid([-</span><span class="s4">1.3416407864999</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.44721359549996</span><span class="s2">,</span>
                                  <span class="s4">0.44721359549996</span><span class="s2">, </span><span class="s4">1.3416407864999</span><span class="s2">, </span><span class="s1">np.nan])</span>
        <span class="s1">assert_almost_equal(desired</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestMisc:</span>

    <span class="s2">def </span><span class="s1">test_obrientransform(self):</span>
        <span class="s1">args = [[</span><span class="s4">5</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">+[</span><span class="s4">6</span><span class="s1">]*</span><span class="s4">11</span><span class="s1">+[</span><span class="s4">7</span><span class="s1">]*</span><span class="s4">9</span><span class="s1">+[</span><span class="s4">8</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">+[</span><span class="s4">9</span><span class="s1">]*</span><span class="s4">2</span><span class="s1">+[</span><span class="s4">10</span><span class="s1">]*</span><span class="s4">2</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s4">6</span><span class="s1">]+[</span><span class="s4">7</span><span class="s1">]*</span><span class="s4">2</span><span class="s1">+[</span><span class="s4">8</span><span class="s1">]*</span><span class="s4">4</span><span class="s1">+[</span><span class="s4">9</span><span class="s1">]*</span><span class="s4">9</span><span class="s1">+[</span><span class="s4">10</span><span class="s1">]*</span><span class="s4">16</span><span class="s1">]</span>
        <span class="s1">result = [</span><span class="s4">5</span><span class="s1">*[</span><span class="s4">3.1828</span><span class="s1">]+</span><span class="s4">11</span><span class="s1">*[</span><span class="s4">0.5591</span><span class="s1">]+</span><span class="s4">9</span><span class="s1">*[</span><span class="s4">0.0344</span><span class="s1">]+</span><span class="s4">3</span><span class="s1">*[</span><span class="s4">1.6086</span><span class="s1">]+</span><span class="s4">2</span><span class="s1">*[</span><span class="s4">5.2817</span><span class="s1">]+</span><span class="s4">2</span><span class="s1">*[</span><span class="s4">11.0538</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s4">10.4352</span><span class="s1">]+</span><span class="s4">2</span><span class="s1">*[</span><span class="s4">4.8599</span><span class="s1">]+</span><span class="s4">4</span><span class="s1">*[</span><span class="s4">1.3836</span><span class="s1">]+</span><span class="s4">9</span><span class="s1">*[</span><span class="s4">0.0061</span><span class="s1">]+</span><span class="s4">16</span><span class="s1">*[</span><span class="s4">0.7277</span><span class="s1">]]</span>
        <span class="s1">assert_almost_equal(np.round(mstats.obrientransform(*args).T</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">result</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_ks_2samp(self):</span>
        <span class="s1">x = [[nan</span><span class="s2">,</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">26</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">nan]</span><span class="s2">,</span>
             <span class="s1">[nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s1">x = ma.fix_invalid(x).T</span>
        <span class="s1">(winter</span><span class="s2">, </span><span class="s1">spring</span><span class="s2">, </span><span class="s1">summer</span><span class="s2">, </span><span class="s1">fall) = x.T</span>

        <span class="s1">assert_almost_equal(np.round(mstats.ks_2samp(winter</span><span class="s2">, </span><span class="s1">spring)</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">(</span><span class="s4">0.1818</span><span class="s2">, </span><span class="s4">0.9628</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.round(mstats.ks_2samp(winter</span><span class="s2">, </span><span class="s1">spring</span><span class="s2">, </span><span class="s5">'g'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">(</span><span class="s4">0.1469</span><span class="s2">, </span><span class="s4">0.6886</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.round(mstats.ks_2samp(winter</span><span class="s2">, </span><span class="s1">spring</span><span class="s2">, </span><span class="s5">'l'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">(</span><span class="s4">0.1818</span><span class="s2">, </span><span class="s4">0.6011</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_friedmanchisq(self):</span>
        <span class="s3"># No missing values</span>
        <span class="s1">args = ([</span><span class="s4">9.0</span><span class="s2">,</span><span class="s4">9.5</span><span class="s2">,</span><span class="s4">5.0</span><span class="s2">,</span><span class="s4">7.5</span><span class="s2">,</span><span class="s4">9.5</span><span class="s2">,</span><span class="s4">7.5</span><span class="s2">,</span><span class="s4">8.0</span><span class="s2">,</span><span class="s4">7.0</span><span class="s2">,</span><span class="s4">8.5</span><span class="s2">,</span><span class="s4">6.0</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s4">7.0</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">7.0</span><span class="s2">,</span><span class="s4">7.5</span><span class="s2">,</span><span class="s4">5.0</span><span class="s2">,</span><span class="s4">8.0</span><span class="s2">,</span><span class="s4">6.0</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">7.0</span><span class="s2">,</span><span class="s4">7.0</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s4">6.0</span><span class="s2">,</span><span class="s4">8.0</span><span class="s2">,</span><span class="s4">4.0</span><span class="s2">,</span><span class="s4">6.0</span><span class="s2">,</span><span class="s4">7.0</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">6.0</span><span class="s2">,</span><span class="s4">4.0</span><span class="s2">,</span><span class="s4">6.5</span><span class="s2">,</span><span class="s4">3.0</span><span class="s1">])</span>
        <span class="s1">result = mstats.friedmanchisquare(*args)</span>
        <span class="s1">assert_almost_equal(result[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">10.4737</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(result[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.005317</span><span class="s2">, </span><span class="s4">6</span><span class="s1">)</span>
        <span class="s3"># Missing values</span>
        <span class="s1">x = [[nan</span><span class="s2">,</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">26</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span><span class="s1">nan]</span><span class="s2">,</span>
             <span class="s1">[nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">17</span><span class="s2">,</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s1">x = ma.fix_invalid(x)</span>
        <span class="s1">result = mstats.friedmanchisquare(*x)</span>
        <span class="s1">assert_almost_equal(result[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">2.0156</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(result[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0.5692</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

        <span class="s3"># test for namedtuple attributes</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(result</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_regress_simple():</span>
    <span class="s3"># Regress a line with sinusoidal noise. Test for #1273.</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">y = </span><span class="s4">0.2 </span><span class="s1">* np.linspace(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s1">) + </span><span class="s4">10</span>
    <span class="s1">y += np.sin(np.linspace(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">100</span><span class="s1">))</span>

    <span class="s1">result = mstats.linregress(x</span><span class="s2">, </span><span class="s1">y)</span>

    <span class="s3"># Result is of a correct class and with correct fields</span>
    <span class="s1">lr = stats._stats_mstats_common.LinregressResult</span>
    <span class="s1">assert_(isinstance(result</span><span class="s2">, </span><span class="s1">lr))</span>
    <span class="s1">attributes = (</span><span class="s5">'slope'</span><span class="s2">, </span><span class="s5">'intercept'</span><span class="s2">, </span><span class="s5">'rvalue'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s2">, </span><span class="s5">'stderr'</span><span class="s1">)</span>
    <span class="s1">check_named_results(result</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s5">'intercept_stderr' </span><span class="s2">in </span><span class="s1">dir(result)</span>

    <span class="s3"># Slope and intercept are estimated correctly</span>
    <span class="s1">assert_almost_equal(result.slope</span><span class="s2">, </span><span class="s4">0.19644990055858422</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(result.intercept</span><span class="s2">, </span><span class="s4">10.211269918932341</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(result.stderr</span><span class="s2">, </span><span class="s4">0.002395781449783862</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(result.intercept_stderr</span><span class="s2">, </span><span class="s4">0.13866936078570702</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_linregress_identical_x():</span>
    <span class="s1">x = np.zeros(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = np.random.random(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">msg = </span><span class="s5">&quot;Cannot calculate a linear regression if all x values are identical&quot;</span>
    <span class="s2">with </span><span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
        <span class="s1">mstats.linregress(x</span><span class="s2">, </span><span class="s1">y)</span>


<span class="s2">def </span><span class="s1">test_theilslopes():</span>
    <span class="s3"># Test for basic slope and intercept.</span>
    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                                                        <span class="s1">method=</span><span class="s5">'joint'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">)</span>

    <span class="s3"># Test for correct masking.</span>
    <span class="s1">y = np.ma.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s2">False, False, True, False</span><span class="s1">])</span>
    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes(y)</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes(y</span><span class="s2">,</span>
                                                        <span class="s1">method=</span><span class="s5">'joint'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">/</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">)</span>

    <span class="s3"># Test of confidence intervals from example in Sen (1968).</span>
    <span class="s1">x = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">18</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">9</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s4">19</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">45</span><span class="s2">, </span><span class="s4">55</span><span class="s2">, </span><span class="s4">78</span><span class="s1">]</span>
    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes(y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s4">0.07</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(upper</span><span class="s2">, </span><span class="s4">4.38</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(lower</span><span class="s2">, </span><span class="s4">3.71</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">lower</span><span class="s2">, </span><span class="s1">upper = mstats.theilslopes(y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s4">0.07</span><span class="s2">,</span>
                                                        <span class="s1">method=</span><span class="s5">'joint'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(slope</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(intercept</span><span class="s2">, </span><span class="s4">6.0</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(upper</span><span class="s2">, </span><span class="s4">4.38</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(lower</span><span class="s2">, </span><span class="s4">3.71</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_theilslopes_warnings():</span>
    <span class="s3"># Test `theilslopes` with degenerate input; see gh-15943</span>
    <span class="s2">with </span><span class="s1">pytest.warns(RuntimeWarning</span><span class="s2">, </span><span class="s1">match=</span><span class="s5">&quot;All `x` coordinates are...&quot;</span><span class="s1">):</span>
        <span class="s1">res = mstats.theilslopes([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s2">assert </span><span class="s1">np.all(np.isnan(res))</span>
    <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
        <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered...&quot;</span><span class="s1">)</span>
        <span class="s1">res = mstats.theilslopes([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_allclose(res</span><span class="s2">, </span><span class="s1">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>


<span class="s2">def </span><span class="s1">test_theilslopes_namedtuple_consistency():</span>
    <span class="s0">&quot;&quot;&quot; 
    Simple test to ensure tuple backwards-compatibility of the returned 
    TheilslopesResult object 
    &quot;&quot;&quot;</span>
    <span class="s1">y = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">x = [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]</span>
    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept</span><span class="s2">, </span><span class="s1">low_slope</span><span class="s2">, </span><span class="s1">high_slope = mstats.theilslopes(y</span><span class="s2">, </span><span class="s1">x)</span>
    <span class="s1">result = mstats.theilslopes(y</span><span class="s2">, </span><span class="s1">x)</span>

    <span class="s3"># note all four returned values are distinct here</span>
    <span class="s1">assert_equal(slope</span><span class="s2">, </span><span class="s1">result.slope)</span>
    <span class="s1">assert_equal(intercept</span><span class="s2">, </span><span class="s1">result.intercept)</span>
    <span class="s1">assert_equal(low_slope</span><span class="s2">, </span><span class="s1">result.low_slope)</span>
    <span class="s1">assert_equal(high_slope</span><span class="s2">, </span><span class="s1">result.high_slope)</span>


<span class="s2">def </span><span class="s1">test_siegelslopes():</span>
    <span class="s3"># method should be exact for straight line</span>
    <span class="s1">y = </span><span class="s4">2 </span><span class="s1">* np.arange(</span><span class="s4">10</span><span class="s1">) + </span><span class="s4">0.5</span>
    <span class="s1">assert_equal(mstats.siegelslopes(y)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">))</span>
    <span class="s1">assert_equal(mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">method=</span><span class="s5">'separate'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">))</span>

    <span class="s1">x = </span><span class="s4">2 </span><span class="s1">* np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = </span><span class="s4">5 </span><span class="s1">* x - </span><span class="s4">3.0</span>
    <span class="s1">assert_equal(mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">5.0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.0</span><span class="s1">))</span>
    <span class="s1">assert_equal(mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">method=</span><span class="s5">'separate'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">5.0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.0</span><span class="s1">))</span>

    <span class="s3"># method is robust to outliers: brekdown point of 50%</span>
    <span class="s1">y[:</span><span class="s4">4</span><span class="s1">] = </span><span class="s4">1000</span>
    <span class="s1">assert_equal(mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">5.0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.0</span><span class="s1">))</span>

    <span class="s3"># if there are no outliers, results should be comparble to linregress</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = -</span><span class="s4">2.3 </span><span class="s1">+ </span><span class="s4">0.3</span><span class="s1">*x + stats.norm.rvs(size=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">231</span><span class="s1">)</span>
    <span class="s1">slope_ols</span><span class="s2">, </span><span class="s1">intercept_ols</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ = stats.linregress(x</span><span class="s2">, </span><span class="s1">y)</span>

    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept = mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x)</span>
    <span class="s1">assert_allclose(slope</span><span class="s2">, </span><span class="s1">slope_ols</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">0.1</span><span class="s1">)</span>
    <span class="s1">assert_allclose(intercept</span><span class="s2">, </span><span class="s1">intercept_ols</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">0.1</span><span class="s1">)</span>

    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept = mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">method=</span><span class="s5">'separate'</span><span class="s1">)</span>
    <span class="s1">assert_allclose(slope</span><span class="s2">, </span><span class="s1">slope_ols</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">0.1</span><span class="s1">)</span>
    <span class="s1">assert_allclose(intercept</span><span class="s2">, </span><span class="s1">intercept_ols</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">0.1</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_siegelslopes_namedtuple_consistency():</span>
    <span class="s0">&quot;&quot;&quot; 
    Simple test to ensure tuple backwards-compatibility of the returned 
    SiegelslopesResult object. 
    &quot;&quot;&quot;</span>
    <span class="s1">y = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">x = [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]</span>
    <span class="s1">slope</span><span class="s2">, </span><span class="s1">intercept = mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x)</span>
    <span class="s1">result = mstats.siegelslopes(y</span><span class="s2">, </span><span class="s1">x)</span>

    <span class="s3"># note both returned values are distinct here</span>
    <span class="s1">assert_equal(slope</span><span class="s2">, </span><span class="s1">result.slope)</span>
    <span class="s1">assert_equal(intercept</span><span class="s2">, </span><span class="s1">result.intercept)</span>


<span class="s2">def </span><span class="s1">test_sen_seasonal_slopes():</span>
    <span class="s1">rng = np.random.default_rng(</span><span class="s4">5765986256978575148</span><span class="s1">)</span>
    <span class="s1">x = rng.random(size=(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
    <span class="s1">intra_slope</span><span class="s2">, </span><span class="s1">inter_slope = mstats.sen_seasonal_slopes(x)</span>

    <span class="s3"># reference implementation from the `sen_seasonal_slopes` documentation</span>
    <span class="s2">def </span><span class="s1">dijk(yi):</span>
        <span class="s1">n = len(yi)</span>
        <span class="s1">x = np.arange(n)</span>
        <span class="s1">dy = yi - yi[:</span><span class="s2">, </span><span class="s1">np.newaxis]</span>
        <span class="s1">dx = x - x[:</span><span class="s2">, </span><span class="s1">np.newaxis]</span>
        <span class="s1">mask = np.triu(np.ones((n</span><span class="s2">, </span><span class="s1">n)</span><span class="s2">, </span><span class="s1">dtype=bool)</span><span class="s2">, </span><span class="s1">k=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">dy[mask]/dx[mask]</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">):</span>
        <span class="s1">assert_allclose(np.median(dijk(x[:</span><span class="s2">, </span><span class="s1">i]))</span><span class="s2">, </span><span class="s1">intra_slope[i])</span>

    <span class="s1">all_slopes = np.concatenate([dijk(x[:</span><span class="s2">, </span><span class="s1">i]) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(x.shape[</span><span class="s4">1</span><span class="s1">])])</span>
    <span class="s1">assert_allclose(np.median(all_slopes)</span><span class="s2">, </span><span class="s1">inter_slope)</span>


<span class="s2">def </span><span class="s1">test_plotting_positions():</span>
    <span class="s3"># Regression test for #1256</span>
    <span class="s1">pos = mstats.plotting_positions(np.arange(</span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">assert_array_almost_equal(pos.data</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s1">]))</span>


<span class="s2">class </span><span class="s1">TestNormalitytests():</span>

    <span class="s2">def </span><span class="s1">test_vs_nonmasked(self):</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">assert_array_almost_equal(mstats.normaltest(x)</span><span class="s2">,</span>
                                  <span class="s1">stats.normaltest(x))</span>
        <span class="s1">assert_array_almost_equal(mstats.skewtest(x)</span><span class="s2">,</span>
                                  <span class="s1">stats.skewtest(x))</span>
        <span class="s1">assert_array_almost_equal(mstats.kurtosistest(x)</span><span class="s2">,</span>
                                  <span class="s1">stats.kurtosistest(x))</span>

        <span class="s1">funcs = [stats.normaltest</span><span class="s2">, </span><span class="s1">stats.skewtest</span><span class="s2">, </span><span class="s1">stats.kurtosistest]</span>
        <span class="s1">mfuncs = [mstats.normaltest</span><span class="s2">, </span><span class="s1">mstats.skewtest</span><span class="s2">, </span><span class="s1">mstats.kurtosistest]</span>
        <span class="s1">x = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span>
        <span class="s2">for </span><span class="s1">func</span><span class="s2">, </span><span class="s1">mfunc </span><span class="s2">in </span><span class="s1">zip(funcs</span><span class="s2">, </span><span class="s1">mfuncs):</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">func</span><span class="s2">, </span><span class="s1">x)</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mfunc</span><span class="s2">, </span><span class="s1">x)</span>

    <span class="s2">def </span><span class="s1">test_axis_None(self):</span>
        <span class="s3"># Test axis=None (equal to axis=0 for 1-D input)</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">,</span><span class="s1">-</span><span class="s4">1</span><span class="s2">,</span><span class="s4">0</span><span class="s2">,</span><span class="s4">1</span><span class="s2">,</span><span class="s4">2</span><span class="s2">,</span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">assert_allclose(mstats.normaltest(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mstats.normaltest(x))</span>
        <span class="s1">assert_allclose(mstats.skewtest(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mstats.skewtest(x))</span>
        <span class="s1">assert_allclose(mstats.kurtosistest(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">mstats.kurtosistest(x))</span>

    <span class="s2">def </span><span class="s1">test_maskedarray_input(self):</span>
        <span class="s3"># Add some masked values, test result doesn't change</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">xm = np.ma.array(np.r_[np.inf</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s4">10</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">mask=np.r_[</span><span class="s2">True, </span><span class="s1">[</span><span class="s2">False</span><span class="s1">] * x.size</span><span class="s2">, True</span><span class="s1">])</span>
        <span class="s1">assert_allclose(mstats.normaltest(xm)</span><span class="s2">, </span><span class="s1">stats.normaltest(x))</span>
        <span class="s1">assert_allclose(mstats.skewtest(xm)</span><span class="s2">, </span><span class="s1">stats.skewtest(x))</span>
        <span class="s1">assert_allclose(mstats.kurtosistest(xm)</span><span class="s2">, </span><span class="s1">stats.kurtosistest(x))</span>

    <span class="s2">def </span><span class="s1">test_nd_input(self):</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">x_2d = np.vstack([x] * </span><span class="s4">2</span><span class="s1">).T</span>
        <span class="s2">for </span><span class="s1">func </span><span class="s2">in </span><span class="s1">[mstats.normaltest</span><span class="s2">, </span><span class="s1">mstats.skewtest</span><span class="s2">, </span><span class="s1">mstats.kurtosistest]:</span>
            <span class="s1">res_1d = func(x)</span>
            <span class="s1">res_2d = func(x_2d)</span>
            <span class="s1">assert_allclose(res_2d[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[res_1d[</span><span class="s4">0</span><span class="s1">]] * </span><span class="s4">2</span><span class="s1">)</span>
            <span class="s1">assert_allclose(res_2d[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[res_1d[</span><span class="s4">1</span><span class="s1">]] * </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_normaltest_result_attributes(self):</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">res = mstats.normaltest(x)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_kurtosistest_result_attributes(self):</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">res = mstats.kurtosistest(x)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_regression_9033(self):</span>
        <span class="s3"># x cleary non-normal but power of negtative denom needs</span>
        <span class="s3"># to be handled correctly to reject normality</span>
        <span class="s1">counts = [</span><span class="s4">128</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">58</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">41</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">167</span><span class="s1">]</span>
        <span class="s1">x = np.hstack([np.full(c</span><span class="s2">, </span><span class="s1">i) </span><span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">c </span><span class="s2">in </span><span class="s1">enumerate(counts)])</span>
        <span class="s1">assert_equal(mstats.kurtosistest(x)[</span><span class="s4">1</span><span class="s1">] &lt; </span><span class="s4">0.01</span><span class="s2">, True</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;test&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;skewtest&quot;</span><span class="s2">, </span><span class="s5">&quot;kurtosistest&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;alternative&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;less&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_alternative(self</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">alternative):</span>
        <span class="s1">x = stats.norm.rvs(loc=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">2.5</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">30</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">123</span><span class="s1">)</span>

        <span class="s1">stats_test = getattr(stats</span><span class="s2">, </span><span class="s1">test)</span>
        <span class="s1">mstats_test = getattr(mstats</span><span class="s2">, </span><span class="s1">test)</span>

        <span class="s1">z_ex</span><span class="s2">, </span><span class="s1">p_ex = stats_test(x</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p = mstats_test(x</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(z</span><span class="s2">, </span><span class="s1">z_ex</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-12</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-12</span><span class="s1">)</span>

        <span class="s3"># test with masked arrays</span>
        <span class="s1">x[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">5</span><span class="s1">] = np.nan</span>
        <span class="s1">x = np.ma.masked_array(x</span><span class="s2">, </span><span class="s1">mask=np.isnan(x))</span>
        <span class="s1">z_ex</span><span class="s2">, </span><span class="s1">p_ex = stats_test(x.compressed()</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p = mstats_test(x</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(z</span><span class="s2">, </span><span class="s1">z_ex</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-12</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_bad_alternative(self):</span>
        <span class="s1">x = stats.norm.rvs(size=</span><span class="s4">20</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">123</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s5">r&quot;alternative must be 'less', 'greater' or 'two-sided'&quot;</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">mstats.skewtest(x</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'error'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">mstats.kurtosistest(x</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'error'</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestFOneway():</span>
    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">655</span><span class="s2">, </span><span class="s4">788</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.uint16)</span>
        <span class="s1">b = np.array([</span><span class="s4">789</span><span class="s2">, </span><span class="s4">772</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.uint16)</span>
        <span class="s1">res = mstats.f_oneway(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestMannwhitneyu():</span>
    <span class="s3"># data from gh-1428</span>
    <span class="s1">x = np.array([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">])</span>

    <span class="s1">y = np.array([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">,</span>
                  <span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">,</span>
                  <span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">,</span>
                  <span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">res = mstats.mannwhitneyu(self.x</span><span class="s2">, </span><span class="s1">self.y)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_against_stats(self):</span>
        <span class="s3"># gh-4641 reported that stats.mannwhitneyu returned half the p-value</span>
        <span class="s3"># of mstats.mannwhitneyu. Default alternative of stats.mannwhitneyu</span>
        <span class="s3"># is now two-sided, so they match.</span>
        <span class="s1">res1 = mstats.mannwhitneyu(self.x</span><span class="s2">, </span><span class="s1">self.y)</span>
        <span class="s1">res2 = stats.mannwhitneyu(self.x</span><span class="s2">, </span><span class="s1">self.y)</span>
        <span class="s2">assert </span><span class="s1">res1.statistic == res2.statistic</span>
        <span class="s1">assert_allclose(res1.pvalue</span><span class="s2">, </span><span class="s1">res2.pvalue)</span>


<span class="s2">class </span><span class="s1">TestKruskal():</span>
    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">x = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">10</span><span class="s1">]</span>

        <span class="s1">res = mstats.kruskal(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s3"># TODO: for all ttest functions, add tests with masked array inputs</span>
<span class="s2">class </span><span class="s1">TestTtest_rel():</span>
    <span class="s2">def </span><span class="s1">test_vs_nonmasked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s3"># 1-D inputs</span>
        <span class="s1">res1 = stats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">res2 = mstats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>

        <span class="s3"># 2-D inputs</span>
        <span class="s1">res1 = stats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">res2 = mstats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>
        <span class="s1">res1 = stats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">res2 = mstats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>

        <span class="s3"># Check default is axis=0</span>
        <span class="s1">res3 = mstats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:])</span>
        <span class="s1">assert_allclose(res2</span><span class="s2">, </span><span class="s1">res3)</span>

    <span class="s2">def </span><span class="s1">test_fully_masked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = ma.masked_array(np.random.randn(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">mask=[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">pair </span><span class="s2">in </span><span class="s1">[(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">([np.nan</span><span class="s2">, </span><span class="s1">np.nan]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">])]:</span>
                <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_rel(*pair)</span>
                <span class="s1">assert_array_equal(t</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>
                <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>

    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s1">res = mstats.ttest_rel(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_size(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.ttest_rel</span><span class="s2">,</span>
                      <span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s4">11</span><span class="s1">))</span>
        <span class="s1">x = np.arange(</span><span class="s4">24</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.ttest_rel</span><span class="s2">,</span>
                      <span class="s1">x.reshape(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">x.reshape(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.ttest_rel</span><span class="s2">,</span>
                      <span class="s1">x.reshape(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">x.reshape(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">res1 = mstats.ttest_rel([]</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s1">assert_(np.all(np.isnan(res1)))</span>

    <span class="s2">def </span><span class="s1">test_zero_division(self):</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal((np.abs(t)</span><span class="s2">, </span><span class="s1">p)</span><span class="s2">, </span><span class="s1">(np.inf</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span>

        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
            <span class="s1">assert_array_equal(t</span><span class="s2">, </span><span class="s1">np.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan]))</span>
            <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">np.array([np.nan</span><span class="s2">, </span><span class="s1">np.nan]))</span>

    <span class="s2">def </span><span class="s1">test_bad_alternative(self):</span>
        <span class="s1">msg = </span><span class="s5">r&quot;alternative must be 'less', 'greater' or 'two-sided'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">mstats.ttest_ind([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'foo'</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;alternative&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;less&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_alternative(self</span><span class="s2">, </span><span class="s1">alternative):</span>
        <span class="s1">x = stats.norm.rvs(loc=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">25</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">42</span><span class="s1">)</span>
        <span class="s1">y = stats.norm.rvs(loc=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">25</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">42</span><span class="s1">)</span>

        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_rel(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_rel(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s3"># test with masked arrays</span>
        <span class="s1">x[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">] = np.nan</span>
        <span class="s1">y[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">] = np.nan</span>
        <span class="s1">x = np.ma.masked_array(x</span><span class="s2">, </span><span class="s1">mask=np.isnan(x))</span>
        <span class="s1">y = np.ma.masked_array(y</span><span class="s2">, </span><span class="s1">mask=np.isnan(y))</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_rel(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_rel(x.compressed()</span><span class="s2">, </span><span class="s1">y.compressed()</span><span class="s2">,</span>
                                     <span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestTtest_ind():</span>
    <span class="s2">def </span><span class="s1">test_vs_nonmasked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s3"># 1-D inputs</span>
        <span class="s1">res1 = stats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">res2 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>

        <span class="s3"># 2-D inputs</span>
        <span class="s1">res1 = stats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">res2 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>
        <span class="s1">res1 = stats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">res2 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>

        <span class="s3"># Check default is axis=0</span>
        <span class="s1">res3 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">2</span><span class="s1">:])</span>
        <span class="s1">assert_allclose(res2</span><span class="s2">, </span><span class="s1">res3)</span>

        <span class="s3"># Check equal_var</span>
        <span class="s1">res4 = stats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">equal_var=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">res5 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">equal_var=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res4</span><span class="s2">, </span><span class="s1">res5)</span>
        <span class="s1">res4 = stats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">equal_var=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">res5 = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">equal_var=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res4</span><span class="s2">, </span><span class="s1">res5)</span>

    <span class="s2">def </span><span class="s1">test_fully_masked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = ma.masked_array(np.random.randn(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mask=[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">pair </span><span class="s2">in </span><span class="s1">[(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">([np.nan</span><span class="s2">, </span><span class="s1">np.nan]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">])]:</span>
                <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind(*pair)</span>
                <span class="s1">assert_array_equal(t</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>
                <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>

    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s1">res = mstats.ttest_ind(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">outcome[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">res1 = mstats.ttest_ind([]</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s1">assert_(np.all(np.isnan(res1)))</span>

    <span class="s2">def </span><span class="s1">test_zero_division(self):</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal((np.abs(t)</span><span class="s2">, </span><span class="s1">p)</span><span class="s2">, </span><span class="s1">(np.inf</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span>

        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">])</span>
            <span class="s1">assert_array_equal(t</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>
            <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>

        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">equal_var=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">assert_equal((np.abs(t)</span><span class="s2">, </span><span class="s1">p)</span><span class="s2">, </span><span class="s1">(np.inf</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(mstats.ttest_ind([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                                            <span class="s1">equal_var=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>

    <span class="s2">def </span><span class="s1">test_bad_alternative(self):</span>
        <span class="s1">msg = </span><span class="s5">r&quot;alternative must be 'less', 'greater' or 'two-sided'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">mstats.ttest_ind([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'foo'</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;alternative&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;less&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_alternative(self</span><span class="s2">, </span><span class="s1">alternative):</span>
        <span class="s1">x = stats.norm.rvs(loc=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">123</span><span class="s1">)</span>
        <span class="s1">y = stats.norm.rvs(loc=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">123</span><span class="s1">)</span>

        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_ind(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s3"># test with masked arrays</span>
        <span class="s1">x[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">] = np.nan</span>
        <span class="s1">y[</span><span class="s4">80</span><span class="s1">:</span><span class="s4">90</span><span class="s1">] = np.nan</span>
        <span class="s1">x = np.ma.masked_array(x</span><span class="s2">, </span><span class="s1">mask=np.isnan(x))</span>
        <span class="s1">y = np.ma.masked_array(y</span><span class="s2">, </span><span class="s1">mask=np.isnan(y))</span>
        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_ind(x.compressed()</span><span class="s2">, </span><span class="s1">y.compressed()</span><span class="s2">,</span>
                                     <span class="s1">alternative=alternative)</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_ind(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestTtest_1samp():</span>
    <span class="s2">def </span><span class="s1">test_vs_nonmasked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s3"># 1-D inputs</span>
        <span class="s1">res1 = stats.ttest_1samp(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">res2 = mstats.ttest_1samp(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res1</span><span class="s2">, </span><span class="s1">res2)</span>

    <span class="s2">def </span><span class="s1">test_fully_masked(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = ma.masked_array(np.random.randn(</span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">expected = (np.nan</span><span class="s2">, </span><span class="s1">np.nan)</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">pair </span><span class="s2">in </span><span class="s1">[((np.nan</span><span class="s2">, </span><span class="s1">np.nan)</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(outcome</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">)]:</span>
                <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_1samp(*pair)</span>
                <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">expected)</span>
                <span class="s1">assert_array_equal(t</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_result_attributes(self):</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">outcome = np.random.randn(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">4</span><span class="s1">) + [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>

        <span class="s1">res = mstats.ttest_1samp(outcome[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">res1 = mstats.ttest_1samp([]</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_(np.all(np.isnan(res1)))</span>

    <span class="s2">def </span><span class="s1">test_zero_division(self):</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_1samp([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal((np.abs(t)</span><span class="s2">, </span><span class="s1">p)</span><span class="s2">, </span><span class="s1">(np.inf</span><span class="s2">, </span><span class="s4">0</span><span class="s1">))</span>

        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;invalid value encountered in absolute&quot;</span><span class="s1">)</span>
            <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_1samp([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">assert_(np.isnan(t))</span>
            <span class="s1">assert_array_equal(p</span><span class="s2">, </span><span class="s1">(np.nan</span><span class="s2">, </span><span class="s1">np.nan))</span>

    <span class="s2">def </span><span class="s1">test_bad_alternative(self):</span>
        <span class="s1">msg = </span><span class="s5">r&quot;alternative must be 'less', 'greater' or 'two-sided'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">mstats.ttest_1samp([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'foo'</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;alternative&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;less&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_alternative(self</span><span class="s2">, </span><span class="s1">alternative):</span>
        <span class="s1">x = stats.norm.rvs(loc=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">scale=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s4">123</span><span class="s1">)</span>

        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_1samp(x</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_1samp(x</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

        <span class="s3"># test with masked arrays</span>
        <span class="s1">x[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">10</span><span class="s1">] = np.nan</span>
        <span class="s1">x = np.ma.masked_array(x</span><span class="s2">, </span><span class="s1">mask=np.isnan(x))</span>
        <span class="s1">t_ex</span><span class="s2">, </span><span class="s1">p_ex = stats.ttest_1samp(x.compressed()</span><span class="s2">, </span><span class="s4">9</span><span class="s2">,</span>
                                       <span class="s1">alternative=alternative)</span>
        <span class="s1">t</span><span class="s2">, </span><span class="s1">p = mstats.ttest_1samp(x</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s1">alternative=alternative)</span>
        <span class="s1">assert_allclose(t</span><span class="s2">, </span><span class="s1">t_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(p</span><span class="s2">, </span><span class="s1">p_ex</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestDescribe:</span>
    <span class="s0">&quot;&quot;&quot; 
    Tests for mstats.describe. 
 
    Note that there are also tests for `mstats.describe` in the 
    class TestCompareWithStats. 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">test_basic_with_axis(self):</span>
        <span class="s3"># This is a basic test that is also a regression test for gh-7303.</span>
        <span class="s1">a = np.ma.masked_array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">,</span>
                                <span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]]</span><span class="s2">,</span>
                               <span class="s1">mask=[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                                     <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">result = mstats.describe(a</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(result.nobs</span><span class="s2">, </span><span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">amin</span><span class="s2">, </span><span class="s1">amax = result.minmax</span>
        <span class="s1">assert_equal(amin</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">assert_equal(amax</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(result.mean</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">])</span>
        <span class="s1">assert_equal(result.variance</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">])</span>
        <span class="s1">assert_equal(result.skewness</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">])</span>
        <span class="s1">assert_allclose(result.kurtosis</span><span class="s2">, </span><span class="s1">[-</span><span class="s4">1.3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2.0</span><span class="s1">])</span>


<span class="s2">class </span><span class="s1">TestCompareWithStats:</span>
    <span class="s0">&quot;&quot;&quot; 
    Class to compare mstats results with stats results. 
 
    It is in general assumed that scipy.stats is at a more mature stage than 
    stats.mstats.  If a routine in mstats results in similar results like in 
    scipy.stats, this is considered also as a proper validation of scipy.mstats 
    routine. 
 
    Different sample sizes are used for testing, as some problems between stats 
    and mstats are dependent on sample size. 
 
    Author: Alexander Loew 
 
    NOTE that some tests fail. This might be caused by 
    a) actual differences or bugs between stats and mstats 
    b) numerical inaccuracies 
    c) different definitions of routine interfaces 
 
    These failures need to be checked. Current workaround is to have disabled these tests, 
    but issuing reports on scipy-dev 
 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">get_n(self):</span>
        <span class="s0">&quot;&quot;&quot; Returns list of sample sizes to be used for comparison. &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">[</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">generate_xy_sample(self</span><span class="s2">, </span><span class="s1">n):</span>
        <span class="s3"># This routine generates numpy arrays and corresponding masked arrays</span>
        <span class="s3"># with the same data, but additional masked values</span>
        <span class="s1">np.random.seed(</span><span class="s4">1234567</span><span class="s1">)</span>
        <span class="s1">x = np.random.randn(n)</span>
        <span class="s1">y = x + np.random.randn(n)</span>
        <span class="s1">xm = np.full(len(x) + </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1e16</span><span class="s1">)</span>
        <span class="s1">ym = np.full(len(y) + </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1e16</span><span class="s1">)</span>
        <span class="s1">xm[</span><span class="s4">0</span><span class="s1">:len(x)] = x</span>
        <span class="s1">ym[</span><span class="s4">0</span><span class="s1">:len(y)] = y</span>
        <span class="s1">mask = xm &gt; </span><span class="s4">9e15</span>
        <span class="s1">xm = np.ma.array(xm</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">ym = np.ma.array(ym</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s2">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span>

    <span class="s2">def </span><span class="s1">generate_xy_sample2D(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">nx):</span>
        <span class="s1">x = np.full((n</span><span class="s2">, </span><span class="s1">nx)</span><span class="s2">, </span><span class="s1">np.nan)</span>
        <span class="s1">y = np.full((n</span><span class="s2">, </span><span class="s1">nx)</span><span class="s2">, </span><span class="s1">np.nan)</span>
        <span class="s1">xm = np.full((n+</span><span class="s4">5</span><span class="s2">, </span><span class="s1">nx)</span><span class="s2">, </span><span class="s1">np.nan)</span>
        <span class="s1">ym = np.full((n+</span><span class="s4">5</span><span class="s2">, </span><span class="s1">nx)</span><span class="s2">, </span><span class="s1">np.nan)</span>

        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(nx):</span>
            <span class="s1">x[:</span><span class="s2">, </span><span class="s1">i]</span><span class="s2">, </span><span class="s1">y[:</span><span class="s2">, </span><span class="s1">i]</span><span class="s2">, </span><span class="s1">dx</span><span class="s2">, </span><span class="s1">dy = self.generate_xy_sample(n)</span>

        <span class="s1">xm[</span><span class="s4">0</span><span class="s1">:n</span><span class="s2">, </span><span class="s1">:] = x[</span><span class="s4">0</span><span class="s1">:n]</span>
        <span class="s1">ym[</span><span class="s4">0</span><span class="s1">:n</span><span class="s2">, </span><span class="s1">:] = y[</span><span class="s4">0</span><span class="s1">:n]</span>
        <span class="s1">xm = np.ma.array(xm</span><span class="s2">, </span><span class="s1">mask=np.isnan(xm))</span>
        <span class="s1">ym = np.ma.array(ym</span><span class="s2">, </span><span class="s1">mask=np.isnan(ym))</span>
        <span class="s2">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span>

    <span class="s2">def </span><span class="s1">test_linregress(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">result1 = stats.linregress(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">result2 = stats.mstats.linregress(xm</span><span class="s2">, </span><span class="s1">ym)</span>
            <span class="s1">assert_allclose(np.asarray(result1)</span><span class="s2">, </span><span class="s1">np.asarray(result2))</span>

    <span class="s2">def </span><span class="s1">test_pearsonr(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r</span><span class="s2">, </span><span class="s1">p = stats.pearsonr(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">rm</span><span class="s2">, </span><span class="s1">pm = stats.mstats.pearsonr(xm</span><span class="s2">, </span><span class="s1">ym)</span>

            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">14</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(p</span><span class="s2">, </span><span class="s1">pm</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spearmanr(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r</span><span class="s2">, </span><span class="s1">p = stats.spearmanr(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">rm</span><span class="s2">, </span><span class="s1">pm = stats.mstats.spearmanr(xm</span><span class="s2">, </span><span class="s1">ym)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">14</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(p</span><span class="s2">, </span><span class="s1">pm</span><span class="s2">, </span><span class="s4">14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spearmanr_backcompat_useties(self):</span>
        <span class="s3"># A regression test to ensure we don't break backwards compat</span>
        <span class="s3"># more than we have to (see gh-9204).</span>
        <span class="s1">x = np.arange(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">mstats.spearmanr</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, False</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_gmean(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.gmean(abs(x))</span>
            <span class="s1">rm = stats.mstats.gmean(abs(xm))</span>
            <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-13</span><span class="s1">)</span>

            <span class="s1">r = stats.gmean(abs(y))</span>
            <span class="s1">rm = stats.mstats.gmean(abs(ym))</span>
            <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-13</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_hmean(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>

            <span class="s1">r = stats.hmean(abs(x))</span>
            <span class="s1">rm = stats.mstats.hmean(abs(xm))</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

            <span class="s1">r = stats.hmean(abs(y))</span>
            <span class="s1">rm = stats.mstats.hmean(abs(ym))</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_skew(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>

            <span class="s1">r = stats.skew(x)</span>
            <span class="s1">rm = stats.mstats.skew(xm)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

            <span class="s1">r = stats.skew(y)</span>
            <span class="s1">rm = stats.mstats.skew(ym)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_moment(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>

            <span class="s1">r = stats.moment(x)</span>
            <span class="s1">rm = stats.mstats.moment(xm)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

            <span class="s1">r = stats.moment(y)</span>
            <span class="s1">rm = stats.mstats.moment(ym)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_zscore(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>

            <span class="s3"># reference solution</span>
            <span class="s1">zx = (x - x.mean()) / x.std()</span>
            <span class="s1">zy = (y - y.mean()) / y.std()</span>

            <span class="s3"># validate stats</span>
            <span class="s1">assert_allclose(stats.zscore(x)</span><span class="s2">, </span><span class="s1">zx</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s1">)</span>
            <span class="s1">assert_allclose(stats.zscore(y)</span><span class="s2">, </span><span class="s1">zy</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s1">)</span>

            <span class="s3"># compare stats and mstats</span>
            <span class="s1">assert_allclose(stats.zscore(x)</span><span class="s2">, </span><span class="s1">stats.mstats.zscore(xm[</span><span class="s4">0</span><span class="s1">:len(x)])</span><span class="s2">,</span>
                            <span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s1">)</span>
            <span class="s1">assert_allclose(stats.zscore(y)</span><span class="s2">, </span><span class="s1">stats.mstats.zscore(ym[</span><span class="s4">0</span><span class="s1">:len(y)])</span><span class="s2">,</span>
                            <span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_kurtosis(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.kurtosis(x)</span>
            <span class="s1">rm = stats.mstats.kurtosis(xm)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

            <span class="s1">r = stats.kurtosis(y)</span>
            <span class="s1">rm = stats.mstats.kurtosis(ym)</span>
            <span class="s1">assert_almost_equal(r</span><span class="s2">, </span><span class="s1">rm</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_sem(self):</span>
        <span class="s3"># example from stats.sem doc</span>
        <span class="s1">a = np.arange(</span><span class="s4">20</span><span class="s1">).reshape(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">am = np.ma.array(a)</span>
        <span class="s1">r = stats.sem(a</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">rm = stats.mstats.sem(am</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s4">2.82842712</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rm</span><span class="s2">, </span><span class="s4">2.82842712</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>

        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.mstats.sem(xm</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.sem(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.mstats.sem(ym</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.sem(y</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.mstats.sem(xm</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.sem(x</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.mstats.sem(ym</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.sem(y</span><span class="s2">, </span><span class="s1">axis=</span><span class="s2">None, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_describe(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.describe(x</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">rm = stats.mstats.describe(xm</span><span class="s2">, </span><span class="s1">ddof=</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ii </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">6</span><span class="s1">):</span>
                <span class="s1">assert_almost_equal(np.asarray(r[ii])</span><span class="s2">,</span>
                                    <span class="s1">np.asarray(rm[ii])</span><span class="s2">,</span>
                                    <span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_describe_result_attributes(self):</span>
        <span class="s1">actual = mstats.describe(np.arange(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">attributes = (</span><span class="s5">'nobs'</span><span class="s2">, </span><span class="s5">'minmax'</span><span class="s2">, </span><span class="s5">'mean'</span><span class="s2">, </span><span class="s5">'variance'</span><span class="s2">, </span><span class="s5">'skewness'</span><span class="s2">,</span>
                      <span class="s5">'kurtosis'</span><span class="s1">)</span>
        <span class="s1">check_named_results(actual</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_rankdata(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.rankdata(x)</span>
            <span class="s1">rm = stats.mstats.rankdata(x)</span>
            <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">rm)</span>

    <span class="s2">def </span><span class="s1">test_tmean(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.tmean(x)</span><span class="s2">,</span><span class="s1">stats.mstats.tmean(xm)</span><span class="s2">, </span><span class="s4">14</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tmean(y)</span><span class="s2">,</span><span class="s1">stats.mstats.tmean(ym)</span><span class="s2">, </span><span class="s4">14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_tmax(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.tmax(x</span><span class="s2">,</span><span class="s4">2.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmax(xm</span><span class="s2">,</span><span class="s4">2.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tmax(y</span><span class="s2">,</span><span class="s4">2.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmax(ym</span><span class="s2">,</span><span class="s4">2.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

            <span class="s1">assert_almost_equal(stats.tmax(x</span><span class="s2">, </span><span class="s1">upperlimit=</span><span class="s4">3.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmax(xm</span><span class="s2">, </span><span class="s1">upperlimit=</span><span class="s4">3.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tmax(y</span><span class="s2">, </span><span class="s1">upperlimit=</span><span class="s4">3.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmax(ym</span><span class="s2">, </span><span class="s1">upperlimit=</span><span class="s4">3.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_tmin(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_equal(stats.tmin(x)</span><span class="s2">, </span><span class="s1">stats.mstats.tmin(xm))</span>
            <span class="s1">assert_equal(stats.tmin(y)</span><span class="s2">, </span><span class="s1">stats.mstats.tmin(ym))</span>

            <span class="s1">assert_almost_equal(stats.tmin(x</span><span class="s2">, </span><span class="s1">lowerlimit=-</span><span class="s4">1.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmin(xm</span><span class="s2">, </span><span class="s1">lowerlimit=-</span><span class="s4">1.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tmin(y</span><span class="s2">, </span><span class="s1">lowerlimit=-</span><span class="s4">1.</span><span class="s1">)</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tmin(ym</span><span class="s2">, </span><span class="s1">lowerlimit=-</span><span class="s4">1.</span><span class="s1">)</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_zmap(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">z = stats.zmap(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">zm = stats.mstats.zmap(xm</span><span class="s2">, </span><span class="s1">ym)</span>
            <span class="s1">assert_allclose(z</span><span class="s2">, </span><span class="s1">zm[</span><span class="s4">0</span><span class="s1">:len(z)]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_variation(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.variation(x)</span><span class="s2">, </span><span class="s1">stats.mstats.variation(xm)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.variation(y)</span><span class="s2">, </span><span class="s1">stats.mstats.variation(ym)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_tvar(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.tvar(x)</span><span class="s2">, </span><span class="s1">stats.mstats.tvar(xm)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tvar(y)</span><span class="s2">, </span><span class="s1">stats.mstats.tvar(ym)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_trimboth(self):</span>
        <span class="s1">a = np.arange(</span><span class="s4">20</span><span class="s1">)</span>
        <span class="s1">b = stats.trimboth(a</span><span class="s2">, </span><span class="s4">0.1</span><span class="s1">)</span>
        <span class="s1">bm = stats.mstats.trimboth(a</span><span class="s2">, </span><span class="s4">0.1</span><span class="s1">)</span>
        <span class="s1">assert_allclose(np.sort(b)</span><span class="s2">, </span><span class="s1">bm.data[~bm.mask])</span>

    <span class="s2">def </span><span class="s1">test_tsem(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">assert_almost_equal(stats.tsem(x)</span><span class="s2">, </span><span class="s1">stats.mstats.tsem(xm)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">14</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tsem(y)</span><span class="s2">, </span><span class="s1">stats.mstats.tsem(ym)</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">14</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(stats.tsem(x</span><span class="s2">, </span><span class="s1">limits=(-</span><span class="s4">2.</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">))</span><span class="s2">,</span>
                                <span class="s1">stats.mstats.tsem(xm</span><span class="s2">, </span><span class="s1">limits=(-</span><span class="s4">2.</span><span class="s2">, </span><span class="s4">2.</span><span class="s1">))</span><span class="s2">,</span>
                                <span class="s1">decimal=</span><span class="s4">14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_skewtest(self):</span>
        <span class="s3"># this test is for 1D data</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s2">if </span><span class="s1">n &gt; </span><span class="s4">8</span><span class="s1">:</span>
                <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                <span class="s1">r = stats.skewtest(x)</span>
                <span class="s1">rm = stats.mstats.skewtest(xm)</span>
                <span class="s1">assert_allclose(r</span><span class="s2">, </span><span class="s1">rm)</span>

    <span class="s2">def </span><span class="s1">test_skewtest_result_attributes(self):</span>
        <span class="s1">x = np.array((-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)*</span><span class="s4">4</span><span class="s1">)**</span><span class="s4">2</span>
        <span class="s1">res = mstats.skewtest(x)</span>
        <span class="s1">attributes = (</span><span class="s5">'statistic'</span><span class="s2">, </span><span class="s5">'pvalue'</span><span class="s1">)</span>
        <span class="s1">check_named_results(res</span><span class="s2">, </span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">ma=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_skewtest_2D_notmasked(self):</span>
        <span class="s3"># a normal ndarray is passed to the masked function</span>
        <span class="s1">x = np.random.random((</span><span class="s4">20</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)) * </span><span class="s4">20.</span>
        <span class="s1">r = stats.skewtest(x)</span>
        <span class="s1">rm = stats.mstats.skewtest(x)</span>
        <span class="s1">assert_allclose(np.asarray(r)</span><span class="s2">, </span><span class="s1">np.asarray(rm))</span>

    <span class="s2">def </span><span class="s1">test_skewtest_2D_WithMask(self):</span>
        <span class="s1">nx = </span><span class="s4">2</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s2">if </span><span class="s1">n &gt; </span><span class="s4">8</span><span class="s1">:</span>
                <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample2D(n</span><span class="s2">, </span><span class="s1">nx)</span>
                <span class="s1">r = stats.skewtest(x)</span>
                <span class="s1">rm = stats.mstats.skewtest(xm)</span>

                <span class="s1">assert_allclose(r[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rm[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>
                <span class="s1">assert_allclose(r[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rm[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-14</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_normaltest(self):</span>
        <span class="s2">with </span><span class="s1">np.errstate(over=</span><span class="s5">'raise'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s2">, </span><span class="s5">&quot;kurtosistest only valid for n&gt;=20&quot;</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
                <span class="s2">if </span><span class="s1">n &gt; </span><span class="s4">8</span><span class="s1">:</span>
                    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                    <span class="s1">r = stats.normaltest(x)</span>
                    <span class="s1">rm = stats.mstats.normaltest(xm)</span>
                    <span class="s1">assert_allclose(np.asarray(r)</span><span class="s2">, </span><span class="s1">np.asarray(rm))</span>

    <span class="s2">def </span><span class="s1">test_find_repeats(self):</span>
        <span class="s1">x = np.asarray([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]).astype(</span><span class="s5">'float'</span><span class="s1">)</span>
        <span class="s1">tmp = np.asarray([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]).astype(</span><span class="s5">'float'</span><span class="s1">)</span>
        <span class="s1">mask = (tmp == </span><span class="s4">5.</span><span class="s1">)</span>
        <span class="s1">xm = np.ma.array(tmp</span><span class="s2">, </span><span class="s1">mask=mask)</span>
        <span class="s1">x_orig</span><span class="s2">, </span><span class="s1">xm_orig = x.copy()</span><span class="s2">, </span><span class="s1">xm.copy()</span>

        <span class="s1">r = stats.find_repeats(x)</span>
        <span class="s1">rm = stats.mstats.find_repeats(xm)</span>

        <span class="s1">assert_equal(r</span><span class="s2">, </span><span class="s1">rm)</span>
        <span class="s1">assert_equal(x</span><span class="s2">, </span><span class="s1">x_orig)</span>
        <span class="s1">assert_equal(xm</span><span class="s2">, </span><span class="s1">xm_orig)</span>

        <span class="s3"># This crazy behavior is expected by count_tied_groups, but is not</span>
        <span class="s3"># in the docstring...</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">counts = stats.mstats.find_repeats([])</span>
        <span class="s1">assert_equal(counts</span><span class="s2">, </span><span class="s1">np.array(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">dtype=np.intp))</span>

    <span class="s2">def </span><span class="s1">test_kendalltau(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.kendalltau(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">rm = stats.mstats.kendalltau(xm</span><span class="s2">, </span><span class="s1">ym)</span>
            <span class="s1">assert_almost_equal(r[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rm[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">10</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(r[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rm[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s4">7</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_obrientransform(self):</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
            <span class="s1">r = stats.obrientransform(x)</span>
            <span class="s1">rm = stats.mstats.obrientransform(xm)</span>
            <span class="s1">assert_almost_equal(r.T</span><span class="s2">, </span><span class="s1">rm[</span><span class="s4">0</span><span class="s1">:len(x)])</span>

    <span class="s2">def </span><span class="s1">test_ks_1samp(self):</span>
        <span class="s0">&quot;&quot;&quot;Checks that mstats.ks_1samp and stats.ks_1samp agree on masked arrays.&quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s2">, </span><span class="s5">'asymp'</span><span class="s1">]:</span>
            <span class="s2">with </span><span class="s1">suppress_warnings():</span>
                <span class="s2">for </span><span class="s1">alternative </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'less'</span><span class="s2">, </span><span class="s5">'greater'</span><span class="s2">, </span><span class="s5">'two-sided'</span><span class="s1">]:</span>
                    <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
                        <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                        <span class="s1">res1 = stats.ks_1samp(x</span><span class="s2">, </span><span class="s1">stats.norm.cdf</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">res2 = stats.mstats.ks_1samp(xm</span><span class="s2">, </span><span class="s1">stats.norm.cdf</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res2))</span>
                        <span class="s1">res3 = stats.ks_1samp(xm</span><span class="s2">, </span><span class="s1">stats.norm.cdf</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res3))</span>

    <span class="s2">def </span><span class="s1">test_kstest_1samp(self):</span>
        <span class="s0">&quot;&quot;&quot;Checks that 1-sample mstats.kstest and stats.kstest agree on masked arrays.&quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s2">, </span><span class="s5">'asymp'</span><span class="s1">]:</span>
            <span class="s2">with </span><span class="s1">suppress_warnings():</span>
                <span class="s2">for </span><span class="s1">alternative </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'less'</span><span class="s2">, </span><span class="s5">'greater'</span><span class="s2">, </span><span class="s5">'two-sided'</span><span class="s1">]:</span>
                    <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
                        <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                        <span class="s1">res1 = stats.kstest(x</span><span class="s2">, </span><span class="s5">'norm'</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">res2 = stats.mstats.kstest(xm</span><span class="s2">, </span><span class="s5">'norm'</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res2))</span>
                        <span class="s1">res3 = stats.kstest(xm</span><span class="s2">, </span><span class="s5">'norm'</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res3))</span>

    <span class="s2">def </span><span class="s1">test_ks_2samp(self):</span>
        <span class="s0">&quot;&quot;&quot;Checks that mstats.ks_2samp and stats.ks_2samp agree on masked arrays. 
        gh-8431&quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s2">, </span><span class="s5">'asymp'</span><span class="s1">]:</span>
            <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
                <span class="s2">if </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s1">]:</span>
                    <span class="s1">message = </span><span class="s5">&quot;ks_2samp: Exact calculation unsuccessful.&quot;</span>
                    <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s1">message)</span>
                <span class="s2">for </span><span class="s1">alternative </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'less'</span><span class="s2">, </span><span class="s5">'greater'</span><span class="s2">, </span><span class="s5">'two-sided'</span><span class="s1">]:</span>
                    <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
                        <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                        <span class="s1">res1 = stats.ks_2samp(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">res2 = stats.mstats.ks_2samp(xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res2))</span>
                        <span class="s1">res3 = stats.ks_2samp(xm</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res3))</span>

    <span class="s2">def </span><span class="s1">test_kstest_2samp(self):</span>
        <span class="s0">&quot;&quot;&quot;Checks that 2-sample mstats.kstest and stats.kstest agree on masked arrays.&quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s2">, </span><span class="s5">'asymp'</span><span class="s1">]:</span>
            <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
                <span class="s2">if </span><span class="s1">mode </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'auto'</span><span class="s2">, </span><span class="s5">'exact'</span><span class="s1">]:</span>
                    <span class="s1">message = </span><span class="s5">&quot;ks_2samp: Exact calculation unsuccessful.&quot;</span>
                    <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s1">message)</span>
                <span class="s2">for </span><span class="s1">alternative </span><span class="s2">in </span><span class="s1">[</span><span class="s5">'less'</span><span class="s2">, </span><span class="s5">'greater'</span><span class="s2">, </span><span class="s5">'two-sided'</span><span class="s1">]:</span>
                    <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">self.get_n():</span>
                        <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym = self.generate_xy_sample(n)</span>
                        <span class="s1">res1 = stats.kstest(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">res2 = stats.mstats.kstest(xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res2))</span>
                        <span class="s1">res3 = stats.kstest(xm</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alternative=alternative</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                        <span class="s1">assert_equal(np.asarray(res1)</span><span class="s2">, </span><span class="s1">np.asarray(res3))</span>


<span class="s2">class </span><span class="s1">TestBrunnerMunzel:</span>
    <span class="s3"># Data from (Lumley, 1996)</span>
    <span class="s1">X = np.ma.masked_invalid([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
                              <span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">np.nan])</span>
    <span class="s1">Y = np.ma.masked_invalid([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">significant = </span><span class="s4">14</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_one_sided(self):</span>
        <span class="s3"># Results are compared with R's lawstat package.</span>
        <span class="s1">u1</span><span class="s2">, </span><span class="s1">p1 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">self.Y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'less'</span><span class="s1">)</span>
        <span class="s1">u2</span><span class="s2">, </span><span class="s1">p2 = mstats.brunnermunzel(self.Y</span><span class="s2">, </span><span class="s1">self.X</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'greater'</span><span class="s1">)</span>
        <span class="s1">u3</span><span class="s2">, </span><span class="s1">p3 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">self.Y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'greater'</span><span class="s1">)</span>
        <span class="s1">u4</span><span class="s2">, </span><span class="s1">p4 = mstats.brunnermunzel(self.Y</span><span class="s2">, </span><span class="s1">self.X</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'less'</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p3</span><span class="s2">, </span><span class="s1">p4</span><span class="s2">, </span><span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_(p1 != p3)</span>
        <span class="s1">assert_almost_equal(u1</span><span class="s2">, </span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u3</span><span class="s2">, </span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u4</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s4">0.0028931043330757342</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p3</span><span class="s2">, </span><span class="s4">0.99710689566692423</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_two_sided(self):</span>
        <span class="s3"># Results are compared with R's lawstat package.</span>
        <span class="s1">u1</span><span class="s2">, </span><span class="s1">p1 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">self.Y</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'two-sided'</span><span class="s1">)</span>
        <span class="s1">u2</span><span class="s2">, </span><span class="s1">p2 = mstats.brunnermunzel(self.Y</span><span class="s2">, </span><span class="s1">self.X</span><span class="s2">, </span><span class="s1">alternative=</span><span class="s5">'two-sided'</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u1</span><span class="s2">, </span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s4">0.0057862086661515377</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_default(self):</span>
        <span class="s3"># The default value for alternative is two-sided</span>
        <span class="s1">u1</span><span class="s2">, </span><span class="s1">p1 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">self.Y)</span>
        <span class="s1">u2</span><span class="s2">, </span><span class="s1">p2 = mstats.brunnermunzel(self.Y</span><span class="s2">, </span><span class="s1">self.X)</span>

        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u1</span><span class="s2">, </span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s4">0.0057862086661515377</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_alternative_error(self):</span>
        <span class="s1">alternative = </span><span class="s5">&quot;error&quot;</span>
        <span class="s1">distribution = </span><span class="s5">&quot;t&quot;</span>
        <span class="s1">assert_(alternative </span><span class="s2">not in </span><span class="s1">[</span><span class="s5">&quot;two-sided&quot;</span><span class="s2">, </span><span class="s5">&quot;greater&quot;</span><span class="s2">, </span><span class="s5">&quot;less&quot;</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">,</span>
                      <span class="s1">mstats.brunnermunzel</span><span class="s2">,</span>
                      <span class="s1">self.X</span><span class="s2">,</span>
                      <span class="s1">self.Y</span><span class="s2">,</span>
                      <span class="s1">alternative</span><span class="s2">,</span>
                      <span class="s1">distribution)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_distribution_norm(self):</span>
        <span class="s1">u1</span><span class="s2">, </span><span class="s1">p1 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">self.Y</span><span class="s2">, </span><span class="s1">distribution=</span><span class="s5">&quot;normal&quot;</span><span class="s1">)</span>
        <span class="s1">u2</span><span class="s2">, </span><span class="s1">p2 = mstats.brunnermunzel(self.Y</span><span class="s2">, </span><span class="s1">self.X</span><span class="s2">, </span><span class="s1">distribution=</span><span class="s5">&quot;normal&quot;</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u1</span><span class="s2">, </span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(u2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3.1374674823029505</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>
        <span class="s1">assert_almost_equal(p1</span><span class="s2">, </span><span class="s4">0.0017041417600383024</span><span class="s2">,</span>
                            <span class="s1">decimal=self.significant)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_distribution_error(self):</span>
        <span class="s1">alternative = </span><span class="s5">&quot;two-sided&quot;</span>
        <span class="s1">distribution = </span><span class="s5">&quot;error&quot;</span>
        <span class="s1">assert_(alternative </span><span class="s2">not in </span><span class="s1">[</span><span class="s5">&quot;t&quot;</span><span class="s2">, </span><span class="s5">&quot;normal&quot;</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">,</span>
                      <span class="s1">mstats.brunnermunzel</span><span class="s2">,</span>
                      <span class="s1">self.X</span><span class="s2">,</span>
                      <span class="s1">self.Y</span><span class="s2">,</span>
                      <span class="s1">alternative</span><span class="s2">,</span>
                      <span class="s1">distribution)</span>

    <span class="s2">def </span><span class="s1">test_brunnermunzel_empty_imput(self):</span>
        <span class="s1">u1</span><span class="s2">, </span><span class="s1">p1 = mstats.brunnermunzel(self.X</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s1">u2</span><span class="s2">, </span><span class="s1">p2 = mstats.brunnermunzel([]</span><span class="s2">, </span><span class="s1">self.Y)</span>
        <span class="s1">u3</span><span class="s2">, </span><span class="s1">p3 = mstats.brunnermunzel([]</span><span class="s2">, </span><span class="s1">[])</span>

        <span class="s1">assert_(np.isnan(u1))</span>
        <span class="s1">assert_(np.isnan(p1))</span>
        <span class="s1">assert_(np.isnan(u2))</span>
        <span class="s1">assert_(np.isnan(p2))</span>
        <span class="s1">assert_(np.isnan(u3))</span>
        <span class="s1">assert_(np.isnan(p3))</span>
</pre>
</body>
</html>
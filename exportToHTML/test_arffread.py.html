<html>
<head>
<title>test_arffread.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arffread.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">os.path </span><span class="s0">import </span><span class="s1">join </span><span class="s0">as </span><span class="s1">pjoin</span>

<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">StringIO</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(assert_array_almost_equal</span><span class="s0">,</span>
                           <span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_)</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy.io.arff </span><span class="s0">import </span><span class="s1">loadarff</span>
<span class="s0">from </span><span class="s1">scipy.io.arff._arffread </span><span class="s0">import </span><span class="s1">read_header</span><span class="s0">, </span><span class="s1">ParseArffError</span>


<span class="s1">data_path = pjoin(os.path.dirname(__file__)</span><span class="s0">, </span><span class="s2">'data'</span><span class="s1">)</span>

<span class="s1">test1 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test1.arff'</span><span class="s1">)</span>
<span class="s1">test2 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test2.arff'</span><span class="s1">)</span>
<span class="s1">test3 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test3.arff'</span><span class="s1">)</span>

<span class="s1">test4 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test4.arff'</span><span class="s1">)</span>
<span class="s1">test5 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test5.arff'</span><span class="s1">)</span>
<span class="s1">test6 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test6.arff'</span><span class="s1">)</span>
<span class="s1">test7 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test7.arff'</span><span class="s1">)</span>
<span class="s1">test8 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test8.arff'</span><span class="s1">)</span>
<span class="s1">test9 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test9.arff'</span><span class="s1">)</span>
<span class="s1">test10 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test10.arff'</span><span class="s1">)</span>
<span class="s1">test11 = pjoin(data_path</span><span class="s0">, </span><span class="s2">'test11.arff'</span><span class="s1">)</span>
<span class="s1">test_quoted_nominal = pjoin(data_path</span><span class="s0">, </span><span class="s2">'quoted_nominal.arff'</span><span class="s1">)</span>
<span class="s1">test_quoted_nominal_spaces = pjoin(data_path</span><span class="s0">, </span><span class="s2">'quoted_nominal_spaces.arff'</span><span class="s1">)</span>

<span class="s1">expect4_data = [(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.4</span><span class="s0">, </span><span class="s2">'class1'</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.4</span><span class="s0">, </span><span class="s2">'class2'</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s2">'class3'</span><span class="s1">)]</span>
<span class="s1">expected_types = [</span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'nominal'</span><span class="s1">]</span>

<span class="s1">missing = pjoin(data_path</span><span class="s0">, </span><span class="s2">'missing.arff'</span><span class="s1">)</span>
<span class="s1">expect_missing_raw = np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s1">np.nan]])</span>
<span class="s1">expect_missing = np.empty(</span><span class="s3">3</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">'yop'</span><span class="s0">, </span><span class="s1">float)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'yap'</span><span class="s0">, </span><span class="s1">float)])</span>
<span class="s1">expect_missing[</span><span class="s2">'yop'</span><span class="s1">] = expect_missing_raw[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
<span class="s1">expect_missing[</span><span class="s2">'yap'</span><span class="s1">] = expect_missing_raw[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>


<span class="s0">class </span><span class="s1">TestData:</span>
    <span class="s0">def </span><span class="s1">test1(self):</span>
        <span class="s4"># Parsing trivial file with nothing.</span>
        <span class="s1">self._test(test4)</span>

    <span class="s0">def </span><span class="s1">test2(self):</span>
        <span class="s4"># Parsing trivial file with some comments in the data section.</span>
        <span class="s1">self._test(test5)</span>

    <span class="s0">def </span><span class="s1">test3(self):</span>
        <span class="s4"># Parsing trivial file with nominal attribute of 1 character.</span>
        <span class="s1">self._test(test6)</span>

    <span class="s0">def </span><span class="s1">test4(self):</span>
        <span class="s4"># Parsing trivial file with trailing spaces in attribute declaration.</span>
        <span class="s1">self._test(test11)</span>

    <span class="s0">def </span><span class="s1">_test(self</span><span class="s0">, </span><span class="s1">test_file):</span>
        <span class="s1">data</span><span class="s0">, </span><span class="s1">meta = loadarff(test_file)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(data)):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">):</span>
                <span class="s1">assert_array_almost_equal(expect4_data[i][j]</span><span class="s0">, </span><span class="s1">data[i][j])</span>
        <span class="s1">assert_equal(meta.types()</span><span class="s0">, </span><span class="s1">expected_types)</span>

    <span class="s0">def </span><span class="s1">test_filelike(self):</span>
        <span class="s4"># Test reading from file-like object (StringIO)</span>
        <span class="s0">with </span><span class="s1">open(test1) </span><span class="s0">as </span><span class="s1">f1:</span>
            <span class="s1">data1</span><span class="s0">, </span><span class="s1">meta1 = loadarff(f1)</span>
        <span class="s0">with </span><span class="s1">open(test1) </span><span class="s0">as </span><span class="s1">f2:</span>
            <span class="s1">data2</span><span class="s0">, </span><span class="s1">meta2 = loadarff(StringIO(f2.read()))</span>
        <span class="s1">assert_(data1 == data2)</span>
        <span class="s1">assert_(repr(meta1) == repr(meta2))</span>

    <span class="s0">def </span><span class="s1">test_path(self):</span>
        <span class="s4"># Test reading from `pathlib.Path` object</span>
        <span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>

        <span class="s0">with </span><span class="s1">open(test1) </span><span class="s0">as </span><span class="s1">f1:</span>
            <span class="s1">data1</span><span class="s0">, </span><span class="s1">meta1 = loadarff(f1)</span>

        <span class="s1">data2</span><span class="s0">, </span><span class="s1">meta2 = loadarff(Path(test1))</span>

        <span class="s1">assert_(data1 == data2)</span>
        <span class="s1">assert_(repr(meta1) == repr(meta2))</span>


<span class="s0">class </span><span class="s1">TestMissingData:</span>
    <span class="s0">def </span><span class="s1">test_missing(self):</span>
        <span class="s1">data</span><span class="s0">, </span><span class="s1">meta = loadarff(missing)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'yop'</span><span class="s0">, </span><span class="s2">'yap'</span><span class="s1">]:</span>
            <span class="s1">assert_array_almost_equal(data[i]</span><span class="s0">, </span><span class="s1">expect_missing[i])</span>


<span class="s0">class </span><span class="s1">TestNoData:</span>
    <span class="s0">def </span><span class="s1">test_nodata(self):</span>
        <span class="s4"># The file nodata.arff has no data in the @DATA section.</span>
        <span class="s4"># Reading it should result in an array with length 0.</span>
        <span class="s1">nodata_filename = os.path.join(data_path</span><span class="s0">, </span><span class="s2">'nodata.arff'</span><span class="s1">)</span>
        <span class="s1">data</span><span class="s0">, </span><span class="s1">meta = loadarff(nodata_filename)</span>
        <span class="s0">if </span><span class="s1">sys.byteorder == </span><span class="s2">'big'</span><span class="s1">:</span>
            <span class="s1">end = </span><span class="s2">'&gt;'</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">end = </span><span class="s2">'&lt;'</span>
        <span class="s1">expected_dtype = np.dtype([(</span><span class="s2">'sepallength'</span><span class="s0">, </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">end</span><span class="s0">}</span><span class="s2">f8'</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s2">'sepalwidth'</span><span class="s0">, </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">end</span><span class="s0">}</span><span class="s2">f8'</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s2">'petallength'</span><span class="s0">, </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">end</span><span class="s0">}</span><span class="s2">f8'</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s2">'petalwidth'</span><span class="s0">, </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">end</span><span class="s0">}</span><span class="s2">f8'</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s2">'class'</span><span class="s0">, </span><span class="s2">'S15'</span><span class="s1">)])</span>
        <span class="s1">assert_equal(data.dtype</span><span class="s0">, </span><span class="s1">expected_dtype)</span>
        <span class="s1">assert_equal(data.size</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestHeader:</span>
    <span class="s0">def </span><span class="s1">test_type_parsing(self):</span>
        <span class="s4"># Test parsing type of attribute from their value.</span>
        <span class="s0">with </span><span class="s1">open(test2) </span><span class="s0">as </span><span class="s1">ofile:</span>
            <span class="s1">rel</span><span class="s0">, </span><span class="s1">attrs = read_header(ofile)</span>

        <span class="s1">expected = [</span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s0">,</span>
                    <span class="s2">'numeric'</span><span class="s0">, </span><span class="s2">'string'</span><span class="s0">, </span><span class="s2">'string'</span><span class="s0">, </span><span class="s2">'nominal'</span><span class="s0">, </span><span class="s2">'nominal'</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(attrs)):</span>
            <span class="s1">assert_(attrs[i].type_name == expected[i])</span>

    <span class="s0">def </span><span class="s1">test_badtype_parsing(self):</span>
        <span class="s4"># Test parsing wrong type of attribute from their value.</span>
        <span class="s0">def </span><span class="s1">badtype_read():</span>
            <span class="s0">with </span><span class="s1">open(test3) </span><span class="s0">as </span><span class="s1">ofile:</span>
                <span class="s1">_</span><span class="s0">, </span><span class="s1">_ = read_header(ofile)</span>

        <span class="s1">assert_raises(ParseArffError</span><span class="s0">, </span><span class="s1">badtype_read)</span>

    <span class="s0">def </span><span class="s1">test_fullheader1(self):</span>
        <span class="s4"># Parsing trivial header with nothing.</span>
        <span class="s0">with </span><span class="s1">open(test1) </span><span class="s0">as </span><span class="s1">ofile:</span>
            <span class="s1">rel</span><span class="s0">, </span><span class="s1">attrs = read_header(ofile)</span>

        <span class="s4"># Test relation</span>
        <span class="s1">assert_(rel == </span><span class="s2">'test1'</span><span class="s1">)</span>

        <span class="s4"># Test numerical attributes</span>
        <span class="s1">assert_(len(attrs) == </span><span class="s3">5</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">):</span>
            <span class="s1">assert_(attrs[i].name == </span><span class="s2">'attr%d' </span><span class="s1">% i)</span>
            <span class="s1">assert_(attrs[i].type_name == </span><span class="s2">'numeric'</span><span class="s1">)</span>

        <span class="s4"># Test nominal attribute</span>
        <span class="s1">assert_(attrs[</span><span class="s3">4</span><span class="s1">].name == </span><span class="s2">'class'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">4</span><span class="s1">].values == (</span><span class="s2">'class0'</span><span class="s0">, </span><span class="s2">'class1'</span><span class="s0">, </span><span class="s2">'class2'</span><span class="s0">, </span><span class="s2">'class3'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_dateheader(self):</span>
        <span class="s0">with </span><span class="s1">open(test7) </span><span class="s0">as </span><span class="s1">ofile:</span>
            <span class="s1">rel</span><span class="s0">, </span><span class="s1">attrs = read_header(ofile)</span>

        <span class="s1">assert_(rel == </span><span class="s2">'test7'</span><span class="s1">)</span>

        <span class="s1">assert_(len(attrs) == </span><span class="s3">5</span><span class="s1">)</span>

        <span class="s1">assert_(attrs[</span><span class="s3">0</span><span class="s1">].name == </span><span class="s2">'attr_year'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">0</span><span class="s1">].date_format == </span><span class="s2">'%Y'</span><span class="s1">)</span>

        <span class="s1">assert_(attrs[</span><span class="s3">1</span><span class="s1">].name == </span><span class="s2">'attr_month'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">1</span><span class="s1">].date_format == </span><span class="s2">'%Y-%m'</span><span class="s1">)</span>

        <span class="s1">assert_(attrs[</span><span class="s3">2</span><span class="s1">].name == </span><span class="s2">'attr_date'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">2</span><span class="s1">].date_format == </span><span class="s2">'%Y-%m-%d'</span><span class="s1">)</span>

        <span class="s1">assert_(attrs[</span><span class="s3">3</span><span class="s1">].name == </span><span class="s2">'attr_datetime_local'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">3</span><span class="s1">].date_format == </span><span class="s2">'%Y-%m-%d %H:%M'</span><span class="s1">)</span>

        <span class="s1">assert_(attrs[</span><span class="s3">4</span><span class="s1">].name == </span><span class="s2">'attr_datetime_missing'</span><span class="s1">)</span>
        <span class="s1">assert_(attrs[</span><span class="s3">4</span><span class="s1">].date_format == </span><span class="s2">'%Y-%m-%d %H:%M'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dateheader_unsupported(self):</span>
        <span class="s0">def </span><span class="s1">read_dateheader_unsupported():</span>
            <span class="s0">with </span><span class="s1">open(test8) </span><span class="s0">as </span><span class="s1">ofile:</span>
                <span class="s1">_</span><span class="s0">, </span><span class="s1">_ = read_header(ofile)</span>

        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">read_dateheader_unsupported)</span>


<span class="s0">class </span><span class="s1">TestDateAttribute:</span>
    <span class="s0">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.data</span><span class="s0">, </span><span class="s1">self.meta = loadarff(test7)</span>

    <span class="s0">def </span><span class="s1">test_year_attribute(self):</span>
        <span class="s1">expected = np.array([</span>
            <span class="s2">'1999'</span><span class="s0">,</span>
            <span class="s2">'2004'</span><span class="s0">,</span>
            <span class="s2">'1817'</span><span class="s0">,</span>
            <span class="s2">'2100'</span><span class="s0">,</span>
            <span class="s2">'2013'</span><span class="s0">,</span>
            <span class="s2">'1631'</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'datetime64[Y]'</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_year&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_month_attribute(self):</span>
        <span class="s1">expected = np.array([</span>
            <span class="s2">'1999-01'</span><span class="s0">,</span>
            <span class="s2">'2004-12'</span><span class="s0">,</span>
            <span class="s2">'1817-04'</span><span class="s0">,</span>
            <span class="s2">'2100-09'</span><span class="s0">,</span>
            <span class="s2">'2013-11'</span><span class="s0">,</span>
            <span class="s2">'1631-10'</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'datetime64[M]'</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_month&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_date_attribute(self):</span>
        <span class="s1">expected = np.array([</span>
            <span class="s2">'1999-01-31'</span><span class="s0">,</span>
            <span class="s2">'2004-12-01'</span><span class="s0">,</span>
            <span class="s2">'1817-04-28'</span><span class="s0">,</span>
            <span class="s2">'2100-09-10'</span><span class="s0">,</span>
            <span class="s2">'2013-11-30'</span><span class="s0">,</span>
            <span class="s2">'1631-10-15'</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'datetime64[D]'</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_date&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_datetime_local_attribute(self):</span>
        <span class="s1">expected = np.array([</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">1999</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">31</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">2004</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">23</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">59</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">1817</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">28</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">13</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">2100</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">9</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">2013</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">11</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">30</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">55</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(year=</span><span class="s3">1631</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">15</span><span class="s0">, </span><span class="s1">hour=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">minute=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'datetime64[m]'</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_datetime_local&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_datetime_missing(self):</span>
        <span class="s1">expected = np.array([</span>
            <span class="s2">'nat'</span><span class="s0">,</span>
            <span class="s2">'2004-12-01T23:59'</span><span class="s0">,</span>
            <span class="s2">'nat'</span><span class="s0">,</span>
            <span class="s2">'nat'</span><span class="s0">,</span>
            <span class="s2">'2013-11-30T04:55'</span><span class="s0">,</span>
            <span class="s2">'1631-10-15T20:04'</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'datetime64[m]'</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_datetime_missing&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_datetime_timezone(self):</span>
        <span class="s1">assert_raises(ParseArffError</span><span class="s0">, </span><span class="s1">loadarff</span><span class="s0">, </span><span class="s1">test8)</span>


<span class="s0">class </span><span class="s1">TestRelationalAttribute:</span>
    <span class="s0">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.data</span><span class="s0">, </span><span class="s1">self.meta = loadarff(test9)</span>

    <span class="s0">def </span><span class="s1">test_attributes(self):</span>
        <span class="s1">assert_equal(len(self.meta._attributes)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">relational = list(self.meta._attributes.values())[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">assert_equal(relational.name</span><span class="s0">, </span><span class="s2">'attr_date_number'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.type_name</span><span class="s0">, </span><span class="s2">'relational'</span><span class="s1">)</span>
        <span class="s1">assert_equal(len(relational.attributes)</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">0</span><span class="s1">].name</span><span class="s0">,</span>
                     <span class="s2">'attr_date'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">0</span><span class="s1">].type_name</span><span class="s0">,</span>
                     <span class="s2">'date'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">1</span><span class="s1">].name</span><span class="s0">,</span>
                     <span class="s2">'attr_number'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">1</span><span class="s1">].type_name</span><span class="s0">,</span>
                     <span class="s2">'numeric'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_data(self):</span>
        <span class="s1">dtype_instance = [(</span><span class="s2">'attr_date'</span><span class="s0">, </span><span class="s2">'datetime64[D]'</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">'attr_number'</span><span class="s0">, </span><span class="s1">np.float_)]</span>

        <span class="s1">expected = [</span>
            <span class="s1">np.array([(</span><span class="s2">'1999-01-31'</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'1935-11-27'</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span><span class="s0">,</span>
            <span class="s1">np.array([(</span><span class="s2">'2004-12-01'</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'1942-08-13'</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span><span class="s0">,</span>
            <span class="s1">np.array([(</span><span class="s2">'1817-04-28'</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span><span class="s0">,</span>
            <span class="s1">np.array([(</span><span class="s2">'2100-09-10'</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'1957-04-17'</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                      <span class="s1">(</span><span class="s2">'1721-01-14'</span><span class="s0">, </span><span class="s3">400</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span><span class="s0">,</span>
            <span class="s1">np.array([(</span><span class="s2">'2013-11-30'</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span><span class="s0">,</span>
            <span class="s1">np.array([(</span><span class="s2">'1631-10-15'</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=dtype_instance)</span>
        <span class="s1">]</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(self.data[</span><span class="s2">&quot;attr_date_number&quot;</span><span class="s1">])):</span>
            <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_date_number&quot;</span><span class="s1">][i]</span><span class="s0">,</span>
                               <span class="s1">expected[i])</span>


<span class="s0">class </span><span class="s1">TestRelationalAttributeLong:</span>
    <span class="s0">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.data</span><span class="s0">, </span><span class="s1">self.meta = loadarff(test10)</span>

    <span class="s0">def </span><span class="s1">test_attributes(self):</span>
        <span class="s1">assert_equal(len(self.meta._attributes)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">relational = list(self.meta._attributes.values())[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">assert_equal(relational.name</span><span class="s0">, </span><span class="s2">'attr_relational'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.type_name</span><span class="s0">, </span><span class="s2">'relational'</span><span class="s1">)</span>
        <span class="s1">assert_equal(len(relational.attributes)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">0</span><span class="s1">].name</span><span class="s0">,</span>
                     <span class="s2">'attr_number'</span><span class="s1">)</span>
        <span class="s1">assert_equal(relational.attributes[</span><span class="s3">0</span><span class="s1">].type_name</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_data(self):</span>
        <span class="s1">dtype_instance = [(</span><span class="s2">'attr_number'</span><span class="s0">, </span><span class="s1">np.float_)]</span>

        <span class="s1">expected = np.array([(n</span><span class="s0">,</span><span class="s1">) </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">30000</span><span class="s1">)]</span><span class="s0">,</span>
                            <span class="s1">dtype=dtype_instance)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;attr_relational&quot;</span><span class="s1">][</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">expected)</span>


<span class="s0">class </span><span class="s1">TestQuotedNominal:</span>
    <span class="s5">&quot;&quot;&quot; 
    Regression test for issue #10232 : Exception in loadarff with quoted nominal attributes. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.data</span><span class="s0">, </span><span class="s1">self.meta = loadarff(test_quoted_nominal)</span>

    <span class="s0">def </span><span class="s1">test_attributes(self):</span>
        <span class="s1">assert_equal(len(self.meta._attributes)</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">age</span><span class="s0">, </span><span class="s1">smoker = self.meta._attributes.values()</span>

        <span class="s1">assert_equal(age.name</span><span class="s0">, </span><span class="s2">'age'</span><span class="s1">)</span>
        <span class="s1">assert_equal(age.type_name</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.name</span><span class="s0">, </span><span class="s2">'smoker'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.type_name</span><span class="s0">, </span><span class="s2">'nominal'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.values</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'yes'</span><span class="s0">, </span><span class="s2">'no'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_data(self):</span>

        <span class="s1">age_dtype_instance = np.float_</span>
        <span class="s1">smoker_dtype_instance = </span><span class="s2">'&lt;S3'</span>

        <span class="s1">age_expected = np.array([</span>
            <span class="s3">18</span><span class="s0">,</span>
            <span class="s3">24</span><span class="s0">,</span>
            <span class="s3">44</span><span class="s0">,</span>
            <span class="s3">56</span><span class="s0">,</span>
            <span class="s3">89</span><span class="s0">,</span>
            <span class="s3">11</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=age_dtype_instance)</span>

        <span class="s1">smoker_expected = np.array([</span>
            <span class="s2">'no'</span><span class="s0">,</span>
            <span class="s2">'yes'</span><span class="s0">,</span>
            <span class="s2">'no'</span><span class="s0">,</span>
            <span class="s2">'no'</span><span class="s0">,</span>
            <span class="s2">'yes'</span><span class="s0">,</span>
            <span class="s2">'no'</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=smoker_dtype_instance)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;age&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">age_expected)</span>
        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;smoker&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">smoker_expected)</span>


<span class="s0">class </span><span class="s1">TestQuotedNominalSpaces:</span>
    <span class="s5">&quot;&quot;&quot; 
    Regression test for issue #10232 : Exception in loadarff with quoted nominal attributes. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">self.data</span><span class="s0">, </span><span class="s1">self.meta = loadarff(test_quoted_nominal_spaces)</span>

    <span class="s0">def </span><span class="s1">test_attributes(self):</span>
        <span class="s1">assert_equal(len(self.meta._attributes)</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">age</span><span class="s0">, </span><span class="s1">smoker = self.meta._attributes.values()</span>

        <span class="s1">assert_equal(age.name</span><span class="s0">, </span><span class="s2">'age'</span><span class="s1">)</span>
        <span class="s1">assert_equal(age.type_name</span><span class="s0">, </span><span class="s2">'numeric'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.name</span><span class="s0">, </span><span class="s2">'smoker'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.type_name</span><span class="s0">, </span><span class="s2">'nominal'</span><span class="s1">)</span>
        <span class="s1">assert_equal(smoker.values</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'  yes'</span><span class="s0">, </span><span class="s2">'no  '</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_data(self):</span>

        <span class="s1">age_dtype_instance = np.float_</span>
        <span class="s1">smoker_dtype_instance = </span><span class="s2">'&lt;S5'</span>

        <span class="s1">age_expected = np.array([</span>
            <span class="s3">18</span><span class="s0">,</span>
            <span class="s3">24</span><span class="s0">,</span>
            <span class="s3">44</span><span class="s0">,</span>
            <span class="s3">56</span><span class="s0">,</span>
            <span class="s3">89</span><span class="s0">,</span>
            <span class="s3">11</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=age_dtype_instance)</span>

        <span class="s1">smoker_expected = np.array([</span>
            <span class="s2">'no  '</span><span class="s0">,</span>
            <span class="s2">'  yes'</span><span class="s0">,</span>
            <span class="s2">'no  '</span><span class="s0">,</span>
            <span class="s2">'no  '</span><span class="s0">,</span>
            <span class="s2">'  yes'</span><span class="s0">,</span>
            <span class="s2">'no  '</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=smoker_dtype_instance)</span>

        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;age&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">age_expected)</span>
        <span class="s1">assert_array_equal(self.data[</span><span class="s2">&quot;smoker&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">smoker_expected)</span>
</pre>
</body>
</html>
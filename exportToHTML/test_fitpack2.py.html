<html>
<head>
<title>test_fitpack2.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_fitpack2.py</font>
</center></td></tr></table>
<pre><span class="s0"># Created by Pearu Peterson, June 2003</span>
<span class="s2">import </span><span class="s1">itertools</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">(assert_equal</span><span class="s2">, </span><span class="s1">assert_almost_equal</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">,</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">suppress_warnings)</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>

<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">array</span><span class="s2">, </span><span class="s1">diff</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">, </span><span class="s1">meshgrid</span><span class="s2">, </span><span class="s1">ones</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s1">shape</span>
<span class="s2">from </span><span class="s1">scipy.interpolate._fitpack_py </span><span class="s2">import </span><span class="s1">bisplrep</span><span class="s2">, </span><span class="s1">bisplev</span><span class="s2">, </span><span class="s1">splrep</span><span class="s2">, </span><span class="s1">spalde</span>
<span class="s2">from </span><span class="s1">scipy.interpolate._fitpack2 </span><span class="s2">import </span><span class="s1">(UnivariateSpline</span><span class="s2">,</span>
        <span class="s1">LSQUnivariateSpline</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s2">,</span>
        <span class="s1">LSQBivariateSpline</span><span class="s2">, </span><span class="s1">SmoothBivariateSpline</span><span class="s2">, </span><span class="s1">RectBivariateSpline</span><span class="s2">,</span>
        <span class="s1">LSQSphereBivariateSpline</span><span class="s2">, </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s2">,</span>
        <span class="s1">RectSphereBivariateSpline)</span>


<span class="s2">class </span><span class="s1">TestUnivariateSpline:</span>
    <span class="s2">def </span><span class="s1">test_linear_constant(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">lut = UnivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut.get_knots()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">assert_array_almost_equal(lut.get_coeffs()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(lut.get_residual()</span><span class="s2">,</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">2</span><span class="s1">])</span><span class="s2">,</span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_preserve_shape(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">lut = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">arg = </span><span class="s3">2</span>
        <span class="s1">assert_equal(shape(arg)</span><span class="s2">, </span><span class="s1">shape(lut(arg)))</span>
        <span class="s1">assert_equal(shape(arg)</span><span class="s2">, </span><span class="s1">shape(lut(arg</span><span class="s2">, </span><span class="s1">nu=</span><span class="s3">1</span><span class="s1">)))</span>
        <span class="s1">arg = [</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2.5</span><span class="s1">]</span>
        <span class="s1">assert_equal(shape(arg)</span><span class="s2">, </span><span class="s1">shape(lut(arg)))</span>
        <span class="s1">assert_equal(shape(arg)</span><span class="s2">, </span><span class="s1">shape(lut(arg</span><span class="s2">, </span><span class="s1">nu=</span><span class="s3">1</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_linear_1d(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">lut = UnivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut.get_knots()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">assert_array_almost_equal(lut.get_coeffs()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(lut.get_residual()</span><span class="s2">,</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">2</span><span class="s1">])</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_subclassing(self):</span>
        <span class="s0"># See #731</span>

        <span class="s2">class </span><span class="s1">ZeroSpline(UnivariateSpline):</span>
            <span class="s2">def </span><span class="s1">__call__(self</span><span class="s2">, </span><span class="s1">x):</span>
                <span class="s2">return </span><span class="s3">0</span><span class="s1">*array(x)</span>

        <span class="s1">sp = ZeroSpline([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(sp([</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">2.5</span><span class="s1">])</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s0"># Test whether empty input returns an empty output. Ticket 1014</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">5</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">9</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">9</span><span class="s2">,</span><span class="s3">12</span><span class="s2">,</span><span class="s3">21</span><span class="s1">]</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(spl([])</span><span class="s2">, </span><span class="s1">array([]))</span>

    <span class="s2">def </span><span class="s1">test_roots(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">9</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">]</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(spl.roots()[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s3">1.050290639101332</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_roots_length(self): </span><span class="s0"># for gh18335</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">50 </span><span class="s1">* np.pi</span><span class="s2">, </span><span class="s3">1000</span><span class="s1">)</span>
        <span class="s1">y = np.cos(x)</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(len(spl.roots())</span><span class="s2">, </span><span class="s3">50</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_derivatives(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">9</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">]</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(spl.derivatives(</span><span class="s3">3.5</span><span class="s1">)</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">5.5152902</span><span class="s2">, </span><span class="s3">1.7146577</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.1830357</span><span class="s2">, </span><span class="s3">0.3125</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_derivatives_2(self):</span>
        <span class="s1">x = np.arange(</span><span class="s3">8</span><span class="s1">)</span>
        <span class="s1">y = x**</span><span class="s3">3 </span><span class="s1">+ </span><span class="s3">2.</span><span class="s1">*x**</span><span class="s3">2</span>

        <span class="s1">tck = splrep(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">ders = spalde(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">tck)</span>
        <span class="s1">assert_allclose(ders</span><span class="s2">, </span><span class="s1">[</span><span class="s3">45.</span><span class="s2">,   </span><span class="s0"># 3**3 + 2*(3)**2</span>
                               <span class="s3">39.</span><span class="s2">,   </span><span class="s0"># 3*(3)**2 + 4*(3)</span>
                               <span class="s3">22.</span><span class="s2">,   </span><span class="s0"># 6*(3) + 4</span>
                               <span class="s3">6.</span><span class="s1">]</span><span class="s2">,   </span><span class="s0"># 6*3**0</span>
                        <span class="s1">atol=</span><span class="s3">1e-15</span><span class="s1">)</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_allclose(spl.derivatives(</span><span class="s3">3</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">ders</span><span class="s2">,</span>
                        <span class="s1">atol=</span><span class="s3">1e-15</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_resize_regression(self):</span>
        <span class="s4">&quot;&quot;&quot;Regression test for #1375.&quot;&quot;&quot;</span>
        <span class="s1">x = [-</span><span class="s3">1.</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.65016502</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.58856235</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.26903553</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.17370892</span><span class="s2">,</span>
             <span class="s1">-</span><span class="s3">0.10011001</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.10011001</span><span class="s2">, </span><span class="s3">0.17370892</span><span class="s2">, </span><span class="s3">0.26903553</span><span class="s2">, </span><span class="s3">0.58856235</span><span class="s2">,</span>
             <span class="s3">0.65016502</span><span class="s2">, </span><span class="s3">1.</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1.</span><span class="s2">,</span><span class="s3">0.62928599</span><span class="s2">, </span><span class="s3">0.5797223</span><span class="s2">, </span><span class="s3">0.39965815</span><span class="s2">, </span><span class="s3">0.36322694</span><span class="s2">, </span><span class="s3">0.3508061</span><span class="s2">,</span>
             <span class="s3">0.35214793</span><span class="s2">, </span><span class="s3">0.3508061</span><span class="s2">, </span><span class="s3">0.36322694</span><span class="s2">, </span><span class="s3">0.39965815</span><span class="s2">, </span><span class="s3">0.5797223</span><span class="s2">,</span>
             <span class="s3">0.62928599</span><span class="s2">, </span><span class="s3">1.</span><span class="s1">]</span>
        <span class="s1">w = [</span><span class="s3">1.00000000e+12</span><span class="s2">, </span><span class="s3">6.88875973e+02</span><span class="s2">, </span><span class="s3">4.89314737e+02</span><span class="s2">, </span><span class="s3">4.26864807e+02</span><span class="s2">,</span>
             <span class="s3">6.07746770e+02</span><span class="s2">, </span><span class="s3">4.51341444e+02</span><span class="s2">, </span><span class="s3">3.17480210e+02</span><span class="s2">, </span><span class="s3">4.51341444e+02</span><span class="s2">,</span>
             <span class="s3">6.07746770e+02</span><span class="s2">, </span><span class="s3">4.26864807e+02</span><span class="s2">, </span><span class="s3">4.89314737e+02</span><span class="s2">, </span><span class="s3">6.88875973e+02</span><span class="s2">,</span>
             <span class="s3">1.00000000e+12</span><span class="s1">]</span>
        <span class="s1">spl = UnivariateSpline(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">s=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">desired = array([</span><span class="s3">0.35100374</span><span class="s2">, </span><span class="s3">0.51715855</span><span class="s2">, </span><span class="s3">0.87789547</span><span class="s2">, </span><span class="s3">0.98719344</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spl([</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.9</span><span class="s2">, </span><span class="s3">0.99</span><span class="s1">])</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">5e-4</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_out_of_range_regression(self):</span>
        <span class="s0"># Test different extrapolation modes. See ticket 3557</span>
        <span class="s1">x = np.arange(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">y = x**</span><span class="s3">3</span>

        <span class="s1">xp = linspace(-</span><span class="s3">8</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">xp_zeros = xp.copy()</span>
        <span class="s1">xp_zeros[np.logical_or(xp_zeros &lt; </span><span class="s3">0.</span><span class="s2">, </span><span class="s1">xp_zeros &gt; </span><span class="s3">4.</span><span class="s1">)] = </span><span class="s3">0</span>
        <span class="s1">xp_clip = xp.copy()</span>
        <span class="s1">xp_clip[xp_clip &lt; x[</span><span class="s3">0</span><span class="s1">]] = x[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">xp_clip[xp_clip &gt; x[-</span><span class="s3">1</span><span class="s1">]] = x[-</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s2">for </span><span class="s1">cls </span><span class="s2">in </span><span class="s1">[UnivariateSpline</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline]:</span>
            <span class="s1">spl = cls(x=x</span><span class="s2">, </span><span class="s1">y=y)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s5">'extrapolate'</span><span class="s1">]:</span>
                <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=ext)</span><span class="s2">, </span><span class="s1">xp**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
                <span class="s1">assert_allclose(cls(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ext=ext)(xp)</span><span class="s2">, </span><span class="s1">xp**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s5">'zeros'</span><span class="s1">]:</span>
                <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=ext)</span><span class="s2">, </span><span class="s1">xp_zeros**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
                <span class="s1">assert_allclose(cls(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ext=ext)(xp)</span><span class="s2">, </span><span class="s1">xp_zeros**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s5">'raise'</span><span class="s1">]:</span>
                <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">spl</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">**dict(ext=ext))</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s5">'const'</span><span class="s1">]:</span>
                <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=ext)</span><span class="s2">, </span><span class="s1">xp_clip**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
                <span class="s1">assert_allclose(cls(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">ext=ext)(xp)</span><span class="s2">, </span><span class="s1">xp_clip**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>

        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">t = spl.get_knots()[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">spl = LSQUnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">t)</span>
        <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">xp**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
        <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">xp_zeros**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">spl</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">**dict(ext=</span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">assert_allclose(spl(xp</span><span class="s2">, </span><span class="s1">ext=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">xp_clip**</span><span class="s3">3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-16</span><span class="s1">)</span>

        <span class="s0"># also make sure that unknown values for `ext` are caught early</span>
        <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s5">'unknown'</span><span class="s1">]:</span>
            <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">spl</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">**dict(ext=ext))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">UnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">ext=ext))</span>

    <span class="s2">def </span><span class="s1">test_lsq_fpchec(self):</span>
        <span class="s1">xs = np.arange(</span><span class="s3">100</span><span class="s1">) * </span><span class="s3">1.</span>
        <span class="s1">ys = np.arange(</span><span class="s3">100</span><span class="s1">) * </span><span class="s3">1.</span>
        <span class="s1">knots = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">99</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">bbox = (-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">101</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">LSQUnivariateSpline</span><span class="s2">, </span><span class="s1">xs</span><span class="s2">, </span><span class="s1">ys</span><span class="s2">, </span><span class="s1">knots</span><span class="s2">,</span>
                      <span class="s1">bbox=bbox)</span>

    <span class="s2">def </span><span class="s1">test_derivative_and_antiderivative(self):</span>
        <span class="s0"># Thin wrappers to splder/splantider, so light smoke test only.</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">70</span><span class="s1">)**</span><span class="s3">3</span>
        <span class="s1">y = np.cos(x)</span>

        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">spl2 = spl.antiderivative(</span><span class="s3">2</span><span class="s1">).derivative(</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_allclose(spl(</span><span class="s3">0.3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">0.3</span><span class="s1">))</span>

        <span class="s1">spl2 = spl.antiderivative(</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_allclose(spl2(</span><span class="s3">0.6</span><span class="s1">) - spl2(</span><span class="s3">0.2</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">spl.integral(</span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">0.6</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_derivative_extrapolation(self):</span>
        <span class="s0"># Regression test for gh-10195: for a const-extrapolation spline</span>
        <span class="s0"># its derivative evaluates to zero for extrapolation</span>
        <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
        <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">f = UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">ext=</span><span class="s5">'const'</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">x = [-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">9.5</span><span class="s2">, </span><span class="s3">10</span><span class="s1">]</span>
        <span class="s1">assert_allclose(f.derivative()(x)</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-15</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_integral_out_of_bounds(self):</span>
        <span class="s0"># Regression test for gh-7906: .integral(a, b) is wrong if both</span>
        <span class="s0"># a and b are out-of-bounds</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">):</span>
            <span class="s1">f = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">ext=ext)</span>
            <span class="s2">for </span><span class="s1">(a</span><span class="s2">, </span><span class="s1">b) </span><span class="s2">in </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)]:</span>
                <span class="s1">assert_allclose(f.integral(a</span><span class="s2">, </span><span class="s1">b)</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-15</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_nan(self):</span>
        <span class="s0"># bail out early if the input data contains nans</span>
        <span class="s1">x = np.arange(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">y = x**</span><span class="s3">3</span>
        <span class="s1">w = np.ones_like(x)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl = UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">t = spl.get_knots()[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">y_end = y[-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s2">for </span><span class="s1">z </span><span class="s2">in </span><span class="s1">[np.nan</span><span class="s2">, </span><span class="s1">np.inf</span><span class="s2">, </span><span class="s1">-np.inf]:</span>
            <span class="s1">y[-</span><span class="s3">1</span><span class="s1">] = z</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">UnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">LSQUnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">t=t</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">y[-</span><span class="s3">1</span><span class="s1">] = y_end  </span><span class="s0"># check valid y but invalid w</span>
            <span class="s1">w[-</span><span class="s3">1</span><span class="s1">] = z</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">UnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">LSQUnivariateSpline</span><span class="s2">,</span>
                    <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">t=t</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_strictly_increasing_x(self):</span>
        <span class="s0"># Test the x is required to be strictly increasing for</span>
        <span class="s0"># UnivariateSpline if s=0 and for InterpolatedUnivariateSpline,</span>
        <span class="s0"># but merely increasing for UnivariateSpline if s&gt;0</span>
        <span class="s0"># and for LSQUnivariateSpline; see gh-8535</span>
        <span class="s1">xx = np.arange(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">yy = xx**</span><span class="s3">3</span>
        <span class="s1">x = np.arange(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">x[</span><span class="s3">1</span><span class="s1">] = x[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">y = x**</span><span class="s3">3</span>
        <span class="s1">w = np.ones_like(x)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl = UnivariateSpline(xx</span><span class="s2">, </span><span class="s1">yy</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">t = spl.get_knots()[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">UnivariateSpline(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">LSQUnivariateSpline(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">t=t</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">UnivariateSpline</span><span class="s2">,</span>
                <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s2">,</span>
                <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_increasing_x(self):</span>
        <span class="s0"># Test that x is required to be increasing, see gh-8535</span>
        <span class="s1">xx = np.arange(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">yy = xx**</span><span class="s3">3</span>
        <span class="s1">x = np.arange(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">x[</span><span class="s3">1</span><span class="s1">] = x[</span><span class="s3">0</span><span class="s1">] - </span><span class="s3">1.0</span>
        <span class="s1">y = x**</span><span class="s3">3</span>
        <span class="s1">w = np.ones_like(x)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl = UnivariateSpline(xx</span><span class="s2">, </span><span class="s1">yy</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">t = spl.get_knots()[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">UnivariateSpline</span><span class="s2">,</span>
                <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s2">,</span>
                <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">LSQUnivariateSpline</span><span class="s2">,</span>
                <span class="s1">**dict(x=x</span><span class="s2">, </span><span class="s1">y=y</span><span class="s2">, </span><span class="s1">t=t</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_univariate_spline(self):</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s1">]</span>
            <span class="s1">UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.8</span><span class="s1">]</span>
            <span class="s1">w_values = [-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">]</span>
            <span class="s1">UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">w=w_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (-</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_interpolated_univariate_spline(self):</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s1">]</span>
            <span class="s1">InterpolatedUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.8</span><span class="s1">]</span>
            <span class="s1">w_values = [-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">]</span>
            <span class="s1">InterpolatedUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">w=w_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (-</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">InterpolatedUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">InterpolatedUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_lsq_univariate_spline(self):</span>

        <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
        <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.8</span><span class="s1">]</span>
        <span class="s1">spl = UnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">check_finite=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">t_values = spl.get_knots()[</span><span class="s3">3</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]  </span><span class="s0"># interior knots w/ default k=3</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s1">]</span>
            <span class="s1">LSQUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">t_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x_values = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">]</span>
            <span class="s1">y_values = [</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.8</span><span class="s1">]</span>
            <span class="s1">w_values = [</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">]</span>
            <span class="s1">LSQUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">t_values</span><span class="s2">, </span><span class="s1">w=w_values)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (</span><span class="s3">100</span><span class="s2">, </span><span class="s1">-</span><span class="s3">100</span><span class="s1">)</span>
            <span class="s1">LSQUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">t_values</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;Interior knots t must satisfy Schoenberg-Whitney conditions&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (-</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">LSQUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">t_values</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">LSQUnivariateSpline(x_values</span><span class="s2">, </span><span class="s1">y_values</span><span class="s2">, </span><span class="s1">t_values</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">x_values = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">8.5</span><span class="s1">])</span>
        <span class="s1">y_values = np.array([</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">1.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">2.8</span><span class="s1">])</span>
        <span class="s1">w_values = np.array([</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">])</span>
        <span class="s1">bbox = np.array([-</span><span class="s3">100</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 = UnivariateSpline(x=x_values</span><span class="s2">, </span><span class="s1">y=y_values</span><span class="s2">, </span><span class="s1">w=w_values</span><span class="s2">,</span>
                                <span class="s1">bbox=bbox)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 = UnivariateSpline(x=x_values.tolist()</span><span class="s2">, </span><span class="s1">y=y_values.tolist()</span><span class="s2">,</span>
                                <span class="s1">w=w_values.tolist()</span><span class="s2">, </span><span class="s1">bbox=bbox.tolist())</span>

        <span class="s1">assert_allclose(spl1([</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.9</span><span class="s2">, </span><span class="s3">0.99</span><span class="s1">])</span><span class="s2">,</span>
                        <span class="s1">spl2([</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.9</span><span class="s2">, </span><span class="s3">0.99</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_fpknot_oob_crash(self):</span>
        <span class="s0"># https://github.com/scipy/scipy/issues/3691</span>
        <span class="s1">x = range(</span><span class="s3">109</span><span class="s1">)</span>
        <span class="s1">y = [</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.9</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">11.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.9</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">10.9</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">11.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.9</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.5</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">11.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">10.9</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.6</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.5</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.5</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">11.5</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.9</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.8</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.6</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.4</span><span class="s2">,</span>
             <span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.6</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.5</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">,</span>
             <span class="s3">10.7</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.4</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">10.8</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(</span>
                <span class="s1">UserWarning</span><span class="s2">,</span>
                <span class="s5">r&quot;&quot;&quot; 
The maximal number of iterations maxit \(set to 20 by the program\) 
allowed for finding a smoothing spline with fp=s has been reached: s 
too small. 
There is an approximation returned but the corresponding weighted sum 
of squared residuals does not satisfy the condition abs\(fp-s\)/s &lt; tol.&quot;&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">UnivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestLSQBivariateSpline:</span>
    <span class="s0"># NOTE: The systems in this test class are rank-deficient</span>
    <span class="s2">def </span><span class="s1">test_linear_constant(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = [</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s1">ty = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">lut = LSQBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z</span><span class="s2">,</span><span class="s1">tx</span><span class="s2">,</span><span class="s1">ty</span><span class="s2">,</span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(lut(</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s3">3.</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_bilinearity(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = [</span><span class="s3">0</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">8</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s1">ty = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s0"># This seems to fail (ier=1, see ticket 1642).</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">lut = LSQBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z</span><span class="s2">,</span><span class="s1">tx</span><span class="s2">,</span><span class="s1">ty</span><span class="s2">,</span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">tx</span><span class="s2">, </span><span class="s1">ty = lut.get_knots()</span>
        <span class="s2">for </span><span class="s1">xa</span><span class="s2">, </span><span class="s1">xb </span><span class="s2">in </span><span class="s1">zip(tx[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">tx[</span><span class="s3">1</span><span class="s1">:]):</span>
            <span class="s2">for </span><span class="s1">ya</span><span class="s2">, </span><span class="s1">yb </span><span class="s2">in </span><span class="s1">zip(ty[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[</span><span class="s3">1</span><span class="s1">:]):</span>
                <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">[</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.9</span><span class="s1">]:</span>
                    <span class="s2">for </span><span class="s1">s </span><span class="s2">in </span><span class="s1">[</span><span class="s3">0.3</span><span class="s2">, </span><span class="s3">0.4</span><span class="s2">, </span><span class="s3">0.7</span><span class="s1">]:</span>
                        <span class="s1">xp = xa*(</span><span class="s3">1</span><span class="s1">-t) + xb*t</span>
                        <span class="s1">yp = ya*(</span><span class="s3">1</span><span class="s1">-s) + yb*s</span>
                        <span class="s1">zp = (+ lut(xa</span><span class="s2">, </span><span class="s1">ya)*(</span><span class="s3">1</span><span class="s1">-t)*(</span><span class="s3">1</span><span class="s1">-s)</span>
                              <span class="s1">+ lut(xb</span><span class="s2">, </span><span class="s1">ya)*t*(</span><span class="s3">1</span><span class="s1">-s)</span>
                              <span class="s1">+ lut(xa</span><span class="s2">, </span><span class="s1">yb)*(</span><span class="s3">1</span><span class="s1">-t)*s</span>
                              <span class="s1">+ lut(xb</span><span class="s2">, </span><span class="s1">yb)*t*s)</span>
                        <span class="s1">assert_almost_equal(lut(xp</span><span class="s2">,</span><span class="s1">yp)</span><span class="s2">, </span><span class="s1">zp)</span>

    <span class="s2">def </span><span class="s1">test_integral(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">8</span><span class="s2">,</span><span class="s3">8</span><span class="s2">,</span><span class="s3">8</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = array([</span><span class="s3">0</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">8</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s1">])</span>

        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s1">ty = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">lut = LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">tx</span><span class="s2">, </span><span class="s1">ty = lut.get_knots()</span>
        <span class="s1">tz = lut(tx</span><span class="s2">, </span><span class="s1">ty)</span>
        <span class="s1">trpz = </span><span class="s3">.25</span><span class="s1">*(diff(tx)[:</span><span class="s2">,None</span><span class="s1">]*diff(ty)[</span><span class="s2">None,</span><span class="s1">:]</span>
                    <span class="s1">* (tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:])).sum()</span>

        <span class="s1">assert_almost_equal(lut.integral(tx[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">tx[-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[-</span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
                            <span class="s1">trpz)</span>

    <span class="s2">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s0"># Test whether empty inputs returns an empty output. Ticket 1014</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = [</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s1">ty = [</span><span class="s3">1</span><span class="s1">+s</span><span class="s2">,</span><span class="s3">3</span><span class="s1">-s]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">lut = LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(lut([]</span><span class="s2">, </span><span class="s1">[])</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_array_equal(lut([]</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>
        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = [</span><span class="s3">1 </span><span class="s1">+ s</span><span class="s2">, </span><span class="s3">3 </span><span class="s1">- s]</span>
        <span class="s1">ty = [</span><span class="s3">1 </span><span class="s1">+ s</span><span class="s2">, </span><span class="s3">3 </span><span class="s1">- s]</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">y = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">z = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">, </span><span class="s1">num=</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, and z should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">y = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">z = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">w = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">, </span><span class="s1">num=</span><span class="s3">20</span><span class="s1">)</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">w=w)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, z, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">w = np.linspace(-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">w=w)</span>
        <span class="s2">assert </span><span class="s5">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (-</span><span class="s3">100</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">-</span><span class="s3">100</span><span class="s1">)</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;The length of x, y and z should be at least (kx+1) * (ky+1)&quot; </span><span class="s2">in </span><span class="s1">\</span>
               <span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">s = </span><span class="s3">0.1</span>
        <span class="s1">tx = np.array([</span><span class="s3">1 </span><span class="s1">+ s</span><span class="s2">, </span><span class="s3">3 </span><span class="s1">- s])</span>
        <span class="s1">ty = np.array([</span><span class="s3">1 </span><span class="s1">+ s</span><span class="s2">, </span><span class="s3">3 </span><span class="s1">- s])</span>
        <span class="s1">x = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
        <span class="s1">y = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
        <span class="s1">z = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
        <span class="s1">w = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
        <span class="s1">bbox = np.array([</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">])</span>

        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s0"># np.array input</span>
            <span class="s1">spl1 = LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
            <span class="s0"># list input</span>
            <span class="s1">spl2 = LSQBivariateSpline(x.tolist()</span><span class="s2">, </span><span class="s1">y.tolist()</span><span class="s2">, </span><span class="s1">z.tolist()</span><span class="s2">,</span>
                                      <span class="s1">tx.tolist()</span><span class="s2">, </span><span class="s1">ty.tolist()</span><span class="s2">, </span><span class="s1">w=w.tolist()</span><span class="s2">,</span>
                                      <span class="s1">bbox=bbox)</span>
            <span class="s1">assert_allclose(spl1(</span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">2.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">2.0</span><span class="s1">))</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_unequal_length_of_knots(self):</span>
        <span class="s4">&quot;&quot;&quot;Test for the case when the input knot-location arrays in x and y are 
        of different lengths. 
        &quot;&quot;&quot;</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y = np.mgrid[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">100</span><span class="s2">, </span><span class="s3">0</span><span class="s1">:</span><span class="s3">100</span><span class="s1">]</span>
        <span class="s1">x = x.ravel()</span>
        <span class="s1">y = y.ravel()</span>
        <span class="s1">z = </span><span class="s3">3.0 </span><span class="s1">* np.ones_like(x)</span>
        <span class="s1">tx = np.linspace(</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">98.0</span><span class="s2">, </span><span class="s3">29</span><span class="s1">)</span>
        <span class="s1">ty = np.linspace(</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">98.0</span><span class="s2">, </span><span class="s3">33</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">r = sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">lut = LSQBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z</span><span class="s2">,</span><span class="s1">tx</span><span class="s2">,</span><span class="s1">ty)</span>
            <span class="s1">assert_equal(len(r)</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">z)</span>


<span class="s2">class </span><span class="s1">TestSmoothBivariateSpline:</span>
    <span class="s2">def </span><span class="s1">test_linear_constant(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = [</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">lut = SmoothBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z</span><span class="s2">,</span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut.get_knots()</span><span class="s2">,</span><span class="s1">([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]))</span>
        <span class="s1">assert_array_almost_equal(lut.get_coeffs()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(lut.get_residual()</span><span class="s2">,</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s1">])</span><span class="s2">,</span><span class="s1">[[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_linear_1d(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = [</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">lut = SmoothBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z</span><span class="s2">,</span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut.get_knots()</span><span class="s2">,</span><span class="s1">([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]))</span>
        <span class="s1">assert_array_almost_equal(lut.get_coeffs()</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(lut.get_residual()</span><span class="s2">,</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(lut([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1.5</span><span class="s1">])</span><span class="s2">,</span><span class="s1">[[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_integral(self):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">z = array([</span><span class="s3">0</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">8</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">7</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s1">])</span>

        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s0"># This seems to fail (ier=1, see ticket 1642).</span>
            <span class="s1">sup.filter(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The required storage space&quot;</span><span class="s1">)</span>
            <span class="s1">lut = SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">tx = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">ty = [</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">]</span>

        <span class="s1">tz = lut(tx</span><span class="s2">, </span><span class="s1">ty)</span>
        <span class="s1">trpz = </span><span class="s3">.25</span><span class="s1">*(diff(tx)[:</span><span class="s2">,None</span><span class="s1">]*diff(ty)[</span><span class="s2">None,</span><span class="s1">:]</span>
                    <span class="s1">* (tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:])).sum()</span>
        <span class="s1">assert_almost_equal(lut.integral(tx[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">tx[-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[-</span><span class="s3">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">trpz)</span>

        <span class="s1">lut2 = SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(lut2.integral(tx[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">tx[-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[-</span><span class="s3">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">trpz</span><span class="s2">,</span>
                            <span class="s1">decimal=</span><span class="s3">0</span><span class="s1">)  </span><span class="s0"># the quadratures give 23.75 and 23.85</span>

        <span class="s1">tz = lut(tx[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[:-</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">trpz = </span><span class="s3">.25</span><span class="s1">*(diff(tx[:-</span><span class="s3">1</span><span class="s1">])[:</span><span class="s2">,None</span><span class="s1">]*diff(ty[:-</span><span class="s3">1</span><span class="s1">])[</span><span class="s2">None,</span><span class="s1">:]</span>
                    <span class="s1">* (tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]+tz[:-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:]+tz[</span><span class="s3">1</span><span class="s1">:</span><span class="s2">,</span><span class="s3">1</span><span class="s1">:])).sum()</span>
        <span class="s1">assert_almost_equal(lut.integral(tx[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">tx[-</span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ty[-</span><span class="s3">2</span><span class="s1">])</span><span class="s2">, </span><span class="s1">trpz)</span>

    <span class="s2">def </span><span class="s1">test_rerun_lwrk2_too_small(self):</span>
        <span class="s0"># in this setting, lwrk2 is too small in the default run. Here we</span>
        <span class="s0"># check for equality with the bisplrep/bisplev output because there,</span>
        <span class="s0"># an automatic re-run of the spline representation is done if ier&gt;10.</span>
        <span class="s1">x = np.linspace(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">80</span><span class="s1">)</span>
        <span class="s1">y = np.linspace(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">80</span><span class="s1">)</span>
        <span class="s1">z = x + y</span>
        <span class="s1">xi = np.linspace(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">yi = np.linspace(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">tck = bisplrep(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s1">res1 = bisplev(xi</span><span class="s2">, </span><span class="s1">yi</span><span class="s2">, </span><span class="s1">tck)</span>
        <span class="s1">interp_ = SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s1">res2 = interp_(xi</span><span class="s2">, </span><span class="s1">yi)</span>
        <span class="s1">assert_almost_equal(res1</span><span class="s2">, </span><span class="s1">res2)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">y = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">z = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">, </span><span class="s1">num=</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, and z should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">y = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">z = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">w = np.linspace(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">, </span><span class="s1">num=</span><span class="s3">20</span><span class="s1">)</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">w=w)</span>
        <span class="s2">assert </span><span class="s5">&quot;x, y, z, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">w = np.linspace(-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">10.0</span><span class="s1">)</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">w=w)</span>
        <span class="s2">assert </span><span class="s5">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">bbox = (-</span><span class="s3">100</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">-</span><span class="s3">100</span><span class="s1">)</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;The length of x, y and z should be at least (kx+1) * (ky+1)&quot; </span><span class="s2">in</span><span class="s1">\</span>
               <span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">x = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">z = np.array([</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">w = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">bbox = np.array([</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">3.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">3.0</span><span class="s1">])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 = SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">bbox=bbox</span><span class="s2">, </span><span class="s1">kx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 = SmoothBivariateSpline(x.tolist()</span><span class="s2">, </span><span class="s1">y.tolist()</span><span class="s2">, </span><span class="s1">z.tolist()</span><span class="s2">,</span>
                                     <span class="s1">bbox=bbox.tolist()</span><span class="s2">, </span><span class="s1">w=w.tolist()</span><span class="s2">,</span>
                                     <span class="s1">kx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ky=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_allclose(spl1(</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">))</span>


<span class="s2">class </span><span class="s1">TestLSQSphereBivariateSpline:</span>
    <span class="s2">def </span><span class="s1">setup_method(self):</span>
        <span class="s0"># define the input data and coordinates</span>
        <span class="s1">ntheta</span><span class="s2">, </span><span class="s1">nphi = </span><span class="s3">70</span><span class="s2">, </span><span class="s3">90</span>
        <span class="s1">theta = linspace(</span><span class="s3">0.5</span><span class="s1">/(ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5</span><span class="s1">/(ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ntheta) * pi</span>
        <span class="s1">phi = linspace(</span><span class="s3">0.5</span><span class="s1">/(nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5</span><span class="s1">/(nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nphi) * </span><span class="s3">2. </span><span class="s1">* pi</span>
        <span class="s1">data = ones((theta.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">phi.shape[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst = theta[::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">knotsp = phi[::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">knotdata = data[::</span><span class="s3">5</span><span class="s2">, </span><span class="s1">::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s0"># calculate spline coefficients</span>
        <span class="s1">lats</span><span class="s2">, </span><span class="s1">lons = meshgrid(theta</span><span class="s2">, </span><span class="s1">phi)</span>
        <span class="s1">lut_lsq = LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                           <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s1">self.lut_lsq = lut_lsq</span>
        <span class="s1">self.data = knotdata</span>
        <span class="s1">self.new_lons</span><span class="s2">, </span><span class="s1">self.new_lats = knotsp</span><span class="s2">, </span><span class="s1">knotst</span>

    <span class="s2">def </span><span class="s1">test_linear_constant(self):</span>
        <span class="s1">assert_almost_equal(self.lut_lsq.get_residual()</span><span class="s2">, </span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(self.lut_lsq(self.new_lats</span><span class="s2">, </span><span class="s1">self.new_lons)</span><span class="s2">,</span>
                                  <span class="s1">self.data)</span>

    <span class="s2">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s1">assert_array_almost_equal(self.lut_lsq([]</span><span class="s2">, </span><span class="s1">[])</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_array_almost_equal(self.lut_lsq([]</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>
        <span class="s1">ntheta</span><span class="s2">, </span><span class="s1">nphi = </span><span class="s3">70</span><span class="s2">, </span><span class="s3">90</span>
        <span class="s1">theta = linspace(</span><span class="s3">0.5 </span><span class="s1">/ (ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5 </span><span class="s1">/ (ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s1">ntheta) * pi</span>
        <span class="s1">phi = linspace(</span><span class="s3">0.5 </span><span class="s1">/ (nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5 </span><span class="s1">/ (nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nphi) * </span><span class="s3">2. </span><span class="s1">* pi</span>
        <span class="s1">data = ones((theta.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">phi.shape[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst = theta[::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">knotsp = phi[::</span><span class="s3">5</span><span class="s1">]</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_theta = linspace(-</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">num=ntheta) * pi</span>
            <span class="s1">invalid_lats</span><span class="s2">, </span><span class="s1">lons = meshgrid(invalid_theta</span><span class="s2">, </span><span class="s1">phi)</span>
            <span class="s1">LSQSphereBivariateSpline(invalid_lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_theta = linspace(</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">1.1</span><span class="s2">, </span><span class="s1">num=ntheta) * pi</span>
            <span class="s1">invalid_lats</span><span class="s2">, </span><span class="s1">lons = meshgrid(invalid_theta</span><span class="s2">, </span><span class="s1">phi)</span>
            <span class="s1">LSQSphereBivariateSpline(invalid_lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_phi = linspace(-</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">num=ntheta) * </span><span class="s3">2.0 </span><span class="s1">* pi</span>
            <span class="s1">lats</span><span class="s2">, </span><span class="s1">invalid_lons = meshgrid(theta</span><span class="s2">, </span><span class="s1">invalid_phi)</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">invalid_lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_phi = linspace(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.1</span><span class="s2">, </span><span class="s1">num=ntheta) * </span><span class="s3">2.0 </span><span class="s1">* pi</span>
            <span class="s1">lats</span><span class="s2">, </span><span class="s1">invalid_lons = meshgrid(theta</span><span class="s2">, </span><span class="s1">invalid_phi)</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">invalid_lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s1">lats</span><span class="s2">, </span><span class="s1">lons = meshgrid(theta</span><span class="s2">, </span><span class="s1">phi)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_knotst = np.copy(knotst)</span>
            <span class="s1">invalid_knotst[</span><span class="s3">0</span><span class="s1">] = -</span><span class="s3">0.1</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">invalid_knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;tt should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_knotst = np.copy(knotst)</span>
            <span class="s1">invalid_knotst[</span><span class="s3">0</span><span class="s1">] = pi</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">invalid_knotst</span><span class="s2">, </span><span class="s1">knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;tt should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_knotsp = np.copy(knotsp)</span>
            <span class="s1">invalid_knotsp[</span><span class="s3">0</span><span class="s1">] = -</span><span class="s3">0.1</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">invalid_knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;tp should be between (0, 2pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_knotsp = np.copy(knotsp)</span>
            <span class="s1">invalid_knotsp[</span><span class="s3">0</span><span class="s1">] = </span><span class="s3">2 </span><span class="s1">* pi</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                     <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">invalid_knotsp)</span>
        <span class="s2">assert </span><span class="s5">&quot;tp should be between (0, 2pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_w = array([-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">])</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">, </span><span class="s1">data.T.ravel()</span><span class="s2">,</span>
                                     <span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp</span><span class="s2">, </span><span class="s1">w=invalid_w)</span>
        <span class="s2">assert </span><span class="s5">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">, </span><span class="s1">data.T.ravel()</span><span class="s2">,</span>
                                     <span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">, </span><span class="s1">data.T.ravel()</span><span class="s2">,</span>
                                     <span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">ntheta</span><span class="s2">, </span><span class="s1">nphi = </span><span class="s3">70</span><span class="s2">, </span><span class="s3">90</span>
        <span class="s1">theta = linspace(</span><span class="s3">0.5 </span><span class="s1">/ (ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5 </span><span class="s1">/ (ntheta - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s1">ntheta) * pi</span>
        <span class="s1">phi = linspace(</span><span class="s3">0.5 </span><span class="s1">/ (nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.5 </span><span class="s1">/ (nphi - </span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                       <span class="s1">nphi) * </span><span class="s3">2. </span><span class="s1">* pi</span>
        <span class="s1">lats</span><span class="s2">, </span><span class="s1">lons = meshgrid(theta</span><span class="s2">, </span><span class="s1">phi)</span>
        <span class="s1">data = ones((theta.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">phi.shape[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst = theta[::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">knotsp = phi[::</span><span class="s3">5</span><span class="s1">]</span>
        <span class="s1">w = ones(lats.ravel().shape[</span><span class="s3">0</span><span class="s1">])</span>

        <span class="s0"># np.array input</span>
        <span class="s1">spl1 = LSQSphereBivariateSpline(lats.ravel()</span><span class="s2">, </span><span class="s1">lons.ravel()</span><span class="s2">,</span>
                                        <span class="s1">data.T.ravel()</span><span class="s2">, </span><span class="s1">knotst</span><span class="s2">, </span><span class="s1">knotsp</span><span class="s2">, </span><span class="s1">w=w)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 = LSQSphereBivariateSpline(lats.ravel().tolist()</span><span class="s2">,</span>
                                        <span class="s1">lons.ravel().tolist()</span><span class="s2">,</span>
                                        <span class="s1">data.T.ravel().tolist()</span><span class="s2">,</span>
                                        <span class="s1">knotst.tolist()</span><span class="s2">,</span>
                                        <span class="s1">knotsp.tolist()</span><span class="s2">, </span><span class="s1">w=w.tolist())</span>
        <span class="s1">assert_array_almost_equal(spl1(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">))</span>


<span class="s2">class </span><span class="s1">TestSmoothSphereBivariateSpline:</span>
    <span class="s2">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">theta = array([</span><span class="s3">.25</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.25</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.25</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.5</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.5</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.5</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.75</span><span class="s1">*pi</span><span class="s2">,</span>
                       <span class="s3">.75</span><span class="s1">*pi</span><span class="s2">, </span><span class="s3">.75</span><span class="s1">*pi])</span>
        <span class="s1">phi = array([</span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">,</span>
                     <span class="s3">1.5 </span><span class="s1">* pi])</span>
        <span class="s1">r = array([</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">self.lut = SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_linear_constant(self):</span>
        <span class="s1">assert_almost_equal(self.lut.get_residual()</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(self.lut([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1.5</span><span class="s1">])</span><span class="s2">,</span>
                                  <span class="s1">[[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s1">assert_array_almost_equal(self.lut([]</span><span class="s2">, </span><span class="s1">[])</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_array_almost_equal(self.lut([]</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">0</span><span class="s2">,</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>
        <span class="s1">theta = array([</span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                       <span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi])</span>
        <span class="s1">phi = array([</span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">,</span>
                     <span class="s3">1.5 </span><span class="s1">* pi])</span>
        <span class="s1">r = array([</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_theta = array([-</span><span class="s3">0.1 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                                   <span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">,</span>
                                   <span class="s3">.75 </span><span class="s1">* pi])</span>
            <span class="s1">SmoothSphereBivariateSpline(invalid_theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_theta = array([</span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                                   <span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">,</span>
                                   <span class="s3">1.1 </span><span class="s1">* pi])</span>
            <span class="s1">SmoothSphereBivariateSpline(invalid_theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_phi = array([-</span><span class="s3">.1 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                                 <span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi])</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">invalid_phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_phi = array([</span><span class="s3">1.0 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                                 <span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">2.1 </span><span class="s1">* pi])</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">invalid_phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">invalid_w = array([-</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">])</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">w=invalid_w</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">eps=-</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">theta = np.array([</span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.25 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                          <span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.75 </span><span class="s1">* pi])</span>
        <span class="s1">phi = np.array([</span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi</span><span class="s2">, </span><span class="s3">.5 </span><span class="s1">* pi</span><span class="s2">,</span>
                        <span class="s1">pi</span><span class="s2">, </span><span class="s3">1.5 </span><span class="s1">* pi])</span>
        <span class="s1">r = np.array([</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">w = np.array([</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">])</span>

        <span class="s0"># np.array input</span>
        <span class="s1">spl1 = SmoothSphereBivariateSpline(theta</span><span class="s2">, </span><span class="s1">phi</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">w=w</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>

        <span class="s0"># list input</span>
        <span class="s1">spl2 = SmoothSphereBivariateSpline(theta.tolist()</span><span class="s2">, </span><span class="s1">phi.tolist()</span><span class="s2">,</span>
                                           <span class="s1">r.tolist()</span><span class="s2">, </span><span class="s1">w=w.tolist()</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">1E10</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(spl1(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">))</span>


<span class="s2">class </span><span class="s1">TestRectBivariateSpline:</span>
    <span class="s2">def </span><span class="s1">test_defaults(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y)</span><span class="s2">,</span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">test_evaluate(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>

        <span class="s1">xi = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2.3</span><span class="s2">, </span><span class="s3">5.3</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">3.3</span><span class="s2">, </span><span class="s3">1.2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">yi = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3.3</span><span class="s2">, </span><span class="s3">1.2</span><span class="s2">, </span><span class="s3">4.0</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">zi = lut.ev(xi</span><span class="s2">, </span><span class="s1">yi)</span>
        <span class="s1">zi2 = array([lut(xp</span><span class="s2">, </span><span class="s1">yp)[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">] </span><span class="s2">for </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">yp </span><span class="s2">in </span><span class="s1">zip(xi</span><span class="s2">, </span><span class="s1">yi)])</span>

        <span class="s1">assert_almost_equal(zi</span><span class="s2">, </span><span class="s1">zi2)</span>

    <span class="s2">def </span><span class="s1">test_derivatives_grid(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">dx = array([[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">20</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">13</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">11</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]])/</span><span class="s3">6.</span>
        <span class="s1">dy = array([[</span><span class="s3">4</span><span class="s2">,</span><span class="s1">-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s1">-</span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">4</span><span class="s2">,</span><span class="s1">-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s1">-</span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">1.5</span><span class="s2">,</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">2</span><span class="s2">,</span><span class="s3">.25</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">.25</span><span class="s2">,</span><span class="s1">-</span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">4</span><span class="s2">,</span><span class="s1">-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s1">-</span><span class="s3">4</span><span class="s1">]])</span>
        <span class="s1">dxdy = array([[</span><span class="s3">40</span><span class="s2">,</span><span class="s1">-</span><span class="s3">25</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">25</span><span class="s2">,</span><span class="s1">-</span><span class="s3">40</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[-</span><span class="s3">26</span><span class="s2">,</span><span class="s3">16.25</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">16.25</span><span class="s2">,</span><span class="s3">26</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[-</span><span class="s3">8</span><span class="s2">,</span><span class="s3">5</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">5</span><span class="s2">,</span><span class="s3">8</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">22</span><span class="s2">,</span><span class="s1">-</span><span class="s3">13.75</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">13.75</span><span class="s2">,</span><span class="s1">-</span><span class="s3">22</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[-</span><span class="s3">8</span><span class="s2">,</span><span class="s3">5</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">5</span><span class="s2">,</span><span class="s3">8</span><span class="s1">]])/</span><span class="s3">6.</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dx=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dx)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dy=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dy)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">dy=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dxdy)</span>

    <span class="s2">def </span><span class="s1">test_derivatives(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">dx = array([</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">2.</span><span class="s1">/</span><span class="s3">3</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">dy = array([</span><span class="s3">4</span><span class="s2">,</span><span class="s1">-</span><span class="s3">1</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s1">-</span><span class="s3">.25</span><span class="s2">,</span><span class="s1">-</span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">dxdy = array([</span><span class="s3">160</span><span class="s2">,</span><span class="s3">65</span><span class="s2">,</span><span class="s3">0</span><span class="s2">,</span><span class="s3">55</span><span class="s2">,</span><span class="s3">32</span><span class="s1">])/</span><span class="s3">24.</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dx)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dy=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dy)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">dx=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">dy=</span><span class="s3">1</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span><span class="s1">dxdy)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_method_grid(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">dx = array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">20</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">11</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]) / </span><span class="s3">6.</span>
        <span class="s1">dy = array([[</span><span class="s3">4</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">4</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">.25</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">.25</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">4</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">4</span><span class="s1">]])</span>
        <span class="s1">dxdy = array([[</span><span class="s3">40</span><span class="s2">, </span><span class="s1">-</span><span class="s3">25</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">-</span><span class="s3">40</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[-</span><span class="s3">26</span><span class="s2">, </span><span class="s3">16.25</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">16.25</span><span class="s2">, </span><span class="s3">26</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[-</span><span class="s3">8</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s3">22</span><span class="s2">, </span><span class="s1">-</span><span class="s3">13.75</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">13.75</span><span class="s2">, </span><span class="s1">-</span><span class="s3">22</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[-</span><span class="s3">8</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]]) / </span><span class="s3">6.</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">dx)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">dy)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">dxdy)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_method(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">dx = array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2.</span><span class="s1">/</span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">dy = array([</span><span class="s3">4</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">.25</span><span class="s2">, </span><span class="s1">-</span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">dxdy = array([</span><span class="s3">160</span><span class="s2">, </span><span class="s3">65</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">55</span><span class="s2">, </span><span class="s3">32</span><span class="s1">]) / </span><span class="s3">24.</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">,</span>
                                                               <span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">dx)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">,</span>
                                                               <span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">dy)</span>
        <span class="s1">assert_array_almost_equal(lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">,</span>
                                                               <span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                                  <span class="s1">dxdy)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_order_too_large(self):</span>
        <span class="s1">x = array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s1">y = x.copy()</span>
        <span class="s1">z = ones((x.size</span><span class="s2">, </span><span class="s1">y.size))</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">lut.partial_derivative(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_broadcast(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">4</span><span class="s2">,</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">lut = RectBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">lut(x[:</span><span class="s2">,None</span><span class="s1">]</span><span class="s2">, </span><span class="s1">y[</span><span class="s2">None,</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = array([</span><span class="s3">6</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">assert </span><span class="s5">&quot;x must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">y = array([</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">assert </span><span class="s5">&quot;y must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">assert </span><span class="s5">&quot;x dimension of z must have same number of elements as x&quot;</span><span class="s1">\</span>
               <span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s2">assert </span><span class="s5">&quot;y dimension of z must have same number of elements as y&quot;</span><span class="s1">\</span>
               <span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
            <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
            <span class="s1">bbox = (-</span><span class="s3">100</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">-</span><span class="s3">100</span><span class="s1">)</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s2">assert </span><span class="s5">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">info:</span>
            <span class="s1">RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str(info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">bbox = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>

        <span class="s1">spl1 = RectBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">bbox=bbox)</span>
        <span class="s1">spl2 = RectBivariateSpline(x.tolist()</span><span class="s2">, </span><span class="s1">y.tolist()</span><span class="s2">, </span><span class="s1">z.tolist()</span><span class="s2">,</span>
                                   <span class="s1">bbox=bbox.tolist())</span>
        <span class="s1">assert_array_almost_equal(spl1(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">spl2(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_not_increasing_input(self):</span>
        <span class="s0"># gh-8565</span>
        <span class="s1">NSamp = </span><span class="s3">20</span>
        <span class="s1">Theta = np.random.uniform(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.pi</span><span class="s2">, </span><span class="s1">NSamp)</span>
        <span class="s1">Phi = np.random.uniform(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2 </span><span class="s1">* np.pi</span><span class="s2">, </span><span class="s1">NSamp)</span>
        <span class="s1">Data = np.ones(NSamp)</span>

        <span class="s1">Interpolator = SmoothSphereBivariateSpline(Theta</span><span class="s2">, </span><span class="s1">Phi</span><span class="s2">, </span><span class="s1">Data</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">3.5</span><span class="s1">)</span>

        <span class="s1">NLon = </span><span class="s3">6</span>
        <span class="s1">NLat = </span><span class="s3">3</span>
        <span class="s1">GridPosLats = np.arange(NLat) / NLat * np.pi</span>
        <span class="s1">GridPosLons = np.arange(NLon) / NLon * </span><span class="s3">2 </span><span class="s1">* np.pi</span>

        <span class="s0"># No error</span>
        <span class="s1">Interpolator(GridPosLats</span><span class="s2">, </span><span class="s1">GridPosLons)</span>

        <span class="s1">nonGridPosLats = GridPosLats.copy()</span>
        <span class="s1">nonGridPosLats[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">0.001</span>
        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">Interpolator(nonGridPosLats</span><span class="s2">, </span><span class="s1">GridPosLons)</span>
        <span class="s2">assert </span><span class="s5">&quot;x must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s1">nonGridPosLons = GridPosLons.copy()</span>
        <span class="s1">nonGridPosLons[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">0.001</span>
        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">Interpolator(GridPosLats</span><span class="s2">, </span><span class="s1">nonGridPosLons)</span>
        <span class="s2">assert </span><span class="s5">&quot;y must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>


<span class="s2">class </span><span class="s1">TestRectSphereBivariateSpline:</span>
    <span class="s2">def </span><span class="s1">test_defaults(self):</span>
        <span class="s1">y = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">lut = RectSphereBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">assert_array_almost_equal(lut(x</span><span class="s2">,</span><span class="s1">y)</span><span class="s2">,</span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">test_evaluate(self):</span>
        <span class="s1">y = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">lut = RectSphereBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>
        <span class="s1">yi = [</span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2.3</span><span class="s2">, </span><span class="s3">2.35</span><span class="s2">, </span><span class="s3">3.0</span><span class="s2">, </span><span class="s3">3.99</span><span class="s2">, </span><span class="s3">5.25</span><span class="s1">]</span>
        <span class="s1">xi = [</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.4</span><span class="s2">, </span><span class="s3">1.1</span><span class="s2">, </span><span class="s3">0.45</span><span class="s2">, </span><span class="s3">0.2345</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.0001</span><span class="s1">]</span>
        <span class="s1">zi = lut.ev(xi</span><span class="s2">, </span><span class="s1">yi)</span>
        <span class="s1">zi2 = array([lut(xp</span><span class="s2">, </span><span class="s1">yp)[</span><span class="s3">0</span><span class="s2">,</span><span class="s3">0</span><span class="s1">] </span><span class="s2">for </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">yp </span><span class="s2">in </span><span class="s1">zip(xi</span><span class="s2">, </span><span class="s1">yi)])</span>
        <span class="s1">assert_almost_equal(zi</span><span class="s2">, </span><span class="s1">zi2)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input(self):</span>
        <span class="s1">data = np.dot(np.atleast_2d(</span><span class="s3">90. </span><span class="s1">- np.linspace(-</span><span class="s3">80.</span><span class="s2">, </span><span class="s3">80.</span><span class="s2">, </span><span class="s3">18</span><span class="s1">)).T</span><span class="s2">,</span>
                      <span class="s1">np.atleast_2d(</span><span class="s3">180. </span><span class="s1">- np.abs(np.linspace(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">350.</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)))).T</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">181</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(-</span><span class="s3">181</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;v[0] should be between [-pi, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(-</span><span class="s3">10</span><span class="s2">, </span><span class="s3">360</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;v[-1] should be v[0] + 2pi or less&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_derivatives_grid(self):</span>
        <span class="s1">y = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>

        <span class="s1">lut = RectSphereBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>

        <span class="s1">y = linspace(</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.02</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>

        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">_numdiff_2d(lut</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dx=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">_numdiff_2d(lut</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dy=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">_numdiff_2d(lut</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dy=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1e-6</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-3</span><span class="s1">)</span>

        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y))</span>
        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y))</span>
        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y))</span>

        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                           <span class="s1">lut.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_derivatives(self):</span>
        <span class="s1">y = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s2">,</span><span class="s3">2</span><span class="s2">,</span><span class="s3">1</span><span class="s1">]])</span>

        <span class="s1">lut = RectSphereBivariateSpline(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">z)</span>

        <span class="s1">y = linspace(</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*pi-</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.02</span><span class="s2">, </span><span class="s1">pi-</span><span class="s3">0.02</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>

        <span class="s1">assert_equal(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">).shape</span><span class="s2">, </span><span class="s1">x.shape)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">_numdiff_2d(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">,</span><span class="s1">y: lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dx=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">_numdiff_2d(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">,</span><span class="s1">y: lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dy=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(lut(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dtheta=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dphi=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">_numdiff_2d(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">,</span><span class="s1">y: lut(x</span><span class="s2">,</span><span class="s1">y</span><span class="s2">,</span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dx=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dy=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1e-6</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-3</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-3</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_2(self):</span>
        <span class="s1">data = np.dot(np.atleast_2d(</span><span class="s3">90. </span><span class="s1">- np.linspace(-</span><span class="s3">80.</span><span class="s2">, </span><span class="s3">80.</span><span class="s2">, </span><span class="s3">18</span><span class="s1">)).T</span><span class="s2">,</span>
                      <span class="s1">np.atleast_2d(</span><span class="s3">180. </span><span class="s1">- np.abs(np.linspace(</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">350.</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)))).T</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">180</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(-</span><span class="s3">181</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;v[0] should be between [-pi, pi)&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(-</span><span class="s3">10</span><span class="s2">, </span><span class="s3">360</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s2">assert </span><span class="s5">&quot;v[-1] should be v[0] + 2pi or less&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">exc_info:</span>
            <span class="s1">lats = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">170</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">lons = np.linspace(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">350</span><span class="s2">, </span><span class="s3">18</span><span class="s1">) * np.pi / </span><span class="s3">180.</span>
            <span class="s1">RectSphereBivariateSpline(lats</span><span class="s2">, </span><span class="s1">lons</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">s=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s5">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str(exc_info.value)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input(self):</span>
        <span class="s1">y = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">2 </span><span class="s1">* pi - </span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">x = linspace(</span><span class="s3">0.01</span><span class="s2">, </span><span class="s1">pi - </span><span class="s3">0.01</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span>
        <span class="s1">z = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 = RectSphereBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 = RectSphereBivariateSpline(x.tolist()</span><span class="s2">, </span><span class="s1">y.tolist()</span><span class="s2">, </span><span class="s1">z.tolist())</span>
        <span class="s1">assert_array_almost_equal(spl1(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">spl2(x</span><span class="s2">, </span><span class="s1">y))</span>

    <span class="s2">def </span><span class="s1">test_negative_evaluation(self):</span>
        <span class="s1">lats = np.array([</span><span class="s3">25</span><span class="s2">, </span><span class="s3">30</span><span class="s2">, </span><span class="s3">35</span><span class="s2">, </span><span class="s3">40</span><span class="s2">, </span><span class="s3">45</span><span class="s1">])</span>
        <span class="s1">lons = np.array([-</span><span class="s3">90</span><span class="s2">, </span><span class="s1">-</span><span class="s3">85</span><span class="s2">, </span><span class="s1">-</span><span class="s3">80</span><span class="s2">, </span><span class="s1">-</span><span class="s3">75</span><span class="s2">, </span><span class="s3">70</span><span class="s1">])</span>
        <span class="s1">mesh = np.meshgrid(lats</span><span class="s2">, </span><span class="s1">lons)</span>
        <span class="s1">data = mesh[</span><span class="s3">0</span><span class="s1">] + mesh[</span><span class="s3">1</span><span class="s1">]  </span><span class="s0"># lon + lat value</span>
        <span class="s1">lat_r = np.radians(lats)</span>
        <span class="s1">lon_r = np.radians(lons)</span>
        <span class="s1">interpolator = RectSphereBivariateSpline(lat_r</span><span class="s2">, </span><span class="s1">lon_r</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s1">query_lat = np.radians(np.array([</span><span class="s3">35</span><span class="s2">, </span><span class="s3">37.5</span><span class="s1">]))</span>
        <span class="s1">query_lon = np.radians(np.array([-</span><span class="s3">80</span><span class="s2">, </span><span class="s1">-</span><span class="s3">77.5</span><span class="s1">]))</span>
        <span class="s1">data_interp = interpolator(query_lat</span><span class="s2">, </span><span class="s1">query_lon)</span>
        <span class="s1">ans = np.array([[-</span><span class="s3">45.0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">42.480862</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[-</span><span class="s3">49.0625</span><span class="s2">, </span><span class="s1">-</span><span class="s3">46.54315</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(data_interp</span><span class="s2">, </span><span class="s1">ans)</span>

    <span class="s2">def </span><span class="s1">test_pole_continuity_gh_14591(self):</span>
        <span class="s0"># regression test for https://github.com/scipy/scipy/issues/14591</span>
        <span class="s0"># with pole_continuty=(True, True), the internal work array size</span>
        <span class="s0"># was too small, leading to a FITPACK data validation error.</span>

        <span class="s0"># The reproducer in gh-14591 was using a NetCDF4 file with</span>
        <span class="s0"># 361x507 arrays, so here we trivialize array sizes to a minimum</span>
        <span class="s0"># which still demonstrates the issue.</span>
        <span class="s1">u = np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) * np.pi / </span><span class="s3">10</span>
        <span class="s1">v = np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) * np.pi / </span><span class="s3">10</span>
        <span class="s1">r = np.zeros((</span><span class="s3">9</span><span class="s2">, </span><span class="s3">9</span><span class="s1">))</span>
        <span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">[(</span><span class="s2">True, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s2">True, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s2">False, False</span><span class="s1">)]:</span>
            <span class="s1">RectSphereBivariateSpline(u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">s=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">pole_continuity=p)</span>


<span class="s2">def </span><span class="s1">_numdiff_2d(func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dx=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">dy=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">eps=</span><span class="s3">1e-8</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">dx == </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">dy == </span><span class="s3">0</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">func(x</span><span class="s2">, </span><span class="s1">y)</span>
    <span class="s2">elif </span><span class="s1">dx == </span><span class="s3">1 </span><span class="s2">and </span><span class="s1">dy == </span><span class="s3">0</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">(func(x + eps</span><span class="s2">, </span><span class="s1">y) - func(x - eps</span><span class="s2">, </span><span class="s1">y)) / (</span><span class="s3">2</span><span class="s1">*eps)</span>
    <span class="s2">elif </span><span class="s1">dx == </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">dy == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">(func(x</span><span class="s2">, </span><span class="s1">y + eps) - func(x</span><span class="s2">, </span><span class="s1">y - eps)) / (</span><span class="s3">2</span><span class="s1">*eps)</span>
    <span class="s2">elif </span><span class="s1">dx == </span><span class="s3">1 </span><span class="s2">and </span><span class="s1">dy == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s2">return </span><span class="s1">(func(x + eps</span><span class="s2">, </span><span class="s1">y + eps) - func(x - eps</span><span class="s2">, </span><span class="s1">y + eps)</span>
                <span class="s1">- func(x + eps</span><span class="s2">, </span><span class="s1">y - eps) + func(x - eps</span><span class="s2">, </span><span class="s1">y - eps)) / (</span><span class="s3">2</span><span class="s1">*eps)**</span><span class="s3">2</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s5">&quot;invalid derivative order&quot;</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">Test_DerivedBivariateSpline:</span>
    <span class="s4">&quot;&quot;&quot;Test the creation, usage, and attribute access of the (private) 
    _DerivedBivariateSpline class. 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">setup_method(self):</span>
        <span class="s1">x = np.concatenate(list(zip(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">))))</span>
        <span class="s1">y = np.concatenate(list(zip(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">range(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))))</span>
        <span class="s1">z = np.concatenate((np.linspace(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.linspace(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)))</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.record(UserWarning</span><span class="s2">, </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">The coefficients of the spline&quot;</span><span class="s1">)</span>
            <span class="s1">self.lut_lsq = LSQBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">,</span>
                                              <span class="s1">linspace(</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">19.5</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                                              <span class="s1">linspace(</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">20.5</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                                              <span class="s1">eps=</span><span class="s3">1e-2</span><span class="s1">)</span>
        <span class="s1">self.lut_smooth = SmoothBivariateSpline(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z)</span>
        <span class="s1">xx = linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">yy = xx + </span><span class="s3">1.0</span>
        <span class="s1">zz = array([np.roll(z</span><span class="s2">, </span><span class="s1">i) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(z.size)])</span>
        <span class="s1">self.lut_rect = RectBivariateSpline(xx</span><span class="s2">, </span><span class="s1">yy</span><span class="s2">, </span><span class="s1">zz)</span>
        <span class="s1">self.orders = list(itertools.product(range(</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_creation_from_LSQ(self):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s2">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self.orders:</span>
            <span class="s1">lut_der = self.lut_lsq.partial_derivative(nux</span><span class="s2">, </span><span class="s1">nuy)</span>
            <span class="s1">a = lut_der(</span><span class="s3">3.5</span><span class="s2">, </span><span class="s3">3.5</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">b = self.lut_lsq(</span><span class="s3">3.5</span><span class="s2">, </span><span class="s3">3.5</span><span class="s2">, </span><span class="s1">dx=nux</span><span class="s2">, </span><span class="s1">dy=nuy</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">assert_equal(a</span><span class="s2">, </span><span class="s1">b)</span>

    <span class="s2">def </span><span class="s1">test_creation_from_Smooth(self):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s2">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self.orders:</span>
            <span class="s1">lut_der = self.lut_smooth.partial_derivative(nux</span><span class="s2">, </span><span class="s1">nuy)</span>
            <span class="s1">a = lut_der(</span><span class="s3">5.5</span><span class="s2">, </span><span class="s3">5.5</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">b = self.lut_smooth(</span><span class="s3">5.5</span><span class="s2">, </span><span class="s3">5.5</span><span class="s2">, </span><span class="s1">dx=nux</span><span class="s2">, </span><span class="s1">dy=nuy</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">assert_equal(a</span><span class="s2">, </span><span class="s1">b)</span>

    <span class="s2">def </span><span class="s1">test_creation_from_Rect(self):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s2">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self.orders:</span>
            <span class="s1">lut_der = self.lut_rect.partial_derivative(nux</span><span class="s2">, </span><span class="s1">nuy)</span>
            <span class="s1">a = lut_der(</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">b = self.lut_rect(</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s1">dx=nux</span><span class="s2">, </span><span class="s1">dy=nuy</span><span class="s2">, </span><span class="s1">grid=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s1">assert_equal(a</span><span class="s2">, </span><span class="s1">b)</span>

    <span class="s2">def </span><span class="s1">test_invalid_attribute_fp(self):</span>
        <span class="s1">der = self.lut_rect.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">assert_raises(AttributeError):</span>
            <span class="s1">der.fp</span>

    <span class="s2">def </span><span class="s1">test_invalid_attribute_get_residual(self):</span>
        <span class="s1">der = self.lut_smooth.partial_derivative(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">assert_raises(AttributeError):</span>
            <span class="s1">der.get_residual()</span>
</pre>
</body>
</html>
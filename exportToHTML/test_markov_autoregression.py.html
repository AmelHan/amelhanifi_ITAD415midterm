<html>
<head>
<title>test_markov_autoregression.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_markov_autoregression.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for Markov Autoregression models 
 
Author: Chad Fulton 
License: BSD-3 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">import </span><span class="s1">os</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span>
<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">statsmodels.tools </span><span class="s2">import </span><span class="s1">add_constant</span>
<span class="s2">from </span><span class="s1">statsmodels.tsa.regime_switching </span><span class="s2">import </span><span class="s1">markov_autoregression</span>

<span class="s1">current_path = os.path.dirname(os.path.abspath(__file__))</span>


<span class="s1">rgnp = [</span><span class="s3">2.59316421</span><span class="s2">, </span><span class="s3">2.20217133</span><span class="s2">, </span><span class="s3">0.45827562</span><span class="s2">, </span><span class="s3">0.9687438</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.24130757</span><span class="s2">, </span><span class="s3">0.89647478</span><span class="s2">, </span><span class="s3">2.05393219</span><span class="s2">, </span><span class="s3">1.73353648</span><span class="s2">,</span>
        <span class="s3">0.93871289</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.46477833</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.80983406</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.39763689</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.39886093</span><span class="s2">, </span><span class="s3">1.1918416</span><span class="s2">, </span><span class="s3">1.45620048</span><span class="s2">, </span><span class="s3">2.11808228</span><span class="s2">,</span>
        <span class="s3">1.08957863</span><span class="s2">, </span><span class="s3">1.32390273</span><span class="s2">, </span><span class="s3">0.87296367</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.19773273</span><span class="s2">,</span>
        <span class="s3">0.45420215</span><span class="s2">, </span><span class="s3">0.07221876</span><span class="s2">, </span><span class="s3">1.1030364</span><span class="s2">, </span><span class="s3">0.82097489</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.05795795</span><span class="s2">, </span><span class="s3">0.58447772</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.56192672</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2.05041027</span><span class="s2">,</span>
        <span class="s3">0.53637183</span><span class="s2">, </span><span class="s3">2.33676839</span><span class="s2">, </span><span class="s3">2.34014559</span><span class="s2">, </span><span class="s3">1.2339263</span><span class="s2">,</span>
        <span class="s3">1.8869648</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.45920792</span><span class="s2">, </span><span class="s3">0.84940469</span><span class="s2">, </span><span class="s3">1.70139849</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.28756312</span><span class="s2">, </span><span class="s3">0.09594627</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.86080289</span><span class="s2">, </span><span class="s3">1.03447127</span><span class="s2">,</span>
        <span class="s3">1.23685944</span><span class="s2">, </span><span class="s3">1.42004502</span><span class="s2">, </span><span class="s3">2.22410631</span><span class="s2">, </span><span class="s3">1.30210173</span><span class="s2">,</span>
        <span class="s3">1.03517699</span><span class="s2">, </span><span class="s3">0.9253425</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.16559951</span><span class="s2">, </span><span class="s3">1.3444382</span><span class="s2">,</span>
        <span class="s3">1.37500131</span><span class="s2">, </span><span class="s3">1.73222184</span><span class="s2">, </span><span class="s3">0.71605635</span><span class="s2">, </span><span class="s3">2.21032143</span><span class="s2">,</span>
        <span class="s3">0.85333031</span><span class="s2">, </span><span class="s3">1.00238776</span><span class="s2">, </span><span class="s3">0.42725441</span><span class="s2">, </span><span class="s3">2.14368343</span><span class="s2">,</span>
        <span class="s3">1.43789184</span><span class="s2">, </span><span class="s3">1.57959926</span><span class="s2">, </span><span class="s3">2.27469826</span><span class="s2">, </span><span class="s3">1.95962656</span><span class="s2">,</span>
        <span class="s3">0.25992399</span><span class="s2">, </span><span class="s3">1.01946914</span><span class="s2">, </span><span class="s3">0.49016398</span><span class="s2">, </span><span class="s3">0.5636338</span><span class="s2">,</span>
        <span class="s3">0.5959546</span><span class="s2">, </span><span class="s3">1.43082857</span><span class="s2">, </span><span class="s3">0.56230122</span><span class="s2">, </span><span class="s3">1.15388393</span><span class="s2">,</span>
        <span class="s3">1.68722844</span><span class="s2">, </span><span class="s3">0.77438205</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.09647045</span><span class="s2">, </span><span class="s3">1.39600146</span><span class="s2">,</span>
        <span class="s3">0.13646798</span><span class="s2">, </span><span class="s3">0.55223715</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.39944872</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.61671102</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.08722561</span><span class="s2">, </span><span class="s3">1.2101835</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.90729755</span><span class="s2">, </span><span class="s3">2.64916158</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.0080694</span><span class="s2">, </span><span class="s3">0.51111895</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.00401437</span><span class="s2">, </span><span class="s3">2.16821432</span><span class="s2">,</span>
        <span class="s3">1.92586732</span><span class="s2">, </span><span class="s3">1.03504717</span><span class="s2">, </span><span class="s3">1.85897219</span><span class="s2">, </span><span class="s3">2.32004929</span><span class="s2">,</span>
        <span class="s3">0.25570789</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.09855274</span><span class="s2">, </span><span class="s3">0.89073682</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.55896485</span><span class="s2">,</span>
        <span class="s3">0.28350255</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.31155407</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.88278776</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.97454941</span><span class="s2">,</span>
        <span class="s3">1.01275265</span><span class="s2">, </span><span class="s3">1.68264723</span><span class="s2">, </span><span class="s3">1.38271284</span><span class="s2">, </span><span class="s3">1.86073637</span><span class="s2">,</span>
        <span class="s3">0.4447377</span><span class="s2">, </span><span class="s3">0.41449001</span><span class="s2">, </span><span class="s3">0.99202275</span><span class="s2">, </span><span class="s3">1.36283576</span><span class="s2">,</span>
        <span class="s3">1.59970522</span><span class="s2">, </span><span class="s3">1.98845816</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.25684232</span><span class="s2">, </span><span class="s3">0.87786949</span><span class="s2">,</span>
        <span class="s3">3.1095655</span><span class="s2">, </span><span class="s3">0.85324478</span><span class="s2">, </span><span class="s3">1.23337317</span><span class="s2">, </span><span class="s3">0.00314302</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.09433369</span><span class="s2">, </span><span class="s3">0.89883322</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.19036628</span><span class="s2">, </span><span class="s3">0.99772376</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">2.39120054</span><span class="s2">, </span><span class="s3">0.06649673</span><span class="s2">, </span><span class="s3">1.26136017</span><span class="s2">, </span><span class="s3">1.91637838</span><span class="s2">,</span>
        <span class="s1">-</span><span class="s3">0.3348029</span><span class="s2">, </span><span class="s3">0.44207108</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.40664911</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.52129889</span><span class="s2">,</span>
        <span class="s3">0.29919869</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.80197448</span><span class="s2">, </span><span class="s3">0.15204792</span><span class="s2">, </span><span class="s3">0.98585027</span><span class="s2">,</span>
        <span class="s3">2.13034606</span><span class="s2">, </span><span class="s3">1.34397924</span><span class="s2">, </span><span class="s3">1.61550522</span><span class="s2">, </span><span class="s3">2.70930099</span><span class="s2">,</span>
        <span class="s3">1.24461412</span><span class="s2">, </span><span class="s3">0.50835466</span><span class="s2">, </span><span class="s3">0.14802167</span><span class="s1">]</span>

<span class="s1">rec = [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">,</span>
       <span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">,</span>
       <span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">,</span>
       <span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">,</span>
       <span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">,</span>
       <span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span>


<span class="s2">def </span><span class="s1">test_predict():</span>
    <span class="s4"># AR(1) without mean, k_regimes=2</span>
    <span class="s1">endog = np.ones(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">,</span>
        <span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">,</span>
        <span class="s1">order=</span><span class="s3">1</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s5">'n'</span>
    <span class="s1">)</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">trend=</span><span class="s5">'n'</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.ones(</span><span class="s3">9</span><span class="s1">))</span>

    <span class="s1">params = np.r_[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">mod_resid = mod._resid(params)</span>
    <span class="s1">resids = np.zeros((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">mod.nobs))</span>
    <span class="s4"># Resids when: S_{t} = 0</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:] = np.ones(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">0.1 </span><span class="s1">* np.ones(</span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_{t} = 1</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:] = np.ones(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">0.5 </span><span class="s1">* np.ones(</span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:])</span>

    <span class="s4"># AR(1) with mean, k_regimes=2</span>
    <span class="s1">endog = np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">params = np.r_[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">mod_resid = mod._resid(params)</span>
    <span class="s1">resids = np.zeros((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">mod.nobs))</span>
    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 0</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) - </span><span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 1</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:] = (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) - </span><span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 1, S_{t-1} = 0</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">) - </span><span class="s3">0.5 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 1, S_{t-1} = 1</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:] = (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">) - </span><span class="s3">0.5 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:])</span>

    <span class="s4"># AR(2) with mean, k_regimes=3</span>
    <span class="s1">endog = np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">8</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">params = np.r_[[</span><span class="s3">0.3</span><span class="s1">] * </span><span class="s3">6</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.05</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.25</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.4</span><span class="s1">]</span>
    <span class="s1">mod_resid = mod._resid(params)</span>
    <span class="s1">resids = np.zeros((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">mod.nobs))</span>
    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 0, S_{t-2} = 0</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) -</span>
        <span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) -</span>
        <span class="s1">(-</span><span class="s3">0.05</span><span class="s1">) * (np.arange(</span><span class="s3">8</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>

    <span class="s4"># Resids when: S_t = 1, S_{t-1} = 0, S_{t-2} = 0</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">) -</span>
        <span class="s3">0.5 </span><span class="s1">* (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) -</span>
        <span class="s1">(-</span><span class="s3">0.25</span><span class="s1">) * (np.arange(</span><span class="s3">8</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>

    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 2, S_{t-2} = 1</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2.</span><span class="s1">) -</span>
        <span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">9</span><span class="s1">) - </span><span class="s3">4.</span><span class="s1">) -</span>
        <span class="s1">(-</span><span class="s3">0.05</span><span class="s1">) * (np.arange(</span><span class="s3">8</span><span class="s1">) - </span><span class="s3">3.</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:])</span>

    <span class="s4"># AR(1) with mean + non-switching exog</span>
    <span class="s1">endog = np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">exog = np.r_[</span><span class="s3">0.4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">1.2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.3</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">, </span><span class="s3">0.2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.7</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.1</span><span class="s1">]</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">exog=exog)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">params = np.r_[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">mod_resid = mod._resid(params)</span>
    <span class="s1">resids = np.zeros((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">mod.nobs))</span>
    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 0</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[</span><span class="s3">1</span><span class="s1">:]) -</span>
        <span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[:-</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 0, S_{t-1} = 1</span>
    <span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">2. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[</span><span class="s3">1</span><span class="s1">:]) -</span>
        <span class="s3">0.1 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">3. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[:-</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 1, S_{t-1} = 0</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">3. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[</span><span class="s3">1</span><span class="s1">:]) -</span>
        <span class="s3">0.5 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">2. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[:-</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">:])</span>
    <span class="s4"># Resids when: S_t = 1, S_{t-1} = 1</span>
    <span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">(np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">) - </span><span class="s3">3. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[</span><span class="s3">1</span><span class="s1">:]) -</span>
        <span class="s3">0.5 </span><span class="s1">* (np.arange(</span><span class="s3">9</span><span class="s1">) - </span><span class="s3">3. </span><span class="s1">- </span><span class="s3">1.5 </span><span class="s1">* exog[:-</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(mod_resid[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">, </span><span class="s1">resids[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">:])</span>


<span class="s2">def </span><span class="s1">test_conditional_loglikelihoods():</span>
    <span class="s4"># AR(1) without mean, k_regimes=2, non-switching variance</span>
    <span class="s1">endog = np.ones(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.ones(</span><span class="s3">9</span><span class="s1">))</span>

    <span class="s1">params = np.r_[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">resid = mod._resid(params)</span>
    <span class="s1">conditional_likelihoods = (</span>
        <span class="s1">np.exp(-</span><span class="s3">0.5 </span><span class="s1">* resid**</span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">2</span><span class="s1">) / np.sqrt(</span><span class="s3">2 </span><span class="s1">* np.pi * </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod._conditional_loglikelihoods(params)</span><span class="s2">,</span>
                    <span class="s1">np.log(conditional_likelihoods))</span>

    <span class="s4"># AR(1) without mean, k_regimes=3, switching variance</span>
    <span class="s1">endog = np.ones(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">mod = markov_autoregression.MarkovAutoregression(</span>
        <span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">switching_variance=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.nobs</span><span class="s2">, </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">assert_equal(mod.endog</span><span class="s2">, </span><span class="s1">np.ones(</span><span class="s3">9</span><span class="s1">))</span>

    <span class="s1">params = np.r_[[</span><span class="s3">0.3</span><span class="s1">]*</span><span class="s3">6</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">4.</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">4.5</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s1">]</span>
    <span class="s1">mod_conditional_loglikelihoods = mod._conditional_loglikelihoods(params)</span>
    <span class="s1">conditional_likelihoods = mod._resid(params)</span>

    <span class="s4"># S_t = 0</span>
    <span class="s1">conditional_likelihoods[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">np.exp(-</span><span class="s3">0.5 </span><span class="s1">* conditional_likelihoods[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]**</span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">1.5</span><span class="s1">) /</span>
        <span class="s1">np.sqrt(</span><span class="s3">2 </span><span class="s1">* np.pi * </span><span class="s3">1.5</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_conditional_loglikelihoods[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">,</span>
                    <span class="s1">np.log(conditional_likelihoods[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]))</span>
    <span class="s4"># S_t = 1</span>
    <span class="s1">conditional_likelihoods[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">np.exp(-</span><span class="s3">0.5 </span><span class="s1">* conditional_likelihoods[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]**</span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3.</span><span class="s1">) /</span>
        <span class="s1">np.sqrt(</span><span class="s3">2 </span><span class="s1">* np.pi * </span><span class="s3">3.</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_conditional_loglikelihoods[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">,</span>
                    <span class="s1">np.log(conditional_likelihoods[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]))</span>
    <span class="s4"># S_t = 2</span>
    <span class="s1">conditional_likelihoods[</span><span class="s3">2</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:] = (</span>
        <span class="s1">np.exp(-</span><span class="s3">0.5 </span><span class="s1">* conditional_likelihoods[</span><span class="s3">2</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]**</span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">4.5</span><span class="s1">) /</span>
        <span class="s1">np.sqrt(</span><span class="s3">2 </span><span class="s1">* np.pi * </span><span class="s3">4.5</span><span class="s1">))</span>
    <span class="s1">assert_allclose(mod_conditional_loglikelihoods[</span><span class="s3">2</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]</span><span class="s2">,</span>
                    <span class="s1">np.log(conditional_likelihoods[</span><span class="s3">2</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:]))</span>


<span class="s2">class </span><span class="s1">MarkovAutoregression:</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls</span><span class="s2">, </span><span class="s1">true</span><span class="s2">, </span><span class="s1">endog</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s3">1e-7</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s1">cls.model = markov_autoregression.MarkovAutoregression(endog</span><span class="s2">, </span><span class="s1">**kwargs)</span>
        <span class="s1">cls.true = true</span>
        <span class="s1">cls.result = cls.model.smooth(cls.true[</span><span class="s5">'params'</span><span class="s1">])</span>
        <span class="s1">cls.atol = atol</span>
        <span class="s1">cls.rtol = rtol</span>

    <span class="s2">def </span><span class="s1">test_llf(self):</span>
        <span class="s1">assert_allclose(self.result.llf</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'llf'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=self.atol</span><span class="s2">,</span>
                        <span class="s1">rtol=self.rtol)</span>

    <span class="s2">def </span><span class="s1">test_fit(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s4"># Test fitting against Stata</span>
        <span class="s2">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s1">warnings.simplefilter(</span><span class="s5">&quot;ignore&quot;</span><span class="s1">)</span>
            <span class="s1">res = self.model.fit(disp=</span><span class="s2">False, </span><span class="s1">**kwargs)</span>
        <span class="s1">assert_allclose(res.llf</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'llf_fit'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=self.atol</span><span class="s2">,</span>
                        <span class="s1">rtol=self.rtol)</span>

    <span class="s1">@pytest.mark.smoke</span>
    <span class="s2">def </span><span class="s1">test_fit_em(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s4"># Test EM fitting (smoke test)</span>
        <span class="s1">res_em = self.model._fit_em(**kwargs)</span>
        <span class="s1">assert_allclose(res_em.llf</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'llf_fit_em'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=self.atol</span><span class="s2">,</span>
                        <span class="s1">rtol=self.rtol)</span>


<span class="s1">hamilton_ar2_short_filtered_joint_probabilities = np.array([</span>
         <span class="s1">[[[</span><span class="s3">4.99506987e-02</span><span class="s2">,   </span><span class="s3">6.44048275e-04</span><span class="s2">,   </span><span class="s3">6.22227140e-05</span><span class="s2">,</span>
            <span class="s3">4.45756755e-06</span><span class="s2">,   </span><span class="s3">5.26645567e-07</span><span class="s2">,   </span><span class="s3">7.99846146e-07</span><span class="s2">,</span>
            <span class="s3">1.19425705e-05</span><span class="s2">,   </span><span class="s3">6.87762063e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">1.95930395e-02</span><span class="s2">,   </span><span class="s3">3.25884335e-04</span><span class="s2">,   </span><span class="s3">1.12955091e-04</span><span class="s2">,</span>
            <span class="s3">3.38537103e-04</span><span class="s2">,   </span><span class="s3">9.81927968e-06</span><span class="s2">,   </span><span class="s3">2.71696750e-05</span><span class="s2">,</span>
            <span class="s3">5.83828290e-03</span><span class="s2">,   </span><span class="s3">7.64261509e-02</span><span class="s1">]]</span><span class="s2">,</span>

          <span class="s1">[[</span><span class="s3">1.97113193e-03</span><span class="s2">,   </span><span class="s3">9.50372207e-05</span><span class="s2">,   </span><span class="s3">1.98390978e-04</span><span class="s2">,</span>
            <span class="s3">1.88188953e-06</span><span class="s2">,   </span><span class="s3">4.83449400e-07</span><span class="s2">,   </span><span class="s3">1.14872860e-05</span><span class="s2">,</span>
            <span class="s3">4.02918239e-06</span><span class="s2">,   </span><span class="s3">4.35015431e-04</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">2.24870443e-02</span><span class="s2">,   </span><span class="s3">1.27331172e-03</span><span class="s2">,   </span><span class="s3">9.62155856e-03</span><span class="s2">,</span>
            <span class="s3">4.04178695e-03</span><span class="s2">,   </span><span class="s3">2.75516282e-04</span><span class="s2">,   </span><span class="s3">1.18179572e-02</span><span class="s2">,</span>
            <span class="s3">5.99778157e-02</span><span class="s2">,   </span><span class="s3">1.48149567e-01</span><span class="s1">]]]</span><span class="s2">,</span>


         <span class="s1">[[[</span><span class="s3">6.70912859e-02</span><span class="s2">,   </span><span class="s3">1.84223872e-02</span><span class="s2">,   </span><span class="s3">2.55621792e-04</span><span class="s2">,</span>
            <span class="s3">4.48500688e-05</span><span class="s2">,   </span><span class="s3">7.80481515e-05</span><span class="s2">,   </span><span class="s3">2.73734559e-06</span><span class="s2">,</span>
            <span class="s3">7.59835896e-06</span><span class="s2">,   </span><span class="s3">1.42930726e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">2.10053328e-02</span><span class="s2">,   </span><span class="s3">7.44036383e-03</span><span class="s2">,   </span><span class="s3">3.70388879e-04</span><span class="s2">,</span>
            <span class="s3">2.71878370e-03</span><span class="s2">,   </span><span class="s3">1.16152088e-03</span><span class="s2">,   </span><span class="s3">7.42182691e-05</span><span class="s2">,</span>
            <span class="s3">2.96490192e-03</span><span class="s2">,   </span><span class="s3">1.26774695e-02</span><span class="s1">]]</span><span class="s2">,</span>

          <span class="s1">[[</span><span class="s3">8.09335679e-02</span><span class="s2">,   </span><span class="s3">8.31016518e-02</span><span class="s2">,   </span><span class="s3">2.49149080e-02</span><span class="s2">,</span>
            <span class="s3">5.78825626e-04</span><span class="s2">,   </span><span class="s3">2.19019941e-03</span><span class="s2">,   </span><span class="s3">1.20179130e-03</span><span class="s2">,</span>
            <span class="s3">7.83659430e-05</span><span class="s2">,   </span><span class="s3">2.76363377e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">7.36967899e-01</span><span class="s2">,   </span><span class="s3">8.88697316e-01</span><span class="s2">,   </span><span class="s3">9.64463954e-01</span><span class="s2">,</span>
            <span class="s3">9.92270877e-01</span><span class="s2">,   </span><span class="s3">9.96283886e-01</span><span class="s2">,   </span><span class="s3">9.86863839e-01</span><span class="s2">,</span>
            <span class="s3">9.31117063e-01</span><span class="s2">,   </span><span class="s3">7.51241236e-01</span><span class="s1">]]]])</span>


<span class="s1">hamilton_ar2_short_predicted_joint_probabilities = np.array([[</span>
          <span class="s1">[[[</span><span class="s3">1.20809334e-01</span><span class="s2">,   </span><span class="s3">3.76964436e-02</span><span class="s2">,   </span><span class="s3">4.86045844e-04</span><span class="s2">,</span>
             <span class="s3">4.69578023e-05</span><span class="s2">,   </span><span class="s3">3.36400588e-06</span><span class="s2">,   </span><span class="s3">3.97445190e-07</span><span class="s2">,</span>
             <span class="s3">6.03622290e-07</span><span class="s2">,   </span><span class="s3">9.01273552e-06</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">3.92723623e-02</span><span class="s2">,   </span><span class="s3">1.47863379e-02</span><span class="s2">,   </span><span class="s3">2.45936108e-04</span><span class="s2">,</span>
             <span class="s3">8.52441571e-05</span><span class="s2">,   </span><span class="s3">2.55484811e-04</span><span class="s2">,   </span><span class="s3">7.41034525e-06</span><span class="s2">,</span>
             <span class="s3">2.05042201e-05</span><span class="s2">,   </span><span class="s3">4.40599447e-03</span><span class="s1">]]</span><span class="s2">,</span>

           <span class="s1">[[</span><span class="s3">4.99131230e-03</span><span class="s2">,   </span><span class="s3">1.48756005e-03</span><span class="s2">,   </span><span class="s3">7.17220245e-05</span><span class="s2">,</span>
             <span class="s3">1.49720314e-04</span><span class="s2">,   </span><span class="s3">1.42021122e-06</span><span class="s2">,   </span><span class="s3">3.64846209e-07</span><span class="s2">,</span>
             <span class="s3">8.66914462e-06</span><span class="s2">,   </span><span class="s3">3.04071516e-06</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">4.70476003e-02</span><span class="s2">,   </span><span class="s3">1.69703652e-02</span><span class="s2">,   </span><span class="s3">9.60933974e-04</span><span class="s2">,</span>
             <span class="s3">7.26113047e-03</span><span class="s2">,   </span><span class="s3">3.05022748e-03</span><span class="s2">,   </span><span class="s3">2.07924699e-04</span><span class="s2">,</span>
             <span class="s3">8.91869322e-03</span><span class="s2">,   </span><span class="s3">4.52636381e-02</span><span class="s1">]]]</span><span class="s2">,</span>


          <span class="s1">[[[</span><span class="s3">4.99131230e-03</span><span class="s2">,   </span><span class="s3">6.43506069e-03</span><span class="s2">,   </span><span class="s3">1.76698327e-03</span><span class="s2">,</span>
             <span class="s3">2.45179642e-05</span><span class="s2">,   </span><span class="s3">4.30179435e-06</span><span class="s2">,   </span><span class="s3">7.48598845e-06</span><span class="s2">,</span>
             <span class="s3">2.62552503e-07</span><span class="s2">,   </span><span class="s3">7.28796600e-07</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">1.62256192e-03</span><span class="s2">,   </span><span class="s3">2.01472650e-03</span><span class="s2">,   </span><span class="s3">7.13642497e-04</span><span class="s2">,</span>
             <span class="s3">3.55258493e-05</span><span class="s2">,   </span><span class="s3">2.60772139e-04</span><span class="s2">,   </span><span class="s3">1.11407276e-04</span><span class="s2">,</span>
             <span class="s3">7.11864528e-06</span><span class="s2">,   </span><span class="s3">2.84378568e-04</span><span class="s1">]]</span><span class="s2">,</span>

           <span class="s1">[[</span><span class="s3">5.97950448e-03</span><span class="s2">,   </span><span class="s3">7.76274317e-03</span><span class="s2">,   </span><span class="s3">7.97069493e-03</span><span class="s2">,</span>
             <span class="s3">2.38971340e-03</span><span class="s2">,   </span><span class="s3">5.55180599e-05</span><span class="s2">,   </span><span class="s3">2.10072977e-04</span><span class="s2">,</span>
             <span class="s3">1.15269812e-04</span><span class="s2">,   </span><span class="s3">7.51646942e-06</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">5.63621989e-02</span><span class="s2">,   </span><span class="s3">7.06862760e-02</span><span class="s2">,   </span><span class="s3">8.52394030e-02</span><span class="s2">,</span>
             <span class="s3">9.25065601e-02</span><span class="s2">,   </span><span class="s3">9.51736612e-02</span><span class="s2">,   </span><span class="s3">9.55585689e-02</span><span class="s2">,</span>
             <span class="s3">9.46550451e-02</span><span class="s2">,   </span><span class="s3">8.93080931e-02</span><span class="s1">]]]]</span><span class="s2">,</span>



         <span class="s1">[[[[</span><span class="s3">3.92723623e-02</span><span class="s2">,   </span><span class="s3">1.22542551e-02</span><span class="s2">,   </span><span class="s3">1.58002431e-04</span><span class="s2">,</span>
             <span class="s3">1.52649118e-05</span><span class="s2">,   </span><span class="s3">1.09356167e-06</span><span class="s2">,   </span><span class="s3">1.29200377e-07</span><span class="s2">,</span>
             <span class="s3">1.96223855e-07</span><span class="s2">,   </span><span class="s3">2.92983500e-06</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">1.27665503e-02</span><span class="s2">,   </span><span class="s3">4.80670161e-03</span><span class="s2">,   </span><span class="s3">7.99482261e-05</span><span class="s2">,</span>
             <span class="s3">2.77109335e-05</span><span class="s2">,   </span><span class="s3">8.30522919e-05</span><span class="s2">,   </span><span class="s3">2.40893443e-06</span><span class="s2">,</span>
             <span class="s3">6.66545485e-06</span><span class="s2">,   </span><span class="s3">1.43228843e-03</span><span class="s1">]]</span><span class="s2">,</span>

           <span class="s1">[[</span><span class="s3">1.62256192e-03</span><span class="s2">,   </span><span class="s3">4.83571884e-04</span><span class="s2">,   </span><span class="s3">2.33151963e-05</span><span class="s2">,</span>
             <span class="s3">4.86706634e-05</span><span class="s2">,   </span><span class="s3">4.61678312e-07</span><span class="s2">,   </span><span class="s3">1.18603191e-07</span><span class="s2">,</span>
             <span class="s3">2.81814142e-06</span><span class="s2">,   </span><span class="s3">9.88467229e-07</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">1.52941031e-02</span><span class="s2">,   </span><span class="s3">5.51667911e-03</span><span class="s2">,   </span><span class="s3">3.12377744e-04</span><span class="s2">,</span>
             <span class="s3">2.36042810e-03</span><span class="s2">,   </span><span class="s3">9.91559466e-04</span><span class="s2">,   </span><span class="s3">6.75915830e-05</span><span class="s2">,</span>
             <span class="s3">2.89926399e-03</span><span class="s2">,   </span><span class="s3">1.47141776e-02</span><span class="s1">]]]</span><span class="s2">,</span>


          <span class="s1">[[[</span><span class="s3">4.70476003e-02</span><span class="s2">,   </span><span class="s3">6.06562252e-02</span><span class="s2">,   </span><span class="s3">1.66554040e-02</span><span class="s2">,</span>
             <span class="s3">2.31103828e-04</span><span class="s2">,   </span><span class="s3">4.05482745e-05</span><span class="s2">,   </span><span class="s3">7.05621631e-05</span><span class="s2">,</span>
             <span class="s3">2.47479309e-06</span><span class="s2">,   </span><span class="s3">6.86956236e-06</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">1.52941031e-02</span><span class="s2">,   </span><span class="s3">1.89906063e-02</span><span class="s2">,   </span><span class="s3">6.72672133e-03</span><span class="s2">,</span>
             <span class="s3">3.34863029e-04</span><span class="s2">,   </span><span class="s3">2.45801156e-03</span><span class="s2">,   </span><span class="s3">1.05011361e-03</span><span class="s2">,</span>
             <span class="s3">6.70996238e-05</span><span class="s2">,   </span><span class="s3">2.68052335e-03</span><span class="s1">]]</span><span class="s2">,</span>

           <span class="s1">[[</span><span class="s3">5.63621989e-02</span><span class="s2">,   </span><span class="s3">7.31708248e-02</span><span class="s2">,   </span><span class="s3">7.51309569e-02</span><span class="s2">,</span>
             <span class="s3">2.25251946e-02</span><span class="s2">,   </span><span class="s3">5.23307566e-04</span><span class="s2">,   </span><span class="s3">1.98012644e-03</span><span class="s2">,</span>
             <span class="s3">1.08652148e-03</span><span class="s2">,   </span><span class="s3">7.08494735e-05</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s3">5.31264334e-01</span><span class="s2">,   </span><span class="s3">6.66281623e-01</span><span class="s2">,   </span><span class="s3">8.03457913e-01</span><span class="s2">,</span>
             <span class="s3">8.71957394e-01</span><span class="s2">,   </span><span class="s3">8.97097216e-01</span><span class="s2">,   </span><span class="s3">9.00725317e-01</span><span class="s2">,</span>
             <span class="s3">8.92208794e-01</span><span class="s2">,   </span><span class="s3">8.41808970e-01</span><span class="s1">]]]]])</span>


<span class="s1">hamilton_ar2_short_smoothed_joint_probabilities = np.array([</span>
         <span class="s1">[[[</span><span class="s3">1.29898189e-02</span><span class="s2">,   </span><span class="s3">1.66298475e-04</span><span class="s2">,   </span><span class="s3">1.29822987e-05</span><span class="s2">,</span>
            <span class="s3">9.95268382e-07</span><span class="s2">,   </span><span class="s3">1.84473346e-07</span><span class="s2">,   </span><span class="s3">7.18761267e-07</span><span class="s2">,</span>
            <span class="s3">1.69576494e-05</span><span class="s2">,   </span><span class="s3">6.87762063e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">5.09522472e-03</span><span class="s2">,   </span><span class="s3">8.41459714e-05</span><span class="s2">,   </span><span class="s3">2.35672254e-05</span><span class="s2">,</span>
            <span class="s3">7.55872505e-05</span><span class="s2">,   </span><span class="s3">3.43949612e-06</span><span class="s2">,   </span><span class="s3">2.44153330e-05</span><span class="s2">,</span>
            <span class="s3">8.28997024e-03</span><span class="s2">,   </span><span class="s3">7.64261509e-02</span><span class="s1">]]</span><span class="s2">,</span>

          <span class="s1">[[</span><span class="s3">5.90021731e-04</span><span class="s2">,   </span><span class="s3">2.55342733e-05</span><span class="s2">,   </span><span class="s3">4.50698224e-05</span><span class="s2">,</span>
            <span class="s3">5.30734135e-07</span><span class="s2">,   </span><span class="s3">1.80741761e-07</span><span class="s2">,   </span><span class="s3">1.11483792e-05</span><span class="s2">,</span>
            <span class="s3">5.98539007e-06</span><span class="s2">,   </span><span class="s3">4.35015431e-04</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">6.73107901e-03</span><span class="s2">,   </span><span class="s3">3.42109009e-04</span><span class="s2">,   </span><span class="s3">2.18579464e-03</span><span class="s2">,</span>
            <span class="s3">1.13987259e-03</span><span class="s2">,   </span><span class="s3">1.03004157e-04</span><span class="s2">,   </span><span class="s3">1.14692946e-02</span><span class="s2">,</span>
            <span class="s3">8.90976350e-02</span><span class="s2">,   </span><span class="s3">1.48149567e-01</span><span class="s1">]]]</span><span class="s2">,</span>


         <span class="s1">[[[</span><span class="s3">6.34648123e-02</span><span class="s2">,   </span><span class="s3">1.79187451e-02</span><span class="s2">,   </span><span class="s3">2.37462147e-04</span><span class="s2">,</span>
            <span class="s3">3.55542558e-05</span><span class="s2">,   </span><span class="s3">7.63980455e-05</span><span class="s2">,   </span><span class="s3">2.90520820e-06</span><span class="s2">,</span>
            <span class="s3">8.17644492e-06</span><span class="s2">,   </span><span class="s3">1.42930726e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">1.98699352e-02</span><span class="s2">,   </span><span class="s3">7.23695477e-03</span><span class="s2">,   </span><span class="s3">3.44076057e-04</span><span class="s2">,</span>
            <span class="s3">2.15527721e-03</span><span class="s2">,   </span><span class="s3">1.13696383e-03</span><span class="s2">,   </span><span class="s3">7.87695658e-05</span><span class="s2">,</span>
            <span class="s3">3.19047276e-03</span><span class="s2">,   </span><span class="s3">1.26774695e-02</span><span class="s1">]]</span><span class="s2">,</span>

          <span class="s1">[[</span><span class="s3">8.81925054e-02</span><span class="s2">,   </span><span class="s3">8.33092133e-02</span><span class="s2">,   </span><span class="s3">2.51106301e-02</span><span class="s2">,</span>
            <span class="s3">5.81007470e-04</span><span class="s2">,   </span><span class="s3">2.19065072e-03</span><span class="s2">,   </span><span class="s3">1.20221350e-03</span><span class="s2">,</span>
            <span class="s3">7.56893839e-05</span><span class="s2">,   </span><span class="s3">2.76363377e-03</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s3">8.03066603e-01</span><span class="s2">,   </span><span class="s3">8.90916999e-01</span><span class="s2">,   </span><span class="s3">9.72040418e-01</span><span class="s2">,</span>
            <span class="s3">9.96011175e-01</span><span class="s2">,   </span><span class="s3">9.96489179e-01</span><span class="s2">,   </span><span class="s3">9.87210535e-01</span><span class="s2">,</span>
            <span class="s3">8.99315113e-01</span><span class="s2">,   </span><span class="s3">7.51241236e-01</span><span class="s1">]]]])</span>


<span class="s2">class </span><span class="s1">TestHamiltonAR2Short(MarkovAutoregression):</span>
    <span class="s4"># This is just a set of regression tests</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">0.754673</span><span class="s2">, </span><span class="s3">0.095915</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.358811</span><span class="s2">, </span><span class="s3">1.163516</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.262658</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.013486</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.057521</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">10.14066</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">4.0523073</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">8.885836</span>
        <span class="s1">}</span>
        <span class="s1">super(TestHamiltonAR2Short</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">rgnp[-</span><span class="s3">10</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">switching_ar=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_fit_em(self):</span>
        <span class="s2">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s1">warnings.simplefilter(</span><span class="s5">&quot;ignore&quot;</span><span class="s1">)</span>
            <span class="s1">super(TestHamiltonAR2Short</span><span class="s2">, </span><span class="s1">self).test_fit_em()</span>

    <span class="s2">def </span><span class="s1">test_filter_output(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s1">res = self.result</span>

        <span class="s4"># Filtered</span>
        <span class="s1">assert_allclose(res.filtered_joint_probabilities</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar2_short_filtered_joint_probabilities)</span>

        <span class="s4"># Predicted</span>
        <span class="s1">desired = hamilton_ar2_short_predicted_joint_probabilities</span>
        <span class="s2">if </span><span class="s1">desired.ndim &gt; res.predicted_joint_probabilities.ndim:</span>
            <span class="s1">desired = desired.sum(axis=-</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res.predicted_joint_probabilities</span><span class="s2">, </span><span class="s1">desired)</span>

    <span class="s2">def </span><span class="s1">test_smoother_output(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s1">res = self.result</span>

        <span class="s4"># Filtered</span>
        <span class="s1">assert_allclose(res.filtered_joint_probabilities</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar2_short_filtered_joint_probabilities)</span>

        <span class="s4"># Predicted</span>
        <span class="s1">desired = hamilton_ar2_short_predicted_joint_probabilities</span>
        <span class="s2">if </span><span class="s1">desired.ndim &gt; res.predicted_joint_probabilities.ndim:</span>
            <span class="s1">desired = desired.sum(axis=-</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_allclose(res.predicted_joint_probabilities</span><span class="s2">, </span><span class="s1">desired)</span>

        <span class="s4"># Smoothed, entry-by-entry</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">res.smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">hamilton_ar2_short_smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">res.smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">hamilton_ar2_short_smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">res.smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">hamilton_ar2_short_smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">res.smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">3</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">hamilton_ar2_short_smoothed_joint_probabilities[...</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">3</span><span class="s1">])</span>


<span class="s1">hamilton_ar4_filtered = [</span>
    <span class="s3">0.776712</span><span class="s2">, </span><span class="s3">0.949192</span><span class="s2">, </span><span class="s3">0.996320</span><span class="s2">, </span><span class="s3">0.990258</span><span class="s2">, </span><span class="s3">0.940111</span><span class="s2">, </span><span class="s3">0.537442</span><span class="s2">,</span>
    <span class="s3">0.140001</span><span class="s2">, </span><span class="s3">0.008942</span><span class="s2">, </span><span class="s3">0.048480</span><span class="s2">, </span><span class="s3">0.614097</span><span class="s2">, </span><span class="s3">0.910889</span><span class="s2">, </span><span class="s3">0.995463</span><span class="s2">,</span>
    <span class="s3">0.979465</span><span class="s2">, </span><span class="s3">0.992324</span><span class="s2">, </span><span class="s3">0.984561</span><span class="s2">, </span><span class="s3">0.751038</span><span class="s2">, </span><span class="s3">0.776268</span><span class="s2">, </span><span class="s3">0.522048</span><span class="s2">,</span>
    <span class="s3">0.814956</span><span class="s2">, </span><span class="s3">0.821786</span><span class="s2">, </span><span class="s3">0.472729</span><span class="s2">, </span><span class="s3">0.673567</span><span class="s2">, </span><span class="s3">0.029031</span><span class="s2">, </span><span class="s3">0.001556</span><span class="s2">,</span>
    <span class="s3">0.433276</span><span class="s2">, </span><span class="s3">0.985463</span><span class="s2">, </span><span class="s3">0.995025</span><span class="s2">, </span><span class="s3">0.966067</span><span class="s2">, </span><span class="s3">0.998445</span><span class="s2">, </span><span class="s3">0.801467</span><span class="s2">,</span>
    <span class="s3">0.960997</span><span class="s2">, </span><span class="s3">0.996431</span><span class="s2">, </span><span class="s3">0.461365</span><span class="s2">, </span><span class="s3">0.199357</span><span class="s2">, </span><span class="s3">0.027398</span><span class="s2">, </span><span class="s3">0.703626</span><span class="s2">,</span>
    <span class="s3">0.946388</span><span class="s2">, </span><span class="s3">0.985321</span><span class="s2">, </span><span class="s3">0.998244</span><span class="s2">, </span><span class="s3">0.989567</span><span class="s2">, </span><span class="s3">0.984510</span><span class="s2">, </span><span class="s3">0.986811</span><span class="s2">,</span>
    <span class="s3">0.793788</span><span class="s2">, </span><span class="s3">0.973675</span><span class="s2">, </span><span class="s3">0.984848</span><span class="s2">, </span><span class="s3">0.990418</span><span class="s2">, </span><span class="s3">0.918427</span><span class="s2">, </span><span class="s3">0.998769</span><span class="s2">,</span>
    <span class="s3">0.977647</span><span class="s2">, </span><span class="s3">0.978742</span><span class="s2">, </span><span class="s3">0.927635</span><span class="s2">, </span><span class="s3">0.998691</span><span class="s2">, </span><span class="s3">0.988934</span><span class="s2">, </span><span class="s3">0.991654</span><span class="s2">,</span>
    <span class="s3">0.999288</span><span class="s2">, </span><span class="s3">0.999073</span><span class="s2">, </span><span class="s3">0.918636</span><span class="s2">, </span><span class="s3">0.987710</span><span class="s2">, </span><span class="s3">0.966876</span><span class="s2">, </span><span class="s3">0.910015</span><span class="s2">,</span>
    <span class="s3">0.826150</span><span class="s2">, </span><span class="s3">0.969451</span><span class="s2">, </span><span class="s3">0.844049</span><span class="s2">, </span><span class="s3">0.941525</span><span class="s2">, </span><span class="s3">0.993363</span><span class="s2">, </span><span class="s3">0.949978</span><span class="s2">,</span>
    <span class="s3">0.615206</span><span class="s2">, </span><span class="s3">0.970915</span><span class="s2">, </span><span class="s3">0.787585</span><span class="s2">, </span><span class="s3">0.707818</span><span class="s2">, </span><span class="s3">0.200476</span><span class="s2">, </span><span class="s3">0.050835</span><span class="s2">,</span>
    <span class="s3">0.140723</span><span class="s2">, </span><span class="s3">0.809850</span><span class="s2">, </span><span class="s3">0.086422</span><span class="s2">, </span><span class="s3">0.990344</span><span class="s2">, </span><span class="s3">0.785963</span><span class="s2">, </span><span class="s3">0.817425</span><span class="s2">,</span>
    <span class="s3">0.659152</span><span class="s2">, </span><span class="s3">0.996578</span><span class="s2">, </span><span class="s3">0.992860</span><span class="s2">, </span><span class="s3">0.948501</span><span class="s2">, </span><span class="s3">0.996883</span><span class="s2">, </span><span class="s3">0.999712</span><span class="s2">,</span>
    <span class="s3">0.906694</span><span class="s2">, </span><span class="s3">0.725013</span><span class="s2">, </span><span class="s3">0.963690</span><span class="s2">, </span><span class="s3">0.386960</span><span class="s2">, </span><span class="s3">0.241302</span><span class="s2">, </span><span class="s3">0.009078</span><span class="s2">,</span>
    <span class="s3">0.015789</span><span class="s2">, </span><span class="s3">0.000896</span><span class="s2">, </span><span class="s3">0.541530</span><span class="s2">, </span><span class="s3">0.928686</span><span class="s2">, </span><span class="s3">0.953704</span><span class="s2">, </span><span class="s3">0.992741</span><span class="s2">,</span>
    <span class="s3">0.935877</span><span class="s2">, </span><span class="s3">0.918958</span><span class="s2">, </span><span class="s3">0.977316</span><span class="s2">, </span><span class="s3">0.987941</span><span class="s2">, </span><span class="s3">0.987300</span><span class="s2">, </span><span class="s3">0.996769</span><span class="s2">,</span>
    <span class="s3">0.645469</span><span class="s2">, </span><span class="s3">0.921285</span><span class="s2">, </span><span class="s3">0.999917</span><span class="s2">, </span><span class="s3">0.949335</span><span class="s2">, </span><span class="s3">0.968914</span><span class="s2">, </span><span class="s3">0.886025</span><span class="s2">,</span>
    <span class="s3">0.777141</span><span class="s2">, </span><span class="s3">0.904381</span><span class="s2">, </span><span class="s3">0.368277</span><span class="s2">, </span><span class="s3">0.607429</span><span class="s2">, </span><span class="s3">0.002491</span><span class="s2">, </span><span class="s3">0.227610</span><span class="s2">,</span>
    <span class="s3">0.871284</span><span class="s2">, </span><span class="s3">0.987717</span><span class="s2">, </span><span class="s3">0.288705</span><span class="s2">, </span><span class="s3">0.512124</span><span class="s2">, </span><span class="s3">0.030329</span><span class="s2">, </span><span class="s3">0.005177</span><span class="s2">,</span>
    <span class="s3">0.256183</span><span class="s2">, </span><span class="s3">0.020955</span><span class="s2">, </span><span class="s3">0.051620</span><span class="s2">, </span><span class="s3">0.549009</span><span class="s2">, </span><span class="s3">0.991715</span><span class="s2">, </span><span class="s3">0.987892</span><span class="s2">,</span>
    <span class="s3">0.995377</span><span class="s2">, </span><span class="s3">0.999833</span><span class="s2">, </span><span class="s3">0.993756</span><span class="s2">, </span><span class="s3">0.956164</span><span class="s2">, </span><span class="s3">0.927714</span><span class="s1">]</span>

<span class="s1">hamilton_ar4_smoothed = [</span>
    <span class="s3">0.968096</span><span class="s2">, </span><span class="s3">0.991071</span><span class="s2">, </span><span class="s3">0.998559</span><span class="s2">, </span><span class="s3">0.958534</span><span class="s2">, </span><span class="s3">0.540652</span><span class="s2">, </span><span class="s3">0.072784</span><span class="s2">,</span>
    <span class="s3">0.010999</span><span class="s2">, </span><span class="s3">0.006228</span><span class="s2">, </span><span class="s3">0.172144</span><span class="s2">, </span><span class="s3">0.898574</span><span class="s2">, </span><span class="s3">0.989054</span><span class="s2">, </span><span class="s3">0.998293</span><span class="s2">,</span>
    <span class="s3">0.986434</span><span class="s2">, </span><span class="s3">0.993248</span><span class="s2">, </span><span class="s3">0.976868</span><span class="s2">, </span><span class="s3">0.858521</span><span class="s2">, </span><span class="s3">0.847452</span><span class="s2">, </span><span class="s3">0.675670</span><span class="s2">,</span>
    <span class="s3">0.596294</span><span class="s2">, </span><span class="s3">0.165407</span><span class="s2">, </span><span class="s3">0.035270</span><span class="s2">, </span><span class="s3">0.127967</span><span class="s2">, </span><span class="s3">0.007414</span><span class="s2">, </span><span class="s3">0.004944</span><span class="s2">,</span>
    <span class="s3">0.815829</span><span class="s2">, </span><span class="s3">0.998128</span><span class="s2">, </span><span class="s3">0.998091</span><span class="s2">, </span><span class="s3">0.993227</span><span class="s2">, </span><span class="s3">0.999283</span><span class="s2">, </span><span class="s3">0.921100</span><span class="s2">,</span>
    <span class="s3">0.977171</span><span class="s2">, </span><span class="s3">0.971757</span><span class="s2">, </span><span class="s3">0.124680</span><span class="s2">, </span><span class="s3">0.063710</span><span class="s2">, </span><span class="s3">0.114570</span><span class="s2">, </span><span class="s3">0.954701</span><span class="s2">,</span>
    <span class="s3">0.994852</span><span class="s2">, </span><span class="s3">0.997302</span><span class="s2">, </span><span class="s3">0.999345</span><span class="s2">, </span><span class="s3">0.995817</span><span class="s2">, </span><span class="s3">0.996218</span><span class="s2">, </span><span class="s3">0.994580</span><span class="s2">,</span>
    <span class="s3">0.933990</span><span class="s2">, </span><span class="s3">0.996054</span><span class="s2">, </span><span class="s3">0.998151</span><span class="s2">, </span><span class="s3">0.996976</span><span class="s2">, </span><span class="s3">0.971489</span><span class="s2">, </span><span class="s3">0.999786</span><span class="s2">,</span>
    <span class="s3">0.997362</span><span class="s2">, </span><span class="s3">0.996755</span><span class="s2">, </span><span class="s3">0.993053</span><span class="s2">, </span><span class="s3">0.999947</span><span class="s2">, </span><span class="s3">0.998469</span><span class="s2">, </span><span class="s3">0.997987</span><span class="s2">,</span>
    <span class="s3">0.999830</span><span class="s2">, </span><span class="s3">0.999360</span><span class="s2">, </span><span class="s3">0.953176</span><span class="s2">, </span><span class="s3">0.992673</span><span class="s2">, </span><span class="s3">0.975235</span><span class="s2">, </span><span class="s3">0.938121</span><span class="s2">,</span>
    <span class="s3">0.946784</span><span class="s2">, </span><span class="s3">0.986897</span><span class="s2">, </span><span class="s3">0.905792</span><span class="s2">, </span><span class="s3">0.969755</span><span class="s2">, </span><span class="s3">0.995379</span><span class="s2">, </span><span class="s3">0.914480</span><span class="s2">,</span>
    <span class="s3">0.772814</span><span class="s2">, </span><span class="s3">0.931385</span><span class="s2">, </span><span class="s3">0.541742</span><span class="s2">, </span><span class="s3">0.394596</span><span class="s2">, </span><span class="s3">0.063428</span><span class="s2">, </span><span class="s3">0.027829</span><span class="s2">,</span>
    <span class="s3">0.124527</span><span class="s2">, </span><span class="s3">0.286105</span><span class="s2">, </span><span class="s3">0.069362</span><span class="s2">, </span><span class="s3">0.995950</span><span class="s2">, </span><span class="s3">0.961153</span><span class="s2">, </span><span class="s3">0.962449</span><span class="s2">,</span>
    <span class="s3">0.945022</span><span class="s2">, </span><span class="s3">0.999855</span><span class="s2">, </span><span class="s3">0.998943</span><span class="s2">, </span><span class="s3">0.980041</span><span class="s2">, </span><span class="s3">0.999028</span><span class="s2">, </span><span class="s3">0.999838</span><span class="s2">,</span>
    <span class="s3">0.863305</span><span class="s2">, </span><span class="s3">0.607421</span><span class="s2">, </span><span class="s3">0.575983</span><span class="s2">, </span><span class="s3">0.013300</span><span class="s2">, </span><span class="s3">0.007562</span><span class="s2">, </span><span class="s3">0.000635</span><span class="s2">,</span>
    <span class="s3">0.001806</span><span class="s2">, </span><span class="s3">0.002196</span><span class="s2">, </span><span class="s3">0.803550</span><span class="s2">, </span><span class="s3">0.972056</span><span class="s2">, </span><span class="s3">0.984503</span><span class="s2">, </span><span class="s3">0.998059</span><span class="s2">,</span>
    <span class="s3">0.985211</span><span class="s2">, </span><span class="s3">0.988486</span><span class="s2">, </span><span class="s3">0.994452</span><span class="s2">, </span><span class="s3">0.994498</span><span class="s2">, </span><span class="s3">0.998873</span><span class="s2">, </span><span class="s3">0.999192</span><span class="s2">,</span>
    <span class="s3">0.870482</span><span class="s2">, </span><span class="s3">0.976282</span><span class="s2">, </span><span class="s3">0.999961</span><span class="s2">, </span><span class="s3">0.984283</span><span class="s2">, </span><span class="s3">0.973045</span><span class="s2">, </span><span class="s3">0.786176</span><span class="s2">,</span>
    <span class="s3">0.403673</span><span class="s2">, </span><span class="s3">0.275418</span><span class="s2">, </span><span class="s3">0.115199</span><span class="s2">, </span><span class="s3">0.257560</span><span class="s2">, </span><span class="s3">0.004735</span><span class="s2">, </span><span class="s3">0.493936</span><span class="s2">,</span>
    <span class="s3">0.907360</span><span class="s2">, </span><span class="s3">0.873199</span><span class="s2">, </span><span class="s3">0.052959</span><span class="s2">, </span><span class="s3">0.076008</span><span class="s2">, </span><span class="s3">0.001653</span><span class="s2">, </span><span class="s3">0.000847</span><span class="s2">,</span>
    <span class="s3">0.062027</span><span class="s2">, </span><span class="s3">0.021257</span><span class="s2">, </span><span class="s3">0.219547</span><span class="s2">, </span><span class="s3">0.955654</span><span class="s2">, </span><span class="s3">0.999851</span><span class="s2">, </span><span class="s3">0.997685</span><span class="s2">,</span>
    <span class="s3">0.998324</span><span class="s2">, </span><span class="s3">0.999939</span><span class="s2">, </span><span class="s3">0.996858</span><span class="s2">, </span><span class="s3">0.969209</span><span class="s2">, </span><span class="s3">0.927714</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">TestHamiltonAR4(MarkovAutoregression):</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s4"># Results from E-views:</span>
        <span class="s4"># Dependent variable followed by a list of switching regressors:</span>
        <span class="s4">#     rgnp c</span>
        <span class="s4"># List of non-switching regressors:</span>
        <span class="s4">#     ar(1) ar(2) ar(3) ar(4)</span>
        <span class="s4"># Do not check &quot;Regime specific error variances&quot;</span>
        <span class="s4"># Switching type: Markov</span>
        <span class="s4"># Number of Regimes: 2</span>
        <span class="s4"># Probability regressors:</span>
        <span class="s4">#     c</span>
        <span class="s4"># Method SWITCHREG</span>
        <span class="s4"># Sample 1951q1 1984q4</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">0.754673</span><span class="s2">, </span><span class="s3">0.095915</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.358811</span><span class="s2">, </span><span class="s3">1.163516</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.262658</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.013486</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.057521</span><span class="s2">,</span>
                            <span class="s1">-</span><span class="s3">0.246983</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.212923</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">181.26339</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">181.26339</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">183.85444</span><span class="s2">,</span>
            <span class="s5">'bse_oim'</span><span class="s1">: np.r_[</span><span class="s3">.0965189</span><span class="s2">, </span><span class="s3">.0377362</span><span class="s2">, </span><span class="s3">.2645396</span><span class="s2">, </span><span class="s3">.0745187</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">,</span>
                             <span class="s3">.1199942</span><span class="s2">, </span><span class="s3">.137663</span><span class="s2">, </span><span class="s3">.1069103</span><span class="s2">, </span><span class="s3">.1105311</span><span class="s2">, </span><span class="s1">]</span>
        <span class="s1">}</span>
        <span class="s1">super(TestHamiltonAR4</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">rgnp</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">switching_ar=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_filtered_regimes(self):</span>
        <span class="s1">res = self.result</span>
        <span class="s1">assert_equal(len(res.filtered_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
                     <span class="s1">self.model.nobs)</span>
        <span class="s1">assert_allclose(res.filtered_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar4_filtered</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_regimes(self):</span>
        <span class="s1">res = self.result</span>
        <span class="s1">assert_equal(len(res.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
                     <span class="s1">self.model.nobs)</span>
        <span class="s1">assert_allclose(res.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar4_smoothed</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_bse(self):</span>
        <span class="s4"># Cannot compare middle element of bse because we estimate sigma^2</span>
        <span class="s4"># rather than sigma</span>
        <span class="s1">bse = self.result.cov_params_approx.diagonal()**</span><span class="s3">0.5</span>
        <span class="s1">assert_allclose(bse[:</span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'bse_oim'</span><span class="s1">][:</span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>
        <span class="s1">assert_allclose(bse[</span><span class="s3">6</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'bse_oim'</span><span class="s1">][</span><span class="s3">6</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestHamiltonAR2Switch(MarkovAutoregression):</span>
    <span class="s4"># Results from Stata, see http://www.stata.com/manuals14/tsmswitch.pdf</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">path = os.path.join(current_path</span><span class="s2">, </span><span class="s5">'results'</span><span class="s2">,</span>
                            <span class="s5">'results_predict_rgnp.csv'</span><span class="s1">)</span>
        <span class="s1">results = pd.read_csv(path)</span>

        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">.3812383</span><span class="s2">, </span><span class="s3">.3564492</span><span class="s2">, </span><span class="s1">-</span><span class="s3">.0055216</span><span class="s2">, </span><span class="s3">1.195482</span><span class="s2">,</span>
                            <span class="s3">.6677098</span><span class="s1">**</span><span class="s3">2</span><span class="s2">, </span><span class="s3">.3710719</span><span class="s2">, </span><span class="s3">.4621503</span><span class="s2">, </span><span class="s3">.7002937</span><span class="s2">,</span>
                            <span class="s1">-</span><span class="s3">.3206652</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">179.32354</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">179.38684</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">184.99606</span><span class="s2">,</span>
            <span class="s5">'bse_oim'</span><span class="s1">: np.r_[</span><span class="s3">.1424841</span><span class="s2">, </span><span class="s3">.0994742</span><span class="s2">, </span><span class="s3">.2057086</span><span class="s2">, </span><span class="s3">.1225987</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">,</span>
                             <span class="s3">.1754383</span><span class="s2">, </span><span class="s3">.1652473</span><span class="s2">, </span><span class="s3">.187409</span><span class="s2">, </span><span class="s3">.1295937</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'smoothed0'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_sm1'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'smoothed1'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_sm2'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'predict0'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_yhat1'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'predict1'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_yhat2'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'predict_predicted'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_pyhat'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'predict_filtered'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_fyhat'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'predict_smoothed'</span><span class="s1">: results.iloc[</span><span class="s3">3</span><span class="s1">:][</span><span class="s5">'switchar2_syhat'</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s1">super(TestHamiltonAR2Switch</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">rgnp</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_marginal_probabilities(self):</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.true[</span><span class="s5">'smoothed0'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.true[</span><span class="s5">'smoothed1'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_predict(self):</span>
        <span class="s4"># Smoothed</span>
        <span class="s1">actual = self.model.predict(</span>
            <span class="s1">self.true[</span><span class="s5">'params'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">probabilities=</span><span class="s5">'smoothed'</span><span class="s1">)</span>
        <span class="s1">assert_allclose(actual</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'predict_smoothed'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>
        <span class="s1">actual = self.model.predict(</span>
            <span class="s1">self.true[</span><span class="s5">'params'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">probabilities=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_allclose(actual</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'predict_smoothed'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>

        <span class="s1">actual = self.result.predict(probabilities=</span><span class="s5">'smoothed'</span><span class="s1">)</span>
        <span class="s1">assert_allclose(actual</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'predict_smoothed'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>
        <span class="s1">actual = self.result.predict(probabilities=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">assert_allclose(actual</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'predict_smoothed'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-6</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_bse(self):</span>
        <span class="s4"># Cannot compare middle element of bse because we estimate sigma^2</span>
        <span class="s4"># rather than sigma</span>
        <span class="s1">bse = self.result.cov_params_approx.diagonal()**</span><span class="s3">0.5</span>
        <span class="s1">assert_allclose(bse[:</span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'bse_oim'</span><span class="s1">][:</span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-7</span><span class="s1">)</span>
        <span class="s1">assert_allclose(bse[</span><span class="s3">6</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">self.true[</span><span class="s5">'bse_oim'</span><span class="s1">][</span><span class="s3">6</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-7</span><span class="s1">)</span>


<span class="s1">hamilton_ar1_switch_filtered = [</span>
    <span class="s3">0.840288</span><span class="s2">, </span><span class="s3">0.730337</span><span class="s2">, </span><span class="s3">0.900234</span><span class="s2">, </span><span class="s3">0.596492</span><span class="s2">, </span><span class="s3">0.921618</span><span class="s2">, </span><span class="s3">0.983828</span><span class="s2">,</span>
    <span class="s3">0.959039</span><span class="s2">, </span><span class="s3">0.898366</span><span class="s2">, </span><span class="s3">0.477335</span><span class="s2">, </span><span class="s3">0.251089</span><span class="s2">, </span><span class="s3">0.049367</span><span class="s2">, </span><span class="s3">0.386782</span><span class="s2">,</span>
    <span class="s3">0.942868</span><span class="s2">, </span><span class="s3">0.965632</span><span class="s2">, </span><span class="s3">0.982857</span><span class="s2">, </span><span class="s3">0.897603</span><span class="s2">, </span><span class="s3">0.946986</span><span class="s2">, </span><span class="s3">0.916413</span><span class="s2">,</span>
    <span class="s3">0.640912</span><span class="s2">, </span><span class="s3">0.849296</span><span class="s2">, </span><span class="s3">0.778371</span><span class="s2">, </span><span class="s3">0.954420</span><span class="s2">, </span><span class="s3">0.929906</span><span class="s2">, </span><span class="s3">0.723930</span><span class="s2">,</span>
    <span class="s3">0.891196</span><span class="s2">, </span><span class="s3">0.061163</span><span class="s2">, </span><span class="s3">0.004806</span><span class="s2">, </span><span class="s3">0.977369</span><span class="s2">, </span><span class="s3">0.997871</span><span class="s2">, </span><span class="s3">0.977950</span><span class="s2">,</span>
    <span class="s3">0.896580</span><span class="s2">, </span><span class="s3">0.963246</span><span class="s2">, </span><span class="s3">0.430539</span><span class="s2">, </span><span class="s3">0.906586</span><span class="s2">, </span><span class="s3">0.974589</span><span class="s2">, </span><span class="s3">0.514506</span><span class="s2">,</span>
    <span class="s3">0.683457</span><span class="s2">, </span><span class="s3">0.276571</span><span class="s2">, </span><span class="s3">0.956475</span><span class="s2">, </span><span class="s3">0.966993</span><span class="s2">, </span><span class="s3">0.971618</span><span class="s2">, </span><span class="s3">0.987019</span><span class="s2">,</span>
    <span class="s3">0.916670</span><span class="s2">, </span><span class="s3">0.921652</span><span class="s2">, </span><span class="s3">0.930265</span><span class="s2">, </span><span class="s3">0.655554</span><span class="s2">, </span><span class="s3">0.965858</span><span class="s2">, </span><span class="s3">0.964981</span><span class="s2">,</span>
    <span class="s3">0.976790</span><span class="s2">, </span><span class="s3">0.868267</span><span class="s2">, </span><span class="s3">0.983240</span><span class="s2">, </span><span class="s3">0.852052</span><span class="s2">, </span><span class="s3">0.919150</span><span class="s2">, </span><span class="s3">0.854467</span><span class="s2">,</span>
    <span class="s3">0.987868</span><span class="s2">, </span><span class="s3">0.935840</span><span class="s2">, </span><span class="s3">0.958138</span><span class="s2">, </span><span class="s3">0.979535</span><span class="s2">, </span><span class="s3">0.956541</span><span class="s2">, </span><span class="s3">0.716322</span><span class="s2">,</span>
    <span class="s3">0.919035</span><span class="s2">, </span><span class="s3">0.866437</span><span class="s2">, </span><span class="s3">0.899609</span><span class="s2">, </span><span class="s3">0.914667</span><span class="s2">, </span><span class="s3">0.976448</span><span class="s2">, </span><span class="s3">0.867252</span><span class="s2">,</span>
    <span class="s3">0.953075</span><span class="s2">, </span><span class="s3">0.977850</span><span class="s2">, </span><span class="s3">0.884242</span><span class="s2">, </span><span class="s3">0.688299</span><span class="s2">, </span><span class="s3">0.968461</span><span class="s2">, </span><span class="s3">0.737517</span><span class="s2">,</span>
    <span class="s3">0.870674</span><span class="s2">, </span><span class="s3">0.559413</span><span class="s2">, </span><span class="s3">0.380339</span><span class="s2">, </span><span class="s3">0.582813</span><span class="s2">, </span><span class="s3">0.941311</span><span class="s2">, </span><span class="s3">0.240020</span><span class="s2">,</span>
    <span class="s3">0.999349</span><span class="s2">, </span><span class="s3">0.619258</span><span class="s2">, </span><span class="s3">0.828343</span><span class="s2">, </span><span class="s3">0.729726</span><span class="s2">, </span><span class="s3">0.991009</span><span class="s2">, </span><span class="s3">0.966291</span><span class="s2">,</span>
    <span class="s3">0.899148</span><span class="s2">, </span><span class="s3">0.970798</span><span class="s2">, </span><span class="s3">0.977684</span><span class="s2">, </span><span class="s3">0.695877</span><span class="s2">, </span><span class="s3">0.637555</span><span class="s2">, </span><span class="s3">0.915824</span><span class="s2">,</span>
    <span class="s3">0.434600</span><span class="s2">, </span><span class="s3">0.771277</span><span class="s2">, </span><span class="s3">0.113756</span><span class="s2">, </span><span class="s3">0.144002</span><span class="s2">, </span><span class="s3">0.008466</span><span class="s2">, </span><span class="s3">0.994860</span><span class="s2">,</span>
    <span class="s3">0.993173</span><span class="s2">, </span><span class="s3">0.961722</span><span class="s2">, </span><span class="s3">0.978555</span><span class="s2">, </span><span class="s3">0.789225</span><span class="s2">, </span><span class="s3">0.836283</span><span class="s2">, </span><span class="s3">0.940383</span><span class="s2">,</span>
    <span class="s3">0.968368</span><span class="s2">, </span><span class="s3">0.974473</span><span class="s2">, </span><span class="s3">0.980248</span><span class="s2">, </span><span class="s3">0.518125</span><span class="s2">, </span><span class="s3">0.904086</span><span class="s2">, </span><span class="s3">0.993023</span><span class="s2">,</span>
    <span class="s3">0.802936</span><span class="s2">, </span><span class="s3">0.920906</span><span class="s2">, </span><span class="s3">0.685445</span><span class="s2">, </span><span class="s3">0.666524</span><span class="s2">, </span><span class="s3">0.923285</span><span class="s2">, </span><span class="s3">0.643861</span><span class="s2">,</span>
    <span class="s3">0.938184</span><span class="s2">, </span><span class="s3">0.008862</span><span class="s2">, </span><span class="s3">0.945406</span><span class="s2">, </span><span class="s3">0.990061</span><span class="s2">, </span><span class="s3">0.991500</span><span class="s2">, </span><span class="s3">0.486669</span><span class="s2">,</span>
    <span class="s3">0.805039</span><span class="s2">, </span><span class="s3">0.089036</span><span class="s2">, </span><span class="s3">0.025067</span><span class="s2">, </span><span class="s3">0.863309</span><span class="s2">, </span><span class="s3">0.352784</span><span class="s2">, </span><span class="s3">0.733295</span><span class="s2">,</span>
    <span class="s3">0.928710</span><span class="s2">, </span><span class="s3">0.984257</span><span class="s2">, </span><span class="s3">0.926597</span><span class="s2">, </span><span class="s3">0.959887</span><span class="s2">, </span><span class="s3">0.984051</span><span class="s2">, </span><span class="s3">0.872682</span><span class="s2">,</span>
    <span class="s3">0.824375</span><span class="s2">, </span><span class="s3">0.780157</span><span class="s1">]</span>

<span class="s1">hamilton_ar1_switch_smoothed = [</span>
    <span class="s3">0.900074</span><span class="s2">, </span><span class="s3">0.758232</span><span class="s2">, </span><span class="s3">0.914068</span><span class="s2">, </span><span class="s3">0.637248</span><span class="s2">, </span><span class="s3">0.901951</span><span class="s2">, </span><span class="s3">0.979905</span><span class="s2">,</span>
    <span class="s3">0.958935</span><span class="s2">, </span><span class="s3">0.888641</span><span class="s2">, </span><span class="s3">0.261602</span><span class="s2">, </span><span class="s3">0.148761</span><span class="s2">, </span><span class="s3">0.056919</span><span class="s2">, </span><span class="s3">0.424396</span><span class="s2">,</span>
    <span class="s3">0.932184</span><span class="s2">, </span><span class="s3">0.954962</span><span class="s2">, </span><span class="s3">0.983958</span><span class="s2">, </span><span class="s3">0.895595</span><span class="s2">, </span><span class="s3">0.949519</span><span class="s2">, </span><span class="s3">0.923473</span><span class="s2">,</span>
    <span class="s3">0.678898</span><span class="s2">, </span><span class="s3">0.848793</span><span class="s2">, </span><span class="s3">0.807294</span><span class="s2">, </span><span class="s3">0.958868</span><span class="s2">, </span><span class="s3">0.942936</span><span class="s2">, </span><span class="s3">0.809137</span><span class="s2">,</span>
    <span class="s3">0.960892</span><span class="s2">, </span><span class="s3">0.032947</span><span class="s2">, </span><span class="s3">0.007127</span><span class="s2">, </span><span class="s3">0.967967</span><span class="s2">, </span><span class="s3">0.996551</span><span class="s2">, </span><span class="s3">0.979278</span><span class="s2">,</span>
    <span class="s3">0.896181</span><span class="s2">, </span><span class="s3">0.987462</span><span class="s2">, </span><span class="s3">0.498965</span><span class="s2">, </span><span class="s3">0.908803</span><span class="s2">, </span><span class="s3">0.986893</span><span class="s2">, </span><span class="s3">0.488720</span><span class="s2">,</span>
    <span class="s3">0.640492</span><span class="s2">, </span><span class="s3">0.325552</span><span class="s2">, </span><span class="s3">0.951996</span><span class="s2">, </span><span class="s3">0.959703</span><span class="s2">, </span><span class="s3">0.960914</span><span class="s2">, </span><span class="s3">0.986989</span><span class="s2">,</span>
    <span class="s3">0.916779</span><span class="s2">, </span><span class="s3">0.924570</span><span class="s2">, </span><span class="s3">0.935348</span><span class="s2">, </span><span class="s3">0.677118</span><span class="s2">, </span><span class="s3">0.960749</span><span class="s2">, </span><span class="s3">0.958966</span><span class="s2">,</span>
    <span class="s3">0.976974</span><span class="s2">, </span><span class="s3">0.838045</span><span class="s2">, </span><span class="s3">0.986562</span><span class="s2">, </span><span class="s3">0.847774</span><span class="s2">, </span><span class="s3">0.908866</span><span class="s2">, </span><span class="s3">0.821110</span><span class="s2">,</span>
    <span class="s3">0.984965</span><span class="s2">, </span><span class="s3">0.915302</span><span class="s2">, </span><span class="s3">0.938196</span><span class="s2">, </span><span class="s3">0.976518</span><span class="s2">, </span><span class="s3">0.973780</span><span class="s2">, </span><span class="s3">0.744159</span><span class="s2">,</span>
    <span class="s3">0.922006</span><span class="s2">, </span><span class="s3">0.873292</span><span class="s2">, </span><span class="s3">0.904035</span><span class="s2">, </span><span class="s3">0.917547</span><span class="s2">, </span><span class="s3">0.978559</span><span class="s2">, </span><span class="s3">0.870915</span><span class="s2">,</span>
    <span class="s3">0.948420</span><span class="s2">, </span><span class="s3">0.979747</span><span class="s2">, </span><span class="s3">0.884791</span><span class="s2">, </span><span class="s3">0.711085</span><span class="s2">, </span><span class="s3">0.973235</span><span class="s2">, </span><span class="s3">0.726311</span><span class="s2">,</span>
    <span class="s3">0.828305</span><span class="s2">, </span><span class="s3">0.446642</span><span class="s2">, </span><span class="s3">0.411135</span><span class="s2">, </span><span class="s3">0.639357</span><span class="s2">, </span><span class="s3">0.973151</span><span class="s2">, </span><span class="s3">0.141707</span><span class="s2">,</span>
    <span class="s3">0.999805</span><span class="s2">, </span><span class="s3">0.618207</span><span class="s2">, </span><span class="s3">0.783239</span><span class="s2">, </span><span class="s3">0.672193</span><span class="s2">, </span><span class="s3">0.987618</span><span class="s2">, </span><span class="s3">0.964655</span><span class="s2">,</span>
    <span class="s3">0.877390</span><span class="s2">, </span><span class="s3">0.962437</span><span class="s2">, </span><span class="s3">0.989002</span><span class="s2">, </span><span class="s3">0.692689</span><span class="s2">, </span><span class="s3">0.699370</span><span class="s2">, </span><span class="s3">0.937934</span><span class="s2">,</span>
    <span class="s3">0.522535</span><span class="s2">, </span><span class="s3">0.824567</span><span class="s2">, </span><span class="s3">0.058746</span><span class="s2">, </span><span class="s3">0.146549</span><span class="s2">, </span><span class="s3">0.009864</span><span class="s2">, </span><span class="s3">0.994072</span><span class="s2">,</span>
    <span class="s3">0.992084</span><span class="s2">, </span><span class="s3">0.956945</span><span class="s2">, </span><span class="s3">0.984297</span><span class="s2">, </span><span class="s3">0.795926</span><span class="s2">, </span><span class="s3">0.845698</span><span class="s2">, </span><span class="s3">0.935364</span><span class="s2">,</span>
    <span class="s3">0.963285</span><span class="s2">, </span><span class="s3">0.972767</span><span class="s2">, </span><span class="s3">0.992168</span><span class="s2">, </span><span class="s3">0.528278</span><span class="s2">, </span><span class="s3">0.826349</span><span class="s2">, </span><span class="s3">0.996574</span><span class="s2">,</span>
    <span class="s3">0.811431</span><span class="s2">, </span><span class="s3">0.930873</span><span class="s2">, </span><span class="s3">0.680756</span><span class="s2">, </span><span class="s3">0.721072</span><span class="s2">, </span><span class="s3">0.937977</span><span class="s2">, </span><span class="s3">0.731879</span><span class="s2">,</span>
    <span class="s3">0.996745</span><span class="s2">, </span><span class="s3">0.016121</span><span class="s2">, </span><span class="s3">0.951187</span><span class="s2">, </span><span class="s3">0.989820</span><span class="s2">, </span><span class="s3">0.996968</span><span class="s2">, </span><span class="s3">0.592477</span><span class="s2">,</span>
    <span class="s3">0.889144</span><span class="s2">, </span><span class="s3">0.036015</span><span class="s2">, </span><span class="s3">0.040084</span><span class="s2">, </span><span class="s3">0.858128</span><span class="s2">, </span><span class="s3">0.418984</span><span class="s2">, </span><span class="s3">0.746265</span><span class="s2">,</span>
    <span class="s3">0.907990</span><span class="s2">, </span><span class="s3">0.980984</span><span class="s2">, </span><span class="s3">0.900449</span><span class="s2">, </span><span class="s3">0.934741</span><span class="s2">, </span><span class="s3">0.986807</span><span class="s2">, </span><span class="s3">0.872818</span><span class="s2">,</span>
    <span class="s3">0.812080</span><span class="s2">, </span><span class="s3">0.780157</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">TestHamiltonAR1Switch(MarkovAutoregression):</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s4"># Results from E-views:</span>
        <span class="s4"># Dependent variable followed by a list of switching regressors:</span>
        <span class="s4">#     rgnp c ar(1)</span>
        <span class="s4"># List of non-switching regressors: &lt;blank&gt;</span>
        <span class="s4"># Do not check &quot;Regime specific error variances&quot;</span>
        <span class="s4"># Switching type: Markov</span>
        <span class="s4"># Number of Regimes: 2</span>
        <span class="s4"># Probability regressors:</span>
        <span class="s4">#     c</span>
        <span class="s4"># Method SWITCHREG</span>
        <span class="s4"># Sample 1951q1 1984q4</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">0.85472458</span><span class="s2">, </span><span class="s3">0.53662099</span><span class="s2">, </span><span class="s3">1.041419</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.479157</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.231404</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.243128</span><span class="s2">, </span><span class="s3">0.713029</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">186.7575</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">186.7575</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">189.25446</span>
        <span class="s1">}</span>
        <span class="s1">super(TestHamiltonAR1Switch</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">rgnp</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_filtered_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.filtered_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar1_switch_filtered</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar1_switch_smoothed</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_expected_durations(self):</span>
        <span class="s1">expected_durations = [</span><span class="s3">6.883477</span><span class="s2">, </span><span class="s3">1.863513</span><span class="s1">]</span>
        <span class="s1">assert_allclose(self.result.expected_durations</span><span class="s2">, </span><span class="s1">expected_durations</span><span class="s2">,</span>
                        <span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>


<span class="s1">hamilton_ar1_switch_tvtp_filtered = [</span>
    <span class="s3">0.999996</span><span class="s2">, </span><span class="s3">0.999211</span><span class="s2">, </span><span class="s3">0.999849</span><span class="s2">, </span><span class="s3">0.996007</span><span class="s2">, </span><span class="s3">0.999825</span><span class="s2">, </span><span class="s3">0.999991</span><span class="s2">,</span>
    <span class="s3">0.999981</span><span class="s2">, </span><span class="s3">0.999819</span><span class="s2">, </span><span class="s3">0.041745</span><span class="s2">, </span><span class="s3">0.001116</span><span class="s2">, </span><span class="s3">1.74e-05</span><span class="s2">, </span><span class="s3">0.000155</span><span class="s2">,</span>
    <span class="s3">0.999976</span><span class="s2">, </span><span class="s3">0.999958</span><span class="s2">, </span><span class="s3">0.999993</span><span class="s2">, </span><span class="s3">0.999878</span><span class="s2">, </span><span class="s3">0.999940</span><span class="s2">, </span><span class="s3">0.999791</span><span class="s2">,</span>
    <span class="s3">0.996553</span><span class="s2">, </span><span class="s3">0.999486</span><span class="s2">, </span><span class="s3">0.998485</span><span class="s2">, </span><span class="s3">0.999894</span><span class="s2">, </span><span class="s3">0.999765</span><span class="s2">, </span><span class="s3">0.997657</span><span class="s2">,</span>
    <span class="s3">0.999619</span><span class="s2">, </span><span class="s3">0.002853</span><span class="s2">, </span><span class="s3">1.09e-05</span><span class="s2">, </span><span class="s3">0.999884</span><span class="s2">, </span><span class="s3">0.999996</span><span class="s2">, </span><span class="s3">0.999997</span><span class="s2">,</span>
    <span class="s3">0.999919</span><span class="s2">, </span><span class="s3">0.999987</span><span class="s2">, </span><span class="s3">0.989762</span><span class="s2">, </span><span class="s3">0.999807</span><span class="s2">, </span><span class="s3">0.999978</span><span class="s2">, </span><span class="s3">0.050734</span><span class="s2">,</span>
    <span class="s3">0.010660</span><span class="s2">, </span><span class="s3">0.000217</span><span class="s2">, </span><span class="s3">0.006174</span><span class="s2">, </span><span class="s3">0.999977</span><span class="s2">, </span><span class="s3">0.999954</span><span class="s2">, </span><span class="s3">0.999995</span><span class="s2">,</span>
    <span class="s3">0.999934</span><span class="s2">, </span><span class="s3">0.999867</span><span class="s2">, </span><span class="s3">0.999824</span><span class="s2">, </span><span class="s3">0.996783</span><span class="s2">, </span><span class="s3">0.999941</span><span class="s2">, </span><span class="s3">0.999948</span><span class="s2">,</span>
    <span class="s3">0.999981</span><span class="s2">, </span><span class="s3">0.999658</span><span class="s2">, </span><span class="s3">0.999994</span><span class="s2">, </span><span class="s3">0.999753</span><span class="s2">, </span><span class="s3">0.999859</span><span class="s2">, </span><span class="s3">0.999330</span><span class="s2">,</span>
    <span class="s3">0.999993</span><span class="s2">, </span><span class="s3">0.999956</span><span class="s2">, </span><span class="s3">0.999970</span><span class="s2">, </span><span class="s3">0.999996</span><span class="s2">, </span><span class="s3">0.999991</span><span class="s2">, </span><span class="s3">0.998674</span><span class="s2">,</span>
    <span class="s3">0.999869</span><span class="s2">, </span><span class="s3">0.999432</span><span class="s2">, </span><span class="s3">0.999570</span><span class="s2">, </span><span class="s3">0.999600</span><span class="s2">, </span><span class="s3">0.999954</span><span class="s2">, </span><span class="s3">0.999499</span><span class="s2">,</span>
    <span class="s3">0.999906</span><span class="s2">, </span><span class="s3">0.999978</span><span class="s2">, </span><span class="s3">0.999712</span><span class="s2">, </span><span class="s3">0.997441</span><span class="s2">, </span><span class="s3">0.999948</span><span class="s2">, </span><span class="s3">0.998379</span><span class="s2">,</span>
    <span class="s3">0.999578</span><span class="s2">, </span><span class="s3">0.994745</span><span class="s2">, </span><span class="s3">0.045936</span><span class="s2">, </span><span class="s3">0.006816</span><span class="s2">, </span><span class="s3">0.027384</span><span class="s2">, </span><span class="s3">0.000278</span><span class="s2">,</span>
    <span class="s3">1.000000</span><span class="s2">, </span><span class="s3">0.996382</span><span class="s2">, </span><span class="s3">0.999541</span><span class="s2">, </span><span class="s3">0.998130</span><span class="s2">, </span><span class="s3">0.999992</span><span class="s2">, </span><span class="s3">0.999990</span><span class="s2">,</span>
    <span class="s3">0.999860</span><span class="s2">, </span><span class="s3">0.999986</span><span class="s2">, </span><span class="s3">0.999997</span><span class="s2">, </span><span class="s3">0.998520</span><span class="s2">, </span><span class="s3">0.997777</span><span class="s2">, </span><span class="s3">0.999821</span><span class="s2">,</span>
    <span class="s3">0.033353</span><span class="s2">, </span><span class="s3">0.011629</span><span class="s2">, </span><span class="s3">6.95e-05</span><span class="s2">, </span><span class="s3">4.52e-05</span><span class="s2">, </span><span class="s3">2.04e-06</span><span class="s2">, </span><span class="s3">0.999963</span><span class="s2">,</span>
    <span class="s3">0.999977</span><span class="s2">, </span><span class="s3">0.999949</span><span class="s2">, </span><span class="s3">0.999986</span><span class="s2">, </span><span class="s3">0.999240</span><span class="s2">, </span><span class="s3">0.999373</span><span class="s2">, </span><span class="s3">0.999858</span><span class="s2">,</span>
    <span class="s3">0.999946</span><span class="s2">, </span><span class="s3">0.999972</span><span class="s2">, </span><span class="s3">0.999991</span><span class="s2">, </span><span class="s3">0.994039</span><span class="s2">, </span><span class="s3">0.999817</span><span class="s2">, </span><span class="s3">0.999999</span><span class="s2">,</span>
    <span class="s3">0.999715</span><span class="s2">, </span><span class="s3">0.999924</span><span class="s2">, </span><span class="s3">0.997763</span><span class="s2">, </span><span class="s3">0.997944</span><span class="s2">, </span><span class="s3">0.999825</span><span class="s2">, </span><span class="s3">0.996592</span><span class="s2">,</span>
    <span class="s3">0.695147</span><span class="s2">, </span><span class="s3">0.000161</span><span class="s2">, </span><span class="s3">0.999665</span><span class="s2">, </span><span class="s3">0.999928</span><span class="s2">, </span><span class="s3">0.999988</span><span class="s2">, </span><span class="s3">0.992742</span><span class="s2">,</span>
    <span class="s3">0.374214</span><span class="s2">, </span><span class="s3">0.001569</span><span class="s2">, </span><span class="s3">2.16e-05</span><span class="s2">, </span><span class="s3">0.000941</span><span class="s2">, </span><span class="s3">4.32e-05</span><span class="s2">, </span><span class="s3">0.000556</span><span class="s2">,</span>
    <span class="s3">0.999955</span><span class="s2">, </span><span class="s3">0.999993</span><span class="s2">, </span><span class="s3">0.999942</span><span class="s2">, </span><span class="s3">0.999973</span><span class="s2">, </span><span class="s3">0.999999</span><span class="s2">, </span><span class="s3">0.999919</span><span class="s2">,</span>
    <span class="s3">0.999438</span><span class="s2">, </span><span class="s3">0.998738</span><span class="s1">]</span>

<span class="s1">hamilton_ar1_switch_tvtp_smoothed = [</span>
    <span class="s3">0.999997</span><span class="s2">, </span><span class="s3">0.999246</span><span class="s2">, </span><span class="s3">0.999918</span><span class="s2">, </span><span class="s3">0.996118</span><span class="s2">, </span><span class="s3">0.999740</span><span class="s2">, </span><span class="s3">0.999990</span><span class="s2">,</span>
    <span class="s3">0.999984</span><span class="s2">, </span><span class="s3">0.999783</span><span class="s2">, </span><span class="s3">0.035454</span><span class="s2">, </span><span class="s3">0.000958</span><span class="s2">, </span><span class="s3">1.53e-05</span><span class="s2">, </span><span class="s3">0.000139</span><span class="s2">,</span>
    <span class="s3">0.999973</span><span class="s2">, </span><span class="s3">0.999939</span><span class="s2">, </span><span class="s3">0.999994</span><span class="s2">, </span><span class="s3">0.999870</span><span class="s2">, </span><span class="s3">0.999948</span><span class="s2">, </span><span class="s3">0.999884</span><span class="s2">,</span>
    <span class="s3">0.997243</span><span class="s2">, </span><span class="s3">0.999668</span><span class="s2">, </span><span class="s3">0.998424</span><span class="s2">, </span><span class="s3">0.999909</span><span class="s2">, </span><span class="s3">0.999860</span><span class="s2">, </span><span class="s3">0.998037</span><span class="s2">,</span>
    <span class="s3">0.999559</span><span class="s2">, </span><span class="s3">0.002533</span><span class="s2">, </span><span class="s3">1.16e-05</span><span class="s2">, </span><span class="s3">0.999801</span><span class="s2">, </span><span class="s3">0.999993</span><span class="s2">, </span><span class="s3">0.999997</span><span class="s2">,</span>
    <span class="s3">0.999891</span><span class="s2">, </span><span class="s3">0.999994</span><span class="s2">, </span><span class="s3">0.990096</span><span class="s2">, </span><span class="s3">0.999753</span><span class="s2">, </span><span class="s3">0.999974</span><span class="s2">, </span><span class="s3">0.048495</span><span class="s2">,</span>
    <span class="s3">0.009289</span><span class="s2">, </span><span class="s3">0.000542</span><span class="s2">, </span><span class="s3">0.005991</span><span class="s2">, </span><span class="s3">0.999974</span><span class="s2">, </span><span class="s3">0.999929</span><span class="s2">, </span><span class="s3">0.999995</span><span class="s2">,</span>
    <span class="s3">0.999939</span><span class="s2">, </span><span class="s3">0.999880</span><span class="s2">, </span><span class="s3">0.999901</span><span class="s2">, </span><span class="s3">0.996221</span><span class="s2">, </span><span class="s3">0.999937</span><span class="s2">, </span><span class="s3">0.999935</span><span class="s2">,</span>
    <span class="s3">0.999985</span><span class="s2">, </span><span class="s3">0.999450</span><span class="s2">, </span><span class="s3">0.999995</span><span class="s2">, </span><span class="s3">0.999768</span><span class="s2">, </span><span class="s3">0.999897</span><span class="s2">, </span><span class="s3">0.998930</span><span class="s2">,</span>
    <span class="s3">0.999992</span><span class="s2">, </span><span class="s3">0.999949</span><span class="s2">, </span><span class="s3">0.999954</span><span class="s2">, </span><span class="s3">0.999995</span><span class="s2">, </span><span class="s3">0.999994</span><span class="s2">, </span><span class="s3">0.998687</span><span class="s2">,</span>
    <span class="s3">0.999902</span><span class="s2">, </span><span class="s3">0.999547</span><span class="s2">, </span><span class="s3">0.999653</span><span class="s2">, </span><span class="s3">0.999538</span><span class="s2">, </span><span class="s3">0.999966</span><span class="s2">, </span><span class="s3">0.999485</span><span class="s2">,</span>
    <span class="s3">0.999883</span><span class="s2">, </span><span class="s3">0.999982</span><span class="s2">, </span><span class="s3">0.999831</span><span class="s2">, </span><span class="s3">0.996940</span><span class="s2">, </span><span class="s3">0.999968</span><span class="s2">, </span><span class="s3">0.998678</span><span class="s2">,</span>
    <span class="s3">0.999780</span><span class="s2">, </span><span class="s3">0.993895</span><span class="s2">, </span><span class="s3">0.055372</span><span class="s2">, </span><span class="s3">0.020421</span><span class="s2">, </span><span class="s3">0.022913</span><span class="s2">, </span><span class="s3">0.000127</span><span class="s2">,</span>
    <span class="s3">1.000000</span><span class="s2">, </span><span class="s3">0.997072</span><span class="s2">, </span><span class="s3">0.999715</span><span class="s2">, </span><span class="s3">0.996893</span><span class="s2">, </span><span class="s3">0.999990</span><span class="s2">, </span><span class="s3">0.999991</span><span class="s2">,</span>
    <span class="s3">0.999811</span><span class="s2">, </span><span class="s3">0.999978</span><span class="s2">, </span><span class="s3">0.999998</span><span class="s2">, </span><span class="s3">0.999100</span><span class="s2">, </span><span class="s3">0.997866</span><span class="s2">, </span><span class="s3">0.999787</span><span class="s2">,</span>
    <span class="s3">0.034912</span><span class="s2">, </span><span class="s3">0.009932</span><span class="s2">, </span><span class="s3">5.91e-05</span><span class="s2">, </span><span class="s3">3.99e-05</span><span class="s2">, </span><span class="s3">1.77e-06</span><span class="s2">, </span><span class="s3">0.999954</span><span class="s2">,</span>
    <span class="s3">0.999976</span><span class="s2">, </span><span class="s3">0.999932</span><span class="s2">, </span><span class="s3">0.999991</span><span class="s2">, </span><span class="s3">0.999429</span><span class="s2">, </span><span class="s3">0.999393</span><span class="s2">, </span><span class="s3">0.999845</span><span class="s2">,</span>
    <span class="s3">0.999936</span><span class="s2">, </span><span class="s3">0.999961</span><span class="s2">, </span><span class="s3">0.999995</span><span class="s2">, </span><span class="s3">0.994246</span><span class="s2">, </span><span class="s3">0.999570</span><span class="s2">, </span><span class="s3">1.000000</span><span class="s2">,</span>
    <span class="s3">0.999702</span><span class="s2">, </span><span class="s3">0.999955</span><span class="s2">, </span><span class="s3">0.998611</span><span class="s2">, </span><span class="s3">0.998019</span><span class="s2">, </span><span class="s3">0.999902</span><span class="s2">, </span><span class="s3">0.998486</span><span class="s2">,</span>
    <span class="s3">0.673991</span><span class="s2">, </span><span class="s3">0.000205</span><span class="s2">, </span><span class="s3">0.999627</span><span class="s2">, </span><span class="s3">0.999902</span><span class="s2">, </span><span class="s3">0.999994</span><span class="s2">, </span><span class="s3">0.993707</span><span class="s2">,</span>
    <span class="s3">0.338707</span><span class="s2">, </span><span class="s3">0.001359</span><span class="s2">, </span><span class="s3">2.36e-05</span><span class="s2">, </span><span class="s3">0.000792</span><span class="s2">, </span><span class="s3">4.47e-05</span><span class="s2">, </span><span class="s3">0.000565</span><span class="s2">,</span>
    <span class="s3">0.999932</span><span class="s2">, </span><span class="s3">0.999993</span><span class="s2">, </span><span class="s3">0.999931</span><span class="s2">, </span><span class="s3">0.999950</span><span class="s2">, </span><span class="s3">0.999999</span><span class="s2">, </span><span class="s3">0.999940</span><span class="s2">,</span>
    <span class="s3">0.999626</span><span class="s2">, </span><span class="s3">0.998738</span><span class="s1">]</span>

<span class="s1">expected_durations = [</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1.223309</span><span class="s2">, </span><span class="s3">1864.084</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">710.7573</span><span class="s2">, </span><span class="s3">1.000391</span><span class="s1">]]</span>


<span class="s2">class </span><span class="s1">TestHamiltonAR1SwitchTVTP(MarkovAutoregression):</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s4"># Results from E-views:</span>
        <span class="s4"># Dependent variable followed by a list of switching regressors:</span>
        <span class="s4">#     rgnp c ar(1)</span>
        <span class="s4"># List of non-switching regressors: &lt;blank&gt;</span>
        <span class="s4"># Do not check &quot;Regime specific error variances&quot;</span>
        <span class="s4"># Switching type: Markov</span>
        <span class="s4"># Number of Regimes: 2</span>
        <span class="s4"># Probability regressors:</span>
        <span class="s4">#     c recession</span>
        <span class="s4"># Method SWITCHREG</span>
        <span class="s4"># Sample 1951q1 1984q4</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">6.564923</span><span class="s2">, </span><span class="s3">7.846371</span><span class="s2">, </span><span class="s1">-</span><span class="s3">8.064123</span><span class="s2">, </span><span class="s1">-</span><span class="s3">15.37636</span><span class="s2">,</span>
                            <span class="s3">1.027190</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.719760</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.217003</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.161489</span><span class="s2">, </span><span class="s3">0.022536</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">163.914049</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">161.786477</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">163.914049</span>
        <span class="s1">}</span>
        <span class="s1">exog_tvtp = np.c_[np.ones(len(rgnp))</span><span class="s2">, </span><span class="s1">rec]</span>
        <span class="s1">super(TestHamiltonAR1SwitchTVTP</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">rgnp</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">exog_tvtp=exog_tvtp)</span>

    <span class="s1">@pytest.mark.skip  </span><span class="s4"># TODO(ChadFulton): give reason for skip</span>
    <span class="s2">def </span><span class="s1">test_fit_em(self):</span>
        <span class="s2">pass</span>

    <span class="s2">def </span><span class="s1">test_filtered_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.filtered_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar1_switch_tvtp_filtered</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">hamilton_ar1_switch_tvtp_smoothed</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_expected_durations(self):</span>
        <span class="s1">assert_allclose(self.result.expected_durations</span><span class="s2">, </span><span class="s1">expected_durations</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-7</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestFilardo(MarkovAutoregression):</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">path = os.path.join(current_path</span><span class="s2">, </span><span class="s5">'results'</span><span class="s2">, </span><span class="s5">'mar_filardo.csv'</span><span class="s1">)</span>
        <span class="s1">cls.mar_filardo = pd.read_csv(path)</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">4.35941747</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.6493936</span><span class="s2">, </span><span class="s3">1.7702123</span><span class="s2">, </span><span class="s3">0.9945672</span><span class="s2">,</span>
                            <span class="s3">0.517298</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.865888</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.362469</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">,</span>
                            <span class="s3">0.189474</span><span class="s2">, </span><span class="s3">0.079344</span><span class="s2">, </span><span class="s3">0.110944</span><span class="s2">, </span><span class="s3">0.122251</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">586.5718</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">586.5718</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">586.5718</span>
        <span class="s1">}</span>
        <span class="s1">endog = cls.mar_filardo[</span><span class="s5">'dlip'</span><span class="s1">].iloc[</span><span class="s3">1</span><span class="s1">:].values</span>
        <span class="s1">exog_tvtp = add_constant(</span>
            <span class="s1">cls.mar_filardo[</span><span class="s5">'dmdlleading'</span><span class="s1">].iloc[:-</span><span class="s3">1</span><span class="s1">].values)</span>
        <span class="s1">super(TestFilardo</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">switching_ar=</span><span class="s2">False,</span>
            <span class="s1">exog_tvtp=exog_tvtp)</span>

    <span class="s1">@pytest.mark.skip  </span><span class="s4"># TODO(ChadFulton): give reason for skip</span>
    <span class="s2">def </span><span class="s1">test_fit(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s2">pass</span>

    <span class="s1">@pytest.mark.skip  </span><span class="s4"># TODO(ChadFulton): give reason for skip</span>
    <span class="s2">def </span><span class="s1">test_fit_em(self):</span>
        <span class="s2">pass</span>

    <span class="s2">def </span><span class="s1">test_filtered_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.filtered_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[</span><span class="s5">'filtered_0'</span><span class="s1">].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[:</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[</span><span class="s5">'smoothed_0'</span><span class="s1">].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_expected_durations(self):</span>
        <span class="s1">assert_allclose(self.result.expected_durations</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[[</span><span class="s5">'duration0'</span><span class="s2">, </span><span class="s5">'duration1'</span><span class="s1">]].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-7</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestFilardoPandas(MarkovAutoregression):</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">path = os.path.join(current_path</span><span class="s2">, </span><span class="s5">'results'</span><span class="s2">, </span><span class="s5">'mar_filardo.csv'</span><span class="s1">)</span>
        <span class="s1">cls.mar_filardo = pd.read_csv(path)</span>
        <span class="s1">cls.mar_filardo.index = pd.date_range(</span><span class="s5">'1948-02-01'</span><span class="s2">, </span><span class="s5">'1991-04-01'</span><span class="s2">,</span>
                                              <span class="s1">freq=</span><span class="s5">'MS'</span><span class="s1">)</span>
        <span class="s1">true = {</span>
            <span class="s5">'params'</span><span class="s1">: np.r_[</span><span class="s3">4.35941747</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1.6493936</span><span class="s2">, </span><span class="s3">1.7702123</span><span class="s2">, </span><span class="s3">0.9945672</span><span class="s2">,</span>
                            <span class="s3">0.517298</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.865888</span><span class="s2">,</span>
                            <span class="s1">np.exp(-</span><span class="s3">0.362469</span><span class="s1">)**</span><span class="s3">2</span><span class="s2">,</span>
                            <span class="s3">0.189474</span><span class="s2">, </span><span class="s3">0.079344</span><span class="s2">, </span><span class="s3">0.110944</span><span class="s2">, </span><span class="s3">0.122251</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">'llf'</span><span class="s1">: -</span><span class="s3">586.5718</span><span class="s2">,</span>
            <span class="s5">'llf_fit'</span><span class="s1">: -</span><span class="s3">586.5718</span><span class="s2">,</span>
            <span class="s5">'llf_fit_em'</span><span class="s1">: -</span><span class="s3">586.5718</span>
        <span class="s1">}</span>
        <span class="s1">endog = cls.mar_filardo[</span><span class="s5">'dlip'</span><span class="s1">].iloc[</span><span class="s3">1</span><span class="s1">:]</span>
        <span class="s1">exog_tvtp = add_constant(</span>
            <span class="s1">cls.mar_filardo[</span><span class="s5">'dmdlleading'</span><span class="s1">].iloc[:-</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">super(TestFilardoPandas</span><span class="s2">, </span><span class="s1">cls).setup_class(</span>
            <span class="s1">true</span><span class="s2">, </span><span class="s1">endog</span><span class="s2">, </span><span class="s1">k_regimes=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">order=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">switching_ar=</span><span class="s2">False,</span>
            <span class="s1">exog_tvtp=exog_tvtp)</span>

    <span class="s1">@pytest.mark.skip  </span><span class="s4"># TODO(ChadFulton): give reason for skip</span>
    <span class="s2">def </span><span class="s1">test_fit(self</span><span class="s2">, </span><span class="s1">**kwargs):</span>
        <span class="s2">pass</span>

    <span class="s1">@pytest.mark.skip  </span><span class="s4"># TODO(ChadFulton): give reason for skip</span>
    <span class="s2">def </span><span class="s1">test_fit_em(self):</span>
        <span class="s2">pass</span>

    <span class="s2">def </span><span class="s1">test_filtered_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.filtered_marginal_probabilities[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[</span><span class="s5">'filtered_0'</span><span class="s1">].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_smoothed_regimes(self):</span>
        <span class="s1">assert_allclose(self.result.smoothed_marginal_probabilities[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[</span><span class="s5">'smoothed_0'</span><span class="s1">].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_expected_durations(self):</span>
        <span class="s1">assert_allclose(self.result.expected_durations</span><span class="s2">,</span>
                        <span class="s1">self.mar_filardo[[</span><span class="s5">'duration0'</span><span class="s2">, </span><span class="s5">'duration1'</span><span class="s1">]].iloc[</span><span class="s3">5</span><span class="s1">:]</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s3">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s3">1e-7</span><span class="s1">)</span>
</pre>
</body>
</html>
<html>
<head>
<title>test_kernel_regression.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #cc7832;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_kernel_regression.py</font>
</center></td></tr></table>
<pre>
<span class="s1">import </span><span class="s0">pytest</span>
<span class="s1">import </span><span class="s0">numpy </span><span class="s1">as </span><span class="s0">np</span>
<span class="s1">import </span><span class="s0">numpy.testing </span><span class="s1">as </span><span class="s0">npt</span>

<span class="s1">import </span><span class="s0">statsmodels.api </span><span class="s1">as </span><span class="s0">sm</span>
<span class="s0">nparam = sm.nonparametric</span>


<span class="s1">class </span><span class="s0">KernelRegressionTestBase:</span>
    <span class="s0">@classmethod</span>
    <span class="s1">def </span><span class="s0">setup_class(cls):</span>
        <span class="s0">nobs = </span><span class="s2">60</span>
        <span class="s0">np.random.seed(</span><span class="s2">123456</span><span class="s0">)</span>
        <span class="s0">cls.o = np.random.binomial(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">0.7</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">cls.o2 = np.random.binomial(</span><span class="s2">3</span><span class="s1">, </span><span class="s2">0.7</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">cls.c1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">cls.c2 = np.random.normal(</span><span class="s2">10</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">cls.c3 = np.random.normal(</span><span class="s2">10</span><span class="s1">, </span><span class="s2">2</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">cls.noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s2">1</span><span class="s0">))</span>
        <span class="s0">b0 = </span><span class="s2">0.3</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">cls.y = b0 + b1 * cls.c1 + b2 * cls.c2 + cls.noise</span>
        <span class="s0">cls.y2 = b0 + b1 * cls.c1 + b2 * cls.c2 + cls.o + cls.noise</span>
        <span class="s3"># Italy data from R's np package (the first 50 obs) R&gt;&gt; data (Italy)</span>

        <span class="s0">cls.Italy_gdp = \</span>
            <span class="s0">[</span><span class="s2">8.556</span><span class="s1">, </span><span class="s2">12.262</span><span class="s1">, </span><span class="s2">9.587</span><span class="s1">, </span><span class="s2">8.119</span><span class="s1">, </span><span class="s2">5.537</span><span class="s1">, </span><span class="s2">6.796</span><span class="s1">, </span><span class="s2">8.638</span><span class="s1">,</span>
             <span class="s2">6.483</span><span class="s1">, </span><span class="s2">6.212</span><span class="s1">, </span><span class="s2">5.111</span><span class="s1">, </span><span class="s2">6.001</span><span class="s1">, </span><span class="s2">7.027</span><span class="s1">, </span><span class="s2">4.616</span><span class="s1">, </span><span class="s2">3.922</span><span class="s1">,</span>
             <span class="s2">4.688</span><span class="s1">, </span><span class="s2">3.957</span><span class="s1">, </span><span class="s2">3.159</span><span class="s1">, </span><span class="s2">3.763</span><span class="s1">, </span><span class="s2">3.829</span><span class="s1">, </span><span class="s2">5.242</span><span class="s1">, </span><span class="s2">6.275</span><span class="s1">,</span>
             <span class="s2">8.518</span><span class="s1">, </span><span class="s2">11.542</span><span class="s1">, </span><span class="s2">9.348</span><span class="s1">, </span><span class="s2">8.02</span><span class="s1">, </span><span class="s2">5.527</span><span class="s1">, </span><span class="s2">6.865</span><span class="s1">, </span><span class="s2">8.666</span><span class="s1">,</span>
             <span class="s2">6.672</span><span class="s1">, </span><span class="s2">6.289</span><span class="s1">, </span><span class="s2">5.286</span><span class="s1">, </span><span class="s2">6.271</span><span class="s1">, </span><span class="s2">7.94</span><span class="s1">, </span><span class="s2">4.72</span><span class="s1">, </span><span class="s2">4.357</span><span class="s1">,</span>
             <span class="s2">4.672</span><span class="s1">, </span><span class="s2">3.883</span><span class="s1">, </span><span class="s2">3.065</span><span class="s1">, </span><span class="s2">3.489</span><span class="s1">, </span><span class="s2">3.635</span><span class="s1">, </span><span class="s2">5.443</span><span class="s1">, </span><span class="s2">6.302</span><span class="s1">,</span>
             <span class="s2">9.054</span><span class="s1">, </span><span class="s2">12.485</span><span class="s1">, </span><span class="s2">9.896</span><span class="s1">, </span><span class="s2">8.33</span><span class="s1">, </span><span class="s2">6.161</span><span class="s1">, </span><span class="s2">7.055</span><span class="s1">, </span><span class="s2">8.717</span><span class="s1">,</span>
             <span class="s2">6.95</span><span class="s0">]</span>

        <span class="s0">cls.Italy_year = \</span>
            <span class="s0">[</span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">,</span>
             <span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1951</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">,</span>
             <span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">,</span>
             <span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1952</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">,</span>
             <span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s1">, </span><span class="s2">1953</span><span class="s0">]</span>

        <span class="s3"># OECD panel data from NP  R&gt;&gt; data(oecdpanel)</span>
        <span class="s0">cls.growth = \</span>
            <span class="s0">[-</span><span class="s2">0.0017584</span><span class="s1">, </span><span class="s2">0.00740688</span><span class="s1">, </span><span class="s2">0.03424461</span><span class="s1">, </span><span class="s2">0.03848719</span><span class="s1">, </span><span class="s2">0.02932506</span><span class="s1">,</span>
             <span class="s2">0.03769199</span><span class="s1">, </span><span class="s2">0.0466038</span><span class="s1">, </span><span class="s2">0.00199456</span><span class="s1">, </span><span class="s2">0.03679607</span><span class="s1">, </span><span class="s2">0.01917304</span><span class="s1">,</span>
             <span class="s0">-</span><span class="s2">0.00221</span><span class="s1">, </span><span class="s2">0.00787269</span><span class="s1">, </span><span class="s2">0.03441118</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.0109228</span><span class="s1">, </span><span class="s2">0.02043064</span><span class="s1">,</span>
             <span class="s0">-</span><span class="s2">0.0307962</span><span class="s1">, </span><span class="s2">0.02008947</span><span class="s1">, </span><span class="s2">0.00580313</span><span class="s1">, </span><span class="s2">0.00344502</span><span class="s1">, </span><span class="s2">0.04706358</span><span class="s1">,</span>
             <span class="s2">0.03585851</span><span class="s1">, </span><span class="s2">0.01464953</span><span class="s1">, </span><span class="s2">0.04525762</span><span class="s1">, </span><span class="s2">0.04109222</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.0087903</span><span class="s1">,</span>
             <span class="s2">0.04087915</span><span class="s1">, </span><span class="s2">0.04551403</span><span class="s1">, </span><span class="s2">0.036916</span><span class="s1">, </span><span class="s2">0.00369293</span><span class="s1">, </span><span class="s2">0.0718669</span><span class="s1">,</span>
             <span class="s2">0.02577732</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.0130759</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.01656641</span><span class="s1">, </span><span class="s2">0.00676429</span><span class="s1">, </span><span class="s2">0.08833017</span><span class="s1">,</span>
             <span class="s2">0.05092105</span><span class="s1">, </span><span class="s2">0.02005877</span><span class="s1">, </span><span class="s2">0.00183858</span><span class="s1">, </span><span class="s2">0.03903173</span><span class="s1">, </span><span class="s2">0.05832116</span><span class="s1">,</span>
             <span class="s2">0.0494571</span><span class="s1">, </span><span class="s2">0.02078484</span><span class="s1">, </span><span class="s2">0.09213897</span><span class="s1">, </span><span class="s2">0.0070534</span><span class="s1">, </span><span class="s2">0.08677202</span><span class="s1">,</span>
             <span class="s2">0.06830603</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.00041</span><span class="s1">, </span><span class="s2">0.0002856</span><span class="s1">, </span><span class="s2">0.03421225</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.0036825</span><span class="s0">]</span>

        <span class="s0">cls.oecd = \</span>
            <span class="s0">[</span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">,</span>
             <span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">,</span>
             <span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s1">, </span><span class="s2">0</span><span class="s0">]</span>

    <span class="s1">def </span><span class="s0">write2file(self</span><span class="s1">, </span><span class="s0">file_name</span><span class="s1">, </span><span class="s0">data):  </span><span class="s3"># pragma: no cover</span>
        <span class="s4">&quot;&quot;&quot;Write some data to a csv file.  Only use for debugging!&quot;&quot;&quot;</span>
        <span class="s1">import </span><span class="s0">csv</span>

        <span class="s0">data_file = csv.writer(open(file_name</span><span class="s1">, </span><span class="s5">&quot;w&quot;</span><span class="s1">, </span><span class="s0">encoding=</span><span class="s5">&quot;utf-8&quot;</span><span class="s0">))</span>
        <span class="s0">data = np.column_stack(data)</span>
        <span class="s0">nobs = max(np.shape(data))</span>
        <span class="s0">K = min(np.shape(data))</span>
        <span class="s0">data = np.reshape(data</span><span class="s1">, </span><span class="s0">(nobs</span><span class="s1">,</span><span class="s0">K))</span>
        <span class="s1">for </span><span class="s0">i </span><span class="s1">in </span><span class="s0">range(nobs):</span>
            <span class="s0">data_file.writerow(list(data[i</span><span class="s1">, </span><span class="s0">:]))</span>


<span class="s1">class </span><span class="s0">TestKernelReg(KernelRegressionTestBase):</span>
    <span class="s1">def </span><span class="s0">test_ordered_lc_cvls(self):</span>
        <span class="s0">model = nparam.KernelReg(endog=[self.Italy_gdp]</span><span class="s1">,</span>
                                 <span class="s0">exog=[self.Italy_year]</span><span class="s1">, </span><span class="s0">reg_type=</span><span class="s5">'lc'</span><span class="s1">,</span>
                                 <span class="s0">var_type=</span><span class="s5">'o'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s0">)</span>
        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">R_bw = </span><span class="s2">0.1390096</span>

        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">sm_mfx = sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">R_mean = </span><span class="s2">6.190486</span>

        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s0">R_R2 = </span><span class="s2">0.1435323</span>

        <span class="s3">## CODE TO REPRODUCE IN R</span>
        <span class="s3">## library(np)</span>
        <span class="s3">## data(Italy)</span>
        <span class="s3">## attach(Italy)</span>
        <span class="s3">## bw &lt;- npregbw(formula=gdp[1:50]~ordered(year[1:50]))</span>
        <span class="s0">npt.assert_allclose(sm_bw</span><span class="s1">, </span><span class="s0">R_bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">R_mean</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_R2</span><span class="s1">, </span><span class="s0">R_R2</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_continuousdata_lc_cvls(self):</span>
        <span class="s0">model = nparam.KernelReg(endog=[self.y]</span><span class="s1">, </span><span class="s0">exog=[self.c1</span><span class="s1">, </span><span class="s0">self.c2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'lc'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s0">)</span>
        <span class="s3"># Bandwidth</span>
        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">R_bw = [</span><span class="s2">0.6163835</span><span class="s1">, </span><span class="s2">0.1649656</span><span class="s0">]</span>
        <span class="s3"># Conditional Mean</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">sm_mfx = sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">R_mean = [</span><span class="s2">31.49157</span><span class="s1">, </span><span class="s2">37.29536</span><span class="s1">, </span><span class="s2">43.72332</span><span class="s1">, </span><span class="s2">40.58997</span><span class="s1">, </span><span class="s2">36.80711</span><span class="s0">]</span>
        <span class="s3"># R-Squared</span>
        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s0">R_R2 = </span><span class="s2">0.956381720885</span>

        <span class="s0">npt.assert_allclose(sm_bw</span><span class="s1">, </span><span class="s0">R_bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">R_mean</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_R2</span><span class="s1">, </span><span class="s0">R_R2</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_continuousdata_ll_cvls(self):</span>
        <span class="s0">model = nparam.KernelReg(endog=[self.y]</span><span class="s1">, </span><span class="s0">exog=[self.c1</span><span class="s1">, </span><span class="s0">self.c2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s0">)</span>

        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">R_bw = [</span><span class="s2">1.717891</span><span class="s1">, </span><span class="s2">2.449415</span><span class="s0">]</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">sm_mfx = sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">R_mean = [</span><span class="s2">31.16003</span><span class="s1">, </span><span class="s2">37.30323</span><span class="s1">, </span><span class="s2">44.49870</span><span class="s1">, </span><span class="s2">40.73704</span><span class="s1">, </span><span class="s2">36.19083</span><span class="s0">]</span>

        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s0">R_R2 = </span><span class="s2">0.9336019</span>

        <span class="s0">npt.assert_allclose(sm_bw</span><span class="s1">, </span><span class="s0">R_bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">R_mean</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_R2</span><span class="s1">, </span><span class="s0">R_R2</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_continuous_mfx_ll_cvls(self</span><span class="s1">, </span><span class="s0">file_name=</span><span class="s5">'RegData.csv'</span><span class="s0">):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C3 = np.random.beta(</span><span class="s2">0.5</span><span class="s1">,</span><span class="s2">0.2</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">b0 = </span><span class="s2">3</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">b3 = </span><span class="s2">2.3</span>
        <span class="s0">Y = b0+ b1 * C1 + b2*C2+ b3 * C3 + noise</span>
        <span class="s0">bw_cv_ls = np.array([</span><span class="s2">0.96075</span><span class="s1">, </span><span class="s2">0.5682</span><span class="s1">, </span><span class="s2">0.29835</span><span class="s0">])</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2</span><span class="s1">, </span><span class="s0">C3]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'ccc'</span><span class="s1">, </span><span class="s0">bw=bw_cv_ls)</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">npt.assert_allclose(sm_mfx[</span><span class="s2">0</span><span class="s1">,</span><span class="s0">:]</span><span class="s1">, </span><span class="s0">[b1</span><span class="s1">,</span><span class="s0">b2</span><span class="s1">,</span><span class="s0">b3]</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">2e-1</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_mixed_mfx_ll_cvls(self</span><span class="s1">, </span><span class="s0">file_name=</span><span class="s5">'RegData.csv'</span><span class="s0">):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">ovals = np.random.binomial(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">0.5</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">b0 = </span><span class="s2">3</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">b3 = </span><span class="s2">2.3</span>
        <span class="s0">Y = b0+ b1 * C1 + b2*C2+ b3 * ovals + noise</span>
        <span class="s0">bw_cv_ls = np.array([</span><span class="s2">1.04726</span><span class="s1">, </span><span class="s2">1.67485</span><span class="s1">, </span><span class="s2">0.39852</span><span class="s0">])</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2</span><span class="s1">, </span><span class="s0">ovals]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cco'</span><span class="s1">, </span><span class="s0">bw=bw_cv_ls)</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s3"># TODO: add expected result</span>
        <span class="s0">sm_R2 = model.r_squared()  </span><span class="s3"># noqa: F841</span>
        <span class="s0">npt.assert_allclose(sm_mfx[</span><span class="s2">0</span><span class="s1">, </span><span class="s0">:]</span><span class="s1">, </span><span class="s0">[b1</span><span class="s1">, </span><span class="s0">b2</span><span class="s1">, </span><span class="s0">b3]</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">2e-1</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s0">@pytest.mark.xfail(reason=</span><span class="s5">&quot;Test does not make much sense - always passes &quot;</span>
                              <span class="s5">&quot;with very small bw.&quot;</span><span class="s0">)</span>
    <span class="s1">def </span><span class="s0">test_mfx_nonlinear_ll_cvls(self</span><span class="s1">, </span><span class="s0">file_name=</span><span class="s5">'RegData.csv'</span><span class="s0">):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">C3 = np.random.beta(</span><span class="s2">0.5</span><span class="s1">,</span><span class="s2">0.2</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">b0 = </span><span class="s2">3</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b3 = </span><span class="s2">2.3</span>
        <span class="s0">Y = b0+ b1 * C1 * C2 + b3 * C3 + noise</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2</span><span class="s1">, </span><span class="s0">C3]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'ccc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s0">)</span>
        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s3"># Theoretical marginal effects</span>
        <span class="s0">mfx1 = b1 * C2</span>
        <span class="s0">mfx2 = b1 * C1</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">Y</span><span class="s1">, </span><span class="s0">rtol = </span><span class="s2">2e-1</span><span class="s0">)</span>

        <span class="s0">npt.assert_allclose(sm_mfx[:</span><span class="s1">, </span><span class="s2">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">mfx1</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">2e-1</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">10</span><span class="s1">, </span><span class="s2">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">mfx2[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">10</span><span class="s0">]</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">2e-1</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s1">def </span><span class="s0">test_continuous_cvls_efficient(self):</span>
        <span class="s0">nobs = </span><span class="s2">500</span>
        <span class="s0">np.random.seed(</span><span class="s2">12345</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">b0 = </span><span class="s2">3</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">Y = b0+ b1 * C1 + b2*C2</span>

        <span class="s0">model_efficient = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1]</span><span class="s1">, </span><span class="s0">reg_type=</span><span class="s5">'lc'</span><span class="s1">,</span>
                              <span class="s0">var_type=</span><span class="s5">'c'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">,</span>
                              <span class="s0">defaults=nparam.EstimatorSettings(efficient=</span><span class="s1">True,</span>
                                                                <span class="s0">n_sub=</span><span class="s2">100</span><span class="s0">))</span>

        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1]</span><span class="s1">, </span><span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">,</span>
                                 <span class="s0">var_type=</span><span class="s5">'c'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(model.bw</span><span class="s1">, </span><span class="s0">model_efficient.bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">5e-2</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">1e-1</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s1">def </span><span class="s0">test_censored_ll_cvls(self):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">Y = </span><span class="s2">0.3 </span><span class="s0">+</span><span class="s2">1.2 </span><span class="s0">* C1 - </span><span class="s2">0.9 </span><span class="s0">* C2 + noise</span>
        <span class="s0">Y[Y&gt;</span><span class="s2">0</span><span class="s0">] = </span><span class="s2">0  </span><span class="s3"># censor the data</span>
        <span class="s0">model = nparam.KernelCensoredReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2]</span><span class="s1">,</span>
                                         <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">,</span>
                                         <span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">, </span><span class="s0">censor_val=</span><span class="s2">0</span><span class="s0">)</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">npt.assert_allclose(sm_mfx[</span><span class="s2">0</span><span class="s1">,</span><span class="s0">:]</span><span class="s1">, </span><span class="s0">[</span><span class="s2">1.2</span><span class="s1">, </span><span class="s0">-</span><span class="s2">0.9</span><span class="s0">]</span><span class="s1">, </span><span class="s0">rtol = </span><span class="s2">2e-1</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s1">def </span><span class="s0">test_continuous_lc_aic(self):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">Y = </span><span class="s2">0.3 </span><span class="s0">+</span><span class="s2">1.2 </span><span class="s0">* C1 - </span><span class="s2">0.9 </span><span class="s0">* C2 + noise</span>
        <span class="s3">#self.write2file('RegData.csv', (Y, C1, C2))</span>

        <span class="s3">#CODE TO PRODUCE BANDWIDTH ESTIMATION IN R</span>
        <span class="s3">#library(np)</span>
        <span class="s3">#data &lt;- read.csv('RegData.csv', header=FALSE)</span>
        <span class="s3">#bw &lt;- npregbw(formula=data$V1 ~ data$V2 + data$V3,</span>
        <span class="s3">#                bwmethod='cv.aic', regtype='lc')</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'lc'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'aic'</span><span class="s0">)</span>
        <span class="s3">#R_bw = [0.4017893, 0.4943397]  # Bandwidth obtained in R</span>
        <span class="s0">bw_expected = [</span><span class="s2">0.3987821</span><span class="s1">, </span><span class="s2">0.50933458</span><span class="s0">]</span>
        <span class="s0">npt.assert_allclose(model.bw</span><span class="s1">, </span><span class="s0">bw_expected</span><span class="s1">, </span><span class="s0">rtol=</span><span class="s2">1e-3</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s1">def </span><span class="s0">test_significance_continuous(self):</span>
        <span class="s0">nobs = </span><span class="s2">250</span>
        <span class="s0">np.random.seed(</span><span class="s2">12345</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C3 = np.random.beta(</span><span class="s2">0.5</span><span class="s1">,</span><span class="s2">0.2</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">Y = b1 * C1 + b2 * C2 + noise</span>

        <span class="s3"># This is the cv_ls bandwidth estimated earlier</span>
        <span class="s0">bw=[</span><span class="s2">11108137.1087194</span><span class="s1">, </span><span class="s2">1333821.85150218</span><span class="s0">]</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C3]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=bw)</span>
        <span class="s0">nboot = </span><span class="s2">45  </span><span class="s3"># Number of bootstrap samples</span>
        <span class="s0">sig_var12 = model.sig_test([</span><span class="s2">0</span><span class="s1">,</span><span class="s2">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">nboot=nboot)  </span><span class="s3"># H0: b1 = 0 and b2 = 0</span>
        <span class="s0">npt.assert_equal(sig_var12 == </span><span class="s5">'Not Significant'</span><span class="s1">, False</span><span class="s0">)</span>
        <span class="s0">sig_var1 = model.sig_test([</span><span class="s2">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">nboot=nboot)  </span><span class="s3"># H0: b1 = 0</span>
        <span class="s0">npt.assert_equal(sig_var1 == </span><span class="s5">'Not Significant'</span><span class="s1">, False</span><span class="s0">)</span>
        <span class="s0">sig_var2 = model.sig_test([</span><span class="s2">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">nboot=nboot)  </span><span class="s3"># H0: b2 = 0</span>
        <span class="s0">npt.assert_equal(sig_var2 == </span><span class="s5">'Not Significant'</span><span class="s1">, True</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.slow</span>
    <span class="s1">def </span><span class="s0">test_significance_discrete(self):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">12345</span><span class="s0">)</span>
        <span class="s0">ovals = np.random.binomial(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">0.5</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C3 = np.random.beta(</span><span class="s2">0.5</span><span class="s1">,</span><span class="s2">0.2</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">,</span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">b1 = </span><span class="s2">1.2</span>
        <span class="s0">b2 = </span><span class="s2">3.7  </span><span class="s3"># regression coefficients</span>
        <span class="s0">Y = b1 * ovals + b2 * C2 + noise</span>

        <span class="s0">bw= [</span><span class="s2">3.63473198e+00</span><span class="s1">, </span><span class="s2">1.21404803e+06</span><span class="s0">]</span>
        <span class="s3"># This is the cv_ls bandwidth estimated earlier</span>
        <span class="s3"># The cv_ls bandwidth was estimated earlier to save time</span>
        <span class="s0">model = nparam.KernelReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[ovals</span><span class="s1">, </span><span class="s0">C3]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'oc'</span><span class="s1">, </span><span class="s0">bw=bw)</span>
        <span class="s3"># This was also tested with local constant estimator</span>
        <span class="s0">nboot = </span><span class="s2">45  </span><span class="s3"># Number of bootstrap samples</span>
        <span class="s0">sig_var1 = model.sig_test([</span><span class="s2">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">nboot=nboot)  </span><span class="s3"># H0: b1 = 0</span>
        <span class="s0">npt.assert_equal(sig_var1 == </span><span class="s5">'Not Significant'</span><span class="s1">, False</span><span class="s0">)</span>
        <span class="s0">sig_var2 = model.sig_test([</span><span class="s2">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">nboot=nboot)  </span><span class="s3"># H0: b2 = 0</span>
        <span class="s0">npt.assert_equal(sig_var2 == </span><span class="s5">'Not Significant'</span><span class="s1">, True</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_user_specified_kernel(self):</span>
        <span class="s0">model = nparam.KernelReg(endog=[self.y]</span><span class="s1">, </span><span class="s0">exog=[self.c1</span><span class="s1">, </span><span class="s0">self.c2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">,</span>
                                 <span class="s0">ckertype=</span><span class="s5">'tricube'</span><span class="s0">)</span>
        <span class="s3"># Bandwidth</span>
        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">R_bw = [</span><span class="s2">0.581663</span><span class="s1">, </span><span class="s2">0.5652</span><span class="s0">]</span>
        <span class="s3"># Conditional Mean</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">sm_mfx = sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">R_mean = [</span><span class="s2">30.926714</span><span class="s1">, </span><span class="s2">36.994604</span><span class="s1">, </span><span class="s2">44.438358</span><span class="s1">, </span><span class="s2">40.680598</span><span class="s1">, </span><span class="s2">35.961593</span><span class="s0">]</span>
        <span class="s3"># R-Squared</span>
        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s0">R_R2 = </span><span class="s2">0.934825</span>

        <span class="s0">npt.assert_allclose(sm_bw</span><span class="s1">, </span><span class="s0">R_bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">R_mean</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_R2</span><span class="s1">, </span><span class="s0">R_R2</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_censored_user_specified_kernel(self):</span>
        <span class="s0">model = nparam.KernelCensoredReg(endog=[self.y]</span><span class="s1">, </span><span class="s0">exog=[self.c1</span><span class="s1">, </span><span class="s0">self.c2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">,</span>
                                 <span class="s0">censor_val=</span><span class="s2">0</span><span class="s1">, </span><span class="s0">ckertype=</span><span class="s5">'tricube'</span><span class="s0">)</span>
        <span class="s3"># Bandwidth</span>
        <span class="s0">sm_bw = model.bw</span>
        <span class="s0">R_bw = [</span><span class="s2">0.581663</span><span class="s1">, </span><span class="s2">0.5652</span><span class="s0">]</span>
        <span class="s3"># Conditional Mean</span>
        <span class="s0">sm_mean</span><span class="s1">, </span><span class="s0">sm_mfx = model.fit()</span>
        <span class="s0">sm_mean = sm_mean[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">sm_mfx = sm_mfx[</span><span class="s2">0</span><span class="s0">:</span><span class="s2">5</span><span class="s0">]</span>
        <span class="s0">R_mean = [</span><span class="s2">29.205526</span><span class="s1">, </span><span class="s2">29.538008</span><span class="s1">, </span><span class="s2">31.667581</span><span class="s1">, </span><span class="s2">31.978866</span><span class="s1">, </span><span class="s2">30.926714</span><span class="s0">]</span>
        <span class="s3"># R-Squared</span>
        <span class="s0">sm_R2 = model.r_squared()</span>
        <span class="s0">R_R2 = </span><span class="s2">0.934825</span>

        <span class="s0">npt.assert_allclose(sm_bw</span><span class="s1">, </span><span class="s0">R_bw</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_mean</span><span class="s1">, </span><span class="s0">R_mean</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>
        <span class="s0">npt.assert_allclose(sm_R2</span><span class="s1">, </span><span class="s0">R_R2</span><span class="s1">, </span><span class="s0">atol=</span><span class="s2">1e-2</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_efficient_user_specificed_bw(self):</span>

        <span class="s0">bw_user=[</span><span class="s2">0.23</span><span class="s1">, </span><span class="s2">434697.22</span><span class="s0">]</span>
        <span class="s0">model = nparam.KernelReg(endog=[self.y]</span><span class="s1">, </span><span class="s0">exog=[self.c1</span><span class="s1">, </span><span class="s0">self.c2]</span><span class="s1">,</span>
                                 <span class="s0">reg_type=</span><span class="s5">'lc'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=bw_user</span><span class="s1">,</span>
                                 <span class="s0">defaults=nparam.EstimatorSettings(efficient=</span><span class="s1">True</span><span class="s0">))</span>
        <span class="s3"># Bandwidth</span>
        <span class="s0">npt.assert_equal(model.bw</span><span class="s1">, </span><span class="s0">bw_user)</span>

    <span class="s1">def </span><span class="s0">test_censored_efficient_user_specificed_bw(self):</span>
        <span class="s0">nobs = </span><span class="s2">200</span>
        <span class="s0">np.random.seed(</span><span class="s2">1234</span><span class="s0">)</span>
        <span class="s0">C1 = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">C2 = np.random.normal(</span><span class="s2">2</span><span class="s1">, </span><span class="s2">1</span><span class="s1">, </span><span class="s0">size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">noise = np.random.normal(size=(nobs</span><span class="s1">, </span><span class="s0">))</span>
        <span class="s0">Y = </span><span class="s2">0.3 </span><span class="s0">+</span><span class="s2">1.2 </span><span class="s0">* C1 - </span><span class="s2">0.9 </span><span class="s0">* C2 + noise</span>
        <span class="s0">Y[Y&gt;</span><span class="s2">0</span><span class="s0">] = </span><span class="s2">0  </span><span class="s3"># censor the data</span>

        <span class="s0">bw_user=[</span><span class="s2">0.23</span><span class="s1">, </span><span class="s2">434697.22</span><span class="s0">]</span>
        <span class="s0">model = nparam.KernelCensoredReg(endog=[Y]</span><span class="s1">, </span><span class="s0">exog=[C1</span><span class="s1">, </span><span class="s0">C2]</span><span class="s1">,</span>
                                         <span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">,</span>
                                         <span class="s0">bw=bw_user</span><span class="s1">, </span><span class="s0">censor_val=</span><span class="s2">0</span><span class="s1">,</span>
                                 <span class="s0">defaults=nparam.EstimatorSettings(efficient=</span><span class="s1">True</span><span class="s0">))</span>
        <span class="s3"># Bandwidth</span>
        <span class="s0">npt.assert_equal(model.bw</span><span class="s1">, </span><span class="s0">bw_user)</span>


<span class="s1">def </span><span class="s0">test_invalid_bw():</span>
    <span class="s3"># GH4873</span>
    <span class="s0">x = np.arange(</span><span class="s2">400</span><span class="s0">)</span>
    <span class="s0">y = x ** </span><span class="s2">2</span>
    <span class="s1">with </span><span class="s0">pytest.raises(ValueError):</span>
        <span class="s0">nparam.KernelReg(x</span><span class="s1">, </span><span class="s0">y</span><span class="s1">, </span><span class="s5">'c'</span><span class="s1">, </span><span class="s0">bw=[</span><span class="s2">12.5</span><span class="s1">, </span><span class="s2">1.</span><span class="s0">])</span>


<span class="s1">def </span><span class="s0">test_invalid_kernel():</span>
    <span class="s0">x = np.arange(</span><span class="s2">400</span><span class="s0">)</span>
    <span class="s0">y = x ** </span><span class="s2">2</span>
    <span class="s3"># silverman kernel is not currently in statsmodels kernel library</span>
    <span class="s1">with </span><span class="s0">pytest.raises(ValueError):</span>
        <span class="s0">nparam.KernelReg(x</span><span class="s1">, </span><span class="s0">y</span><span class="s1">, </span><span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">,</span>
                         <span class="s0">ckertype=</span><span class="s5">'silverman'</span><span class="s0">)</span>

    <span class="s1">with </span><span class="s0">pytest.raises(ValueError):</span>
        <span class="s0">nparam.KernelCensoredReg(x</span><span class="s1">, </span><span class="s0">y</span><span class="s1">, </span><span class="s0">reg_type=</span><span class="s5">'ll'</span><span class="s1">, </span><span class="s0">var_type=</span><span class="s5">'cc'</span><span class="s1">, </span><span class="s0">bw=</span><span class="s5">'cv_ls'</span><span class="s1">,</span>
                                 <span class="s0">censor_val=</span><span class="s2">0</span><span class="s1">, </span><span class="s0">ckertype=</span><span class="s5">'silverman'</span><span class="s0">)</span>
</pre>
</body>
</html>
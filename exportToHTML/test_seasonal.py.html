<html>
<head>
<title>test_seasonal.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_seasonal.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_allclose</span><span class="s0">,</span>
    <span class="s1">assert_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_equal</span><span class="s0">,</span>
    <span class="s1">assert_raises</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">statsmodels.tsa.seasonal </span><span class="s0">import </span><span class="s1">seasonal_decompose</span>

<span class="s2"># Verification values for tests</span>
<span class="s1">SEASONAL = [</span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s0">,</span>
            <span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">60.25</span><span class="s0">, </span><span class="s3">62.46</span><span class="s0">, </span><span class="s3">86.17</span><span class="s0">, </span><span class="s1">-</span><span class="s3">88.38</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.25</span><span class="s1">]</span>
<span class="s1">TREND = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">159.12</span><span class="s0">, </span><span class="s3">204.00</span><span class="s0">, </span><span class="s3">221.25</span><span class="s0">, </span><span class="s3">245.12</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">,</span>
         <span class="s3">451.50</span><span class="s0">, </span><span class="s3">561.12</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">, </span><span class="s3">615.62</span><span class="s0">, </span><span class="s3">548.00</span><span class="s0">, </span><span class="s3">462.12</span><span class="s0">, </span><span class="s3">381.12</span><span class="s0">,</span>
         <span class="s3">316.62</span><span class="s0">, </span><span class="s3">264.00</span><span class="s0">, </span><span class="s3">228.38</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.38</span><span class="s0">, </span><span class="s3">199.00</span><span class="s0">, </span><span class="s3">207.12</span><span class="s0">,</span>
         <span class="s3">191.00</span><span class="s0">, </span><span class="s3">166.88</span><span class="s0">, </span><span class="s3">72.00</span><span class="s0">, </span><span class="s1">-</span><span class="s3">9.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.12</span><span class="s0">, </span><span class="s1">-</span><span class="s3">36.75</span><span class="s0">, </span><span class="s3">36.25</span><span class="s0">,</span>
         <span class="s3">103.00</span><span class="s0">, </span><span class="s3">131.62</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
<span class="s1">RANDOM = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">78.254</span><span class="s0">, </span><span class="s3">70.254</span><span class="s0">, </span><span class="s1">-</span><span class="s3">36.710</span><span class="s0">, </span><span class="s1">-</span><span class="s3">94.299</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6.371</span><span class="s0">,</span>
          <span class="s1">-</span><span class="s3">62.246</span><span class="s0">, </span><span class="s3">105.415</span><span class="s0">, </span><span class="s3">103.576</span><span class="s0">, </span><span class="s3">2.754</span><span class="s0">, </span><span class="s3">1.254</span><span class="s0">, </span><span class="s3">15.415</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.299</span><span class="s0">,</span>
          <span class="s1">-</span><span class="s3">33.246</span><span class="s0">, </span><span class="s1">-</span><span class="s3">27.746</span><span class="s0">, </span><span class="s3">46.165</span><span class="s0">, </span><span class="s1">-</span><span class="s3">57.924</span><span class="s0">, </span><span class="s3">28.004</span><span class="s0">, </span><span class="s1">-</span><span class="s3">36.746</span><span class="s0">,</span>
          <span class="s1">-</span><span class="s3">37.585</span><span class="s0">, </span><span class="s3">151.826</span><span class="s0">, </span><span class="s1">-</span><span class="s3">75.496</span><span class="s0">, </span><span class="s3">86.254</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.210</span><span class="s0">, </span><span class="s1">-</span><span class="s3">194.049</span><span class="s0">,</span>
          <span class="s3">48.129</span><span class="s0">, </span><span class="s3">11.004</span><span class="s0">, </span><span class="s1">-</span><span class="s3">40.460</span><span class="s0">, </span><span class="s3">143.201</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>

<span class="s1">MULT_SEASONAL = [</span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">,</span>
                 <span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">,</span>
                 <span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">,</span>
                 <span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">, </span><span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s0">,</span>
                 <span class="s3">1.0815</span><span class="s0">, </span><span class="s3">1.5538</span><span class="s0">, </span><span class="s3">0.6716</span><span class="s0">, </span><span class="s3">0.6931</span><span class="s1">]</span>
<span class="s1">MULT_TREND = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">171.62</span><span class="s0">, </span><span class="s3">204.00</span><span class="s0">, </span><span class="s3">221.25</span><span class="s0">, </span><span class="s3">245.12</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">,</span>
              <span class="s3">451.50</span><span class="s0">, </span><span class="s3">561.12</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">, </span><span class="s3">615.62</span><span class="s0">, </span><span class="s3">548.00</span><span class="s0">, </span><span class="s3">462.12</span><span class="s0">, </span><span class="s3">381.12</span><span class="s0">,</span>
              <span class="s3">316.62</span><span class="s0">, </span><span class="s3">264.00</span><span class="s0">, </span><span class="s3">228.38</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.38</span><span class="s0">, </span><span class="s3">199.00</span><span class="s0">, </span><span class="s3">207.12</span><span class="s0">,</span>
              <span class="s3">191.00</span><span class="s0">, </span><span class="s3">166.88</span><span class="s0">, </span><span class="s3">107.25</span><span class="s0">, </span><span class="s3">80.50</span><span class="s0">, </span><span class="s3">79.12</span><span class="s0">, </span><span class="s3">78.75</span><span class="s0">, </span><span class="s3">116.50</span><span class="s0">,</span>
              <span class="s3">140.00</span><span class="s0">, </span><span class="s3">157.38</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
<span class="s1">MULT_RANDOM = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">1.29263</span><span class="s0">, </span><span class="s3">1.51360</span><span class="s0">, </span><span class="s3">1.03223</span><span class="s0">, </span><span class="s3">0.62226</span><span class="s0">,</span>
               <span class="s3">1.04771</span><span class="s0">, </span><span class="s3">1.05139</span><span class="s0">, </span><span class="s3">1.20124</span><span class="s0">, </span><span class="s3">0.84080</span><span class="s0">, </span><span class="s3">1.28182</span><span class="s0">, </span><span class="s3">1.28752</span><span class="s0">,</span>
               <span class="s3">1.08043</span><span class="s0">, </span><span class="s3">0.77172</span><span class="s0">, </span><span class="s3">0.91697</span><span class="s0">, </span><span class="s3">0.96191</span><span class="s0">, </span><span class="s3">1.36441</span><span class="s0">, </span><span class="s3">0.72986</span><span class="s0">,</span>
               <span class="s3">1.01171</span><span class="s0">, </span><span class="s3">0.73956</span><span class="s0">, </span><span class="s3">1.03566</span><span class="s0">, </span><span class="s3">1.44556</span><span class="s0">, </span><span class="s3">0.02677</span><span class="s0">, </span><span class="s3">1.31843</span><span class="s0">,</span>
               <span class="s3">0.49390</span><span class="s0">, </span><span class="s3">1.14688</span><span class="s0">, </span><span class="s3">1.45582</span><span class="s0">, </span><span class="s3">0.16101</span><span class="s0">, </span><span class="s3">0.82555</span><span class="s0">, </span><span class="s3">1.47633</span><span class="s0">,</span>
               <span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>


<span class="s0">class </span><span class="s1">TestDecompose:</span>
    <span class="s1">@classmethod</span>
    <span class="s0">def </span><span class="s1">setup_class(cls):</span>
        <span class="s2"># even</span>
        <span class="s1">data = [-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">175</span><span class="s0">, </span><span class="s3">149</span><span class="s0">, </span><span class="s3">214</span><span class="s0">, </span><span class="s3">247</span><span class="s0">, </span><span class="s3">237</span><span class="s0">, </span><span class="s3">225</span><span class="s0">, </span><span class="s3">329</span><span class="s0">, </span><span class="s3">729</span><span class="s0">, </span><span class="s3">809</span><span class="s0">,</span>
                <span class="s3">530</span><span class="s0">, </span><span class="s3">489</span><span class="s0">, </span><span class="s3">540</span><span class="s0">, </span><span class="s3">457</span><span class="s0">, </span><span class="s3">195</span><span class="s0">, </span><span class="s3">176</span><span class="s0">, </span><span class="s3">337</span><span class="s0">, </span><span class="s3">239</span><span class="s0">, </span><span class="s3">128</span><span class="s0">, </span><span class="s3">102</span><span class="s0">,</span>
                <span class="s3">232</span><span class="s0">, </span><span class="s3">429</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">98</span><span class="s0">, </span><span class="s3">43</span><span class="s0">, </span><span class="s1">-</span><span class="s3">141</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77</span><span class="s0">, </span><span class="s1">-</span><span class="s3">13</span><span class="s0">, </span><span class="s3">125</span><span class="s0">, </span><span class="s3">361</span><span class="s0">, </span><span class="s1">-</span><span class="s3">45</span><span class="s0">, </span><span class="s3">184</span><span class="s1">]</span>
        <span class="s1">cls.data = pd.DataFrame(data</span><span class="s0">, </span><span class="s1">pd.date_range(start=</span><span class="s4">'1/1/1951'</span><span class="s0">,</span>
                                                    <span class="s1">periods=len(data)</span><span class="s0">,</span>
                                                    <span class="s1">freq=</span><span class="s4">'Q'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_ndarray(self):</span>
        <span class="s1">res_add = seasonal_decompose(self.data.values</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.seasonal</span><span class="s0">, </span><span class="s1">SEASONAL</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend</span><span class="s0">, </span><span class="s1">TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid</span><span class="s0">, </span><span class="s1">RANDOM</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">res_mult = seasonal_decompose(np.abs(self.data.values)</span><span class="s0">, </span><span class="s4">'m'</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(res_mult.seasonal</span><span class="s0">, </span><span class="s1">MULT_SEASONAL</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.trend</span><span class="s0">, </span><span class="s1">MULT_TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.resid</span><span class="s0">, </span><span class="s1">MULT_RANDOM</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

        <span class="s2"># test odd</span>
        <span class="s1">res_add = seasonal_decompose(self.data.values[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">seasonal = [</span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">,</span>
                    <span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">,</span>
                    <span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">,</span>
                    <span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">, </span><span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s0">, </span><span class="s1">-</span><span class="s3">54.54</span><span class="s0">,</span>
                    <span class="s3">68.18</span><span class="s0">, </span><span class="s3">69.02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">82.66</span><span class="s1">]</span>
        <span class="s1">trend = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">159.12</span><span class="s0">, </span><span class="s3">204.00</span><span class="s0">, </span><span class="s3">221.25</span><span class="s0">, </span><span class="s3">245.12</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">,</span>
                 <span class="s3">451.50</span><span class="s0">, </span><span class="s3">561.12</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">, </span><span class="s3">615.62</span><span class="s0">, </span><span class="s3">548.00</span><span class="s0">, </span><span class="s3">462.12</span><span class="s0">, </span><span class="s3">381.12</span><span class="s0">,</span>
                 <span class="s3">316.62</span><span class="s0">, </span><span class="s3">264.00</span><span class="s0">, </span><span class="s3">228.38</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.38</span><span class="s0">, </span><span class="s3">199.00</span><span class="s0">, </span><span class="s3">207.12</span><span class="s0">,</span>
                 <span class="s3">191.00</span><span class="s0">, </span><span class="s3">166.88</span><span class="s0">, </span><span class="s3">72.00</span><span class="s0">, </span><span class="s1">-</span><span class="s3">9.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.12</span><span class="s0">, </span><span class="s1">-</span><span class="s3">36.75</span><span class="s0">, </span><span class="s3">36.25</span><span class="s0">,</span>
                 <span class="s3">103.00</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
        <span class="s1">random = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">72.538</span><span class="s0">, </span><span class="s3">64.538</span><span class="s0">, </span><span class="s1">-</span><span class="s3">42.426</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77.150</span><span class="s0">,</span>
                  <span class="s1">-</span><span class="s3">12.087</span><span class="s0">, </span><span class="s1">-</span><span class="s3">67.962</span><span class="s0">, </span><span class="s3">99.699</span><span class="s0">, </span><span class="s3">120.725</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.962</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.462</span><span class="s0">,</span>
                  <span class="s3">9.699</span><span class="s0">, </span><span class="s3">6.850</span><span class="s0">, </span><span class="s1">-</span><span class="s3">38.962</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.462</span><span class="s0">, </span><span class="s3">40.449</span><span class="s0">, </span><span class="s1">-</span><span class="s3">40.775</span><span class="s0">, </span><span class="s3">22.288</span><span class="s0">,</span>
                  <span class="s1">-</span><span class="s3">42.462</span><span class="s0">, </span><span class="s1">-</span><span class="s3">43.301</span><span class="s0">, </span><span class="s3">168.975</span><span class="s0">, </span><span class="s1">-</span><span class="s3">81.212</span><span class="s0">, </span><span class="s3">80.538</span><span class="s0">, </span><span class="s1">-</span><span class="s3">15.926</span><span class="s0">,</span>
                  <span class="s1">-</span><span class="s3">176.900</span><span class="s0">, </span><span class="s3">42.413</span><span class="s0">, </span><span class="s3">5.288</span><span class="s0">, </span><span class="s1">-</span><span class="s3">46.176</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
        <span class="s1">assert_almost_equal(res_add.seasonal</span><span class="s0">, </span><span class="s1">seasonal</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend</span><span class="s0">, </span><span class="s1">trend</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid</span><span class="s0">, </span><span class="s1">random</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_pandas(self):</span>
        <span class="s1">res_add = seasonal_decompose(self.data</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">freq_override_data = self.data.copy()</span>
        <span class="s1">freq_override_data.index = pd.date_range(</span>
            <span class="s1">start=</span><span class="s4">'1/1/1951'</span><span class="s0">, </span><span class="s1">periods=len(freq_override_data)</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">'A'</span><span class="s1">)</span>
        <span class="s1">res_add_override = seasonal_decompose(freq_override_data</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>

        <span class="s1">assert_almost_equal(res_add.seasonal.values.squeeze()</span><span class="s0">, </span><span class="s1">SEASONAL</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend.values.squeeze()</span><span class="s0">, </span><span class="s1">TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid.values.squeeze()</span><span class="s0">, </span><span class="s1">RANDOM</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add_override.seasonal.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">SEASONAL</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add_override.trend.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add_override.resid.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">RANDOM</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_equal(res_add.seasonal.index.values.squeeze()</span><span class="s0">,</span>
                     <span class="s1">self.data.index.values)</span>

        <span class="s1">res_mult = seasonal_decompose(np.abs(self.data)</span><span class="s0">, </span><span class="s4">'m'</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">res_mult_override = seasonal_decompose(np.abs(freq_override_data)</span><span class="s0">, </span><span class="s4">'m'</span><span class="s0">,</span>
                                               <span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.seasonal.values.squeeze()</span><span class="s0">, </span><span class="s1">MULT_SEASONAL</span><span class="s0">,</span>
                            <span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.trend.values.squeeze()</span><span class="s0">, </span><span class="s1">MULT_TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.resid.values.squeeze()</span><span class="s0">, </span><span class="s1">MULT_RANDOM</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult_override.seasonal.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">MULT_SEASONAL</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult_override.trend.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">MULT_TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult_override.resid.values.squeeze()</span><span class="s0">,</span>
                            <span class="s1">MULT_RANDOM</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(res_mult.seasonal.index.values.squeeze()</span><span class="s0">,</span>
                     <span class="s1">self.data.index.values)</span>

    <span class="s0">def </span><span class="s1">test_pandas_nofreq(self</span><span class="s0">, </span><span class="s1">reset_randomstate):</span>
        <span class="s2"># issue #3503</span>
        <span class="s1">nobs = </span><span class="s3">100</span>
        <span class="s1">dta = pd.Series([x % </span><span class="s3">3 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(nobs)] + np.random.randn(nobs))</span>
        <span class="s1">res_np = seasonal_decompose(dta.values</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">res = seasonal_decompose(dta</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">atol = </span><span class="s3">1e-8</span>
        <span class="s1">rtol = </span><span class="s3">1e-10</span>
        <span class="s1">assert_allclose(res.seasonal.values.squeeze()</span><span class="s0">, </span><span class="s1">res_np.seasonal</span><span class="s0">,</span>
                        <span class="s1">atol=atol</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>
        <span class="s1">assert_allclose(res.trend.values.squeeze()</span><span class="s0">, </span><span class="s1">res_np.trend</span><span class="s0">,</span>
                        <span class="s1">atol=atol</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>
        <span class="s1">assert_allclose(res.resid.values.squeeze()</span><span class="s0">, </span><span class="s1">res_np.resid</span><span class="s0">,</span>
                        <span class="s1">atol=atol</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

    <span class="s0">def </span><span class="s1">test_filt(self):</span>
        <span class="s1">filt = np.array([</span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">8.</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4.</span><span class="s0">, </span><span class="s3">1. </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4.</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">8.</span><span class="s1">])</span>
        <span class="s1">res_add = seasonal_decompose(self.data.values</span><span class="s0">, </span><span class="s1">filt=filt</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.seasonal</span><span class="s0">, </span><span class="s1">SEASONAL</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend</span><span class="s0">, </span><span class="s1">TREND</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid</span><span class="s0">, </span><span class="s1">RANDOM</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_one_sided_moving_average_in_stl_decompose(self):</span>
        <span class="s1">res_add = seasonal_decompose(self.data.values</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s0">,</span>
                                     <span class="s1">two_sided=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">seasonal = np.array([</span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">,</span>
                             <span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">,</span>
                             <span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">,</span>
                             <span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">, </span><span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s0">,</span>
                             <span class="s3">76.76</span><span class="s0">, </span><span class="s3">90.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">114.4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">52.4</span><span class="s1">])</span>

        <span class="s1">trend = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">159.12</span><span class="s0">, </span><span class="s3">204.</span><span class="s0">, </span><span class="s3">221.25</span><span class="s0">,</span>
                          <span class="s3">245.12</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">, </span><span class="s3">451.5</span><span class="s0">, </span><span class="s3">561.12</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">, </span><span class="s3">615.62</span><span class="s0">, </span><span class="s3">548.</span><span class="s0">,</span>
                          <span class="s3">462.12</span><span class="s0">, </span><span class="s3">381.12</span><span class="s0">, </span><span class="s3">316.62</span><span class="s0">, </span><span class="s3">264.</span><span class="s0">, </span><span class="s3">228.38</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.38</span><span class="s0">,</span>
                          <span class="s3">199.</span><span class="s0">, </span><span class="s3">207.12</span><span class="s0">, </span><span class="s3">191.</span><span class="s0">, </span><span class="s3">166.88</span><span class="s0">, </span><span class="s3">72.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">9.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.12</span><span class="s0">,</span>
                          <span class="s1">-</span><span class="s3">36.75</span><span class="s0">, </span><span class="s3">36.25</span><span class="s0">, </span><span class="s3">103.</span><span class="s0">, </span><span class="s3">131.62</span><span class="s1">])</span>

        <span class="s1">resid = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">11.112</span><span class="s0">, </span><span class="s1">-</span><span class="s3">57.031</span><span class="s0">,</span>
                          <span class="s3">118.147</span><span class="s0">, </span><span class="s3">136.272</span><span class="s0">, </span><span class="s3">332.487</span><span class="s0">, </span><span class="s3">267.469</span><span class="s0">, </span><span class="s3">83.272</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77.853</span><span class="s0">,</span>
                          <span class="s1">-</span><span class="s3">152.388</span><span class="s0">, </span><span class="s1">-</span><span class="s3">181.031</span><span class="s0">, </span><span class="s1">-</span><span class="s3">152.728</span><span class="s0">, </span><span class="s1">-</span><span class="s3">152.728</span><span class="s0">, </span><span class="s1">-</span><span class="s3">56.388</span><span class="s0">,</span>
                          <span class="s1">-</span><span class="s3">115.031</span><span class="s0">, </span><span class="s3">14.022</span><span class="s0">, </span><span class="s1">-</span><span class="s3">56.353</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.138</span><span class="s0">, </span><span class="s3">139.969</span><span class="s0">, </span><span class="s1">-</span><span class="s3">89.728</span><span class="s0">,</span>
                          <span class="s1">-</span><span class="s3">40.603</span><span class="s0">, </span><span class="s1">-</span><span class="s3">200.638</span><span class="s0">, </span><span class="s1">-</span><span class="s3">303.031</span><span class="s0">, </span><span class="s3">46.647</span><span class="s0">, </span><span class="s3">72.522</span><span class="s0">, </span><span class="s3">84.987</span><span class="s0">,</span>
                          <span class="s3">234.719</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.603</span><span class="s0">, </span><span class="s3">104.772</span><span class="s1">])</span>

        <span class="s1">assert_almost_equal(res_add.seasonal</span><span class="s0">, </span><span class="s1">seasonal</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend</span><span class="s0">, </span><span class="s1">trend</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid</span><span class="s0">, </span><span class="s1">resid</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">res_mult = seasonal_decompose(np.abs(self.data.values)</span><span class="s0">, </span><span class="s4">'m'</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s0">,</span>
                                      <span class="s1">two_sided=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">seasonal = np.array([</span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">, </span><span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">, </span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">,</span>
                             <span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">, </span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">, </span><span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">,</span>
                             <span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">, </span><span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">, </span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">,</span>
                             <span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">, </span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">, </span><span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">,</span>
                             <span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">, </span><span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s0">, </span><span class="s3">1.1985</span><span class="s0">, </span><span class="s3">1.5449</span><span class="s0">,</span>
                             <span class="s3">0.5811</span><span class="s0">, </span><span class="s3">0.6755</span><span class="s1">])</span>

        <span class="s1">trend = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">171.625</span><span class="s0">, </span><span class="s3">204.</span><span class="s0">,</span>
                          <span class="s3">221.25</span><span class="s0">, </span><span class="s3">245.125</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">, </span><span class="s3">451.5</span><span class="s0">, </span><span class="s3">561.125</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">,</span>
                          <span class="s3">615.625</span><span class="s0">, </span><span class="s3">548.</span><span class="s0">, </span><span class="s3">462.125</span><span class="s0">, </span><span class="s3">381.125</span><span class="s0">, </span><span class="s3">316.625</span><span class="s0">, </span><span class="s3">264.</span><span class="s0">,</span>
                          <span class="s3">228.375</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.375</span><span class="s0">, </span><span class="s3">199.</span><span class="s0">, </span><span class="s3">207.125</span><span class="s0">, </span><span class="s3">191.</span><span class="s0">,</span>
                          <span class="s3">166.875</span><span class="s0">, </span><span class="s3">107.25</span><span class="s0">, </span><span class="s3">80.5</span><span class="s0">, </span><span class="s3">79.125</span><span class="s0">, </span><span class="s3">78.75</span><span class="s0">, </span><span class="s3">116.5</span><span class="s0">,</span>
                          <span class="s3">140.</span><span class="s0">, </span><span class="s3">157.375</span><span class="s1">])</span>

        <span class="s1">resid = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">1.2008</span><span class="s0">, </span><span class="s3">0.752</span><span class="s0">, </span><span class="s3">1.75</span><span class="s0">,</span>
                          <span class="s3">1.987</span><span class="s0">, </span><span class="s3">1.9023</span><span class="s0">, </span><span class="s3">1.1598</span><span class="s0">, </span><span class="s3">1.6253</span><span class="s0">, </span><span class="s3">1.169</span><span class="s0">, </span><span class="s3">0.7319</span><span class="s0">, </span><span class="s3">0.5398</span><span class="s0">,</span>
                          <span class="s3">0.7261</span><span class="s0">, </span><span class="s3">0.6837</span><span class="s0">, </span><span class="s3">0.888</span><span class="s0">, </span><span class="s3">0.586</span><span class="s0">, </span><span class="s3">0.9645</span><span class="s0">, </span><span class="s3">0.7165</span><span class="s0">, </span><span class="s3">1.0276</span><span class="s0">,</span>
                          <span class="s3">1.3954</span><span class="s0">, </span><span class="s3">0.0249</span><span class="s0">, </span><span class="s3">0.7596</span><span class="s0">, </span><span class="s3">0.215</span><span class="s0">, </span><span class="s3">0.851</span><span class="s0">, </span><span class="s3">1.646</span><span class="s0">, </span><span class="s3">0.2432</span><span class="s0">,</span>
                          <span class="s3">1.3244</span><span class="s0">, </span><span class="s3">2.0058</span><span class="s0">, </span><span class="s3">0.5531</span><span class="s0">, </span><span class="s3">1.7309</span><span class="s1">])</span>

        <span class="s1">assert_almost_equal(res_mult.seasonal</span><span class="s0">, </span><span class="s1">seasonal</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.trend</span><span class="s0">, </span><span class="s1">trend</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_mult.resid</span><span class="s0">, </span><span class="s1">resid</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

        <span class="s2"># test odd</span>
        <span class="s1">res_add = seasonal_decompose(self.data.values[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s0">,</span>
                                     <span class="s1">two_sided=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">seasonal = np.array([</span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">, </span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">,</span>
                             <span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">, </span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">,</span>
                             <span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">, </span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">,</span>
                             <span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">, </span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">,</span>
                             <span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">109.95</span><span class="s0">, </span><span class="s1">-</span><span class="s3">65.74</span><span class="s0">, </span><span class="s3">81.21</span><span class="s0">, </span><span class="s3">94.48</span><span class="s0">,</span>
                             <span class="s1">-</span><span class="s3">109.95</span><span class="s1">])</span>

        <span class="s1">trend = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">159.12</span><span class="s0">, </span><span class="s3">204.</span><span class="s0">, </span><span class="s3">221.25</span><span class="s0">,</span>
                 <span class="s3">245.12</span><span class="s0">, </span><span class="s3">319.75</span><span class="s0">, </span><span class="s3">451.5</span><span class="s0">, </span><span class="s3">561.12</span><span class="s0">, </span><span class="s3">619.25</span><span class="s0">, </span><span class="s3">615.62</span><span class="s0">, </span><span class="s3">548.</span><span class="s0">,</span>
                 <span class="s3">462.12</span><span class="s0">, </span><span class="s3">381.12</span><span class="s0">, </span><span class="s3">316.62</span><span class="s0">, </span><span class="s3">264.</span><span class="s0">, </span><span class="s3">228.38</span><span class="s0">, </span><span class="s3">210.75</span><span class="s0">, </span><span class="s3">188.38</span><span class="s0">,</span>
                 <span class="s3">199.</span><span class="s0">, </span><span class="s3">207.12</span><span class="s0">, </span><span class="s3">191.</span><span class="s0">, </span><span class="s3">166.88</span><span class="s0">, </span><span class="s3">72.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">9.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">33.12</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">36.75</span><span class="s0">, </span><span class="s3">36.25</span><span class="s0">, </span><span class="s3">103.</span><span class="s1">]</span>

        <span class="s1">random = [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.663</span><span class="s0">, </span><span class="s1">-</span><span class="s3">61.48</span><span class="s0">,</span>
                  <span class="s3">113.699</span><span class="s0">, </span><span class="s3">149.618</span><span class="s0">, </span><span class="s3">328.038</span><span class="s0">, </span><span class="s3">263.02</span><span class="s0">, </span><span class="s3">78.824</span><span class="s0">, </span><span class="s1">-</span><span class="s3">64.507</span><span class="s0">,</span>
                  <span class="s1">-</span><span class="s3">156.837</span><span class="s0">, </span><span class="s1">-</span><span class="s3">185.48</span><span class="s0">, </span><span class="s1">-</span><span class="s3">157.176</span><span class="s0">, </span><span class="s1">-</span><span class="s3">139.382</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60.837</span><span class="s0">, </span><span class="s1">-</span><span class="s3">119.48</span><span class="s0">,</span>
                  <span class="s3">9.574</span><span class="s0">, </span><span class="s1">-</span><span class="s3">43.007</span><span class="s0">, </span><span class="s1">-</span><span class="s3">37.587</span><span class="s0">, </span><span class="s3">135.52</span><span class="s0">, </span><span class="s1">-</span><span class="s3">94.176</span><span class="s0">, </span><span class="s1">-</span><span class="s3">27.257</span><span class="s0">,</span>
                  <span class="s1">-</span><span class="s3">205.087</span><span class="s0">, </span><span class="s1">-</span><span class="s3">307.48</span><span class="s0">, </span><span class="s3">42.199</span><span class="s0">, </span><span class="s3">85.868</span><span class="s0">, </span><span class="s3">80.538</span><span class="s0">, </span><span class="s3">230.27</span><span class="s0">, </span><span class="s1">-</span><span class="s3">38.051</span><span class="s1">]</span>

        <span class="s1">assert_almost_equal(res_add.seasonal</span><span class="s0">, </span><span class="s1">seasonal</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.trend</span><span class="s0">, </span><span class="s1">trend</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res_add.resid</span><span class="s0">, </span><span class="s1">random</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_2d(self):</span>
        <span class="s1">x = np.tile(np.arange(</span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)).T</span>
        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">2</span><span class="s1">).trend</span>
        <span class="s1">expected = np.tile(np.arange(</span><span class="s3">6</span><span class="s0">, </span><span class="s1">dtype=float)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)).T</span>
        <span class="s1">expected[</span><span class="s3">0</span><span class="s1">] = expected[-</span><span class="s3">1</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_equal(trend</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_interpolate_trend(self):</span>
        <span class="s1">x = np.arange(</span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">freq = </span><span class="s3">4</span>
        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq).trend</span>
        <span class="s1">assert_equal(trend[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.nan)</span>

        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">, </span><span class="s1">extrapolate_trend=</span><span class="s3">5</span><span class="s1">).trend</span>
        <span class="s1">assert_almost_equal(trend</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">,</span>
                                   <span class="s1">extrapolate_trend=</span><span class="s4">'freq'</span><span class="s1">).trend</span>
        <span class="s1">assert_almost_equal(trend</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s1">trend = seasonal_decompose(x[:</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">,</span>
                                   <span class="s1">extrapolate_trend=</span><span class="s3">5</span><span class="s1">).trend</span>
        <span class="s1">assert_almost_equal(trend</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s2"># 2d case</span>
        <span class="s1">x = np.tile(np.arange(</span><span class="s3">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)).T</span>
        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">, </span><span class="s1">extrapolate_trend=</span><span class="s3">1</span><span class="s1">).trend</span>
        <span class="s1">assert_almost_equal(trend</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s1">trend = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">,</span>
                                   <span class="s1">extrapolate_trend=</span><span class="s4">'freq'</span><span class="s1">).trend</span>
        <span class="s1">assert_almost_equal(trend</span><span class="s0">, </span><span class="s1">x)</span>

    <span class="s0">def </span><span class="s1">test_raises(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">seasonal_decompose</span><span class="s0">, </span><span class="s1">self.data.values)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">seasonal_decompose</span><span class="s0">, </span><span class="s1">self.data</span><span class="s0">, </span><span class="s4">'m'</span><span class="s0">,</span>
                      <span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">x = self.data.astype(float).copy()</span>
        <span class="s1">x.iloc[</span><span class="s3">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">seasonal_decompose</span><span class="s0">, </span><span class="s1">x)</span>


<span class="s0">def </span><span class="s1">test_seasonal_decompose_too_short(reset_randomstate):</span>
    <span class="s1">dates = pd.date_range(</span><span class="s4">'2000-01-31'</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">'Q'</span><span class="s1">)</span>
    <span class="s1">y = np.sin(np.arange(</span><span class="s3">4</span><span class="s1">) / </span><span class="s3">4 </span><span class="s1">* </span><span class="s3">2 </span><span class="s1">* np.pi)</span>
    <span class="s1">y += np.random.standard_normal(y.size)</span>
    <span class="s1">y = pd.Series(y</span><span class="s0">, </span><span class="s1">name=</span><span class="s4">'y'</span><span class="s0">, </span><span class="s1">index=dates)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">seasonal_decompose(y)</span>

    <span class="s1">dates = pd.date_range(</span><span class="s4">'2000-01-31'</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">'M'</span><span class="s1">)</span>
    <span class="s1">y = np.sin(np.arange(</span><span class="s3">12</span><span class="s1">) / </span><span class="s3">12 </span><span class="s1">* </span><span class="s3">2 </span><span class="s1">* np.pi)</span>
    <span class="s1">y += np.random.standard_normal(y.size)</span>
    <span class="s1">y = pd.Series(y</span><span class="s0">, </span><span class="s1">name=</span><span class="s4">'y'</span><span class="s0">, </span><span class="s1">index=dates)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">seasonal_decompose(y)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">seasonal_decompose(y.values</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">12</span><span class="s1">)</span>


<span class="s1">@pytest.mark.smoke</span>
<span class="s0">def </span><span class="s1">test_seasonal_decompose_smoke():</span>
    <span class="s1">x = np.array([-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">175</span><span class="s0">, </span><span class="s3">149</span><span class="s0">, </span><span class="s3">214</span><span class="s0">, </span><span class="s3">247</span><span class="s0">, </span><span class="s3">237</span><span class="s0">, </span><span class="s3">225</span><span class="s0">, </span><span class="s3">329</span><span class="s0">, </span><span class="s3">729</span><span class="s0">, </span><span class="s3">809</span><span class="s0">,</span>
                  <span class="s3">530</span><span class="s0">, </span><span class="s3">489</span><span class="s0">, </span><span class="s3">540</span><span class="s0">, </span><span class="s3">457</span><span class="s0">, </span><span class="s3">195</span><span class="s0">, </span><span class="s3">176</span><span class="s0">, </span><span class="s3">337</span><span class="s0">, </span><span class="s3">239</span><span class="s0">, </span><span class="s3">128</span><span class="s0">, </span><span class="s3">102</span><span class="s0">,</span>
                  <span class="s3">232</span><span class="s0">, </span><span class="s3">429</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">98</span><span class="s0">, </span><span class="s3">43</span><span class="s0">, </span><span class="s1">-</span><span class="s3">141</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77</span><span class="s0">, </span><span class="s1">-</span><span class="s3">13</span><span class="s0">, </span><span class="s3">125</span><span class="s0">, </span><span class="s3">361</span><span class="s0">, </span><span class="s1">-</span><span class="s3">45</span><span class="s0">, </span><span class="s3">184</span><span class="s1">])</span>
    <span class="s1">seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">data = pd.DataFrame(x</span><span class="s0">, </span><span class="s1">pd.date_range(start=</span><span class="s4">'1/1/1951'</span><span class="s0">,</span>
                                         <span class="s1">periods=len(x)</span><span class="s0">,</span>
                                         <span class="s1">freq=</span><span class="s4">'Q'</span><span class="s1">))</span>

    <span class="s1">seasonal_decompose(data)</span>


<span class="s0">def </span><span class="s1">test_seasonal_decompose_multiple():</span>
    <span class="s1">x = np.array([-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">175</span><span class="s0">, </span><span class="s3">149</span><span class="s0">, </span><span class="s3">214</span><span class="s0">, </span><span class="s3">247</span><span class="s0">, </span><span class="s3">237</span><span class="s0">, </span><span class="s3">225</span><span class="s0">, </span><span class="s3">329</span><span class="s0">, </span><span class="s3">729</span><span class="s0">, </span><span class="s3">809</span><span class="s0">,</span>
                  <span class="s3">530</span><span class="s0">, </span><span class="s3">489</span><span class="s0">, </span><span class="s3">540</span><span class="s0">, </span><span class="s3">457</span><span class="s0">, </span><span class="s3">195</span><span class="s0">, </span><span class="s3">176</span><span class="s0">, </span><span class="s3">337</span><span class="s0">, </span><span class="s3">239</span><span class="s0">, </span><span class="s3">128</span><span class="s0">, </span><span class="s3">102</span><span class="s0">,</span>
                  <span class="s3">232</span><span class="s0">, </span><span class="s3">429</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">98</span><span class="s0">, </span><span class="s3">43</span><span class="s0">, </span><span class="s1">-</span><span class="s3">141</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77</span><span class="s0">, </span><span class="s1">-</span><span class="s3">13</span><span class="s0">, </span><span class="s3">125</span><span class="s0">, </span><span class="s3">361</span><span class="s0">, </span><span class="s1">-</span><span class="s3">45</span><span class="s0">, </span><span class="s3">184</span><span class="s1">])</span>
    <span class="s1">x = np.c_[x</span><span class="s0">, </span><span class="s1">x]</span>
    <span class="s1">res = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">assert_allclose(res.trend[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">res.trend[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(res.seasonal[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">res.seasonal[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(res.resid[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">res.resid[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'model'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'additive'</span><span class="s0">, </span><span class="s4">'multiplicative'</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'freq'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">12</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'two_sided'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'extrapolate_trend'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_seasonal_decompose_plot(model</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">two_sided</span><span class="s0">, </span><span class="s1">extrapolate_trend):</span>
    <span class="s1">x = np.array([-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">175</span><span class="s0">, </span><span class="s3">149</span><span class="s0">, </span><span class="s3">214</span><span class="s0">, </span><span class="s3">247</span><span class="s0">, </span><span class="s3">237</span><span class="s0">, </span><span class="s3">225</span><span class="s0">, </span><span class="s3">329</span><span class="s0">, </span><span class="s3">729</span><span class="s0">, </span><span class="s3">809</span><span class="s0">,</span>
                  <span class="s3">530</span><span class="s0">, </span><span class="s3">489</span><span class="s0">, </span><span class="s3">540</span><span class="s0">, </span><span class="s3">457</span><span class="s0">, </span><span class="s3">195</span><span class="s0">, </span><span class="s3">176</span><span class="s0">, </span><span class="s3">337</span><span class="s0">, </span><span class="s3">239</span><span class="s0">, </span><span class="s3">128</span><span class="s0">, </span><span class="s3">102</span><span class="s0">,</span>
                  <span class="s3">232</span><span class="s0">, </span><span class="s3">429</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">98</span><span class="s0">, </span><span class="s3">43</span><span class="s0">, </span><span class="s1">-</span><span class="s3">141</span><span class="s0">, </span><span class="s1">-</span><span class="s3">77</span><span class="s0">, </span><span class="s1">-</span><span class="s3">13</span><span class="s0">, </span><span class="s3">125</span><span class="s0">, </span><span class="s3">361</span><span class="s0">, </span><span class="s1">-</span><span class="s3">45</span><span class="s0">, </span><span class="s3">184</span><span class="s1">])</span>
    <span class="s1">x -= x.min() + </span><span class="s3">1</span>
    <span class="s1">x2 = np.r_[x[</span><span class="s3">12</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x[:</span><span class="s3">12</span><span class="s1">]]</span>
    <span class="s1">x = np.c_[x</span><span class="s0">, </span><span class="s1">x2]</span>
    <span class="s1">res = seasonal_decompose(x</span><span class="s0">, </span><span class="s1">period=freq</span><span class="s0">, </span><span class="s1">two_sided=two_sided</span><span class="s0">,</span>
                             <span class="s1">extrapolate_trend=extrapolate_trend)</span>
    <span class="s1">res.plot()</span>
</pre>
</body>
</html>
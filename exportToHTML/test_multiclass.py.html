<html>
<head>
<title>test_multiclass.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_multiclass.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">scipy.sparse </span><span class="s0">as </span><span class="s1">sp</span>
<span class="s0">from </span><span class="s1">scipy.sparse </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">coo_matrix</span><span class="s0">,</span>
    <span class="s1">csc_matrix</span><span class="s0">,</span>
    <span class="s1">csr_matrix</span><span class="s0">,</span>
    <span class="s1">dok_matrix</span><span class="s0">,</span>
    <span class="s1">issparse</span><span class="s0">,</span>
    <span class="s1">lil_matrix</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">from </span><span class="s1">sklearn </span><span class="s0">import </span><span class="s1">datasets</span>
<span class="s0">from </span><span class="s1">sklearn.model_selection </span><span class="s0">import </span><span class="s1">ShuffleSplit</span>
<span class="s0">from </span><span class="s1">sklearn.svm </span><span class="s0">import </span><span class="s1">SVC</span>
<span class="s0">from </span><span class="s1">sklearn.utils._testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_allclose</span><span class="s0">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_equal</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">sklearn.utils.estimator_checks </span><span class="s0">import </span><span class="s1">_NotAnArray</span>
<span class="s0">from </span><span class="s1">sklearn.utils.metaestimators </span><span class="s0">import </span><span class="s1">_safe_split</span>
<span class="s0">from </span><span class="s1">sklearn.utils.multiclass </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">_ovr_decision_function</span><span class="s0">,</span>
    <span class="s1">check_classification_targets</span><span class="s0">,</span>
    <span class="s1">class_distribution</span><span class="s0">,</span>
    <span class="s1">is_multilabel</span><span class="s0">,</span>
    <span class="s1">type_of_target</span><span class="s0">,</span>
    <span class="s1">unique_labels</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s1">sparse_multilable_explicit_zero = csc_matrix(np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]))</span>
<span class="s1">sparse_multilable_explicit_zero[:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] = </span><span class="s2">0</span>


<span class="s0">def </span><span class="s1">_generate_sparse(</span>
    <span class="s1">matrix</span><span class="s0">,</span>
    <span class="s1">matrix_types=(csr_matrix</span><span class="s0">, </span><span class="s1">csc_matrix</span><span class="s0">, </span><span class="s1">coo_matrix</span><span class="s0">, </span><span class="s1">dok_matrix</span><span class="s0">, </span><span class="s1">lil_matrix)</span><span class="s0">,</span>
    <span class="s1">dtypes=(bool</span><span class="s0">, </span><span class="s1">int</span><span class="s0">, </span><span class="s1">np.int8</span><span class="s0">, </span><span class="s1">np.uint8</span><span class="s0">, </span><span class="s1">float</span><span class="s0">, </span><span class="s1">np.float32)</span><span class="s0">,</span>
<span class="s1">):</span>
    <span class="s0">return </span><span class="s1">[</span>
        <span class="s1">matrix_type(matrix</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">for </span><span class="s1">matrix_type </span><span class="s0">in </span><span class="s1">matrix_types</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">dtypes</span>
    <span class="s1">]</span>


<span class="s1">EXAMPLES = {</span>
    <span class="s3">&quot;multilabel-indicator&quot;</span><span class="s1">: [</span>
        <span class="s4"># valid when the data is formatted as sparse or dense, identified</span>
        <span class="s4"># by CSR format when the testing takes place</span>
        <span class="s1">csr_matrix(np.random.RandomState(</span><span class="s2">42</span><span class="s1">).randint(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">size=(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
        <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">sparse_multilable_explicit_zero</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s4"># Only valid when data is dense</span>
        <span class="s1">[[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">np.array([[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[-</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">_NotAnArray(np.array([[-</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">]]))</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;multiclass&quot;</span><span class="s1">: [</span>
        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int8)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.uint8)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=float)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">_NotAnArray(np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]))</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;multiclass-multioutput&quot;</span><span class="s1">: [</span>
        <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.int8)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.uint8)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=float)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse(</span>
            <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">matrix_types=(csr_matrix</span><span class="s0">, </span><span class="s1">csc_matrix)</span><span class="s0">,</span>
            <span class="s1">dtypes=(int</span><span class="s0">, </span><span class="s1">np.int8</span><span class="s0">, </span><span class="s1">np.uint8</span><span class="s0">, </span><span class="s1">float</span><span class="s0">, </span><span class="s1">np.float32)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">_NotAnArray(np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]))</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;binary&quot;</span><span class="s1">: [</span>
        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=bool)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int8)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.uint8)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=float)</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">_NotAnArray(np.array([[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]]))</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;def&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;def&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;def&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;continuous&quot;</span><span class="s1">: [</span>
        <span class="s1">[</span><span class="s2">1e-5</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;continuous-multioutput&quot;</span><span class="s1">: [</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
        <span class="s1">np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse(</span>
            <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">matrix_types=(csr_matrix</span><span class="s0">, </span><span class="s1">csc_matrix)</span><span class="s0">,</span>
            <span class="s1">dtypes=(float</span><span class="s0">, </span><span class="s1">np.float32)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*_generate_sparse(</span>
            <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">matrix_types=(csr_matrix</span><span class="s0">, </span><span class="s1">csc_matrix)</span><span class="s0">,</span>
            <span class="s1">dtypes=(float</span><span class="s0">, </span><span class="s1">np.float32)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s3">&quot;unknown&quot;</span><span class="s1">: [</span>
        <span class="s1">[[]]</span><span class="s0">,</span>
        <span class="s1">np.array([[]]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">[()]</span><span class="s0">,</span>
        <span class="s4"># sequence of sequences that weren't supported even before deprecation</span>
        <span class="s1">np.array([np.array([])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">[np.array([])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])]</span><span class="s0">,</span>
        <span class="s1">[{</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">}]</span><span class="s0">,</span>
        <span class="s1">[frozenset([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">, </span><span class="s1">frozenset([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])]</span><span class="s0">,</span>
        <span class="s4"># and also confusable as sequences of sequences</span>
        <span class="s1">[{</span><span class="s2">0</span><span class="s1">: </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s2">1</span><span class="s1">: </span><span class="s3">&quot;b&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s2">0</span><span class="s1">: </span><span class="s3">&quot;a&quot;</span><span class="s1">}]</span><span class="s0">,</span>
        <span class="s4"># ndim 0</span>
        <span class="s1">np.array(</span><span class="s2">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s4"># empty second dimension</span>
        <span class="s1">np.array([[]</span><span class="s0">, </span><span class="s1">[]])</span><span class="s0">,</span>
        <span class="s4"># 3d</span>
        <span class="s1">np.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s1">]]])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">}</span>

<span class="s1">NON_ARRAY_LIKE_EXAMPLES = [</span>
    <span class="s1">{</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">}</span><span class="s0">,</span>
    <span class="s1">{</span><span class="s2">0</span><span class="s1">: </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s2">1</span><span class="s1">: </span><span class="s3">&quot;b&quot;</span><span class="s1">}</span><span class="s0">,</span>
    <span class="s1">{</span><span class="s2">0</span><span class="s1">: [</span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">: [</span><span class="s2">5</span><span class="s1">]}</span><span class="s0">,</span>
    <span class="s3">&quot;abc&quot;</span><span class="s0">,</span>
    <span class="s1">frozenset([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s0">None,</span>
<span class="s1">]</span>

<span class="s1">MULTILABEL_SEQUENCES = [</span>
    <span class="s1">[[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">[()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)]</span><span class="s0">,</span>
    <span class="s1">np.array([[]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;object&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">_NotAnArray(np.array([[]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;object&quot;</span><span class="s1">))</span><span class="s0">,</span>
<span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_unique_labels():</span>
    <span class="s4"># Empty iterable</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels()</span>

    <span class="s4"># Multiclass problem</span>
    <span class="s1">assert_array_equal(unique_labels(range(</span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(unique_labels(np.arange(</span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(unique_labels([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]))</span>

    <span class="s4"># Multilabel indicator</span>
    <span class="s1">assert_array_equal(</span>
        <span class="s1">unique_labels(np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s1">assert_array_equal(unique_labels(np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">3</span><span class="s1">))</span>

    <span class="s4"># Several arrays passed</span>
    <span class="s1">assert_array_equal(unique_labels([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">5</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(unique_labels((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">3</span><span class="s1">))</span>

    <span class="s4"># Border line case with binary indicator matrix</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels(np.ones((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)))</span>

    <span class="s1">assert_array_equal(unique_labels(np.ones((</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_unique_labels_non_specific():</span>
    <span class="s4"># Test unique_labels with a variety of collected examples</span>

    <span class="s4"># Smoke test for all supported format</span>
    <span class="s0">for </span><span class="s1">format </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;binary&quot;</span><span class="s0">, </span><span class="s3">&quot;multiclass&quot;</span><span class="s0">, </span><span class="s3">&quot;multilabel-indicator&quot;</span><span class="s1">]:</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">EXAMPLES[format]:</span>
            <span class="s1">unique_labels(y)</span>

    <span class="s4"># We don't support those format at the moment</span>
    <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">NON_ARRAY_LIKE_EXAMPLES:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">unique_labels(example)</span>

    <span class="s0">for </span><span class="s1">y_type </span><span class="s0">in </span><span class="s1">[</span>
        <span class="s3">&quot;unknown&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;continuous&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;continuous-multioutput&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;multiclass-multioutput&quot;</span><span class="s0">,</span>
    <span class="s1">]:</span>
        <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">EXAMPLES[y_type]:</span>
            <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
                <span class="s1">unique_labels(example)</span>


<span class="s0">def </span><span class="s1">test_unique_labels_mixed_types():</span>
    <span class="s4"># Mix with binary or multiclass and multilabel</span>
    <span class="s1">mix_clf_format = product(</span>
        <span class="s1">EXAMPLES[</span><span class="s3">&quot;multilabel-indicator&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">EXAMPLES[</span><span class="s3">&quot;multiclass&quot;</span><span class="s1">] + EXAMPLES[</span><span class="s3">&quot;binary&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">y_multilabel</span><span class="s0">, </span><span class="s1">y_multiclass </span><span class="s0">in </span><span class="s1">mix_clf_format:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">unique_labels(y_multiclass</span><span class="s0">, </span><span class="s1">y_multilabel)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">unique_labels(y_multilabel</span><span class="s0">, </span><span class="s1">y_multiclass)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels([</span><span class="s3">&quot;1&quot;</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels([[</span><span class="s3">&quot;1&quot;</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">unique_labels([[</span><span class="s3">&quot;1&quot;</span><span class="s0">, </span><span class="s3">&quot;2&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>


<span class="s0">def </span><span class="s1">test_is_multilabel():</span>
    <span class="s0">for </span><span class="s1">group</span><span class="s0">, </span><span class="s1">group_examples </span><span class="s0">in </span><span class="s1">EXAMPLES.items():</span>
        <span class="s0">if </span><span class="s1">group </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;multilabel-indicator&quot;</span><span class="s1">]:</span>
            <span class="s1">dense_exp = </span><span class="s0">True</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">dense_exp = </span><span class="s0">False</span>

        <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">group_examples:</span>
            <span class="s4"># Only mark explicitly defined sparse examples as valid sparse</span>
            <span class="s4"># multilabel-indicators</span>
            <span class="s0">if </span><span class="s1">group == </span><span class="s3">&quot;multilabel-indicator&quot; </span><span class="s0">and </span><span class="s1">issparse(example):</span>
                <span class="s1">sparse_exp = </span><span class="s0">True</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">sparse_exp = </span><span class="s0">False</span>

            <span class="s0">if </span><span class="s1">issparse(example) </span><span class="s0">or </span><span class="s1">(</span>
                <span class="s1">hasattr(example</span><span class="s0">, </span><span class="s3">&quot;__array__&quot;</span><span class="s1">)</span>
                <span class="s0">and </span><span class="s1">np.asarray(example).ndim == </span><span class="s2">2</span>
                <span class="s0">and </span><span class="s1">np.asarray(example).dtype.kind </span><span class="s0">in </span><span class="s3">&quot;biuf&quot;</span>
                <span class="s0">and </span><span class="s1">np.asarray(example).shape[</span><span class="s2">1</span><span class="s1">] &gt; </span><span class="s2">0</span>
            <span class="s1">):</span>
                <span class="s1">examples_sparse = [</span>
                    <span class="s1">sparse_matrix(example)</span>
                    <span class="s0">for </span><span class="s1">sparse_matrix </span><span class="s0">in </span><span class="s1">[</span>
                        <span class="s1">coo_matrix</span><span class="s0">,</span>
                        <span class="s1">csc_matrix</span><span class="s0">,</span>
                        <span class="s1">csr_matrix</span><span class="s0">,</span>
                        <span class="s1">dok_matrix</span><span class="s0">,</span>
                        <span class="s1">lil_matrix</span><span class="s0">,</span>
                    <span class="s1">]</span>
                <span class="s1">]</span>
                <span class="s0">for </span><span class="s1">exmpl_sparse </span><span class="s0">in </span><span class="s1">examples_sparse:</span>
                    <span class="s0">assert </span><span class="s1">sparse_exp == is_multilabel(</span>
                        <span class="s1">exmpl_sparse</span>
                    <span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;is_multilabel(%r) should be %s&quot; </span><span class="s1">% (exmpl_sparse</span><span class="s0">, </span><span class="s1">sparse_exp)</span>

            <span class="s4"># Densify sparse examples before testing</span>
            <span class="s0">if </span><span class="s1">issparse(example):</span>
                <span class="s1">example = example.toarray()</span>

            <span class="s0">assert </span><span class="s1">dense_exp == is_multilabel(</span>
                <span class="s1">example</span>
            <span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;is_multilabel(%r) should be %s&quot; </span><span class="s1">% (example</span><span class="s0">, </span><span class="s1">dense_exp)</span>


<span class="s0">def </span><span class="s1">test_check_classification_targets():</span>
    <span class="s0">for </span><span class="s1">y_type </span><span class="s0">in </span><span class="s1">EXAMPLES.keys():</span>
        <span class="s0">if </span><span class="s1">y_type </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;unknown&quot;</span><span class="s0">, </span><span class="s3">&quot;continuous&quot;</span><span class="s0">, </span><span class="s3">&quot;continuous-multioutput&quot;</span><span class="s1">]:</span>
            <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">EXAMPLES[y_type]:</span>
                <span class="s1">msg = </span><span class="s3">&quot;Unknown label type: &quot;</span>
                <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                    <span class="s1">check_classification_targets(example)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">EXAMPLES[y_type]:</span>
                <span class="s1">check_classification_targets(example)</span>


<span class="s4"># @ignore_warnings</span>
<span class="s0">def </span><span class="s1">test_type_of_target():</span>
    <span class="s0">for </span><span class="s1">group</span><span class="s0">, </span><span class="s1">group_examples </span><span class="s0">in </span><span class="s1">EXAMPLES.items():</span>
        <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">group_examples:</span>
            <span class="s0">assert </span><span class="s1">(</span>
                <span class="s1">type_of_target(example) == group</span>
            <span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;type_of_target(%r) should be %r, got %r&quot; </span><span class="s1">% (</span>
                <span class="s1">example</span><span class="s0">,</span>
                <span class="s1">group</span><span class="s0">,</span>
                <span class="s1">type_of_target(example)</span><span class="s0">,</span>
            <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">NON_ARRAY_LIKE_EXAMPLES:</span>
        <span class="s1">msg_regex = </span><span class="s3">r&quot;Expected array-like \(array or non-string sequence\).*&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg_regex):</span>
            <span class="s1">type_of_target(example)</span>

    <span class="s0">for </span><span class="s1">example </span><span class="s0">in </span><span class="s1">MULTILABEL_SEQUENCES:</span>
        <span class="s1">msg = (</span>
            <span class="s3">&quot;You appear to be using a legacy multi-label data &quot;</span>
            <span class="s3">&quot;representation. Sequence of sequences are no longer supported;&quot;</span>
            <span class="s3">&quot; use a binary array or sparse matrix instead.&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">type_of_target(example)</span>


<span class="s0">def </span><span class="s1">test_type_of_target_pandas_sparse():</span>
    <span class="s1">pd = pytest.importorskip(</span><span class="s3">&quot;pandas&quot;</span><span class="s1">)</span>

    <span class="s1">y = pd.arrays.SparseArray([</span><span class="s2">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">msg = </span><span class="s3">&quot;y cannot be class 'SparseSeries' or 'SparseArray'&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">type_of_target(y)</span>


<span class="s0">def </span><span class="s1">test_type_of_target_pandas_nullable():</span>
    <span class="s5">&quot;&quot;&quot;Check that type_of_target works with pandas nullable dtypes.&quot;&quot;&quot;</span>
    <span class="s1">pd = pytest.importorskip(</span><span class="s3">&quot;pandas&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;Int32&quot;</span><span class="s0">, </span><span class="s3">&quot;Float32&quot;</span><span class="s1">]:</span>
        <span class="s1">y_true = pd.Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">assert </span><span class="s1">type_of_target(y_true) == </span><span class="s3">&quot;multiclass&quot;</span>

        <span class="s1">y_true = pd.Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s0">assert </span><span class="s1">type_of_target(y_true) == </span><span class="s3">&quot;binary&quot;</span>

    <span class="s1">y_true = pd.DataFrame([[</span><span class="s2">1.4</span><span class="s0">, </span><span class="s2">3.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3.1</span><span class="s0">, </span><span class="s2">1.4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Float32&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">type_of_target(y_true) == </span><span class="s3">&quot;continuous-multioutput&quot;</span>

    <span class="s1">y_true = pd.DataFrame([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int32&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">type_of_target(y_true) == </span><span class="s3">&quot;multilabel-indicator&quot;</span>

    <span class="s1">y_true = pd.DataFrame([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int32&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">type_of_target(y_true) == </span><span class="s3">&quot;multiclass-multioutput&quot;</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;Int64&quot;</span><span class="s0">, </span><span class="s3">&quot;Float64&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_unique_labels_pandas_nullable(dtype):</span>
    <span class="s5">&quot;&quot;&quot;Checks that unique_labels work with pandas nullable dtypes. 
 
    Non-regression test for gh-25634. 
    &quot;&quot;&quot;</span>
    <span class="s1">pd = pytest.importorskip(</span><span class="s3">&quot;pandas&quot;</span><span class="s1">)</span>

    <span class="s1">y_true = pd.Series([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">y_predicted = pd.Series([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">)</span>

    <span class="s1">labels = unique_labels(y_true</span><span class="s0">, </span><span class="s1">y_predicted)</span>
    <span class="s1">assert_array_equal(labels</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_class_distribution():</span>
    <span class="s1">y = np.array(</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s4"># Define the sparse matrix with a mix of implicit and explicit zeros</span>
    <span class="s1">data = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">indices = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">])</span>
    <span class="s1">indptr = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">17</span><span class="s1">])</span>
    <span class="s1">y_sp = sp.csc_matrix((data</span><span class="s0">, </span><span class="s1">indices</span><span class="s0">, </span><span class="s1">indptr)</span><span class="s0">, </span><span class="s1">shape=(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>

    <span class="s1">classes</span><span class="s0">, </span><span class="s1">n_classes</span><span class="s0">, </span><span class="s1">class_prior = class_distribution(y)</span>
    <span class="s1">classes_sp</span><span class="s0">, </span><span class="s1">n_classes_sp</span><span class="s0">, </span><span class="s1">class_prior_sp = class_distribution(y_sp)</span>
    <span class="s1">classes_expected = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]]</span>
    <span class="s1">n_classes_expected = [</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
    <span class="s1">class_prior_expected = [[</span><span class="s2">3 </span><span class="s1">/ </span><span class="s2">6</span><span class="s0">, </span><span class="s2">2 </span><span class="s1">/ </span><span class="s2">6</span><span class="s0">, </span><span class="s2">1 </span><span class="s1">/ </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1 </span><span class="s1">/ </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1 </span><span class="s1">/ </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1 </span><span class="s1">/ </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s1">]]</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s2">1</span><span class="s1">]):</span>
        <span class="s1">assert_array_almost_equal(classes[k]</span><span class="s0">, </span><span class="s1">classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(n_classes[k]</span><span class="s0">, </span><span class="s1">n_classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(class_prior[k]</span><span class="s0">, </span><span class="s1">class_prior_expected[k])</span>

        <span class="s1">assert_array_almost_equal(classes_sp[k]</span><span class="s0">, </span><span class="s1">classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(n_classes_sp[k]</span><span class="s0">, </span><span class="s1">n_classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(class_prior_sp[k]</span><span class="s0">, </span><span class="s1">class_prior_expected[k])</span>

    <span class="s4"># Test again with explicit sample weights</span>
    <span class="s1">(classes</span><span class="s0">, </span><span class="s1">n_classes</span><span class="s0">, </span><span class="s1">class_prior) = class_distribution(</span>
        <span class="s1">y</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">(classes_sp</span><span class="s0">, </span><span class="s1">n_classes_sp</span><span class="s0">, </span><span class="s1">class_prior_sp) = class_distribution(</span>
        <span class="s1">y</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">class_prior_expected = [[</span><span class="s2">4 </span><span class="s1">/ </span><span class="s2">9</span><span class="s0">, </span><span class="s2">3 </span><span class="s1">/ </span><span class="s2">9</span><span class="s0">, </span><span class="s2">2 </span><span class="s1">/ </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2 </span><span class="s1">/ </span><span class="s2">9</span><span class="s0">, </span><span class="s2">4 </span><span class="s1">/ </span><span class="s2">9</span><span class="s0">, </span><span class="s2">3 </span><span class="s1">/ </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s1">]]</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s2">1</span><span class="s1">]):</span>
        <span class="s1">assert_array_almost_equal(classes[k]</span><span class="s0">, </span><span class="s1">classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(n_classes[k]</span><span class="s0">, </span><span class="s1">n_classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(class_prior[k]</span><span class="s0">, </span><span class="s1">class_prior_expected[k])</span>

        <span class="s1">assert_array_almost_equal(classes_sp[k]</span><span class="s0">, </span><span class="s1">classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(n_classes_sp[k]</span><span class="s0">, </span><span class="s1">n_classes_expected[k])</span>
        <span class="s1">assert_array_almost_equal(class_prior_sp[k]</span><span class="s0">, </span><span class="s1">class_prior_expected[k])</span>


<span class="s0">def </span><span class="s1">test_safe_split_with_precomputed_kernel():</span>
    <span class="s1">clf = SVC()</span>
    <span class="s1">clfp = SVC(kernel=</span><span class="s3">&quot;precomputed&quot;</span><span class="s1">)</span>

    <span class="s1">iris = datasets.load_iris()</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">y = iris.data</span><span class="s0">, </span><span class="s1">iris.target</span>
    <span class="s1">K = np.dot(X</span><span class="s0">, </span><span class="s1">X.T)</span>

    <span class="s1">cv = ShuffleSplit(test_size=</span><span class="s2">0.25</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s2">0</span><span class="s1">)</span>
    <span class="s1">train</span><span class="s0">, </span><span class="s1">test = list(cv.split(X))[</span><span class="s2">0</span><span class="s1">]</span>

    <span class="s1">X_train</span><span class="s0">, </span><span class="s1">y_train = _safe_split(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">train)</span>
    <span class="s1">K_train</span><span class="s0">, </span><span class="s1">y_train2 = _safe_split(clfp</span><span class="s0">, </span><span class="s1">K</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">train)</span>
    <span class="s1">assert_array_almost_equal(K_train</span><span class="s0">, </span><span class="s1">np.dot(X_train</span><span class="s0">, </span><span class="s1">X_train.T))</span>
    <span class="s1">assert_array_almost_equal(y_train</span><span class="s0">, </span><span class="s1">y_train2)</span>

    <span class="s1">X_test</span><span class="s0">, </span><span class="s1">y_test = _safe_split(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">test</span><span class="s0">, </span><span class="s1">train)</span>
    <span class="s1">K_test</span><span class="s0">, </span><span class="s1">y_test2 = _safe_split(clfp</span><span class="s0">, </span><span class="s1">K</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">test</span><span class="s0">, </span><span class="s1">train)</span>
    <span class="s1">assert_array_almost_equal(K_test</span><span class="s0">, </span><span class="s1">np.dot(X_test</span><span class="s0">, </span><span class="s1">X_train.T))</span>
    <span class="s1">assert_array_almost_equal(y_test</span><span class="s0">, </span><span class="s1">y_test2)</span>


<span class="s0">def </span><span class="s1">test_ovr_decision_function():</span>
    <span class="s4"># test properties for ovr decision function</span>

    <span class="s1">predictions = np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>

    <span class="s1">confidences = np.array(</span>
        <span class="s1">[[-</span><span class="s2">1e16</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1e16</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">5.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">5.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]]</span>
    <span class="s1">)</span>

    <span class="s1">n_classes = </span><span class="s2">3</span>

    <span class="s1">dec_values = _ovr_decision_function(predictions</span><span class="s0">, </span><span class="s1">confidences</span><span class="s0">, </span><span class="s1">n_classes)</span>

    <span class="s4"># check that the decision values are within 0.5 range of the votes</span>
    <span class="s1">votes = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>

    <span class="s1">assert_allclose(votes</span><span class="s0">, </span><span class="s1">dec_values</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">0.5</span><span class="s1">)</span>

    <span class="s4"># check that the prediction are what we expect</span>
    <span class="s4"># highest vote or highest confidence if there is a tie.</span>
    <span class="s4"># for the second sample we have a tie (should be won by 1)</span>
    <span class="s1">expected_prediction = np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
    <span class="s1">assert_array_equal(np.argmax(dec_values</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected_prediction)</span>

    <span class="s4"># third and fourth sample have the same vote but third sample</span>
    <span class="s4"># has higher confidence, this should reflect on the decision values</span>
    <span class="s0">assert </span><span class="s1">dec_values[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">] &gt; dec_values[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span>

    <span class="s4"># assert subset invariance.</span>
    <span class="s1">dec_values_one = [</span>
        <span class="s1">_ovr_decision_function(</span>
            <span class="s1">np.array([predictions[i]])</span><span class="s0">, </span><span class="s1">np.array([confidences[i]])</span><span class="s0">, </span><span class="s1">n_classes</span>
        <span class="s1">)[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">4</span><span class="s1">)</span>
    <span class="s1">]</span>

    <span class="s1">assert_allclose(dec_values</span><span class="s0">, </span><span class="s1">dec_values_one</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-6</span><span class="s1">)</span>
</pre>
</body>
</html>
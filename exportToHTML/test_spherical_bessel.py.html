<html>
<head>
<title>test_spherical_bessel.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_spherical_bessel.py</font>
</center></td></tr></table>
<pre><span class="s0">#</span>
<span class="s0"># Tests of spherical Bessel functions.</span>
<span class="s0">#</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">(assert_almost_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span><span class="s2">,</span>
                           <span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">suppress_warnings)</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">sin</span><span class="s2">, </span><span class="s1">cos</span><span class="s2">, </span><span class="s1">sinh</span><span class="s2">, </span><span class="s1">cosh</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">inf</span><span class="s2">, </span><span class="s1">nan</span><span class="s2">, </span><span class="s1">r_</span><span class="s2">, </span><span class="s1">pi</span>

<span class="s2">from </span><span class="s1">scipy.special </span><span class="s2">import </span><span class="s1">spherical_jn</span><span class="s2">, </span><span class="s1">spherical_yn</span><span class="s2">, </span><span class="s1">spherical_in</span><span class="s2">, </span><span class="s1">spherical_kn</span>
<span class="s2">from </span><span class="s1">scipy.integrate </span><span class="s2">import </span><span class="s1">quad</span>


<span class="s2">class </span><span class="s1">TestSphericalJn:</span>
    <span class="s2">def </span><span class="s1">test_spherical_jn_exact(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.49.E3</span>
        <span class="s0"># Note: exact expression is numerically stable only for small</span>
        <span class="s0"># n or z &gt;&gt; n.</span>
        <span class="s1">x = np.array([</span><span class="s3">0.12</span><span class="s2">, </span><span class="s3">1.23</span><span class="s2">, </span><span class="s3">12.34</span><span class="s2">, </span><span class="s3">123.45</span><span class="s2">, </span><span class="s3">1234.5</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_jn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(-</span><span class="s3">1</span><span class="s1">/x + </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">3</span><span class="s1">)*sin(x) - </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">2</span><span class="s1">*cos(x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_recurrence_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E1</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">1.1 </span><span class="s1">+ </span><span class="s3">1.5j</span>
        <span class="s1">assert_allclose(spherical_jn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) + spherical_jn(n + </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_jn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_recurrence_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E1</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0.12</span>
        <span class="s1">assert_allclose(spherical_jn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) + spherical_jn(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_jn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_inf_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E3</span>
        <span class="s1">n = </span><span class="s3">6</span>
        <span class="s1">x = np.array([-inf</span><span class="s2">, </span><span class="s1">inf])</span>
        <span class="s1">assert_allclose(spherical_jn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_inf_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E3</span>
        <span class="s1">n = </span><span class="s3">7</span>
        <span class="s1">x = np.array([-inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)])</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s4">&quot;invalid value encountered in multiply&quot;</span><span class="s1">)</span>
            <span class="s1">assert_allclose(spherical_jn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_large_arg_1(self):</span>
        <span class="s0"># https://github.com/scipy/scipy/issues/2165</span>
        <span class="s0"># Reference value computed using mpmath, via</span>
        <span class="s0"># besselj(n + mpf(1)/2, z)*sqrt(pi/(2*z))</span>
        <span class="s1">assert_allclose(spherical_jn(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3350.507</span><span class="s1">)</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.00029846226538040747</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_large_arg_2(self):</span>
        <span class="s0"># https://github.com/scipy/scipy/issues/1641</span>
        <span class="s0"># Reference value computed using mpmath, via</span>
        <span class="s0"># besselj(n + mpf(1)/2, z)*sqrt(pi/(2*z))</span>
        <span class="s1">assert_allclose(spherical_jn(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10000</span><span class="s1">)</span><span class="s2">, </span><span class="s3">3.0590002633029811e-05</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_at_zero(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E1</span>
        <span class="s0"># But note that n = 0 is a special case: j0 = sin(x)/x -&gt; 1</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0</span>
        <span class="s1">assert_allclose(spherical_jn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>


<span class="s2">class </span><span class="s1">TestSphericalYn:</span>
    <span class="s2">def </span><span class="s1">test_spherical_yn_exact(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.49.E5</span>
        <span class="s0"># Note: exact expression is numerically stable only for small</span>
        <span class="s0"># n or z &gt;&gt; n.</span>
        <span class="s1">x = np.array([</span><span class="s3">0.12</span><span class="s2">, </span><span class="s3">1.23</span><span class="s2">, </span><span class="s3">12.34</span><span class="s2">, </span><span class="s3">123.45</span><span class="s2">, </span><span class="s3">1234.5</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_yn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">1</span><span class="s1">/x - </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">3</span><span class="s1">)*cos(x) - </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">2</span><span class="s1">*sin(x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_recurrence_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E1</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0.12</span>
        <span class="s1">assert_allclose(spherical_yn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) + spherical_yn(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_yn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_recurrence_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E1</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">1.1 </span><span class="s1">+ </span><span class="s3">1.5j</span>
        <span class="s1">assert_allclose(spherical_yn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) + spherical_yn(n + </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_yn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_inf_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E3</span>
        <span class="s1">n = </span><span class="s3">6</span>
        <span class="s1">x = np.array([-inf</span><span class="s2">, </span><span class="s1">inf])</span>
        <span class="s1">assert_allclose(spherical_yn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_inf_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E3</span>
        <span class="s1">n = </span><span class="s3">7</span>
        <span class="s1">x = np.array([-inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)])</span>
        <span class="s2">with </span><span class="s1">suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(RuntimeWarning</span><span class="s2">, </span><span class="s4">&quot;invalid value encountered in multiply&quot;</span><span class="s1">)</span>
            <span class="s1">assert_allclose(spherical_yn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_at_zero(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E2</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0</span>
        <span class="s1">assert_allclose(spherical_yn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.full(n.shape</span><span class="s2">, </span><span class="s1">-inf))</span>

    <span class="s2">def </span><span class="s1">test_spherical_yn_at_zero_complex(self):</span>
        <span class="s0"># Consistently with numpy:</span>
        <span class="s0"># &gt;&gt;&gt; -np.cos(0)/0</span>
        <span class="s0"># -inf</span>
        <span class="s0"># &gt;&gt;&gt; -np.cos(0+0j)/(0+0j)</span>
        <span class="s0"># (-inf + nan*j)</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0 </span><span class="s1">+ </span><span class="s3">0j</span>
        <span class="s1">assert_allclose(spherical_yn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.full(n.shape</span><span class="s2">, </span><span class="s1">nan))</span>


<span class="s2">class </span><span class="s1">TestSphericalJnYnCrossProduct:</span>
    <span class="s2">def </span><span class="s1">test_spherical_jn_yn_cross_product_1(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.50.E3</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">8</span><span class="s1">])</span>
        <span class="s1">x = np.array([</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">])</span>
        <span class="s1">left = (spherical_jn(n + </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) * spherical_yn(n</span><span class="s2">, </span><span class="s1">x) -</span>
                <span class="s1">spherical_jn(n</span><span class="s2">, </span><span class="s1">x) * spherical_yn(n + </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x))</span>
        <span class="s1">right = </span><span class="s3">1</span><span class="s1">/x**</span><span class="s3">2</span>
        <span class="s1">assert_allclose(left</span><span class="s2">, </span><span class="s1">right)</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_yn_cross_product_2(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.50.E3</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">8</span><span class="s1">])</span>
        <span class="s1">x = np.array([</span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">])</span>
        <span class="s1">left = (spherical_jn(n + </span><span class="s3">2</span><span class="s2">, </span><span class="s1">x) * spherical_yn(n</span><span class="s2">, </span><span class="s1">x) -</span>
                <span class="s1">spherical_jn(n</span><span class="s2">, </span><span class="s1">x) * spherical_yn(n + </span><span class="s3">2</span><span class="s2">, </span><span class="s1">x))</span>
        <span class="s1">right = (</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">3</span><span class="s1">)/x**</span><span class="s3">3</span>
        <span class="s1">assert_allclose(left</span><span class="s2">, </span><span class="s1">right)</span>


<span class="s2">class </span><span class="s1">TestSphericalIn:</span>
    <span class="s2">def </span><span class="s1">test_spherical_in_exact(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.49.E9</span>
        <span class="s1">x = np.array([</span><span class="s3">0.12</span><span class="s2">, </span><span class="s3">1.23</span><span class="s2">, </span><span class="s3">12.34</span><span class="s2">, </span><span class="s3">123.45</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_in(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">1</span><span class="s1">/x + </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">3</span><span class="s1">)*sinh(x) - </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">2</span><span class="s1">*cosh(x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_recurrence_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E4</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0.12</span>
        <span class="s1">assert_allclose(spherical_in(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) - spherical_in(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_in(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_recurrence_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E1</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">1.1 </span><span class="s1">+ </span><span class="s3">1.5j</span>
        <span class="s1">assert_allclose(spherical_in(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) - spherical_in(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_in(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_inf_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E3</span>
        <span class="s1">n = </span><span class="s3">5</span>
        <span class="s1">x = np.array([-inf</span><span class="s2">, </span><span class="s1">inf])</span>
        <span class="s1">assert_allclose(spherical_in(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([-inf</span><span class="s2">, </span><span class="s1">inf]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_inf_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E5</span>
        <span class="s0"># Ideally, i1n(n, 1j*inf) = 0 and i1n(n, (1+1j)*inf) = (1+1j)*inf, but</span>
        <span class="s0"># this appears impossible to achieve because C99 regards any complex</span>
        <span class="s0"># value with at least one infinite  part as a complex infinity, so</span>
        <span class="s0"># 1j*inf cannot be distinguished from (1+1j)*inf.  Therefore, nan is</span>
        <span class="s0"># the correct return value.</span>
        <span class="s1">n = </span><span class="s3">7</span>
        <span class="s1">x = np.array([-inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)])</span>
        <span class="s1">assert_allclose(spherical_in(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([-inf</span><span class="s2">, </span><span class="s1">inf</span><span class="s2">, </span><span class="s1">nan]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_at_zero(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E1</span>
        <span class="s0"># But note that n = 0 is a special case: i0 = sinh(x)/x -&gt; 1</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0</span>
        <span class="s1">assert_allclose(spherical_in(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>


<span class="s2">class </span><span class="s1">TestSphericalKn:</span>
    <span class="s2">def </span><span class="s1">test_spherical_kn_exact(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.49.E13</span>
        <span class="s1">x = np.array([</span><span class="s3">0.12</span><span class="s2">, </span><span class="s3">1.23</span><span class="s2">, </span><span class="s3">12.34</span><span class="s2">, </span><span class="s3">123.45</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_kn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">pi/</span><span class="s3">2</span><span class="s1">*exp(-x)*(</span><span class="s3">1</span><span class="s1">/x + </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">3</span><span class="s1">/x**</span><span class="s3">3</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_recurrence_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E4</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0.12</span>
        <span class="s1">assert_allclose((-</span><span class="s3">1</span><span class="s1">)**(n - </span><span class="s3">1</span><span class="s1">)*spherical_kn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) - (-</span><span class="s3">1</span><span class="s1">)**(n + </span><span class="s3">1</span><span class="s1">)*spherical_kn(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(-</span><span class="s3">1</span><span class="s1">)**n*(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_kn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_recurrence_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.51.E4</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">12</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">1.1 </span><span class="s1">+ </span><span class="s3">1.5j</span>
        <span class="s1">assert_allclose((-</span><span class="s3">1</span><span class="s1">)**(n - </span><span class="s3">1</span><span class="s1">)*spherical_kn(n - </span><span class="s3">1</span><span class="s2">, </span><span class="s1">x) - (-</span><span class="s3">1</span><span class="s1">)**(n + </span><span class="s3">1</span><span class="s1">)*spherical_kn(n + </span><span class="s3">1</span><span class="s2">,</span><span class="s1">x)</span><span class="s2">,</span>
                        <span class="s1">(-</span><span class="s3">1</span><span class="s1">)**n*(</span><span class="s3">2</span><span class="s1">*n + </span><span class="s3">1</span><span class="s1">)/x*spherical_kn(n</span><span class="s2">, </span><span class="s1">x))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_inf_real(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E6</span>
        <span class="s1">n = </span><span class="s3">5</span>
        <span class="s1">x = np.array([-inf</span><span class="s2">, </span><span class="s1">inf])</span>
        <span class="s1">assert_allclose(spherical_kn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([-inf</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_inf_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E6</span>
        <span class="s0"># The behavior at complex infinity depends on the sign of the real</span>
        <span class="s0"># part: if Re(z) &gt;= 0, then the limit is 0; if Re(z) &lt; 0, then it's</span>
        <span class="s0"># z*inf.  This distinction cannot be captured, so we return nan.</span>
        <span class="s1">n = </span><span class="s3">7</span>
        <span class="s1">x = np.array([-inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf + </span><span class="s3">0j</span><span class="s2">, </span><span class="s1">inf*(</span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s1">)])</span>
        <span class="s1">assert_allclose(spherical_kn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.array([-inf</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">nan]))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_at_zero(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E2</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0</span>
        <span class="s1">assert_allclose(spherical_kn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.full(n.shape</span><span class="s2">, </span><span class="s1">inf))</span>

    <span class="s2">def </span><span class="s1">test_spherical_kn_at_zero_complex(self):</span>
        <span class="s0"># https://dlmf.nist.gov/10.52.E2</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s1">])</span>
        <span class="s1">x = </span><span class="s3">0 </span><span class="s1">+ </span><span class="s3">0j</span>
        <span class="s1">assert_allclose(spherical_kn(n</span><span class="s2">, </span><span class="s1">x)</span><span class="s2">, </span><span class="s1">np.full(n.shape</span><span class="s2">, </span><span class="s1">nan))</span>


<span class="s2">class </span><span class="s1">SphericalDerivativesTestCase:</span>
    <span class="s2">def </span><span class="s1">fundamental_theorem(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b):</span>
        <span class="s1">integral</span><span class="s2">, </span><span class="s1">tolerance = quad(</span><span class="s2">lambda </span><span class="s1">z: self.df(n</span><span class="s2">, </span><span class="s1">z)</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_allclose(integral</span><span class="s2">,</span>
                        <span class="s1">self.f(n</span><span class="s2">, </span><span class="s1">b) - self.f(n</span><span class="s2">, </span><span class="s1">a)</span><span class="s2">,</span>
                        <span class="s1">atol=tolerance)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s2">def </span><span class="s1">test_fundamental_theorem_0(self):</span>
        <span class="s1">self.fundamental_theorem(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">3.0</span><span class="s2">, </span><span class="s3">15.0</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s2">def </span><span class="s1">test_fundamental_theorem_7(self):</span>
        <span class="s1">self.fundamental_theorem(</span><span class="s3">7</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1.2</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestSphericalJnDerivatives(SphericalDerivativesTestCase):</span>
    <span class="s2">def </span><span class="s1">f(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_jn(n</span><span class="s2">, </span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">df(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_jn(n</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spherical_jn_d_zero(self):</span>
        <span class="s1">n = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">15</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_jn(n</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>


<span class="s2">class </span><span class="s1">TestSphericalYnDerivatives(SphericalDerivativesTestCase):</span>
    <span class="s2">def </span><span class="s1">f(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_yn(n</span><span class="s2">, </span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">df(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_yn(n</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestSphericalInDerivatives(SphericalDerivativesTestCase):</span>
    <span class="s2">def </span><span class="s1">f(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_in(n</span><span class="s2">, </span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">df(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_in(n</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_spherical_in_d_zero(self):</span>
        <span class="s1">n = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">15</span><span class="s1">])</span>
        <span class="s1">assert_allclose(spherical_in(n</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">np.zeros(</span><span class="s3">5</span><span class="s1">))</span>


<span class="s2">class </span><span class="s1">TestSphericalKnDerivatives(SphericalDerivativesTestCase):</span>
    <span class="s2">def </span><span class="s1">f(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_kn(n</span><span class="s2">, </span><span class="s1">z)</span>

    <span class="s2">def </span><span class="s1">df(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">z):</span>
        <span class="s2">return </span><span class="s1">spherical_kn(n</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestSphericalOld:</span>
    <span class="s0"># These are tests from the TestSpherical class of test_basic.py,</span>
    <span class="s0"># rewritten to use spherical_* instead of sph_* but otherwise unchanged.</span>

    <span class="s2">def </span><span class="s1">test_sph_in(self):</span>
        <span class="s0"># This test reproduces test_basic.TestSpherical.test_sph_in.</span>
        <span class="s1">i1n = np.empty((</span><span class="s3">2</span><span class="s2">,</span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">x = </span><span class="s3">0.2</span>

        <span class="s1">i1n[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_in(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">i1n[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_in(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">i1n[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_in(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">i1n[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_in(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">inp0 = (i1n[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">inp1 = (i1n[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] - </span><span class="s3">2.0</span><span class="s1">/</span><span class="s3">0.2 </span><span class="s1">* i1n[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">assert_array_almost_equal(i1n[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">np.array([</span><span class="s3">1.0066800127054699381</span><span class="s2">,</span>
                                                <span class="s3">0.066933714568029540839</span><span class="s1">])</span><span class="s2">,</span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(i1n[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[inp0</span><span class="s2">,</span><span class="s1">inp1]</span><span class="s2">,</span><span class="s3">12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_sph_in_kn_order0(self):</span>
        <span class="s1">x = </span><span class="s3">1.</span>
        <span class="s1">sph_i0 = np.empty((</span><span class="s3">2</span><span class="s2">,</span><span class="s1">))</span>
        <span class="s1">sph_i0[</span><span class="s3">0</span><span class="s1">] = spherical_in(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">sph_i0[</span><span class="s3">1</span><span class="s1">] = spherical_in(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">sph_i0_expected = np.array([np.sinh(x)/x</span><span class="s2">,</span>
                                    <span class="s1">np.cosh(x)/x-np.sinh(x)/x**</span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_array_almost_equal(r_[sph_i0]</span><span class="s2">, </span><span class="s1">sph_i0_expected)</span>

        <span class="s1">sph_k0 = np.empty((</span><span class="s3">2</span><span class="s2">,</span><span class="s1">))</span>
        <span class="s1">sph_k0[</span><span class="s3">0</span><span class="s1">] = spherical_kn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">sph_k0[</span><span class="s3">1</span><span class="s1">] = spherical_kn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">sph_k0_expected = np.array([</span><span class="s3">0.5</span><span class="s1">*pi*exp(-x)/x</span><span class="s2">,</span>
                                    <span class="s1">-</span><span class="s3">0.5</span><span class="s1">*pi*exp(-x)*(</span><span class="s3">1</span><span class="s1">/x+</span><span class="s3">1</span><span class="s1">/x**</span><span class="s3">2</span><span class="s1">)])</span>
        <span class="s1">assert_array_almost_equal(r_[sph_k0]</span><span class="s2">, </span><span class="s1">sph_k0_expected)</span>

    <span class="s2">def </span><span class="s1">test_sph_jn(self):</span>
        <span class="s1">s1 = np.empty((</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">x = </span><span class="s3">0.2</span>

        <span class="s1">s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_jn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_jn(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">2</span><span class="s1">] = spherical_jn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">s1[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_jn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">s1[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_jn(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">s1[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">2</span><span class="s1">] = spherical_jn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">s10 = -s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">s11 = s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">]-</span><span class="s3">2.0</span><span class="s1">/</span><span class="s3">0.2</span><span class="s1">*s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">s12 = s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]-</span><span class="s3">3.0</span><span class="s1">/</span><span class="s3">0.2</span><span class="s1">*s1[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">2</span><span class="s1">]</span>
        <span class="s1">assert_array_almost_equal(s1[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">0.99334665397530607731</span><span class="s2">,</span>
                                      <span class="s3">0.066400380670322230863</span><span class="s2">,</span>
                                      <span class="s3">0.0026590560795273856680</span><span class="s1">]</span><span class="s2">,</span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(s1[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[s10</span><span class="s2">,</span><span class="s1">s11</span><span class="s2">,</span><span class="s1">s12]</span><span class="s2">,</span><span class="s3">12</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_sph_kn(self):</span>
        <span class="s1">kn = np.empty((</span><span class="s3">2</span><span class="s2">,</span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">x = </span><span class="s3">0.2</span>

        <span class="s1">kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_kn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_kn(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">2</span><span class="s1">] = spherical_kn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">kn[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">0</span><span class="s1">] = spherical_kn(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">kn[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] = spherical_kn(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">kn[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">2</span><span class="s1">] = spherical_kn(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">kn0 = -kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">kn1 = -kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">0</span><span class="s1">]-</span><span class="s3">2.0</span><span class="s1">/</span><span class="s3">0.2</span><span class="s1">*kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">kn2 = -kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]-</span><span class="s3">3.0</span><span class="s1">/</span><span class="s3">0.2</span><span class="s1">*kn[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">2</span><span class="s1">]</span>
        <span class="s1">assert_array_almost_equal(kn[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s3">6.4302962978445670140</span><span class="s2">,</span>
                                         <span class="s3">38.581777787067402086</span><span class="s2">,</span>
                                         <span class="s3">585.15696310385559829</span><span class="s1">]</span><span class="s2">,</span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(kn[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[kn0</span><span class="s2">,</span><span class="s1">kn1</span><span class="s2">,</span><span class="s1">kn2]</span><span class="s2">,</span><span class="s3">9</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_sph_yn(self):</span>
        <span class="s1">sy1 = spherical_yn(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.2</span><span class="s1">)</span>
        <span class="s1">sy2 = spherical_yn(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(sy1</span><span class="s2">,</span><span class="s1">-</span><span class="s3">377.52483</span><span class="s2">,</span><span class="s3">5</span><span class="s1">)  </span><span class="s0"># previous values in the system</span>
        <span class="s1">assert_almost_equal(sy2</span><span class="s2">,</span><span class="s1">-</span><span class="s3">4.9003329</span><span class="s2">,</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">sphpy = (spherical_yn(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.2</span><span class="s1">) - </span><span class="s3">2</span><span class="s1">*spherical_yn(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">0.2</span><span class="s1">))/</span><span class="s3">3</span>
        <span class="s1">sy3 = spherical_yn(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0.2</span><span class="s2">, </span><span class="s1">derivative=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(sy3</span><span class="s2">,</span><span class="s1">sphpy</span><span class="s2">,</span><span class="s3">4</span><span class="s1">)  </span><span class="s0"># compare correct derivative val. (correct =-system val).</span>
</pre>
</body>
</html>
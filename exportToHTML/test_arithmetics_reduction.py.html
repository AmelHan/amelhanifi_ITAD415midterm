<html>
<head>
<title>test_arithmetics_reduction.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arithmetics_reduction.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">import </span><span class="s1">warnings</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pandas.api.types </span><span class="s0">import </span><span class="s1">is_scalar</span>

<span class="s0">import </span><span class="s1">dask.dataframe </span><span class="s0">as </span><span class="s1">dd</span>
<span class="s0">from </span><span class="s1">dask.array.numpy_compat </span><span class="s0">import </span><span class="s1">_numpy_125</span>
<span class="s0">from </span><span class="s1">dask.dataframe._compat </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">PANDAS_GE_140</span><span class="s0">,</span>
    <span class="s1">PANDAS_GE_150</span><span class="s0">,</span>
    <span class="s1">PANDAS_GE_200</span><span class="s0">,</span>
    <span class="s1">PANDAS_VERSION</span><span class="s0">,</span>
    <span class="s1">check_numeric_only_deprecation</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">dask.dataframe.utils </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_dask_graph</span><span class="s0">,</span>
    <span class="s1">assert_eq</span><span class="s0">,</span>
    <span class="s1">make_meta</span><span class="s0">,</span>
    <span class="s1">pyarrow_strings_enabled</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">try</span><span class="s1">:</span>
    <span class="s0">import </span><span class="s1">scipy</span>
<span class="s0">except </span><span class="s1">ImportError:</span>
    <span class="s1">scipy = </span><span class="s0">None</span>

<span class="s0">try</span><span class="s1">:</span>
    <span class="s0">import </span><span class="s1">pyarrow </span><span class="s0">as </span><span class="s1">pa</span>
    <span class="s0">from </span><span class="s1">pyarrow.lib </span><span class="s0">import </span><span class="s1">ArrowNotImplementedError</span>
<span class="s0">except </span><span class="s1">ImportError:</span>
    <span class="s1">pa = </span><span class="s0">None</span>
    <span class="s1">ArrowNotImplementedError = </span><span class="s0">None</span>


<span class="s1">@pytest.mark.slow</span>
<span class="s0">def </span><span class="s1">test_arithmetics():</span>
    <span class="s1">dsk = {</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">meta = make_meta(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=pd.Index([]</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">parent_meta=pd.DataFrame()</span>
    <span class="s1">)</span>
    <span class="s1">ddf1 = dd.DataFrame(dsk</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">meta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">pdf1 = ddf1.compute()</span>

    <span class="s1">pdf2 = pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]})</span>
    <span class="s1">pdf3 = pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]})</span>
    <span class="s1">ddf2 = dd.from_pandas(pdf2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf3 = dd.from_pandas(pdf3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">dsk4 = {</span>
        <span class="s1">(</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">ddf4 = dd.DataFrame(dsk4</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s1">meta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">pdf4 = ddf4.compute()</span>

    <span class="s4"># Arithmetics</span>
    <span class="s1">cases = [</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf1</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf1)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf1.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf1)</span><span class="s0">,</span>
        <span class="s1">(ddf2</span><span class="s0">, </span><span class="s1">ddf3</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(ddf2.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf3.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(ddf2.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf3.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf4</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf4.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s1">(ddf1.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf4.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s4"># dask + pandas</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">pdf4</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s1">(ddf2</span><span class="s0">, </span><span class="s1">pdf3</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">cases:</span>
        <span class="s1">check_series_arithmetics(l.a</span><span class="s0">, </span><span class="s1">r.b</span><span class="s0">, </span><span class="s1">el.a</span><span class="s0">, </span><span class="s1">er.b)</span>
        <span class="s1">check_frame_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er)</span>

    <span class="s4"># different index, pandas raises ValueError in comparison ops</span>

    <span class="s1">pdf5 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf5 = dd.from_pandas(pdf5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">pdf6 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf6 = dd.from_pandas(pdf6</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">pdf7 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=list(</span><span class="s2">&quot;aaabcdeh&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pdf8 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf7 = dd.from_pandas(pdf7</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf8 = dd.from_pandas(pdf8</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">pdf9 = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">index=list(</span><span class="s2">&quot;aaabcdeh&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pdf10 = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;d&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">index=list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf9 = dd.from_pandas(pdf9</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf10 = dd.from_pandas(pdf10</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s4"># Arithmetics with different index</span>
    <span class="s1">cases = [</span>
        <span class="s1">(ddf5</span><span class="s0">, </span><span class="s1">ddf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf5.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf5.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf6.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf7</span><span class="s0">, </span><span class="s1">ddf8</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8)</span><span class="s0">,</span>
        <span class="s1">(ddf7.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf8.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">ddf7.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">ddf8.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">pdf7</span><span class="s0">,</span>
            <span class="s1">pdf8</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ddf9</span><span class="s0">, </span><span class="s1">ddf10</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10)</span><span class="s0">,</span>
        <span class="s1">(ddf9.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf10.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10)</span><span class="s0">,</span>
        <span class="s4"># dask + pandas</span>
        <span class="s1">(ddf5</span><span class="s0">, </span><span class="s1">pdf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf7</span><span class="s0">, </span><span class="s1">pdf8</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8)</span><span class="s0">,</span>
        <span class="s1">(ddf9</span><span class="s0">, </span><span class="s1">pdf10</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">cases:</span>
        <span class="s1">check_series_arithmetics(l.a</span><span class="s0">, </span><span class="s1">r.b</span><span class="s0">, </span><span class="s1">el.a</span><span class="s0">, </span><span class="s1">er.b</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">check_frame_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_deterministic_arithmetic_names():</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s2">&quot;x&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]})</span>
    <span class="s1">a = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">sorted((a.x + a.y**</span><span class="s3">2</span><span class="s1">).dask) == sorted((a.x + a.y**</span><span class="s3">2</span><span class="s1">).dask)</span>
    <span class="s0">assert </span><span class="s1">sorted((a.x + a.y**</span><span class="s3">2</span><span class="s1">).dask) != sorted((a.x + a.y**</span><span class="s3">3</span><span class="s1">).dask)</span>
    <span class="s0">assert </span><span class="s1">sorted((a.x + a.y**</span><span class="s3">2</span><span class="s1">).dask) != sorted((a.x - a.y**</span><span class="s3">2</span><span class="s1">).dask)</span>


<span class="s1">@pytest.mark.slow</span>
<span class="s0">def </span><span class="s1">test_arithmetics_different_index():</span>
    <span class="s4"># index are different, but overwraps</span>
    <span class="s1">pdf1 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf1 = dd.from_pandas(pdf1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">pdf2 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">9</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf2 = dd.from_pandas(pdf2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># index are not overwrapped</span>
    <span class="s1">pdf3 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf3 = dd.from_pandas(pdf3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">pdf4 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">9</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s0">, </span><span class="s3">14</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf4 = dd.from_pandas(pdf4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># index is included in another</span>
    <span class="s1">pdf5 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf5 = dd.from_pandas(pdf5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">pdf6 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">9</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">ddf6 = dd.from_pandas(pdf6</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">cases = [</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ddf2</span><span class="s0">, </span><span class="s1">ddf1</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf1)</span><span class="s0">,</span>
        <span class="s1">(ddf1.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf2.repartition([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ddf2.repartition([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf1.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf1)</span><span class="s0">,</span>
        <span class="s1">(ddf3</span><span class="s0">, </span><span class="s1">ddf4</span><span class="s0">, </span><span class="s1">pdf3</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s1">(ddf4</span><span class="s0">, </span><span class="s1">ddf3</span><span class="s0">, </span><span class="s1">pdf4</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">ddf3.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">ddf4.repartition([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s0">, </span><span class="s3">14</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">pdf3</span><span class="s0">,</span>
            <span class="s1">pdf4</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ddf4.repartition([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">14</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf3.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf4</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(ddf5</span><span class="s0">, </span><span class="s1">ddf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf6</span><span class="s0">, </span><span class="s1">ddf5</span><span class="s0">, </span><span class="s1">pdf6</span><span class="s0">, </span><span class="s1">pdf5)</span><span class="s0">,</span>
        <span class="s1">(ddf5.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf6.repartition([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf6.repartition([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf5.repartition([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf6</span><span class="s0">, </span><span class="s1">pdf5)</span><span class="s0">,</span>
        <span class="s4"># dask + pandas</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ddf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf1)</span><span class="s0">,</span>
        <span class="s1">(ddf3</span><span class="s0">, </span><span class="s1">pdf4</span><span class="s0">, </span><span class="s1">pdf3</span><span class="s0">, </span><span class="s1">pdf4)</span><span class="s0">,</span>
        <span class="s1">(ddf4</span><span class="s0">, </span><span class="s1">pdf3</span><span class="s0">, </span><span class="s1">pdf4</span><span class="s0">, </span><span class="s1">pdf3)</span><span class="s0">,</span>
        <span class="s1">(ddf5</span><span class="s0">, </span><span class="s1">pdf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6)</span><span class="s0">,</span>
        <span class="s1">(ddf6</span><span class="s0">, </span><span class="s1">pdf5</span><span class="s0">, </span><span class="s1">pdf6</span><span class="s0">, </span><span class="s1">pdf5)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">cases:</span>
        <span class="s1">check_series_arithmetics(l.a</span><span class="s0">, </span><span class="s1">r.b</span><span class="s0">, </span><span class="s1">el.a</span><span class="s0">, </span><span class="s1">er.b</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">check_frame_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">pdf7 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pdf8 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf7 = dd.from_pandas(pdf7</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf8 = dd.from_pandas(pdf8</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">pdf9 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pdf10 = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf9 = dd.from_pandas(pdf9</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf10 = dd.from_pandas(pdf10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">cases = [</span>
        <span class="s1">(ddf7</span><span class="s0">, </span><span class="s1">ddf8</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8)</span><span class="s0">,</span>
        <span class="s1">(ddf8</span><span class="s0">, </span><span class="s1">ddf7</span><span class="s0">, </span><span class="s1">pdf8</span><span class="s0">, </span><span class="s1">pdf7)</span><span class="s0">,</span>
        <span class="s4"># (ddf7.repartition([0, 13]),</span>
        <span class="s4">#  ddf8.repartition([0, 4, 11, 14], force=True),</span>
        <span class="s4">#  pdf7, pdf8),</span>
        <span class="s1">(</span>
            <span class="s1">ddf8.repartition([-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">force=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf7.repartition([-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">force=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">pdf8</span><span class="s0">,</span>
            <span class="s1">pdf7</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">ddf7.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">ddf8.repartition([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">force=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">pdf7</span><span class="s0">,</span>
            <span class="s1">pdf8</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">ddf8.repartition([-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">force=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf7.repartition([-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">force=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">pdf8</span><span class="s0">,</span>
            <span class="s1">pdf7</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ddf9</span><span class="s0">, </span><span class="s1">ddf10</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10)</span><span class="s0">,</span>
        <span class="s1">(ddf10</span><span class="s0">, </span><span class="s1">ddf9</span><span class="s0">, </span><span class="s1">pdf10</span><span class="s0">, </span><span class="s1">pdf9)</span><span class="s0">,</span>
        <span class="s4"># dask + pandas</span>
        <span class="s1">(ddf7</span><span class="s0">, </span><span class="s1">pdf8</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8)</span><span class="s0">,</span>
        <span class="s1">(ddf8</span><span class="s0">, </span><span class="s1">pdf7</span><span class="s0">, </span><span class="s1">pdf8</span><span class="s0">, </span><span class="s1">pdf7)</span><span class="s0">,</span>
        <span class="s1">(ddf9</span><span class="s0">, </span><span class="s1">pdf10</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10)</span><span class="s0">,</span>
        <span class="s1">(ddf10</span><span class="s0">, </span><span class="s1">pdf9</span><span class="s0">, </span><span class="s1">pdf10</span><span class="s0">, </span><span class="s1">pdf9)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">cases:</span>
        <span class="s1">check_series_arithmetics(l.a</span><span class="s0">, </span><span class="s1">r.b</span><span class="s0">, </span><span class="s1">el.a</span><span class="s0">, </span><span class="s1">er.b</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">check_frame_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">check_series_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">True</span><span class="s1">):</span>
    <span class="s0">assert </span><span class="s1">isinstance(l</span><span class="s0">, </span><span class="s1">dd.Series)</span>
    <span class="s0">assert </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">(dd.Series</span><span class="s0">, </span><span class="s1">pd.Series))</span>
    <span class="s0">assert </span><span class="s1">isinstance(el</span><span class="s0">, </span><span class="s1">pd.Series)</span>
    <span class="s0">assert </span><span class="s1">isinstance(er</span><span class="s0">, </span><span class="s1">pd.Series)</span>

    <span class="s4"># l, r may be repartitioned, test whether repartition keeps original data</span>
    <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
    <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

    <span class="s1">assert_eq(l + r</span><span class="s0">, </span><span class="s1">el + er)</span>
    <span class="s1">assert_eq(l * r</span><span class="s0">, </span><span class="s1">el * er)</span>
    <span class="s1">assert_eq(l - r</span><span class="s0">, </span><span class="s1">el - er)</span>
    <span class="s1">assert_eq(l / r</span><span class="s0">, </span><span class="s1">el / er)</span>
    <span class="s1">assert_eq(l // r</span><span class="s0">, </span><span class="s1">el // er)</span>
    <span class="s1">assert_eq(l**r</span><span class="s0">, </span><span class="s1">el**er)</span>
    <span class="s1">assert_eq(l % r</span><span class="s0">, </span><span class="s1">el % er)</span>

    <span class="s0">if </span><span class="s1">allow_comparison_ops:</span>
        <span class="s4"># comparison is allowed if data have same index</span>
        <span class="s1">assert_eq(l &amp; r</span><span class="s0">, </span><span class="s1">el &amp; er)</span>
        <span class="s1">assert_eq(l | r</span><span class="s0">, </span><span class="s1">el | er)</span>
        <span class="s1">assert_eq(l ^ r</span><span class="s0">, </span><span class="s1">el ^ er)</span>
        <span class="s1">assert_eq(l &gt; r</span><span class="s0">, </span><span class="s1">el &gt; er)</span>
        <span class="s1">assert_eq(l &lt; r</span><span class="s0">, </span><span class="s1">el &lt; er)</span>
        <span class="s1">assert_eq(l &gt;= r</span><span class="s0">, </span><span class="s1">el &gt;= er)</span>
        <span class="s1">assert_eq(l &lt;= r</span><span class="s0">, </span><span class="s1">el &lt;= er)</span>
        <span class="s1">assert_eq(l == r</span><span class="s0">, </span><span class="s1">el == er)</span>
        <span class="s1">assert_eq(l != r</span><span class="s0">, </span><span class="s1">el != er)</span>
        <span class="s1">assert_eq(l.lt(r)</span><span class="s0">, </span><span class="s1">el.lt(er))</span>
        <span class="s1">assert_eq(l.gt(r)</span><span class="s0">, </span><span class="s1">el.gt(er))</span>
        <span class="s1">assert_eq(l.le(r)</span><span class="s0">, </span><span class="s1">el.le(er))</span>
        <span class="s1">assert_eq(l.ge(r)</span><span class="s0">, </span><span class="s1">el.ge(er))</span>
        <span class="s1">assert_eq(l.ne(r)</span><span class="s0">, </span><span class="s1">el.ne(er))</span>
        <span class="s1">assert_eq(l.eq(r)</span><span class="s0">, </span><span class="s1">el.eq(er))</span>

    <span class="s1">assert_eq(l + </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el + </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el * </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l - </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el - </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l / </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el / </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &amp; </span><span class="s0">True, </span><span class="s1">el &amp; </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l | </span><span class="s0">True, </span><span class="s1">el | </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l ^ </span><span class="s0">True, </span><span class="s1">el ^ </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l // </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el // </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l**</span><span class="s3">2</span><span class="s0">, </span><span class="s1">el**</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l % </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el % </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l == </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el == </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l != </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el != </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">+ r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">+ er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">* r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">- r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">- er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">/ r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">&amp; r</span><span class="s0">, True </span><span class="s1">&amp; er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">| r</span><span class="s0">, True </span><span class="s1">| er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">^ r</span><span class="s0">, True </span><span class="s1">^ er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">// r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">// er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2</span><span class="s1">**r</span><span class="s0">, </span><span class="s3">2</span><span class="s1">**er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">% r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">% er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt; r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt; er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt; r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt; er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt;= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt;= er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt;= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt;= er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">== r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">== er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">!= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">!= er)</span>

    <span class="s1">assert_eq(l.lt(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.lt(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.gt(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.gt(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.le(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.le(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.ge(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.ge(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.ne(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.ne(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.eq(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.eq(</span><span class="s3">2</span><span class="s1">))</span>

    <span class="s1">assert_eq(-l</span><span class="s0">, </span><span class="s1">-el)</span>
    <span class="s1">assert_eq(abs(l)</span><span class="s0">, </span><span class="s1">abs(el))</span>

    <span class="s0">if </span><span class="s1">allow_comparison_ops:</span>
        <span class="s4"># comparison is allowed if data have same index</span>
        <span class="s1">assert_eq(~(l == r)</span><span class="s0">, </span><span class="s1">~(el == er))</span>


<span class="s0">def </span><span class="s1">check_frame_arithmetics(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er</span><span class="s0">, </span><span class="s1">allow_comparison_ops=</span><span class="s0">True</span><span class="s1">):</span>
    <span class="s0">assert </span><span class="s1">isinstance(l</span><span class="s0">, </span><span class="s1">dd.DataFrame)</span>
    <span class="s0">assert </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">(dd.DataFrame</span><span class="s0">, </span><span class="s1">pd.DataFrame))</span>
    <span class="s0">assert </span><span class="s1">isinstance(el</span><span class="s0">, </span><span class="s1">pd.DataFrame)</span>
    <span class="s0">assert </span><span class="s1">isinstance(er</span><span class="s0">, </span><span class="s1">pd.DataFrame)</span>
    <span class="s4"># l, r may be repartitioned, test whether repartition keeps original data</span>
    <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
    <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

    <span class="s1">assert_eq(l + r</span><span class="s0">, </span><span class="s1">el + er)</span>
    <span class="s1">assert_eq(l * r</span><span class="s0">, </span><span class="s1">el * er)</span>
    <span class="s1">assert_eq(l - r</span><span class="s0">, </span><span class="s1">el - er)</span>
    <span class="s1">assert_eq(l / r</span><span class="s0">, </span><span class="s1">el / er)</span>
    <span class="s1">assert_eq(l // r</span><span class="s0">, </span><span class="s1">el // er)</span>
    <span class="s1">assert_eq(l**r</span><span class="s0">, </span><span class="s1">el**er)</span>
    <span class="s1">assert_eq(l % r</span><span class="s0">, </span><span class="s1">el % er)</span>

    <span class="s0">if </span><span class="s1">allow_comparison_ops:</span>
        <span class="s4"># comparison is allowed if data have same index</span>
        <span class="s1">assert_eq(l &amp; r</span><span class="s0">, </span><span class="s1">el &amp; er)</span>
        <span class="s1">assert_eq(l | r</span><span class="s0">, </span><span class="s1">el | er)</span>
        <span class="s1">assert_eq(l ^ r</span><span class="s0">, </span><span class="s1">el ^ er)</span>
        <span class="s1">assert_eq(l &gt; r</span><span class="s0">, </span><span class="s1">el &gt; er)</span>
        <span class="s1">assert_eq(l &lt; r</span><span class="s0">, </span><span class="s1">el &lt; er)</span>
        <span class="s1">assert_eq(l &gt;= r</span><span class="s0">, </span><span class="s1">el &gt;= er)</span>
        <span class="s1">assert_eq(l &lt;= r</span><span class="s0">, </span><span class="s1">el &lt;= er)</span>
        <span class="s1">assert_eq(l == r</span><span class="s0">, </span><span class="s1">el == er)</span>
        <span class="s1">assert_eq(l != r</span><span class="s0">, </span><span class="s1">el != er)</span>
        <span class="s1">assert_eq(l.lt(r)</span><span class="s0">, </span><span class="s1">el.lt(er))</span>
        <span class="s1">assert_eq(l.gt(r)</span><span class="s0">, </span><span class="s1">el.gt(er))</span>
        <span class="s1">assert_eq(l.le(r)</span><span class="s0">, </span><span class="s1">el.le(er))</span>
        <span class="s1">assert_eq(l.ge(r)</span><span class="s0">, </span><span class="s1">el.ge(er))</span>
        <span class="s1">assert_eq(l.ne(r)</span><span class="s0">, </span><span class="s1">el.ne(er))</span>
        <span class="s1">assert_eq(l.eq(r)</span><span class="s0">, </span><span class="s1">el.eq(er))</span>

    <span class="s1">assert_eq(l + </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el + </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el * </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l - </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el - </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l / </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el / </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &amp; </span><span class="s0">True, </span><span class="s1">el &amp; </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l | </span><span class="s0">True, </span><span class="s1">el | </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l ^ </span><span class="s0">True, </span><span class="s1">el ^ </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l // </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el // </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l**</span><span class="s3">2</span><span class="s0">, </span><span class="s1">el**</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l % </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el % </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l == </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el == </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l != </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el != </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">+ l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">+ el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">* l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">- l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">- el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">/ l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ el)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">&amp; l</span><span class="s0">, True </span><span class="s1">&amp; el)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">| l</span><span class="s0">, True </span><span class="s1">| el)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">^ l</span><span class="s0">, True </span><span class="s1">^ el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">// l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">// el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2</span><span class="s1">**l</span><span class="s0">, </span><span class="s3">2</span><span class="s1">**el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">% l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">% el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt; l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt; el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt; l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt; el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt;= l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt;= el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt;= l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt;= el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">== l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">== el)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">!= l</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">!= el)</span>

    <span class="s1">assert_eq(l.lt(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.lt(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.gt(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.gt(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.le(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.le(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.ge(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.ge(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.ne(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.ne(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_eq(l.eq(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.eq(</span><span class="s3">2</span><span class="s1">))</span>

    <span class="s1">assert_eq(-l</span><span class="s0">, </span><span class="s1">-el)</span>
    <span class="s1">assert_eq(abs(l)</span><span class="s0">, </span><span class="s1">abs(el))</span>

    <span class="s0">if </span><span class="s1">allow_comparison_ops:</span>
        <span class="s4"># comparison is allowed if data have same index</span>
        <span class="s1">assert_eq(~(l == r)</span><span class="s0">, </span><span class="s1">~(el == er))</span>


<span class="s0">def </span><span class="s1">test_scalar_arithmetics():</span>
    <span class="s1">el = np.int64(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">er = np.int64(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">l = dd.core.Scalar({(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): el}</span><span class="s0">, </span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span>
    <span class="s1">r = dd.core.Scalar({(</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): er}</span><span class="s0">, </span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">isinstance(l</span><span class="s0">, </span><span class="s1">dd.core.Scalar)</span>
    <span class="s0">assert </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">dd.core.Scalar)</span>

    <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
    <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

    <span class="s1">assert_eq(l + r</span><span class="s0">, </span><span class="s1">el + er)</span>
    <span class="s1">assert_eq(l * r</span><span class="s0">, </span><span class="s1">el * er)</span>
    <span class="s1">assert_eq(l - r</span><span class="s0">, </span><span class="s1">el - er)</span>
    <span class="s1">assert_eq(l / r</span><span class="s0">, </span><span class="s1">el / er)</span>
    <span class="s1">assert_eq(l // r</span><span class="s0">, </span><span class="s1">el // er)</span>
    <span class="s1">assert_eq(l**r</span><span class="s0">, </span><span class="s1">el**er)</span>
    <span class="s1">assert_eq(l % r</span><span class="s0">, </span><span class="s1">el % er)</span>

    <span class="s1">assert_eq(l &amp; r</span><span class="s0">, </span><span class="s1">el &amp; er)</span>
    <span class="s1">assert_eq(l | r</span><span class="s0">, </span><span class="s1">el | er)</span>
    <span class="s1">assert_eq(l ^ r</span><span class="s0">, </span><span class="s1">el ^ er)</span>
    <span class="s1">assert_eq(l &gt; r</span><span class="s0">, </span><span class="s1">el &gt; er)</span>
    <span class="s1">assert_eq(l &lt; r</span><span class="s0">, </span><span class="s1">el &lt; er)</span>
    <span class="s1">assert_eq(l &gt;= r</span><span class="s0">, </span><span class="s1">el &gt;= er)</span>
    <span class="s1">assert_eq(l &lt;= r</span><span class="s0">, </span><span class="s1">el &lt;= er)</span>
    <span class="s1">assert_eq(l == r</span><span class="s0">, </span><span class="s1">el == er)</span>
    <span class="s1">assert_eq(l != r</span><span class="s0">, </span><span class="s1">el != er)</span>

    <span class="s1">assert_eq(l + </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el + </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el * </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l - </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el - </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l / </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el / </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &amp; </span><span class="s0">True, </span><span class="s1">el &amp; </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l | </span><span class="s0">True, </span><span class="s1">el | </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l ^ </span><span class="s0">True, </span><span class="s1">el ^ </span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_eq(l // </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el // </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l**</span><span class="s3">2</span><span class="s0">, </span><span class="s1">el**</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l % </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el % </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt; </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt; </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &gt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &gt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l &lt;= </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el &lt;= </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l == </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el == </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(l != </span><span class="s3">2</span><span class="s0">, </span><span class="s1">el != </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">+ r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">+ er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">* r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">- r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">- er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">/ r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">&amp; r</span><span class="s0">, True </span><span class="s1">&amp; er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">| r</span><span class="s0">, True </span><span class="s1">| er)</span>
    <span class="s1">assert_eq(</span><span class="s0">True </span><span class="s1">^ r</span><span class="s0">, True </span><span class="s1">^ er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">// r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">// er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2</span><span class="s1">**r</span><span class="s0">, </span><span class="s3">2</span><span class="s1">**er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">% r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">% er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt; r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt; er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt; r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt; er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&gt;= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&gt;= er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">&lt;= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">&lt;= er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">== r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">== er)</span>
    <span class="s1">assert_eq(</span><span class="s3">2 </span><span class="s1">!= r</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">!= er)</span>

    <span class="s1">assert_eq(-l</span><span class="s0">, </span><span class="s1">-el)</span>
    <span class="s1">assert_eq(abs(l)</span><span class="s0">, </span><span class="s1">abs(el))</span>

    <span class="s1">assert_eq(~(l == r)</span><span class="s0">, </span><span class="s1">~(el == er))</span>


<span class="s0">def </span><span class="s1">test_scalar_arithmetics_with_dask_instances():</span>
    <span class="s1">s = dd.core.Scalar({(</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): </span><span class="s3">10</span><span class="s1">}</span><span class="s0">, </span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span>
    <span class="s1">e = </span><span class="s3">10</span>

    <span class="s1">pds = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span>
    <span class="s1">dds = dd.from_pandas(pds</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">pdf = pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]})</span>
    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># pandas Series</span>
    <span class="s1">result = pds + s  </span><span class="s4"># this result pd.Series (automatically computed)</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">pd.Series)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pds + e)</span>

    <span class="s1">result = s + pds  </span><span class="s4"># this result dd.Series</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.Series)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pds + e)</span>

    <span class="s4"># dask Series</span>
    <span class="s1">result = dds + s  </span><span class="s4"># this result dd.Series</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.Series)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pds + e)</span>

    <span class="s1">result = s + dds  </span><span class="s4"># this result dd.Series</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.Series)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pds + e)</span>

    <span class="s4"># pandas DataFrame</span>
    <span class="s1">result = pdf + s  </span><span class="s4"># this result pd.DataFrame (automatically computed)</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">pd.DataFrame)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pdf + e)</span>

    <span class="s1">result = s + pdf  </span><span class="s4"># this result dd.DataFrame</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.DataFrame)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pdf + e)</span>

    <span class="s4"># dask DataFrame</span>
    <span class="s1">result = ddf + s  </span><span class="s4"># this result dd.DataFrame</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.DataFrame)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pdf + e)</span>

    <span class="s1">result = s + ddf  </span><span class="s4"># this result dd.DataFrame</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">dd.DataFrame)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">pdf + e)</span>


<span class="s1">@pytest.mark.xfail(</span>
    <span class="s1">PANDAS_VERSION == </span><span class="s2">&quot;1.0.2&quot;</span><span class="s0">,</span>
    <span class="s1">reason=</span><span class="s2">&quot;https://github.com/pandas-dev/pandas/issues/32685&quot;</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_frame_series_arithmetic_methods():</span>
    <span class="s1">pdf1 = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;A&quot;</span><span class="s1">: np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;B&quot;</span><span class="s1">: [np.nan</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">,</span>
            <span class="s2">&quot;C&quot;</span><span class="s1">: [np.nan] * </span><span class="s3">10</span><span class="s0">,</span>
            <span class="s2">&quot;D&quot;</span><span class="s1">: np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">index=list(</span><span class="s2">&quot;abcdefghij&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">columns=list(</span><span class="s2">&quot;ABCD&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pdf2 = pd.DataFrame(</span>
        <span class="s1">np.random.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=list(</span><span class="s2">&quot;abcdefghjk&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=list(</span><span class="s2">&quot;ABCX&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">ps1 = pdf1.A</span>
    <span class="s1">ps2 = pdf2.A</span>
    <span class="s1">ps3 = pd.Series(np.random.randn(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=list(</span><span class="s2">&quot;ABCDXabcde&quot;</span><span class="s1">))</span>

    <span class="s1">ddf1 = dd.from_pandas(pdf1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ddf2 = dd.from_pandas(pdf2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ds1 = ddf1.A</span>
    <span class="s1">ds2 = ddf2.A</span>

    <span class="s1">s = dd.core.Scalar({(</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): </span><span class="s3">4</span><span class="s1">}</span><span class="s0">, </span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">[</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ds1</span><span class="s0">, </span><span class="s1">ds2</span><span class="s0">, </span><span class="s1">ps1</span><span class="s0">, </span><span class="s1">ps2)</span><span class="s0">,</span>
        <span class="s1">(ddf1.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s2">&quot;j&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ddf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ds1.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s2">&quot;j&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ds2</span><span class="s0">, </span><span class="s1">ps1</span><span class="s0">, </span><span class="s1">ps2)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf2.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">,</span>
        <span class="s1">(ds1</span><span class="s0">, </span><span class="s1">ds2.repartition([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ps1</span><span class="s0">, </span><span class="s1">ps2)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ds1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">ps1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ds1</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">ps1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]:</span>
        <span class="s4"># l, r may be repartitioned, test whether repartition keeps original data</span>
        <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
        <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

        <span class="s1">assert_eq(l.add(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.add(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.sub(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.sub(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.mul(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.mul(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.div(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.div(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.divide(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.divide(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.truediv(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.truediv(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.floordiv(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.floordiv(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.pow(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.pow(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.mod(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.mod(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">assert_eq(l.radd(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.radd(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rsub(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rsub(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rmul(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rmul(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rdiv(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rdiv(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rtruediv(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rtruediv(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rpow(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rpow(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rmod(r</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rmod(er</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">[(ddf1</span><span class="s0">, </span><span class="s1">ds2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">ps2)</span><span class="s0">, </span><span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ddf2.X</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2.X)]:</span>
        <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
        <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

        <span class="s4"># must specify axis=0 to add Series to each column</span>
        <span class="s4"># axis=1 is not supported (add to each row)</span>
        <span class="s1">assert_eq(l.add(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.add(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.sub(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.sub(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.mul(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.mul(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.div(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.div(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.divide(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.divide(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.truediv(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.truediv(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.floordiv(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.floordiv(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.mod(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.mod(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.pow(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.pow(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">assert_eq(l.radd(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.radd(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rsub(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rsub(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rmul(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rmul(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rdiv(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rdiv(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rtruediv(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rtruediv(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rmod(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rmod(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(l.rpow(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">el.rpow(er</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">l=l</span><span class="s0">, </span><span class="s1">r=r: l.add(r</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">el</span><span class="s0">, </span><span class="s1">er </span><span class="s0">in </span><span class="s1">[(ddf1</span><span class="s0">, </span><span class="s1">pdf2</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">pdf2)</span><span class="s0">, </span><span class="s1">(ddf1</span><span class="s0">, </span><span class="s1">ps3</span><span class="s0">, </span><span class="s1">pdf1</span><span class="s0">, </span><span class="s1">ps3)]:</span>
        <span class="s1">assert_eq(l</span><span class="s0">, </span><span class="s1">el)</span>
        <span class="s1">assert_eq(r</span><span class="s0">, </span><span class="s1">er)</span>

        <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;columns&quot;</span><span class="s1">]:</span>
            <span class="s1">assert_eq(l.add(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.add(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.sub(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.sub(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.mul(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.mul(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.div(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.div(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.divide(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.divide(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.truediv(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.truediv(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.floordiv(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.floordiv(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.mod(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.mod(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.pow(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.pow(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rdiv(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rdiv(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rtruediv(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rtruediv(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rpow(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rpow(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rmod(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rmod(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.radd(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.radd(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rsub(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rsub(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>
            <span class="s1">assert_eq(l.rmul(r</span><span class="s0">, </span><span class="s1">axis=axis)</span><span class="s0">, </span><span class="s1">el.rmul(er</span><span class="s0">, </span><span class="s1">axis=axis))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reductions(split_every):</span>
    <span class="s1">dsk = {</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): pd.DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s0">True, True, False</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">): pd.DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s0">False, False, False</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">13094304034</span><span class="s0">, </span><span class="s3">3489385935</span><span class="s0">, </span><span class="s3">100006774</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s0">True, True, True</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">meta = make_meta(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: </span><span class="s2">&quot;bool&quot;</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">index=pd.Index([]</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">parent_meta=pd.DataFrame()</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf1 = dd.DataFrame(dsk</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">meta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">pdf1 = ddf1.compute()</span>

    <span class="s1">nans1 = pd.Series([</span><span class="s3">1</span><span class="s1">] + [np.nan] * </span><span class="s3">4 </span><span class="s1">+ [</span><span class="s3">2</span><span class="s1">] + [np.nan] * </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">nands1 = dd.from_pandas(nans1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">nans2 = pd.Series([</span><span class="s3">1</span><span class="s1">] + [np.nan] * </span><span class="s3">8</span><span class="s1">)</span>
    <span class="s1">nands2 = dd.from_pandas(nans2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">nans3 = pd.Series([np.nan] * </span><span class="s3">9</span><span class="s1">)</span>
    <span class="s1">nands3 = dd.from_pandas(nans3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">bools = pd.Series([</span><span class="s0">True, False, True, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=bool)</span>
    <span class="s1">boolds = dd.from_pandas(bools</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">dds</span><span class="s0">, </span><span class="s1">pds </span><span class="s0">in </span><span class="s1">[</span>
        <span class="s1">(ddf1.a</span><span class="s0">, </span><span class="s1">pdf1.a)</span><span class="s0">,</span>
        <span class="s1">(ddf1.b</span><span class="s0">, </span><span class="s1">pdf1.b)</span><span class="s0">,</span>
        <span class="s1">(ddf1.c</span><span class="s0">, </span><span class="s1">pdf1.c)</span><span class="s0">,</span>
        <span class="s1">(ddf1[</span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pdf1[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(ddf1[</span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pdf1[</span><span class="s2">&quot;b&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(nands1</span><span class="s0">, </span><span class="s1">nans1)</span><span class="s0">,</span>
        <span class="s1">(nands2</span><span class="s0">, </span><span class="s1">nans2)</span><span class="s0">,</span>
        <span class="s1">(nands3</span><span class="s0">, </span><span class="s1">nans3)</span><span class="s0">,</span>
        <span class="s1">(boolds</span><span class="s0">, </span><span class="s1">bools)</span><span class="s0">,</span>
    <span class="s1">]:</span>
        <span class="s0">assert </span><span class="s1">isinstance(dds</span><span class="s0">, </span><span class="s1">dd.Series)</span>
        <span class="s0">assert </span><span class="s1">isinstance(pds</span><span class="s0">, </span><span class="s1">pd.Series)</span>

        <span class="s1">assert_eq(dds.sum(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.sum())</span>
        <span class="s1">assert_eq(dds.prod(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.prod())</span>
        <span class="s1">assert_eq(dds.product(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.product())</span>
        <span class="s1">assert_eq(dds.min(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.min())</span>
        <span class="s1">assert_eq(dds.max(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.max())</span>
        <span class="s1">assert_eq(dds.count(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.count())</span>

        <span class="s0">if </span><span class="s1">scipy:</span>
            <span class="s4"># pandas uses unbiased skew, need to correct for that</span>
            <span class="s1">n = pds.shape[</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s1">bias_factor = (n * (n - </span><span class="s3">1</span><span class="s1">)) ** </span><span class="s3">0.5 </span><span class="s1">/ (n - </span><span class="s3">2</span><span class="s1">)</span>
            <span class="s1">assert_eq(dds.skew()</span><span class="s0">, </span><span class="s1">pds.skew() / bias_factor)</span>

            <span class="s0">if </span><span class="s1">PANDAS_GE_200:</span>
                <span class="s4"># TODO: Remove this `if`-block once `axis=None` support is added.</span>
                <span class="s4"># https://github.com/dask/dask/issues/9915</span>
                <span class="s0">with </span><span class="s1">pytest.raises(</span>
                    <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;`axis=None` isn't currently supported&quot;</span>
                <span class="s1">):</span>
                    <span class="s1">dds.skew(axis=</span><span class="s0">None</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">assert_eq(dds.skew(axis=</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pds.skew(axis=</span><span class="s0">None</span><span class="s1">) / bias_factor)</span>

        <span class="s0">if </span><span class="s1">scipy:</span>
            <span class="s4"># pandas uses a bias factor for kurtosis, need to correct for that</span>
            <span class="s1">n = pds.shape[</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s1">factor = ((n - </span><span class="s3">1</span><span class="s1">) * (n + </span><span class="s3">1</span><span class="s1">)) / ((n - </span><span class="s3">2</span><span class="s1">) * (n - </span><span class="s3">3</span><span class="s1">))</span>
            <span class="s1">offset = (</span><span class="s3">6 </span><span class="s1">* (n - </span><span class="s3">1</span><span class="s1">)) / ((n - </span><span class="s3">2</span><span class="s1">) * (n - </span><span class="s3">3</span><span class="s1">))</span>
            <span class="s1">assert_eq(factor * dds.kurtosis() + offset</span><span class="s0">, </span><span class="s1">pds.kurtosis())</span>

            <span class="s0">if </span><span class="s1">PANDAS_GE_200:</span>
                <span class="s4"># TODO: Remove this `if`-block once `axis=None` support is added.</span>
                <span class="s4"># https://github.com/dask/dask/issues/9915</span>
                <span class="s0">with </span><span class="s1">pytest.raises(</span>
                    <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;`axis=None` isn't currently supported&quot;</span>
                <span class="s1">):</span>
                    <span class="s1">dds.kurtosis(axis=</span><span class="s0">None</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">assert_eq(</span>
                    <span class="s1">factor * dds.kurtosis(axis=</span><span class="s0">None</span><span class="s1">) + offset</span><span class="s0">, </span><span class="s1">pds.kurtosis(axis=</span><span class="s0">None</span><span class="s1">)</span>
                <span class="s1">)</span>

        <span class="s0">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">RuntimeWarning)</span>
            <span class="s4"># runtime warnings; https://github.com/dask/dask/issues/2381</span>
            <span class="s1">assert_eq(dds.std(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.std())</span>
            <span class="s1">assert_eq(dds.var(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.var())</span>
            <span class="s1">assert_eq(dds.sem(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.sem())</span>

        <span class="s0">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s4"># dask.dataframe should probably filter this, to match pandas, but</span>
            <span class="s4"># it seems quite difficult.</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">RuntimeWarning)</span>
            <span class="s1">assert_eq(dds.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.std(ddof=</span><span class="s3">0</span><span class="s1">))</span>
            <span class="s1">assert_eq(dds.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.var(ddof=</span><span class="s3">0</span><span class="s1">))</span>
            <span class="s1">assert_eq(dds.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.sem(ddof=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_eq(dds.mean(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.mean())</span>
        <span class="s1">assert_eq(dds.nunique(split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.nunique())</span>

        <span class="s1">assert_eq(dds.sum(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.sum(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.prod(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.prod(skipna=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.product(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pds.product(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(dds.min(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.min(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(dds.max(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.max(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(dds.std(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.std(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(dds.var(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.var(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(dds.sem(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.sem(skipna=</span><span class="s0">False</span><span class="s1">))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.std(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pds.std(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pds.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.sem(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pds.sem(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">dds.mean(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pds.mean(skipna=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s1">assert_dask_graph(ddf1.b.sum(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-sum&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.prod(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-prod&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.min(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-min&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.max(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-max&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.count(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-count&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.std(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-std&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.var(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-var&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.sem(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-sem&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-std&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-var&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-sem&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.b.mean(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;series-mean&quot;</span><span class="s1">)</span>
    <span class="s4"># nunique is performed using drop-duplicates</span>
    <span class="s1">assert_dask_graph(ddf1.b.nunique(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;drop-duplicates&quot;</span><span class="s1">)</span>

    <span class="s4"># testing index</span>
    <span class="s1">assert_eq(ddf1.index.min(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.index.min())</span>
    <span class="s1">assert_eq(ddf1.index.max(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.index.max())</span>
    <span class="s1">assert_eq(ddf1.index.count(split_every=split_every)</span><span class="s0">, </span><span class="s1">pd.notnull(pdf1.index).sum())</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reductions_timedelta(split_every):</span>
    <span class="s1">ds = pd.Series(pd.to_timedelta([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]))</span>
    <span class="s1">dds = dd.from_pandas(ds</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(dds.sum(split_every=split_every)</span><span class="s0">, </span><span class="s1">ds.sum())</span>
    <span class="s1">assert_eq(dds.min(split_every=split_every)</span><span class="s0">, </span><span class="s1">ds.min())</span>
    <span class="s1">assert_eq(dds.max(split_every=split_every)</span><span class="s0">, </span><span class="s1">ds.max())</span>
    <span class="s1">assert_eq(dds.count(split_every=split_every)</span><span class="s0">, </span><span class="s1">ds.count())</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;frame,axis,out&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s1">pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s3">0</span><span class="s0">,</span>
            <span class="s1">pd.Series([]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s3">1</span><span class="s0">,</span>
            <span class="s1">pd.Series([]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">])</span><span class="s0">, None, None</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;redfunc&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s0">, </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_reductions_out(frame</span><span class="s0">, </span><span class="s1">axis</span><span class="s0">, </span><span class="s1">out</span><span class="s0">, </span><span class="s1">redfunc):</span>
    <span class="s1">dsk_in = dd.from_pandas(frame</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">dsk_out = dd.from_pandas(pd.Series([</span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s3">1</span><span class="s1">).sum()</span>

    <span class="s0">if </span><span class="s1">out </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">dsk_out = dd.from_pandas(out</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">np_redfunc = getattr(np</span><span class="s0">, </span><span class="s1">redfunc)</span>
    <span class="s1">pd_redfunc = getattr(frame.__class__</span><span class="s0">, </span><span class="s1">redfunc)</span>
    <span class="s1">dsk_redfunc = getattr(dsk_in.__class__</span><span class="s0">, </span><span class="s1">redfunc)</span>

    <span class="s0">if </span><span class="s1">redfunc </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s1">]:</span>
        <span class="s4"># numpy has default ddof value 0 while</span>
        <span class="s4"># dask and pandas have 1, so ddof should be passed</span>
        <span class="s4"># explicitly when calling np.var(dask)</span>
        <span class="s1">np_redfunc(dsk_in</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">out=dsk_out)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">ctx = contextlib.nullcontext()</span>
        <span class="s0">if </span><span class="s1">_numpy_125 </span><span class="s0">and </span><span class="s1">redfunc == </span><span class="s2">&quot;product&quot;</span><span class="s1">:</span>
            <span class="s1">ctx = pytest.warns(DeprecationWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;`product` is deprecated&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">ctx:</span>
            <span class="s1">np_redfunc(dsk_in</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">out=dsk_out)</span>

    <span class="s1">assert_eq(dsk_out</span><span class="s0">, </span><span class="s1">pd_redfunc(frame</span><span class="s0">, </span><span class="s1">axis=axis))</span>

    <span class="s1">dsk_redfunc(dsk_in</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">split_every=</span><span class="s0">False, </span><span class="s1">out=dsk_out)</span>
    <span class="s1">assert_eq(dsk_out</span><span class="s0">, </span><span class="s1">pd_redfunc(frame</span><span class="s0">, </span><span class="s1">axis=axis))</span>

    <span class="s1">dsk_redfunc(dsk_in</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">split_every=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">out=dsk_out)</span>
    <span class="s1">assert_eq(dsk_out</span><span class="s0">, </span><span class="s1">pd_redfunc(frame</span><span class="s0">, </span><span class="s1">axis=axis))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s1">@pytest.mark.xfail_with_pyarrow_strings</span>
<span class="s0">def </span><span class="s1">test_allany(split_every):</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">np.random.choice([</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">size=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">df[</span><span class="s2">&quot;E&quot;</span><span class="s1">] = list(</span><span class="s2">&quot;abcde&quot;</span><span class="s1">) * </span><span class="s3">20</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>

    <span class="s1">assert_eq(ddf.all(split_every=split_every)</span><span class="s0">, </span><span class="s1">df.all())</span>
    <span class="s1">assert_eq(ddf.all(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">df.all(axis=</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">assert_eq(ddf.all(axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">df.all(axis=</span><span class="s3">0</span><span class="s1">))</span>

    <span class="s1">assert_eq(ddf.any(split_every=split_every)</span><span class="s0">, </span><span class="s1">df.any())</span>
    <span class="s1">assert_eq(ddf.any(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">df.any(axis=</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">assert_eq(ddf.any(axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">df.any(axis=</span><span class="s3">0</span><span class="s1">))</span>

    <span class="s1">assert_eq(ddf.A.all(split_every=split_every)</span><span class="s0">, </span><span class="s1">df.A.all())</span>
    <span class="s1">assert_eq(ddf.A.any(split_every=split_every)</span><span class="s0">, </span><span class="s1">df.A.any())</span>

    <span class="s4"># testing numpy functions with out param</span>
    <span class="s1">ddf_out_axis_default = dd.from_pandas(</span>
        <span class="s1">pd.Series([</span><span class="s0">False, False, False, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s3">10</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">ddf_out_axis1 = dd.from_pandas(</span>
        <span class="s1">pd.Series(np.random.choice([</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">size=(</span><span class="s3">100</span><span class="s0">,</span><span class="s1">)))</span><span class="s0">, </span><span class="s3">10</span>
    <span class="s1">)</span>

    <span class="s4"># all</span>
    <span class="s1">ddf.all(split_every=split_every</span><span class="s0">, </span><span class="s1">out=ddf_out_axis_default)</span>
    <span class="s1">assert_eq(ddf_out_axis_default</span><span class="s0">, </span><span class="s1">df.all())</span>

    <span class="s1">ddf.all(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every</span><span class="s0">, </span><span class="s1">out=ddf_out_axis1)</span>
    <span class="s1">assert_eq(ddf_out_axis1</span><span class="s0">, </span><span class="s1">df.all(axis=</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">ddf.all(split_every=split_every</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">out=ddf_out_axis_default)</span>
    <span class="s1">assert_eq(ddf_out_axis_default</span><span class="s0">, </span><span class="s1">df.all(axis=</span><span class="s3">0</span><span class="s1">))</span>

    <span class="s4"># any</span>
    <span class="s1">ddf.any(split_every=split_every</span><span class="s0">, </span><span class="s1">out=ddf_out_axis_default)</span>
    <span class="s1">assert_eq(ddf_out_axis_default</span><span class="s0">, </span><span class="s1">df.any())</span>

    <span class="s1">ddf.any(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every</span><span class="s0">, </span><span class="s1">out=ddf_out_axis1)</span>
    <span class="s1">assert_eq(ddf_out_axis1</span><span class="s0">, </span><span class="s1">df.any(axis=</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">ddf.any(split_every=split_every</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">out=ddf_out_axis_default)</span>
    <span class="s1">assert_eq(ddf_out_axis_default</span><span class="s0">, </span><span class="s1">df.any(axis=</span><span class="s3">0</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_deterministic_reduction_names(split_every):</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s2">&quot;x&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">: [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]})</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">[ddf</span><span class="s0">, </span><span class="s1">ddf.x]:</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.sum(split_every=split_every)._name == x.sum(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.prod(split_every=split_every)._name</span>
            <span class="s1">== x.prod(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.product(split_every=split_every)._name</span>
            <span class="s1">== x.product(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.min(split_every=split_every)._name == x.min(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.max(split_every=split_every)._name == x.max(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.count(split_every=split_every)._name</span>
            <span class="s1">== x.count(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.std(split_every=split_every)._name == x.std(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.var(split_every=split_every)._name == x.var(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.sem(split_every=split_every)._name == x.sem(split_every=split_every)._name</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">(</span>
            <span class="s1">x.mean(split_every=split_every)._name</span>
            <span class="s1">== x.mean(split_every=split_every)._name</span>
        <span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">(</span>
        <span class="s1">ddf.x.nunique(split_every=split_every)._name</span>
        <span class="s1">== ddf.x.nunique(split_every=split_every)._name</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_reduction_series_invalid_axis():</span>
    <span class="s1">dsk = {</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">meta = make_meta(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=pd.Index([]</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">parent_meta=pd.DataFrame()</span>
    <span class="s1">)</span>
    <span class="s1">ddf1 = dd.DataFrame(dsk</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">meta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">pdf1 = ddf1.compute()</span>

    <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;columns&quot;</span><span class="s1">]:</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">[ddf1.a</span><span class="s0">, </span><span class="s1">pdf1.a]:  </span><span class="s4"># both must behave the same</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.sum(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.prod(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.product(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.min(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.max(axis=axis))</span>
            <span class="s4"># only count doesn't have axis keyword</span>
            <span class="s1">pytest.raises(TypeError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.count(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.std(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.var(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.sem(axis=axis))</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">axis=axis: s.mean(axis=axis))</span>


<span class="s1">@pytest.mark.xfail_with_pyarrow_strings</span>
<span class="s0">def </span><span class="s1">test_reductions_non_numeric_dtypes():</span>
    <span class="s4"># test non-numric blocks</span>

    <span class="s0">def </span><span class="s1">check_raises(d</span><span class="s0">, </span><span class="s1">p</span><span class="s0">, </span><span class="s1">func):</span>
        <span class="s1">pytest.raises((TypeError</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">, lambda</span><span class="s1">: getattr(d</span><span class="s0">, </span><span class="s1">func)().compute())</span>
        <span class="s1">pytest.raises((TypeError</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">, lambda</span><span class="s1">: getattr(p</span><span class="s0">, </span><span class="s1">func)())</span>

    <span class="s1">pds = pd.Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">])</span>
    <span class="s1">dds = dd.from_pandas(pds</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(dds.sum()</span><span class="s0">, </span><span class="s1">pds.sum())</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s1">)</span>
    <span class="s1">assert_eq(dds.min()</span><span class="s0">, </span><span class="s1">pds.min())</span>
    <span class="s1">assert_eq(dds.max()</span><span class="s0">, </span><span class="s1">pds.max())</span>
    <span class="s1">assert_eq(dds.count()</span><span class="s0">, </span><span class="s1">pds.count())</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;sem&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;skew&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">)</span>
    <span class="s1">assert_eq(dds.nunique()</span><span class="s0">, </span><span class="s1">pds.nunique())</span>

    <span class="s0">for </span><span class="s1">pds </span><span class="s0">in </span><span class="s1">[</span>
        <span class="s1">pd.Series(pd.Categorical([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">pd.Series(pd.Categorical(list(</span><span class="s2">&quot;abcde&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">pd.Series(pd.date_range(</span><span class="s2">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">]:</span>
        <span class="s1">dds = dd.from_pandas(pds</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;sum&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s1">)</span>
        <span class="s1">assert_eq(dds.min()</span><span class="s0">, </span><span class="s1">pds.min())</span>
        <span class="s1">assert_eq(dds.max()</span><span class="s0">, </span><span class="s1">pds.max())</span>
        <span class="s1">assert_eq(dds.count()</span><span class="s0">, </span><span class="s1">pds.count())</span>
        <span class="s0">if </span><span class="s1">pds.dtype != </span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="s1">:</span>
            <span class="s4"># std is implemented for datetimes in pandas 1.2.0, but dask</span>
            <span class="s4"># implementation depends on var which isn't</span>
            <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;sem&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;skew&quot;</span><span class="s1">)</span>
        <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">)</span>
        <span class="s1">assert_eq(dds.nunique()</span><span class="s0">, </span><span class="s1">pds.nunique())</span>

    <span class="s1">pds = pd.Series(pd.timedelta_range(</span><span class="s2">&quot;1 days&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">dds = dd.from_pandas(pds</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(dds.sum()</span><span class="s0">, </span><span class="s1">pds.sum())</span>
    <span class="s1">assert_eq(dds.min()</span><span class="s0">, </span><span class="s1">pds.min())</span>
    <span class="s1">assert_eq(dds.max()</span><span class="s0">, </span><span class="s1">pds.max())</span>
    <span class="s1">assert_eq(dds.count()</span><span class="s0">, </span><span class="s1">pds.count())</span>
    <span class="s4"># both pandas and dask skew calculations do not support timedelta</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;skew&quot;</span><span class="s1">)</span>
    <span class="s1">check_raises(dds</span><span class="s0">, </span><span class="s1">pds</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">)</span>

    <span class="s4"># ToDo: pandas supports timedelta std, dask returns float64</span>
    <span class="s4"># assert_eq(dds.std(), pds.std())</span>

    <span class="s4"># ToDo: pandas supports timedelta std, otherwise dask raises:</span>
    <span class="s4"># TypeError: unsupported operand type(s) for *: 'float' and 'Timedelta'</span>
    <span class="s4"># assert_eq(dds.mean(), pds.mean())</span>

    <span class="s1">assert_eq(dds.nunique()</span><span class="s0">, </span><span class="s1">pds.nunique())</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reductions_frame(split_every):</span>
    <span class="s1">dsk = {</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">meta = make_meta(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;i8&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=pd.Index([]</span><span class="s0">, </span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">parent_meta=pd.DataFrame()</span>
    <span class="s1">)</span>
    <span class="s1">ddf1 = dd.DataFrame(dsk</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">meta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">pdf1 = ddf1.compute()</span>

    <span class="s1">assert_eq(ddf1.sum(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.sum())</span>
    <span class="s1">assert_eq(ddf1.prod(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.prod())</span>
    <span class="s1">assert_eq(ddf1.product(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.product())</span>
    <span class="s1">assert_eq(ddf1.min(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.min())</span>
    <span class="s1">assert_eq(ddf1.max(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.max())</span>
    <span class="s1">assert_eq(ddf1.count(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.count())</span>
    <span class="s1">assert_eq(ddf1.std(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.std())</span>
    <span class="s1">assert_eq(ddf1.var(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.var())</span>
    <span class="s1">assert_eq(ddf1.sem(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.sem())</span>
    <span class="s1">assert_eq(ddf1.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.std(ddof=</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">assert_eq(ddf1.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.var(ddof=</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">assert_eq(ddf1.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.sem(ddof=</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">assert_eq(ddf1.mean(split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.mean())</span>

    <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;columns&quot;</span><span class="s1">]:</span>
        <span class="s1">assert_eq(ddf1.sum(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.sum(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.prod(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.prod(axis=axis))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">ddf1.product(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.product(axis=axis)</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(ddf1.min(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.min(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.max(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.max(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.count(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.count(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.std(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.std(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.var(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.var(axis=axis))</span>
        <span class="s1">assert_eq(ddf1.sem(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.sem(axis=axis))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">ddf1.std(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pdf1.std(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">ddf1.var(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pdf1.var(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">ddf1.sem(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
            <span class="s1">pdf1.sem(axis=axis</span><span class="s0">, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(ddf1.mean(axis=axis</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s1">pdf1.mean(axis=axis))</span>

    <span class="s1">pytest.raises(ValueError</span><span class="s0">, lambda</span><span class="s1">: ddf1.sum(axis=</span><span class="s2">&quot;incorrect&quot;</span><span class="s1">).compute())</span>

    <span class="s4"># axis=None</span>
    <span class="s0">if </span><span class="s1">PANDAS_GE_140 </span><span class="s0">and not </span><span class="s1">PANDAS_GE_200:</span>
        <span class="s1">ctx = pytest.warns(FutureWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;axis=None&quot;</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">ctx = contextlib.nullcontext()</span>
    <span class="s4"># min</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">result = ddf1.min(axis=</span><span class="s0">None, </span><span class="s1">split_every=split_every)</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">expected = pdf1.min(axis=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s4"># max</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">result = ddf1.max(axis=</span><span class="s0">None, </span><span class="s1">split_every=split_every)</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">expected = pdf1.max(axis=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s4"># mean</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">result = ddf1.mean(axis=</span><span class="s0">None, </span><span class="s1">split_every=split_every)</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">expected = pdf1.mean(axis=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># axis=0</span>
    <span class="s1">assert_dask_graph(ddf1.sum(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-sum&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.prod(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-prod&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.min(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-min&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.max(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-max&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.count(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-count&quot;</span><span class="s1">)</span>

    <span class="s4"># std, var, sem, and mean consist of moment_* operations</span>
    <span class="s1">assert_dask_graph(ddf1.std(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-var&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.std(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_chunk&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.std(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_agg&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.std(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;values&quot;</span><span class="s1">)</span>

    <span class="s1">assert_dask_graph(ddf1.var(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_chunk&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.var(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_agg&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.var(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;values&quot;</span><span class="s1">)</span>

    <span class="s1">assert_dask_graph(ddf1.sem(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-var&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.sem(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_chunk&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.sem(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;moment_agg&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.sem(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;values&quot;</span><span class="s1">)</span>

    <span class="s1">assert_dask_graph(ddf1.mean(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-sum&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.mean(split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-count&quot;</span><span class="s1">)</span>

    <span class="s4"># axis=1</span>
    <span class="s1">assert_dask_graph(ddf1.sum(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-sum&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.prod(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-prod&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.min(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-min&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.max(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-max&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.count(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-count&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-std&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.var(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-var&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.sem(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-sem&quot;</span><span class="s1">)</span>
    <span class="s1">assert_dask_graph(ddf1.mean(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">, </span><span class="s2">&quot;dataframe-mean&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;func, kwargs&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;sum&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;prod&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;product&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;mean&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;std&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;min&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;max&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;count&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;sem&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;sem&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;sem&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;sem&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;var&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;ddof&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;skipna&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;numeric_only&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s0">None,</span>
        <span class="s0">True,</span>
        <span class="s1">pytest.param(</span>
            <span class="s0">False,</span>
            <span class="s1">marks=pytest.mark.xfail(</span>
                <span class="s0">True, </span><span class="s1">reason=</span><span class="s2">&quot;numeric_only=False not implemented&quot;</span><span class="s0">, </span><span class="s1">strict=</span><span class="s0">False</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_reductions_frame_dtypes(func</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">numeric_only):</span>
    <span class="s0">if </span><span class="s1">pyarrow_strings_enabled() </span><span class="s0">and </span><span class="s1">func == </span><span class="s2">&quot;sum&quot; </span><span class="s0">and </span><span class="s1">numeric_only </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">pytest.xfail(</span><span class="s2">&quot;Known failure with pyarrow strings&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;int&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;float&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">8.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt&quot;</span><span class="s1">: [pd.NaT] + [datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s2">&quot;str&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;timedelta&quot;</span><span class="s1">: pd.to_timedelta([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
            <span class="s2">&quot;bool&quot;</span><span class="s1">: [</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s3">4</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s0">if </span><span class="s1">kwargs </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">kwargs = {}</span>

    <span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is False or </span><span class="s1">numeric_only </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;median&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;sem&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">):</span>
            <span class="s4"># datetime columns don't support some aggs</span>
            <span class="s1">df = df.drop(columns=[</span><span class="s2">&quot;dt&quot;</span><span class="s0">, </span><span class="s2">&quot;timedelta&quot;</span><span class="s1">])</span>
        <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;sem&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">):</span>
            <span class="s4"># string columns don't support some other aggs</span>
            <span class="s1">df = df.drop(columns=[</span><span class="s2">&quot;str&quot;</span><span class="s1">])</span>

    <span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">kwargs[</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">] = numeric_only</span>

    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">check_numeric_only_deprecation():</span>
        <span class="s1">expected = getattr(df</span><span class="s0">, </span><span class="s1">func)(**kwargs)</span>
        <span class="s1">actual = getattr(ddf</span><span class="s0">, </span><span class="s1">func)(**kwargs)</span>
        <span class="s1">assert_eq(expected</span><span class="s0">, </span><span class="s1">actual)</span>


<span class="s0">def </span><span class="s1">test_count_numeric_only_axis_one():</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;int&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;float&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">8.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt&quot;</span><span class="s1">: [pd.NaT] + [datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s2">&quot;str&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;timedelta&quot;</span><span class="s1">: pd.to_timedelta([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
            <span class="s2">&quot;bool&quot;</span><span class="s1">: [</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s3">4</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(ddf.count(axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df.count(axis=</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">assert_eq(</span>
        <span class="s1">ddf.count(numeric_only=</span><span class="s0">False, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df.count(numeric_only=</span><span class="s0">False, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">assert_eq(ddf.count(numeric_only=</span><span class="s0">True, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df.count(numeric_only=</span><span class="s0">True, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s0">, </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;count&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;quantile&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_reductions_frame_dtypes_numeric_only_supported(func):</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;int&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;float&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">8.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt&quot;</span><span class="s1">: [pd.NaT] + [datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s2">&quot;str&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;timedelta&quot;</span><span class="s1">: pd.to_timedelta([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
            <span class="s2">&quot;bool&quot;</span><span class="s1">: [</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s3">4</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">npartitions = </span><span class="s3">3</span>
    <span class="s0">if </span><span class="s1">func == </span><span class="s2">&quot;quantile&quot;</span><span class="s1">:</span>
        <span class="s4"># bool doesn't work in pandas quantile</span>
        <span class="s1">df = df.drop(columns=</span><span class="s2">&quot;bool&quot;</span><span class="s1">)</span>
        <span class="s1">npartitions = </span><span class="s3">1  </span><span class="s4"># https://github.com/dask/dask/issues/9227</span>

    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions)</span>

    <span class="s1">numeric_only_false_raises = [</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;quantile&quot;</span><span class="s1">]</span>

    <span class="s4"># `numeric_only=True` is always supported</span>
    <span class="s1">assert_eq(</span>
        <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">errors = TypeError </span><span class="s0">if </span><span class="s1">pa </span><span class="s0">is None else </span><span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">ArrowNotImplementedError)</span>

    <span class="s4"># `numeric_only=False`</span>
    <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">numeric_only_false_raises:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(</span>
            <span class="s1">errors</span><span class="s0">,</span>
            <span class="s1">match=</span><span class="s2">&quot;'DatetimeArray' with dtype datetime64.*|&quot;</span>
            <span class="s2">&quot;'DatetimeArray' does not implement reduction|could not convert|&quot;</span>
            <span class="s2">&quot;'ArrowStringArray' with dtype string&quot;</span>
            <span class="s2">&quot;|unsupported operand|no kernel&quot;</span><span class="s0">,</span>
        <span class="s1">):</span>
            <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">warning = FutureWarning</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">warning = </span><span class="s0">None</span>

    <span class="s4"># `numeric_only` default value</span>
    <span class="s0">if </span><span class="s1">PANDAS_GE_200:</span>
        <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">numeric_only_false_raises:</span>
            <span class="s0">with </span><span class="s1">pytest.raises(</span>
                <span class="s1">errors</span><span class="s0">,</span>
                <span class="s1">match=</span><span class="s2">&quot;'DatetimeArray' with dtype datetime64.*|&quot;</span>
                <span class="s2">&quot;'DatetimeArray' does not implement reduction|could not convert|&quot;</span>
                <span class="s2">&quot;'ArrowStringArray' with dtype string&quot;</span>
                <span class="s2">&quot;|unsupported operand|no kernel&quot;</span><span class="s0">,</span>
            <span class="s1">):</span>
                <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">assert_eq(</span>
                <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
                <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
            <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">PANDAS_GE_150:</span>
        <span class="s0">with </span><span class="s1">pytest.warns(warning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;The default value of numeric_only&quot;</span><span class="s1">):</span>
            <span class="s1">pd_result = getattr(df</span><span class="s0">, </span><span class="s1">func)()</span>
        <span class="s0">with </span><span class="s1">pytest.warns(warning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;The default value of numeric_only&quot;</span><span class="s1">):</span>
            <span class="s1">dd_result = getattr(ddf</span><span class="s0">, </span><span class="s1">func)()</span>
        <span class="s1">assert_eq(pd_result</span><span class="s0">, </span><span class="s1">dd_result)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;quantile&quot;</span><span class="s1">]:</span>
            <span class="s1">warning = </span><span class="s0">None</span>
        <span class="s0">with </span><span class="s1">pytest.warns(warning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Dropping of nuisance&quot;</span><span class="s1">):</span>
            <span class="s1">pd_result = getattr(df</span><span class="s0">, </span><span class="s1">func)()</span>
        <span class="s0">with </span><span class="s1">pytest.warns(warning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Dropping of nuisance&quot;</span><span class="s1">):</span>
            <span class="s1">dd_result = getattr(ddf</span><span class="s0">, </span><span class="s1">func)()</span>
        <span class="s1">assert_eq(pd_result</span><span class="s0">, </span><span class="s1">dd_result)</span>

    <span class="s1">num_cols = [</span><span class="s2">&quot;int&quot;</span><span class="s0">, </span><span class="s2">&quot;float&quot;</span><span class="s1">]</span>
    <span class="s0">if </span><span class="s1">func != </span><span class="s2">&quot;quantile&quot;</span><span class="s1">:</span>
        <span class="s1">num_cols.append(</span><span class="s2">&quot;bool&quot;</span><span class="s1">)</span>

    <span class="s1">df_numerics = df[num_cols]</span>
    <span class="s1">ddf_numerics = ddf[num_cols]</span>

    <span class="s1">assert_eq(</span>
        <span class="s1">getattr(df_numerics</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
        <span class="s1">getattr(ddf_numerics</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_eq(</span>
        <span class="s1">getattr(df_numerics</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">getattr(ddf_numerics</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;func&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s2">&quot;mean&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;sem&quot;</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_reductions_frame_dtypes_numeric_only(func):</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;int&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;float&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">8.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt&quot;</span><span class="s1">: [pd.NaT] + [datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s2">&quot;str&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abcdefgh&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;timedelta&quot;</span><span class="s1">: pd.to_timedelta([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
            <span class="s2">&quot;bool&quot;</span><span class="s1">: [</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s3">4</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">kwargs = {</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span>

    <span class="s1">assert_eq(</span>
        <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)(**kwargs)</span><span class="s0">,</span>
        <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(**kwargs)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;'numeric_only=False&quot;</span><span class="s1">):</span>
        <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">assert_eq(df.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs)</span><span class="s0">, </span><span class="s1">ddf.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs))</span>
    <span class="s1">assert_eq(df.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs)</span><span class="s0">, </span><span class="s1">ddf.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs))</span>
    <span class="s1">assert_eq(df.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs)</span><span class="s0">, </span><span class="s1">ddf.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs))</span>
    <span class="s1">assert_eq(df.var(skipna=</span><span class="s0">False, </span><span class="s1">**kwargs)</span><span class="s0">, </span><span class="s1">ddf.var(skipna=</span><span class="s0">False, </span><span class="s1">**kwargs))</span>
    <span class="s1">assert_eq(</span>
        <span class="s1">df.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs)</span><span class="s0">, </span><span class="s1">ddf.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">)</span>

    <span class="s4"># ------ only include numerics columns ------ #</span>
    <span class="s1">assert_eq(df._get_numeric_data()</span><span class="s0">, </span><span class="s1">ddf._get_numeric_data())</span>

    <span class="s1">df_numerics = df[[</span><span class="s2">&quot;int&quot;</span><span class="s0">, </span><span class="s2">&quot;float&quot;</span><span class="s0">, </span><span class="s2">&quot;bool&quot;</span><span class="s1">]]</span>
    <span class="s1">ddf_numerics = ddf[[</span><span class="s2">&quot;int&quot;</span><span class="s0">, </span><span class="s2">&quot;float&quot;</span><span class="s0">, </span><span class="s2">&quot;bool&quot;</span><span class="s1">]]</span>

    <span class="s1">assert_eq(df_numerics</span><span class="s0">, </span><span class="s1">ddf._get_numeric_data())</span>
    <span class="s0">assert </span><span class="s1">ddf_numerics._get_numeric_data().dask == ddf_numerics.dask</span>

    <span class="s1">assert_eq(</span>
        <span class="s1">getattr(df_numerics</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
        <span class="s1">getattr(ddf_numerics</span><span class="s0">, </span><span class="s1">func)()</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;skew&quot;</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_skew_kurt_numeric_only_false(func):</span>
    <span class="s1">pytest.importorskip(</span><span class="s2">&quot;scipy.stats&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;int&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;float&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">6.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">8.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt&quot;</span><span class="s1">: [pd.NaT] + [datetime(</span><span class="s3">2010</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ctx = pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;does not support|does not implement&quot;</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)(numeric_only=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">PANDAS_GE_150 </span><span class="s0">and not </span><span class="s1">PANDAS_GE_200:</span>
        <span class="s1">ctx = pytest.warns(FutureWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;default value&quot;</span><span class="s1">)</span>
    <span class="s0">elif not </span><span class="s1">PANDAS_GE_150:</span>
        <span class="s1">ctx = pytest.warns(FutureWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;nuisance columns&quot;</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">getattr(df</span><span class="s0">, </span><span class="s1">func)()</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">getattr(ddf</span><span class="s0">, </span><span class="s1">func)()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;split_every&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s3">2</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reductions_frame_nan(split_every):</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
            <span class="s2">&quot;c&quot;</span><span class="s1">: [np.nan] * </span><span class="s3">8</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">assert_eq(df.sum()</span><span class="s0">, </span><span class="s1">ddf.sum(split_every=split_every))</span>
    <span class="s1">assert_eq(df.prod()</span><span class="s0">, </span><span class="s1">ddf.prod(split_every=split_every))</span>
    <span class="s1">assert_eq(df.product()</span><span class="s0">, </span><span class="s1">ddf.product(split_every=split_every))</span>
    <span class="s1">assert_eq(df.min()</span><span class="s0">, </span><span class="s1">ddf.min(split_every=split_every))</span>
    <span class="s1">assert_eq(df.max()</span><span class="s0">, </span><span class="s1">ddf.max(split_every=split_every))</span>
    <span class="s1">assert_eq(df.count()</span><span class="s0">, </span><span class="s1">ddf.count(split_every=split_every))</span>
    <span class="s0">with </span><span class="s1">warnings.catch_warnings():</span>
        <span class="s4"># dask.dataframe should probably filter this, to match pandas, but</span>
        <span class="s4"># it seems quite difficult.</span>
        <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">RuntimeWarning)</span>
        <span class="s1">assert_eq(df.std()</span><span class="s0">, </span><span class="s1">ddf.std(split_every=split_every))</span>
        <span class="s1">assert_eq(df.var()</span><span class="s0">, </span><span class="s1">ddf.var(split_every=split_every))</span>
        <span class="s1">assert_eq(df.sem()</span><span class="s0">, </span><span class="s1">ddf.sem(split_every=split_every))</span>
        <span class="s1">assert_eq(df.std(ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.std(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.var(ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.var(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.sem(ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.sem(ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every))</span>
    <span class="s1">assert_eq(df.mean()</span><span class="s0">, </span><span class="s1">ddf.mean(split_every=split_every))</span>

    <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">assert_eq(df.sum(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.sum(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.prod(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.prod(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.product(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.product(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(df.min(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.min(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.max(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.max(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.std(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.std(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.var(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.var(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(df.sem(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.sem(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every))</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.std(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.std(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.var(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.sem(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.sem(skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.mean(skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ddf.mean(skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span>
        <span class="s1">)</span>

        <span class="s1">assert_eq(</span>
            <span class="s1">df.sum(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.sum(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.prod(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.prod(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.product(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.product(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.min(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.min(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.max(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.max(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.var(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.var(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.sem(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.sem(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.var(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.var(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.sem(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.sem(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">ddof=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_eq(</span>
            <span class="s1">df.mean(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">ddf.mean(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">skipna=</span><span class="s0">False, </span><span class="s1">split_every=split_every)</span><span class="s0">,</span>
        <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;comparison&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;lt&quot;</span><span class="s0">, </span><span class="s2">&quot;gt&quot;</span><span class="s0">, </span><span class="s2">&quot;le&quot;</span><span class="s0">, </span><span class="s2">&quot;ge&quot;</span><span class="s0">, </span><span class="s2">&quot;ne&quot;</span><span class="s0">, </span><span class="s2">&quot;eq&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_series_comparison_nan(comparison):</span>
    <span class="s1">s = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">])</span>
    <span class="s1">s_nan = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">2.4</span><span class="s1">])</span>
    <span class="s1">ds = dd.from_pandas(s</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ds_nan = dd.from_pandas(s_nan</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">fill_value = </span><span class="s3">7</span>
    <span class="s1">comparison_pd = getattr(s</span><span class="s0">, </span><span class="s1">comparison)</span>
    <span class="s1">comparison_dd = getattr(ds</span><span class="s0">, </span><span class="s1">comparison)</span>
    <span class="s1">assert_eq(</span>
        <span class="s1">comparison_dd(ds_nan</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span><span class="s0">,</span>
        <span class="s1">comparison_pd(s_nan</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_sum_intna():</span>
    <span class="s1">a = pd.Series([</span><span class="s3">1</span><span class="s0">, None, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=pd.Int32Dtype())</span>
    <span class="s1">b = dd.from_pandas(a</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_eq(a.sum()</span><span class="s0">, </span><span class="s1">b.sum())</span>


<span class="s0">def </span><span class="s1">test_divmod():</span>
    <span class="s1">df1 = pd.Series(np.random.rand(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">df2 = pd.Series(np.random.rand(</span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">ddf1 = dd.from_pandas(df1</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ddf2 = dd.from_pandas(df2</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">result = divmod(ddf1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">)</span>
    <span class="s1">expected = divmod(df1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">)</span>
    <span class="s1">assert_eq(result[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">assert_eq(result[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">1</span><span class="s1">])</span>

    <span class="s1">result = divmod(ddf1</span><span class="s0">, </span><span class="s1">ddf2)</span>
    <span class="s1">expected = divmod(df1</span><span class="s0">, </span><span class="s1">df2)</span>
    <span class="s1">assert_eq(result[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">assert_eq(result[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">1</span><span class="s1">])</span>


<span class="s1">@pytest.mark.skipif(</span><span class="s2">&quot;not scipy&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_moment():</span>
    <span class="s0">from </span><span class="s1">dask.array </span><span class="s0">import </span><span class="s1">stats</span>
    <span class="s0">from </span><span class="s1">dask.array.utils </span><span class="s0">import </span><span class="s1">assert_eq</span>

    <span class="s1">df = pd.Series(list(range(</span><span class="s3">10</span><span class="s1">)))</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_eq(stats.moment(ddf</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">scipy.stats.moment(df</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;count&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;sem&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_empty_df_reductions(func):</span>
    <span class="s1">pdf = pd.DataFrame()</span>
    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">dsk_func = getattr(ddf.__class__</span><span class="s0">, </span><span class="s1">func)</span>
    <span class="s1">pd_func = getattr(pdf.__class__</span><span class="s0">, </span><span class="s1">func)</span>

    <span class="s1">assert_eq(dsk_func(ddf)</span><span class="s0">, </span><span class="s1">pd_func(pdf))</span>

    <span class="s1">idx = pd.date_range(</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">pdf = pd.DataFrame(index=idx)</span>
    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">assert_eq(dsk_func(ddf)</span><span class="s0">, </span><span class="s1">pd_func(pdf))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;method&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;product&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;min_count&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_series_agg_with_min_count(method</span><span class="s0">, </span><span class="s1">min_count):</span>
    <span class="s1">df = pd.DataFrame([[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>
    <span class="s1">ddf = dd.from_pandas(df</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">func = getattr(ddf[</span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">method)</span>
    <span class="s1">result = func(min_count=min_count).compute()</span>
    <span class="s0">if </span><span class="s1">min_count == </span><span class="s3">0</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">result == </span><span class="s3">1</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">np.nan</span>


<span class="s4"># Default absolute tolerance of 2000 nanoseconds</span>
<span class="s0">def </span><span class="s1">assert_near_timedeltas(t1</span><span class="s0">, </span><span class="s1">t2</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">2000</span><span class="s1">):</span>
    <span class="s0">if </span><span class="s1">is_scalar(t1):</span>
        <span class="s1">t1 = pd.Series([t1])</span>
    <span class="s0">if </span><span class="s1">is_scalar(t2):</span>
        <span class="s1">t2 = pd.Series([t2])</span>

    <span class="s0">assert </span><span class="s1">t1.dtype == t2.dtype</span>
    <span class="s1">assert_eq(pd.to_numeric(t1)</span><span class="s0">, </span><span class="s1">pd.to_numeric(t2)</span><span class="s0">, </span><span class="s1">atol=atol)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;numeric_only&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, None</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_datetime_std_creates_copy_cols(axis</span><span class="s0">, </span><span class="s1">numeric_only):</span>
    <span class="s1">pdf = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;dt1&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426700 </span><span class="s1">+ (i * </span><span class="s3">250000</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt2&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426700 </span><span class="s1">+ (i * </span><span class="s3">300000</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">kwargs = {} </span><span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is None else </span><span class="s1">{</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">: numeric_only}</span>

    <span class="s4"># Series test (same line twice to make sure data structure wasn't mutated)</span>
    <span class="s1">assert_eq(ddf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs)</span><span class="s0">, </span><span class="s1">pdf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs))</span>
    <span class="s1">assert_eq(ddf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs)</span><span class="s0">, </span><span class="s1">pdf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs))</span>

    <span class="s4"># DataFrame test (same line twice to make sure data structure wasn't mutated)</span>
    <span class="s1">expected = pdf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">assert_near_timedeltas(result.compute()</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected = pdf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">assert_near_timedeltas(result.compute()</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;skipna&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;numeric_only&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, None</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_datetime_std_with_larger_dataset(axis</span><span class="s0">, </span><span class="s1">skipna</span><span class="s0">, </span><span class="s1">numeric_only):</span>
    <span class="s1">num_rows = </span><span class="s3">250</span>

    <span class="s1">dt1 = pd.concat(</span>
        <span class="s1">[</span>
            <span class="s1">pd.Series([pd.NaT] * </span><span class="s3">15</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">15</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">pd.to_datetime(</span>
                <span class="s1">pd.Series(</span>
                    <span class="s1">[</span>
                        <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">250000</span><span class="s1">))</span>
                        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_rows - </span><span class="s3">15</span><span class="s1">)</span>
                    <span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">index=range(</span><span class="s3">15</span><span class="s0">, </span><span class="s3">250</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">ignore_index=</span><span class="s0">False,</span>
    <span class="s1">)</span>

    <span class="s1">base_numbers = [</span>
        <span class="s1">(</span><span class="s3">1638290040706793300 </span><span class="s1">+ (i * </span><span class="s3">69527182702409</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(num_rows)</span>
    <span class="s1">]</span>

    <span class="s1">pdf = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;dt1&quot;</span><span class="s1">: dt1</span><span class="s0">, </span><span class="s2">&quot;dt2&quot;</span><span class="s1">: pd.to_datetime(pd.Series(base_numbers))}</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">250</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">8</span><span class="s1">):</span>
        <span class="s1">pdf[</span><span class="s2">f&quot;dt</span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">] = pd.to_datetime(</span>
            <span class="s1">pd.Series([int(x + (</span><span class="s3">0.12 </span><span class="s1">* i)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">base_numbers])</span>
        <span class="s1">)</span>

    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span>

    <span class="s1">kwargs = {} </span><span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is None else </span><span class="s1">{</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">: numeric_only}</span>
    <span class="s1">kwargs[</span><span class="s2">&quot;skipna&quot;</span><span class="s1">] = skipna</span>

    <span class="s1">expected = pdf[[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">]].std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf[[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">]].std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">assert_near_timedeltas(result.compute()</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># Same thing but as Series. No axis, since axis=1 raises error</span>
    <span class="s1">assert_near_timedeltas(ddf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs).compute()</span><span class="s0">, </span><span class="s1">pdf[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">].std(**kwargs))</span>

    <span class="s4"># Computation on full dataset</span>
    <span class="s1">expected = pdf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf.std(axis=axis</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">assert_near_timedeltas(result.compute()</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;skipna&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;numeric_only&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, None</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_datetime_std_across_axis1_null_results(skipna</span><span class="s0">, </span><span class="s1">numeric_only):</span>
    <span class="s1">pdf = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;dt1&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">250000</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt2&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">217790</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;nums&quot;</span><span class="s1">: [i </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">ddf = dd.from_pandas(pdf</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">kwargs = {} </span><span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is None else </span><span class="s1">{</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">: numeric_only}</span>
    <span class="s1">kwargs[</span><span class="s2">&quot;skipna&quot;</span><span class="s1">] = skipna</span>

    <span class="s1">ctx = contextlib.nullcontext()</span>
    <span class="s1">success = </span><span class="s0">True</span>
    <span class="s0">if </span><span class="s1">numeric_only </span><span class="s0">is False or </span><span class="s1">(PANDAS_GE_200 </span><span class="s0">and </span><span class="s1">numeric_only </span><span class="s0">is None</span><span class="s1">):</span>
        <span class="s1">ctx = pytest.raises(TypeError)</span>
        <span class="s1">success = </span><span class="s0">False</span>
    <span class="s0">elif </span><span class="s1">numeric_only </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ctx = pytest.warns(FutureWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;numeric_only&quot;</span><span class="s1">)</span>

    <span class="s4"># Single column always results in NaT</span>
    <span class="s1">expected = pdf[[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">]].std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf[[</span><span class="s2">&quot;dt1&quot;</span><span class="s1">]].std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">if </span><span class="s1">success:</span>
        <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># Mix of datetimes with other numeric types produces NaNs</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">expected = pdf.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">with </span><span class="s1">ctx:</span>
        <span class="s1">result = ddf.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">if </span><span class="s1">success:</span>
        <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># Test with mix of na and truthy datetimes</span>
    <span class="s1">pdf2 = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;dt1&quot;</span><span class="s1">: [pd.NaT]</span>
            <span class="s1">+ [datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">250000</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">10</span><span class="s1">)]</span>
            <span class="s1">+ [pd.NaT]</span><span class="s0">,</span>
            <span class="s2">&quot;dt2&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">250000</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">12</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt3&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime.fromtimestamp(</span><span class="s3">1636426704 </span><span class="s1">+ (i * </span><span class="s3">282616</span><span class="s1">)) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">12</span><span class="s1">)</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">ddf2 = dd.from_pandas(pdf2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">expected = pdf2.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">result = ddf2.std(axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">if </span><span class="s1">success:</span>
        <span class="s1">assert_eq(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_std_raises_on_index():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(</span>
        <span class="s1">NotImplementedError</span><span class="s0">,</span>
        <span class="s1">match=</span><span class="s2">&quot;`std` is only supported with objects that are Dataframes or Series&quot;</span><span class="s0">,</span>
    <span class="s1">):</span>
        <span class="s1">dd.from_pandas(pd.DataFrame({</span><span class="s2">&quot;test&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]})</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">).index.std()</span>


<span class="s1">@pytest.mark.skipif(</span><span class="s0">not </span><span class="s1">PANDAS_GE_200</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;ArrowDtype not supported&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_std_raises_with_arrow_string_ea():</span>
    <span class="s1">pa = pytest.importorskip(</span><span class="s2">&quot;pyarrow&quot;</span><span class="s1">)</span>
    <span class="s1">ser = pd.Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=pd.ArrowDtype(pa.string()))</span>
    <span class="s1">ds = dd.from_pandas(ser</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;`std` not supported with string series&quot;</span><span class="s1">):</span>
        <span class="s1">ds.std()</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;dtype&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">pytest.param(</span>
            <span class="s2">&quot;int64[pyarrow]&quot;</span><span class="s0">,</span>
            <span class="s1">marks=pytest.mark.skipif(</span>
                <span class="s1">pa </span><span class="s0">is None or not </span><span class="s1">PANDAS_GE_150</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;requires pyarrow installed&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">pytest.param(</span>
            <span class="s2">&quot;float64[pyarrow]&quot;</span><span class="s0">,</span>
            <span class="s1">marks=pytest.mark.skipif(</span>
                <span class="s1">pa </span><span class="s0">is None or not </span><span class="s1">PANDAS_GE_150</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;requires pyarrow installed&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;Int64&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;Int32&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;Float64&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;UInt64&quot;</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;std&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;skew&quot;</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reductions_with_pandas_and_arrow_ea(dtype</span><span class="s0">, </span><span class="s1">func):</span>
    <span class="s0">if </span><span class="s1">func </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;skew&quot;</span><span class="s0">, </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">]:</span>
        <span class="s1">pytest.importorskip(</span><span class="s2">&quot;scipy&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s2">&quot;pyarrow&quot; </span><span class="s0">in </span><span class="s1">dtype:</span>
            <span class="s1">pytest.xfail(</span><span class="s2">&quot;skew/kurtosis not implemented for arrow dtypes&quot;</span><span class="s1">)</span>

    <span class="s1">ser = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">ds = dd.from_pandas(ser</span><span class="s0">, </span><span class="s1">npartitions=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">pd_result = getattr(ser</span><span class="s0">, </span><span class="s1">func)()</span>
    <span class="s1">dd_result = getattr(ds</span><span class="s0">, </span><span class="s1">func)()</span>
    <span class="s0">if </span><span class="s1">func == </span><span class="s2">&quot;kurtosis&quot;</span><span class="s1">:</span>
        <span class="s1">n = ser.shape[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">factor = ((n - </span><span class="s3">1</span><span class="s1">) * (n + </span><span class="s3">1</span><span class="s1">)) / ((n - </span><span class="s3">2</span><span class="s1">) * (n - </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">offset = (</span><span class="s3">6 </span><span class="s1">* (n - </span><span class="s3">1</span><span class="s1">)) / ((n - </span><span class="s3">2</span><span class="s1">) * (n - </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">dd_result = factor * dd_result + offset</span>
    <span class="s4"># _meta is wrongly NA</span>
    <span class="s1">assert_eq(dd_result</span><span class="s0">, </span><span class="s1">pd_result</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>
</pre>
</body>
</html>
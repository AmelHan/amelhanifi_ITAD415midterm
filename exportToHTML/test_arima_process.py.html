<html>
<head>
<title>test_arima_process.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arima_process.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime </span><span class="s0">as </span><span class="s1">dt</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">,</span>
    <span class="s1">assert_allclose</span><span class="s0">,</span>
    <span class="s1">assert_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_equal</span><span class="s0">,</span>
    <span class="s1">assert_raises</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">statsmodels.sandbox.tsa.fftarma </span><span class="s0">import </span><span class="s1">ArmaFft</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.arima.model </span><span class="s0">import </span><span class="s1">ARIMA</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.arima_process </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">ArmaProcess</span><span class="s0">,</span>
    <span class="s1">arma_acf</span><span class="s0">,</span>
    <span class="s1">arma_acovf</span><span class="s0">,</span>
    <span class="s1">arma_generate_sample</span><span class="s0">,</span>
    <span class="s1">arma_impulse_response</span><span class="s0">,</span>
    <span class="s1">index2lpol</span><span class="s0">,</span>
    <span class="s1">lpol2index</span><span class="s0">,</span>
    <span class="s1">lpol_fiar</span><span class="s0">,</span>
    <span class="s1">lpol_fima</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.tests.results </span><span class="s0">import </span><span class="s1">results_arma_acf</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.tests.results.results_process </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">armarep</span><span class="s0">,  </span><span class="s2"># benchmarkdata</span>
<span class="s1">)</span>

<span class="s1">arlist = [</span>
    <span class="s1">[</span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">,  </span><span class="s2"># ma representation will need many terms to get high precision</span>
    <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">]</span><span class="s0">,</span>
<span class="s1">]</span>

<span class="s1">malist = [[</span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.3</span><span class="s1">]]</span>

<span class="s1">DECIMAL_4 = </span><span class="s3">4</span>


<span class="s0">def </span><span class="s1">test_arma_acovf():</span>
    <span class="s2"># Check for specific AR(1)</span>
    <span class="s1">N = </span><span class="s3">20</span>
    <span class="s1">phi = </span><span class="s3">0.9</span>
    <span class="s1">sigma = </span><span class="s3">1</span>
    <span class="s2"># rep 1: from module function</span>
    <span class="s1">rep1 = arma_acovf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-phi]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">N)</span>
    <span class="s2"># rep 2: manually</span>
    <span class="s1">rep2 = [</span><span class="s3">1.0 </span><span class="s1">* sigma * phi ** i / (</span><span class="s3">1 </span><span class="s1">- phi ** </span><span class="s3">2</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(N)]</span>
    <span class="s1">assert_allclose(rep1</span><span class="s0">, </span><span class="s1">rep2)</span>


<span class="s0">def </span><span class="s1">test_arma_acovf_persistent():</span>
    <span class="s2"># Test arma_acovf in case where there is a near-unit root.</span>
    <span class="s2"># .999 is high enough to trigger the &quot;while ir[-1] &gt; 5*1e-5:&quot; clause,</span>
    <span class="s2"># but not high enough to trigger the &quot;nobs_ir &gt; 50000&quot; clause.</span>
    <span class="s1">ar = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9995</span><span class="s1">])</span>
    <span class="s1">ma = np.array([</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">process = ArmaProcess(ar</span><span class="s0">, </span><span class="s1">ma)</span>
    <span class="s1">res = process.acovf(</span><span class="s3">10</span><span class="s1">)</span>

    <span class="s2"># Theoretical variance sig2 given by:</span>
    <span class="s2"># sig2 = .9995**2 * sig2 + 1</span>
    <span class="s1">sig2 = </span><span class="s3">1 </span><span class="s1">/ (</span><span class="s3">1 </span><span class="s1">- </span><span class="s3">0.9995 </span><span class="s1">** </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">corrs = </span><span class="s3">0.9995 </span><span class="s1">** np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">expected = sig2 * corrs</span>
    <span class="s1">assert_equal(res.ndim</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_allclose(res</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_arma_acf():</span>
    <span class="s2"># Check for specific AR(1)</span>
    <span class="s1">N = </span><span class="s3">20</span>
    <span class="s1">phi = </span><span class="s3">0.9</span>
    <span class="s1">sigma = </span><span class="s3">1</span>
    <span class="s2"># rep 1: from module function</span>
    <span class="s1">rep1 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-phi]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">N)</span>
    <span class="s2"># rep 2: manually</span>
    <span class="s1">acovf = np.array(</span>
        <span class="s1">[</span><span class="s3">1.0 </span><span class="s1">* sigma * phi ** i / (</span><span class="s3">1 </span><span class="s1">- phi ** </span><span class="s3">2</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(N)]</span>
    <span class="s1">)</span>
    <span class="s1">rep2 = acovf / (</span><span class="s3">1.0 </span><span class="s1">/ (</span><span class="s3">1 </span><span class="s1">- phi ** </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">assert_allclose(rep1</span><span class="s0">, </span><span class="s1">rep2)</span>


<span class="s0">def </span><span class="s1">test_arma_acf_compare_R_ARMAacf():</span>
    <span class="s2"># Test specific cases against output from R's ARMAacf</span>
    <span class="s1">bd_example_3_3_2 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(bd_example_3_3_2</span><span class="s0">, </span><span class="s1">results_arma_acf.bd_example_3_3_2)</span>
    <span class="s1">example_1 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_1</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_1)</span>
    <span class="s1">example_2 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_2</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_2)</span>
    <span class="s1">example_3 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.35</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_3</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_3)</span>
    <span class="s1">example_4 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.35</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_4</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_4)</span>
    <span class="s1">example_5 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_5</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_5)</span>
    <span class="s1">example_6 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_6</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_6)</span>
    <span class="s1">example_7 = arma_acf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.02</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span>
    <span class="s1">assert_allclose(example_7</span><span class="s0">, </span><span class="s1">results_arma_acf.custom_example_7)</span>


<span class="s0">def </span><span class="s1">test_arma_acov_compare_theoretical_arma_acov():</span>
    <span class="s2"># Test against the older version of this function, which used a different</span>
    <span class="s2"># approach that nicely shows the theoretical relationship</span>
    <span class="s2"># See GH:5324 when this was removed for full version of the function</span>
    <span class="s2"># including documentation and inline comments</span>

    <span class="s0">def </span><span class="s1">arma_acovf_historical(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s1">nobs=</span><span class="s3">10</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">np.abs(np.sum(ar) - </span><span class="s3">1</span><span class="s1">) &gt; </span><span class="s3">0.9</span><span class="s1">:</span>
            <span class="s1">nobs_ir = max(</span><span class="s3">1000</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* nobs)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">nobs_ir = max(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* nobs)</span>
        <span class="s1">ir = arma_impulse_response(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s1">leads=nobs_ir)</span>
        <span class="s0">while </span><span class="s1">ir[-</span><span class="s3">1</span><span class="s1">] &gt; </span><span class="s3">5 </span><span class="s1">* </span><span class="s3">1e-5</span><span class="s1">:</span>
            <span class="s1">nobs_ir *= </span><span class="s3">10</span>
            <span class="s1">ir = arma_impulse_response(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s1">leads=nobs_ir)</span>
        <span class="s0">if </span><span class="s1">nobs_ir &gt; </span><span class="s3">50000 </span><span class="s0">and </span><span class="s1">nobs &lt; </span><span class="s3">1001</span><span class="s1">:</span>
            <span class="s1">end = len(ir)</span>
            <span class="s1">acovf = np.array(</span>
                <span class="s1">[</span>
                    <span class="s1">np.dot(ir[: end - nobs - t]</span><span class="s0">, </span><span class="s1">ir[t : end - nobs])</span>
                    <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(nobs)</span>
                <span class="s1">]</span>
            <span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">acovf = np.correlate(ir</span><span class="s0">, </span><span class="s1">ir</span><span class="s0">, </span><span class="s4">&quot;full&quot;</span><span class="s1">)[len(ir) - </span><span class="s3">1 </span><span class="s1">:]</span>
        <span class="s0">return </span><span class="s1">acovf[:nobs]</span>

    <span class="s1">assert_allclose(</span>
        <span class="s1">arma_acovf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">arma_acovf_historical([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">arma_acovf([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.99</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">arma_acovf_historical([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.99</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">_manual_arma_generate_sample(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s1">eta):</span>
    <span class="s1">T = len(eta)</span>
    <span class="s1">ar = ar[::-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">ma = ma[::-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">p</span><span class="s0">, </span><span class="s1">q = len(ar)</span><span class="s0">, </span><span class="s1">len(ma)</span>
    <span class="s1">rep2 = [</span><span class="s3">0</span><span class="s1">] * max(p</span><span class="s0">, </span><span class="s1">q)  </span><span class="s2"># initialize with zeroes</span>
    <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(T):</span>
        <span class="s1">yt = eta[t]</span>
        <span class="s0">if </span><span class="s1">p:</span>
            <span class="s1">yt += np.dot(rep2[-p:]</span><span class="s0">, </span><span class="s1">ar)</span>
        <span class="s0">if </span><span class="s1">q:</span>
            <span class="s2"># left pad shocks with zeros</span>
            <span class="s1">yt += np.dot([</span><span class="s3">0</span><span class="s1">] * (q - t) + list(eta[max(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">t - q) : t])</span><span class="s0">, </span><span class="s1">ma)</span>
        <span class="s1">rep2.append(yt)</span>
    <span class="s0">return </span><span class="s1">np.array(rep2[max(p</span><span class="s0">, </span><span class="s1">q) :])</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ar&quot;</span><span class="s0">, </span><span class="s1">arlist)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ma&quot;</span><span class="s0">, </span><span class="s1">malist)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;dist&quot;</span><span class="s0">, </span><span class="s1">[np.random.standard_normal])</span>
<span class="s0">def </span><span class="s1">test_arma_generate_sample(dist</span><span class="s0">, </span><span class="s1">ar</span><span class="s0">, </span><span class="s1">ma):</span>
    <span class="s2"># Test that this generates a true ARMA process</span>
    <span class="s2"># (amounts to just a test that scipy.signal.lfilter does what we want)</span>
    <span class="s1">T = </span><span class="s3">100</span>
    <span class="s1">np.random.seed(</span><span class="s3">1234</span><span class="s1">)</span>
    <span class="s1">eta = dist(T)</span>

    <span class="s2"># rep1: from module function</span>
    <span class="s1">np.random.seed(</span><span class="s3">1234</span><span class="s1">)</span>
    <span class="s1">rep1 = arma_generate_sample(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s1">T</span><span class="s0">, </span><span class="s1">distrvs=dist)</span>
    <span class="s2"># rep2: &quot;manually&quot; create the ARMA process</span>
    <span class="s1">ar_params = -</span><span class="s3">1 </span><span class="s1">* np.array(ar[</span><span class="s3">1</span><span class="s1">:])</span>
    <span class="s1">ma_params = np.array(ma[</span><span class="s3">1</span><span class="s1">:])</span>
    <span class="s1">rep2 = _manual_arma_generate_sample(ar_params</span><span class="s0">, </span><span class="s1">ma_params</span><span class="s0">, </span><span class="s1">eta)</span>
    <span class="s1">assert_array_almost_equal(rep1</span><span class="s0">, </span><span class="s1">rep2</span><span class="s0">, </span><span class="s3">13</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_fi():</span>
    <span class="s2"># test identity of ma and ar representation of fi lag polynomial</span>
    <span class="s1">n = </span><span class="s3">100</span>
    <span class="s1">mafromar = arma_impulse_response(lpol_fiar(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s1">n=n)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">n)</span>
    <span class="s1">assert_array_almost_equal(mafromar</span><span class="s0">, </span><span class="s1">lpol_fima(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s1">n=n)</span><span class="s0">, </span><span class="s3">13</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_arma_impulse_response():</span>
    <span class="s1">arrep = arma_impulse_response(armarep.ma</span><span class="s0">, </span><span class="s1">armarep.ar</span><span class="s0">, </span><span class="s1">leads=</span><span class="s3">21</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">:]</span>
    <span class="s1">marep = arma_impulse_response(armarep.ar</span><span class="s0">, </span><span class="s1">armarep.ma</span><span class="s0">, </span><span class="s1">leads=</span><span class="s3">21</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">:]</span>
    <span class="s1">assert_array_almost_equal(armarep.marep.ravel()</span><span class="s0">, </span><span class="s1">marep</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)</span>
    <span class="s2"># difference in sign convention to matlab for AR term</span>
    <span class="s1">assert_array_almost_equal(-armarep.arrep.ravel()</span><span class="s0">, </span><span class="s1">arrep</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ar&quot;</span><span class="s0">, </span><span class="s1">arlist)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ma&quot;</span><span class="s0">, </span><span class="s1">malist)</span>
<span class="s0">def </span><span class="s1">test_spectrum(ar</span><span class="s0">, </span><span class="s1">ma):</span>
    <span class="s1">nfreq = </span><span class="s3">20</span>
    <span class="s1">w = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s1">nfreq</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">arma = ArmaFft(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">spdr</span><span class="s0">, </span><span class="s1">wr = arma.spdroots(w)</span>
    <span class="s1">spdp</span><span class="s0">, </span><span class="s1">wp = arma.spdpoly(w</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">spdd</span><span class="s0">, </span><span class="s1">wd = arma.spddirect(nfreq * </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">assert_equal(w</span><span class="s0">, </span><span class="s1">wr)</span>
    <span class="s1">assert_equal(w</span><span class="s0">, </span><span class="s1">wp)</span>
    <span class="s1">assert_almost_equal(w</span><span class="s0">, </span><span class="s1">wd[:nfreq]</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">spdr</span><span class="s0">,</span>
        <span class="s1">spdd[:nfreq]</span><span class="s0">,</span>
        <span class="s1">decimal=</span><span class="s3">7</span><span class="s0">,</span>
        <span class="s1">err_msg=</span><span class="s4">&quot;spdr spdd not equal for %s, %s&quot; </span><span class="s1">% (ar</span><span class="s0">, </span><span class="s1">ma)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">spdr</span><span class="s0">,</span>
        <span class="s1">spdp</span><span class="s0">,</span>
        <span class="s1">decimal=</span><span class="s3">7</span><span class="s0">,</span>
        <span class="s1">err_msg=</span><span class="s4">&quot;spdr spdp not equal for %s, %s&quot; </span><span class="s1">% (ar</span><span class="s0">, </span><span class="s1">ma)</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ar&quot;</span><span class="s0">, </span><span class="s1">arlist)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;ma&quot;</span><span class="s0">, </span><span class="s1">malist)</span>
<span class="s0">def </span><span class="s1">test_armafft(ar</span><span class="s0">, </span><span class="s1">ma):</span>
    <span class="s2"># test other methods</span>
    <span class="s1">nfreq = </span><span class="s3">20</span>
    <span class="s1">w = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s1">nfreq</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">arma = ArmaFft(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">ac1 = arma.invpowerspd(</span><span class="s3">1024</span><span class="s1">)[:</span><span class="s3">10</span><span class="s1">]</span>
    <span class="s1">ac2 = arma.acovf(</span><span class="s3">10</span><span class="s1">)[:</span><span class="s3">10</span><span class="s1">]</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">ac1</span><span class="s0">, </span><span class="s1">ac2</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-15</span><span class="s0">, </span><span class="s1">err_msg=</span><span class="s4">&quot;acovf not equal for %s, %s&quot; </span><span class="s1">% (ar</span><span class="s0">, </span><span class="s1">ma)</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_lpol2index_index2lpol():</span>
    <span class="s1">process = ArmaProcess([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.8</span><span class="s1">])</span>
    <span class="s1">coefs</span><span class="s0">, </span><span class="s1">locs = lpol2index(process.arcoefs)</span>
    <span class="s1">assert_almost_equal(coefs</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.8</span><span class="s1">])</span>
    <span class="s1">assert_equal(locs</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">])</span>

    <span class="s1">process = ArmaProcess([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.8</span><span class="s1">])</span>
    <span class="s1">coefs</span><span class="s0">, </span><span class="s1">locs = lpol2index(process.arcoefs)</span>
    <span class="s1">assert_almost_equal(coefs</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">])</span>
    <span class="s1">assert_equal(locs</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ar = index2lpol(coefs</span><span class="s0">, </span><span class="s1">locs)</span>
    <span class="s1">assert_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">ar)</span>


<span class="s0">class </span><span class="s1">TestArmaProcess:</span>
    <span class="s0">def </span><span class="s1">test_empty_coeff(self):</span>
        <span class="s1">process = ArmaProcess()</span>
        <span class="s1">assert_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">np.array([]))</span>
        <span class="s1">assert_equal(process.macoefs</span><span class="s0">, </span><span class="s1">np.array([]))</span>

        <span class="s1">process = ArmaProcess([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.8</span><span class="s1">])</span>
        <span class="s1">assert_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">0.8</span><span class="s1">]))</span>
        <span class="s1">assert_equal(process.macoefs</span><span class="s0">, </span><span class="s1">np.array([]))</span>

        <span class="s1">process = ArmaProcess(ma=[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.8</span><span class="s1">])</span>
        <span class="s1">assert_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">np.array([]))</span>
        <span class="s1">assert_equal(process.macoefs</span><span class="s0">, </span><span class="s1">np.array([-</span><span class="s3">0.8</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_from_roots(self):</span>
        <span class="s1">ar = [</span><span class="s3">1.8</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">]</span>
        <span class="s1">ma = [</span><span class="s3">0.3</span><span class="s1">]</span>

        <span class="s1">ar.insert(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ma.insert(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ar_p = -</span><span class="s3">1 </span><span class="s1">* np.array(ar)</span>
        <span class="s1">ma_p = ma</span>
        <span class="s1">process_direct = ArmaProcess(ar_p</span><span class="s0">, </span><span class="s1">ma_p)</span>

        <span class="s1">process = ArmaProcess.from_roots(np.array(process_direct.maroots)</span><span class="s0">, </span><span class="s1">np.array(process_direct.arroots))</span>

        <span class="s1">assert_almost_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">process_direct.arcoefs)</span>
        <span class="s1">assert_almost_equal(process.macoefs</span><span class="s0">, </span><span class="s1">process_direct.macoefs)</span>
        <span class="s1">assert_almost_equal(process.nobs</span><span class="s0">, </span><span class="s1">process_direct.nobs)</span>
        <span class="s1">assert_almost_equal(process.maroots</span><span class="s0">, </span><span class="s1">process_direct.maroots)</span>
        <span class="s1">assert_almost_equal(process.arroots</span><span class="s0">, </span><span class="s1">process_direct.arroots)</span>
        <span class="s1">assert_almost_equal(process.isinvertible</span><span class="s0">, </span><span class="s1">process_direct.isinvertible)</span>
        <span class="s1">assert_almost_equal(process.isstationary</span><span class="s0">, </span><span class="s1">process_direct.isstationary)</span>

        <span class="s1">process_direct = ArmaProcess(ar=ar_p)</span>
        <span class="s1">process = ArmaProcess.from_roots(arroots=np.array(process_direct.arroots))</span>

        <span class="s1">assert_almost_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">process_direct.arcoefs)</span>
        <span class="s1">assert_almost_equal(process.macoefs</span><span class="s0">, </span><span class="s1">process_direct.macoefs)</span>
        <span class="s1">assert_almost_equal(process.nobs</span><span class="s0">, </span><span class="s1">process_direct.nobs)</span>
        <span class="s1">assert_almost_equal(process.maroots</span><span class="s0">, </span><span class="s1">process_direct.maroots)</span>
        <span class="s1">assert_almost_equal(process.arroots</span><span class="s0">, </span><span class="s1">process_direct.arroots)</span>
        <span class="s1">assert_almost_equal(process.isinvertible</span><span class="s0">, </span><span class="s1">process_direct.isinvertible)</span>
        <span class="s1">assert_almost_equal(process.isstationary</span><span class="s0">, </span><span class="s1">process_direct.isstationary)</span>

        <span class="s1">process_direct = ArmaProcess(ma=ma_p)</span>
        <span class="s1">process = ArmaProcess.from_roots(maroots=np.array(process_direct.maroots))</span>

        <span class="s1">assert_almost_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">process_direct.arcoefs)</span>
        <span class="s1">assert_almost_equal(process.macoefs</span><span class="s0">, </span><span class="s1">process_direct.macoefs)</span>
        <span class="s1">assert_almost_equal(process.nobs</span><span class="s0">, </span><span class="s1">process_direct.nobs)</span>
        <span class="s1">assert_almost_equal(process.maroots</span><span class="s0">, </span><span class="s1">process_direct.maroots)</span>
        <span class="s1">assert_almost_equal(process.arroots</span><span class="s0">, </span><span class="s1">process_direct.arroots)</span>
        <span class="s1">assert_almost_equal(process.isinvertible</span><span class="s0">, </span><span class="s1">process_direct.isinvertible)</span>
        <span class="s1">assert_almost_equal(process.isstationary</span><span class="s0">, </span><span class="s1">process_direct.isstationary)</span>

        <span class="s1">process_direct = ArmaProcess()</span>
        <span class="s1">process = ArmaProcess.from_roots()</span>

        <span class="s1">assert_almost_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">process_direct.arcoefs)</span>
        <span class="s1">assert_almost_equal(process.macoefs</span><span class="s0">, </span><span class="s1">process_direct.macoefs)</span>
        <span class="s1">assert_almost_equal(process.nobs</span><span class="s0">, </span><span class="s1">process_direct.nobs)</span>
        <span class="s1">assert_almost_equal(process.maroots</span><span class="s0">, </span><span class="s1">process_direct.maroots)</span>
        <span class="s1">assert_almost_equal(process.arroots</span><span class="s0">, </span><span class="s1">process_direct.arroots)</span>
        <span class="s1">assert_almost_equal(process.isinvertible</span><span class="s0">, </span><span class="s1">process_direct.isinvertible)</span>
        <span class="s1">assert_almost_equal(process.isstationary</span><span class="s0">, </span><span class="s1">process_direct.isstationary)</span>

    <span class="s0">def </span><span class="s1">test_from_coeff(self):</span>
        <span class="s1">ar = [</span><span class="s3">1.8</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">]</span>
        <span class="s1">ma = [</span><span class="s3">0.3</span><span class="s1">]</span>
        <span class="s1">process = ArmaProcess.from_coeffs(np.array(ar)</span><span class="s0">, </span><span class="s1">np.array(ma))</span>

        <span class="s1">ar.insert(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ma.insert(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ar_p = -</span><span class="s3">1 </span><span class="s1">* np.array(ar)</span>
        <span class="s1">ma_p = ma</span>
        <span class="s1">process_direct = ArmaProcess(ar_p</span><span class="s0">, </span><span class="s1">ma_p)</span>

        <span class="s1">assert_equal(process.arcoefs</span><span class="s0">, </span><span class="s1">process_direct.arcoefs)</span>
        <span class="s1">assert_equal(process.macoefs</span><span class="s0">, </span><span class="s1">process_direct.macoefs)</span>
        <span class="s1">assert_equal(process.nobs</span><span class="s0">, </span><span class="s1">process_direct.nobs)</span>
        <span class="s1">assert_equal(process.maroots</span><span class="s0">, </span><span class="s1">process_direct.maroots)</span>
        <span class="s1">assert_equal(process.arroots</span><span class="s0">, </span><span class="s1">process_direct.arroots)</span>
        <span class="s1">assert_equal(process.isinvertible</span><span class="s0">, </span><span class="s1">process_direct.isinvertible)</span>
        <span class="s1">assert_equal(process.isstationary</span><span class="s0">, </span><span class="s1">process_direct.isstationary)</span>

    <span class="s0">def </span><span class="s1">test_process_multiplication(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">process2 = ArmaProcess.from_coeffs([</span><span class="s3">0.7</span><span class="s1">])</span>
        <span class="s1">process3 = process1 * process2</span>
        <span class="s1">assert_equal(process3.arcoefs</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.7 </span><span class="s1">* </span><span class="s3">0.9</span><span class="s1">]))</span>
        <span class="s1">assert_equal(process3.macoefs</span><span class="s0">, </span><span class="s1">np.array([]))</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2</span><span class="s1">])</span>
        <span class="s1">process2 = ArmaProcess.from_coeffs([</span><span class="s3">0.7</span><span class="s1">])</span>
        <span class="s1">process3 = process1 * process2</span>

        <span class="s1">assert_equal(process3.arcoefs</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.7 </span><span class="s1">* </span><span class="s3">0.9</span><span class="s1">]))</span>
        <span class="s1">assert_equal(process3.macoefs</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">0.2</span><span class="s1">]))</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2</span><span class="s1">])</span>
        <span class="s1">process2 = process1 * (np.array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.7</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.0</span><span class="s1">]))</span>
        <span class="s1">assert_equal(process2.arcoefs</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.7 </span><span class="s1">* </span><span class="s3">0.9</span><span class="s1">]))</span>

        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">process1.__mul__</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_str_repr(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2</span><span class="s1">])</span>
        <span class="s1">out = process1.__str__()</span>
        <span class="s1">print(out)</span>
        <span class="s1">assert_(out.find(</span><span class="s4">&quot;AR: [1.0, -0.9]&quot;</span><span class="s1">) != -</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(out.find(</span><span class="s4">&quot;MA: [1.0, 0.2]&quot;</span><span class="s1">) != -</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">out = process1.__repr__()</span>
        <span class="s1">assert_(out.find(</span><span class="s4">&quot;nobs=100&quot;</span><span class="s1">) != -</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(out.find(</span><span class="s4">&quot;at &quot; </span><span class="s1">+ str(hex(id(process1)))) != -</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_acf(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">acf = process1.acf(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">expected = np.array(</span><span class="s3">0.9</span><span class="s1">) ** np.arange(</span><span class="s3">10.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(acf</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">acf = process1.acf()</span>
        <span class="s1">assert_(acf.shape[</span><span class="s3">0</span><span class="s1">] == process1.nobs)</span>

    <span class="s0">def </span><span class="s1">test_pacf(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">pacf = process1.pacf(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">expected = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">] + [</span><span class="s3">0</span><span class="s1">] * </span><span class="s3">8</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(pacf</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">pacf = process1.pacf()</span>
        <span class="s1">assert_(pacf.shape[</span><span class="s3">0</span><span class="s1">] == process1.nobs)</span>

    <span class="s0">def </span><span class="s1">test_isstationary(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">1.1</span><span class="s1">])</span>
        <span class="s1">assert_equal(process1.isstationary</span><span class="s0">, False</span><span class="s1">)</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">1.8</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">assert_equal(process1.isstationary</span><span class="s0">, True</span><span class="s1">)</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([</span><span class="s3">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">])</span>
        <span class="s1">print(np.abs(process1.arroots))</span>
        <span class="s1">assert_equal(process1.isstationary</span><span class="s0">, False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_arma2ar(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.8</span><span class="s1">])</span>
        <span class="s1">vals = process1.arma2ar(</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(vals</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.8</span><span class="s1">) ** np.arange(</span><span class="s3">100.0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_invertroots(self):</span>
        <span class="s1">process1 = ArmaProcess.from_coeffs([]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2.5</span><span class="s1">])</span>
        <span class="s1">process2 = process1.invertroots(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(process2.ma</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">]))</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.4</span><span class="s1">])</span>
        <span class="s1">process2 = process1.invertroots(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(process2.ma</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">]))</span>

        <span class="s1">process1 = ArmaProcess.from_coeffs([]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2.5</span><span class="s1">])</span>
        <span class="s1">roots</span><span class="s0">, </span><span class="s1">invertable = process1.invertroots(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(invertable</span><span class="s0">, False</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(roots</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_generate_sample(self):</span>
        <span class="s1">process = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">sample = process.generate_sample()</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">expected = np.random.randn(</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">100</span><span class="s1">):</span>
            <span class="s1">expected[i] = </span><span class="s3">0.9 </span><span class="s1">* expected[i - </span><span class="s3">1</span><span class="s1">] + expected[i]</span>
        <span class="s1">assert_almost_equal(sample</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">process = ArmaProcess.from_coeffs([</span><span class="s3">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">sample = process.generate_sample()</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">expected = np.random.randn(</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">expected[</span><span class="s3">1</span><span class="s1">] = </span><span class="s3">1.6 </span><span class="s1">* expected[</span><span class="s3">0</span><span class="s1">] + expected[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">100</span><span class="s1">):</span>
            <span class="s1">expected[i] = (</span>
                <span class="s3">1.6 </span><span class="s1">* expected[i - </span><span class="s3">1</span><span class="s1">] - </span><span class="s3">0.9 </span><span class="s1">* expected[i - </span><span class="s3">2</span><span class="s1">] + expected[i]</span>
            <span class="s1">)</span>
        <span class="s1">assert_almost_equal(sample</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">process = ArmaProcess.from_coeffs([</span><span class="s3">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">sample = process.generate_sample(burnin=</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">expected = np.random.randn(</span><span class="s3">200</span><span class="s1">)</span>
        <span class="s1">expected[</span><span class="s3">1</span><span class="s1">] = </span><span class="s3">1.6 </span><span class="s1">* expected[</span><span class="s3">0</span><span class="s1">] + expected[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">200</span><span class="s1">):</span>
            <span class="s1">expected[i] = (</span>
                <span class="s3">1.6 </span><span class="s1">* expected[i - </span><span class="s3">1</span><span class="s1">] - </span><span class="s3">0.9 </span><span class="s1">* expected[i - </span><span class="s3">2</span><span class="s1">] + expected[i]</span>
            <span class="s1">)</span>
        <span class="s1">assert_almost_equal(sample</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">100</span><span class="s1">:])</span>

        <span class="s1">np.random.seed(</span><span class="s3">12345</span><span class="s1">)</span>
        <span class="s1">sample = process.generate_sample(nsample=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
        <span class="s1">assert_equal(sample.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_impulse_response(self):</span>
        <span class="s1">process = ArmaProcess.from_coeffs([</span><span class="s3">0.9</span><span class="s1">])</span>
        <span class="s1">ir = process.impulse_response(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(ir</span><span class="s0">, </span><span class="s3">0.9 </span><span class="s1">** np.arange(</span><span class="s3">10</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_periodogram(self):</span>
        <span class="s1">process = ArmaProcess()</span>
        <span class="s1">pg = process.periodogram()</span>
        <span class="s1">assert_almost_equal(pg[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, False</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(pg[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.sqrt(</span><span class="s3">2 </span><span class="s1">/ np.pi) / </span><span class="s3">2 </span><span class="s1">* np.ones(</span><span class="s3">100</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;seasonal&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_from_estimation(d</span><span class="s0">, </span><span class="s1">seasonal):</span>
    <span class="s1">ar = [</span><span class="s3">0.8</span><span class="s1">] </span><span class="s0">if not </span><span class="s1">seasonal </span><span class="s0">else </span><span class="s1">[</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.16</span><span class="s1">]</span>
    <span class="s1">ma = [</span><span class="s3">0.4</span><span class="s1">] </span><span class="s0">if not </span><span class="s1">seasonal </span><span class="s0">else </span><span class="s1">[</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.08</span><span class="s1">]</span>
    <span class="s1">ap = ArmaProcess.from_coeffs(ar</span><span class="s0">, </span><span class="s1">ma</span><span class="s0">, </span><span class="s3">500</span><span class="s1">)</span>
    <span class="s1">idx = pd.date_range(dt.datetime(</span><span class="s3">1900</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">500</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;Q&quot;</span><span class="s1">)</span>
    <span class="s1">data = ap.generate_sample(</span><span class="s3">500</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">d == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">data = np.cumsum(data)</span>
    <span class="s1">data = pd.Series(data</span><span class="s0">, </span><span class="s1">index=idx)</span>
    <span class="s1">seasonal_order = (</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">) </span><span class="s0">if </span><span class="s1">seasonal </span><span class="s0">else None</span>
    <span class="s1">mod = ARIMA(data</span><span class="s0">, </span><span class="s1">order=(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">d</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">seasonal_order=seasonal_order)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">ap_from = ArmaProcess.from_estimation(res)</span>
    <span class="s1">shape = (</span><span class="s3">5</span><span class="s0">,</span><span class="s1">) </span><span class="s0">if </span><span class="s1">seasonal </span><span class="s0">else </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ap_from.arcoefs.shape == shape</span>
    <span class="s0">assert </span><span class="s1">ap_from.macoefs.shape == shape</span>
</pre>
</body>
</html>
<html>
<head>
<title>test_contingency_tables.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_contingency_tables.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for contingency table analyses. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">statsmodels.stats.contingency_tables </span><span class="s2">as </span><span class="s1">ctab</span>
<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_equal</span>
<span class="s2">import </span><span class="s1">statsmodels.api </span><span class="s2">as </span><span class="s1">sm</span>

<span class="s1">cur_dir = os.path.dirname(os.path.abspath(__file__))</span>
<span class="s1">fname = </span><span class="s3">&quot;contingency_table_r_results.csv&quot;</span>
<span class="s1">fpath = os.path.join(cur_dir</span><span class="s2">, </span><span class="s3">'results'</span><span class="s2">, </span><span class="s1">fname)</span>
<span class="s1">r_results = pd.read_csv(fpath)</span>


<span class="s1">tables = [</span><span class="s2">None, None, None</span><span class="s1">]</span>

<span class="s1">tables[</span><span class="s4">0</span><span class="s1">] = np.asarray([[</span><span class="s4">23</span><span class="s2">, </span><span class="s4">15</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">19</span><span class="s2">, </span><span class="s4">31</span><span class="s1">]])</span>

<span class="s1">tables[</span><span class="s4">1</span><span class="s1">] = np.asarray([[</span><span class="s4">144</span><span class="s2">, </span><span class="s4">33</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">126</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">14</span><span class="s2">, </span><span class="s4">29</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">25</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]])</span>

<span class="s1">tables[</span><span class="s4">2</span><span class="s1">] = np.asarray([[</span><span class="s4">20</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">15</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">40</span><span class="s1">]])</span>


<span class="s2">def </span><span class="s1">test_homogeneity():</span>

    <span class="s2">for </span><span class="s1">k</span><span class="s2">,</span><span class="s1">table </span><span class="s2">in </span><span class="s1">enumerate(tables):</span>
        <span class="s1">st = sm.stats.SquareTable(table</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">hm = st.homogeneity()</span>
        <span class="s1">assert_allclose(hm.statistic</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;homog_stat&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(hm.df</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;homog_df&quot;</span><span class="s1">])</span>

        <span class="s5"># Test Bhapkar via its relationship to Stuart_Maxwell.</span>
        <span class="s1">hmb = st.homogeneity(method=</span><span class="s3">&quot;bhapkar&quot;</span><span class="s1">)</span>
        <span class="s1">assert_allclose(hmb.statistic</span><span class="s2">, </span><span class="s1">hm.statistic / (</span><span class="s4">1 </span><span class="s1">- hm.statistic / table.sum()))</span>


<span class="s2">def </span><span class="s1">test_SquareTable_from_data():</span>

    <span class="s1">np.random.seed(</span><span class="s4">434</span><span class="s1">)</span>
    <span class="s1">df = pd.DataFrame(index=range(</span><span class="s4">100</span><span class="s1">)</span><span class="s2">, </span><span class="s1">columns=[</span><span class="s3">&quot;v1&quot;</span><span class="s2">, </span><span class="s3">&quot;v2&quot;</span><span class="s1">])</span>
    <span class="s1">df[</span><span class="s3">&quot;v1&quot;</span><span class="s1">] = np.random.randint(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">df[</span><span class="s3">&quot;v2&quot;</span><span class="s1">] = np.random.randint(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">table = pd.crosstab(df[</span><span class="s3">&quot;v1&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">df[</span><span class="s3">&quot;v2&quot;</span><span class="s1">])</span>

    <span class="s1">rslt1 = ctab.SquareTable(table)</span>
    <span class="s1">rslt2 = ctab.SquareTable.from_data(df)</span>
    <span class="s1">rslt3 = ctab.SquareTable(np.asarray(table))</span>

    <span class="s1">assert_equal(rslt1.summary().as_text()</span><span class="s2">,</span>
                 <span class="s1">rslt2.summary().as_text())</span>

    <span class="s1">assert_equal(rslt2.summary().as_text()</span><span class="s2">,</span>
                 <span class="s1">rslt3.summary().as_text())</span>

    <span class="s1">s = str(rslt1)</span>
    <span class="s1">assert_equal(s.startswith(</span><span class="s3">'A 5x5 contingency table with counts:'</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span>
    <span class="s1">assert_equal(rslt1.table[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">8.</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_SquareTable_nonsquare():</span>

    <span class="s1">tab = [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]]</span>
    <span class="s1">df = pd.DataFrame(tab</span><span class="s2">, </span><span class="s1">index=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>

    <span class="s1">df2 = ctab.SquareTable(df</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s1">e = np.asarray([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]]</span><span class="s2">,</span>
                   <span class="s1">dtype=np.float64)</span>

    <span class="s1">assert_equal(e</span><span class="s2">, </span><span class="s1">df2.table)</span>


<span class="s2">def </span><span class="s1">test_cumulative_odds():</span>

    <span class="s1">table = [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]]</span>
    <span class="s1">table = np.asarray(table)</span>
    <span class="s1">tbl_obj = ctab.Table(table)</span>

    <span class="s1">cum_odds = tbl_obj.cumulative_oddsratios</span>
    <span class="s1">assert_allclose(cum_odds[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">28 </span><span class="s1">/ float(</span><span class="s4">5 </span><span class="s1">* </span><span class="s4">11</span><span class="s1">))</span>
    <span class="s1">assert_allclose(cum_odds[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3 </span><span class="s1">* </span><span class="s4">15</span><span class="s1">) / float(</span><span class="s4">3 </span><span class="s1">* </span><span class="s4">24</span><span class="s1">)</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s2">,</span>
                    <span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s1">)</span>
    <span class="s1">assert_allclose(np.log(cum_odds)</span><span class="s2">, </span><span class="s1">tbl_obj.cumulative_log_oddsratios</span><span class="s2">,</span>
                    <span class="s1">atol=</span><span class="s4">1e-5</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_local_odds():</span>

    <span class="s1">table = [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]]</span>
    <span class="s1">table = np.asarray(table)</span>
    <span class="s1">tbl_obj = ctab.Table(table)</span>

    <span class="s1">loc_odds = tbl_obj.local_oddsratios</span>
    <span class="s1">assert_allclose(loc_odds[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s4">5 </span><span class="s1">/ </span><span class="s4">8.</span><span class="s1">)</span>
    <span class="s1">assert_allclose(loc_odds[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s4">12 </span><span class="s1">/ float(</span><span class="s4">15</span><span class="s1">)</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s2">,</span>
                    <span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s1">)</span>
    <span class="s1">assert_allclose(np.log(loc_odds)</span><span class="s2">, </span><span class="s1">tbl_obj.local_log_oddsratios</span><span class="s2">,</span>
                    <span class="s1">atol=</span><span class="s4">1e-5</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_shifting():</span>

    <span class="s1">t = np.zeros((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
    <span class="s1">result = np.full((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">assert_equal(ctab.Table(t</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">).table</span><span class="s2">, </span><span class="s1">t)</span>
    <span class="s1">assert_equal(ctab.Table(t</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">True</span><span class="s1">).table</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s1">t = np.asarray([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
    <span class="s1">r = np.asarray([[</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span>
    <span class="s1">assert_equal(ctab.Table(t).table</span><span class="s2">, </span><span class="s1">r)</span>
    <span class="s1">assert_equal(ctab.Table(t</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">True</span><span class="s1">).table</span><span class="s2">, </span><span class="s1">r)</span>


<span class="s2">def </span><span class="s1">test_stratified_table_cube():</span>
    <span class="s5"># Test that we can pass a rank 3 ndarray or a list of rank 2</span>
    <span class="s5"># ndarrays to StratifiedTable and get the same results.</span>

    <span class="s1">tab1 = [[[</span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">8</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">9</span><span class="s2">, </span><span class="s4">11</span><span class="s1">]]]</span>
    <span class="s1">tab2 = np.asarray(tab1).T</span>

    <span class="s1">ct1 = ctab.StratifiedTable(tab1)</span>
    <span class="s1">ct2 = ctab.StratifiedTable(tab2)</span>

    <span class="s1">assert_allclose(ct1.oddsratio_pooled</span><span class="s2">, </span><span class="s1">ct2.oddsratio_pooled)</span>
    <span class="s1">assert_allclose(ct1.logodds_pooled</span><span class="s2">, </span><span class="s1">ct2.logodds_pooled)</span>


<span class="s2">def </span><span class="s1">test_resids():</span>

    <span class="s5"># CHD x serum data</span>
    <span class="s1">table = [[</span><span class="s4">12</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">31</span><span class="s2">, </span><span class="s4">41</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">307</span><span class="s2">, </span><span class="s4">246</span><span class="s2">, </span><span class="s4">439</span><span class="s2">, </span><span class="s4">245</span><span class="s1">]]</span>

    <span class="s5"># These results come from SAS</span>
    <span class="s1">fit = [[</span><span class="s4">22.083</span><span class="s2">, </span><span class="s4">17.583</span><span class="s2">, </span><span class="s4">32.536</span><span class="s2">, </span><span class="s4">19.798</span><span class="s1">]</span><span class="s2">,</span>
           <span class="s1">[</span><span class="s4">296.92</span><span class="s2">, </span><span class="s4">236.42</span><span class="s2">, </span><span class="s4">437.46</span><span class="s2">, </span><span class="s4">266.2</span><span class="s1">]]</span>
    <span class="s1">c2 = [[</span><span class="s4">4.6037</span><span class="s2">, </span><span class="s4">5.223</span><span class="s2">, </span><span class="s4">0.0725</span><span class="s2">, </span><span class="s4">22.704</span><span class="s1">]</span><span class="s2">,</span>
          <span class="s1">[</span><span class="s4">0.3424</span><span class="s2">, </span><span class="s4">0.3885</span><span class="s2">, </span><span class="s4">0.0054</span><span class="s2">, </span><span class="s4">1.6886</span><span class="s1">]]</span>

    <span class="s5"># These are regression tests</span>
    <span class="s1">pr = np.array([[-</span><span class="s4">2.14562121</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2.28538719</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.26923882</span><span class="s2">,  </span><span class="s4">4.7649169 </span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[ </span><span class="s4">0.58514314</span><span class="s2">,  </span><span class="s4">0.62325942</span><span class="s2">,  </span><span class="s4">0.07342547</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1.29946443</span><span class="s1">]])</span>
    <span class="s1">sr = np.array([[-</span><span class="s4">2.55112945</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2.6338782 </span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.34712127</span><span class="s2">,  </span><span class="s4">5.5751083 </span><span class="s1">]</span><span class="s2">,</span>
                   <span class="s1">[ </span><span class="s4">2.55112945</span><span class="s2">,  </span><span class="s4">2.6338782 </span><span class="s2">,  </span><span class="s4">0.34712127</span><span class="s2">, </span><span class="s1">-</span><span class="s4">5.5751083 </span><span class="s1">]])</span>

    <span class="s1">tab = ctab.Table(table)</span>
    <span class="s1">assert_allclose(tab.fittedvalues</span><span class="s2">, </span><span class="s1">fit</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tab.chi2_contribs</span><span class="s2">, </span><span class="s1">c2</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tab.resid_pearson</span><span class="s2">, </span><span class="s1">pr</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tab.standardized_resids</span><span class="s2">, </span><span class="s1">sr</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_ordinal_association():</span>

    <span class="s2">for </span><span class="s1">k</span><span class="s2">,</span><span class="s1">table </span><span class="s2">in </span><span class="s1">enumerate(tables):</span>

        <span class="s1">row_scores = </span><span class="s4">1 </span><span class="s1">+ np.arange(table.shape[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">col_scores = </span><span class="s4">1 </span><span class="s1">+ np.arange(table.shape[</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s5"># First set of scores</span>
        <span class="s1">rslt = ctab.Table(table</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">).test_ordinal_association(row_scores</span><span class="s2">, </span><span class="s1">col_scores)</span>
        <span class="s1">assert_allclose(rslt.statistic</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl_stat&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.null_mean</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl_expval&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.null_sd**</span><span class="s4">2</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl_var&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.zscore**</span><span class="s4">2</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl_chi2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.pvalue</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl_pvalue&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>

        <span class="s5"># Second set of scores</span>
        <span class="s1">rslt = ctab.Table(table</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">).test_ordinal_association(row_scores</span><span class="s2">, </span><span class="s1">col_scores**</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.statistic</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl2_stat&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.null_mean</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl2_expval&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.null_sd**</span><span class="s4">2</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl2_var&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.zscore**</span><span class="s4">2</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl2_chi2&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(rslt.pvalue</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;lbl2_pvalue&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-5</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_chi2_association():</span>

    <span class="s1">np.random.seed(</span><span class="s4">8743</span><span class="s1">)</span>

    <span class="s1">table = np.random.randint(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">size=(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>

    <span class="s2">from </span><span class="s1">scipy.stats </span><span class="s2">import </span><span class="s1">chi2_contingency</span>
    <span class="s1">rslt_scipy = chi2_contingency(table)</span>

    <span class="s1">b = ctab.Table(table).test_nominal_association()</span>

    <span class="s1">assert_allclose(b.statistic</span><span class="s2">, </span><span class="s1">rslt_scipy[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s1">assert_allclose(b.pvalue</span><span class="s2">, </span><span class="s1">rslt_scipy[</span><span class="s4">1</span><span class="s1">])</span>


<span class="s2">def </span><span class="s1">test_symmetry():</span>

    <span class="s2">for </span><span class="s1">k</span><span class="s2">,</span><span class="s1">table </span><span class="s2">in </span><span class="s1">enumerate(tables):</span>
        <span class="s1">st = sm.stats.SquareTable(table</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">b = st.symmetry()</span>
        <span class="s1">assert_allclose(b.statistic</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;bowker_stat&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(b.df</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;bowker_df&quot;</span><span class="s1">])</span>
        <span class="s1">assert_allclose(b.pvalue</span><span class="s2">, </span><span class="s1">r_results.loc[k</span><span class="s2">, </span><span class="s3">&quot;bowker_pvalue&quot;</span><span class="s1">])</span>


<span class="s2">def </span><span class="s1">test_mcnemar():</span>

    <span class="s5"># Use chi^2 without continuity correction</span>
    <span class="s1">b1 = ctab.mcnemar(tables[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">exact=</span><span class="s2">False, </span><span class="s1">correction=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s1">st = sm.stats.SquareTable(tables[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s1">b2 = st.homogeneity()</span>
    <span class="s1">assert_allclose(b1.statistic</span><span class="s2">, </span><span class="s1">b2.statistic)</span>
    <span class="s1">assert_equal(b2.df</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>

    <span class="s5"># Use chi^2 with continuity correction</span>
    <span class="s1">b3 = ctab.mcnemar(tables[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">exact=</span><span class="s2">False, </span><span class="s1">correction=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">assert_allclose(b3.pvalue</span><span class="s2">, </span><span class="s1">r_results.loc[</span><span class="s4">0</span><span class="s2">, </span><span class="s3">&quot;homog_cont_p&quot;</span><span class="s1">])</span>

    <span class="s5"># Use binomial reference distribution</span>
    <span class="s1">b4 = ctab.mcnemar(tables[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">exact=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">assert_allclose(b4.pvalue</span><span class="s2">, </span><span class="s1">r_results.loc[</span><span class="s4">0</span><span class="s2">, </span><span class="s3">&quot;homog_binom_p&quot;</span><span class="s1">])</span>

<span class="s2">def </span><span class="s1">test_from_data_stratified():</span>

    <span class="s1">df = pd.DataFrame([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]]).T</span>
    <span class="s1">e = np.asarray([[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]])</span>

    <span class="s5"># Test pandas</span>
    <span class="s1">tab1 = ctab.StratifiedTable.from_data(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">df)</span>
    <span class="s1">assert_equal(tab1.table</span><span class="s2">, </span><span class="s1">e)</span>

    <span class="s5"># Test ndarray</span>
    <span class="s1">tab1 = ctab.StratifiedTable.from_data(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">np.asarray(df))</span>
    <span class="s1">assert_equal(tab1.table</span><span class="s2">, </span><span class="s1">e)</span>

<span class="s2">def </span><span class="s1">test_from_data_2x2():</span>

    <span class="s1">df = pd.DataFrame([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]).T</span>
    <span class="s1">e = np.asarray([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]])</span>

    <span class="s5"># Test pandas</span>
    <span class="s1">tab1 = ctab.Table2x2.from_data(df</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">assert_equal(tab1.table</span><span class="s2">, </span><span class="s1">e)</span>

    <span class="s5"># Test ndarray</span>
    <span class="s1">tab1 = ctab.Table2x2.from_data(np.asarray(df)</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">assert_equal(tab1.table</span><span class="s2">, </span><span class="s1">e)</span>


<span class="s2">def </span><span class="s1">test_cochranq():</span>
    <span class="s5"># library(CVST)</span>
    <span class="s5"># table1 = matrix(c(1, 0, 1, 1,</span>
    <span class="s5">#                   0, 1, 1, 1,</span>
    <span class="s5">#                   1, 1, 1, 0,</span>
    <span class="s5">#                   0, 1, 0, 0,</span>
    <span class="s5">#                   0, 1, 0, 0,</span>
    <span class="s5">#                   1, 0, 1, 0,</span>
    <span class="s5">#                   0, 1, 0, 0,</span>
    <span class="s5">#                   1, 1, 1, 1,</span>
    <span class="s5">#                   0, 1, 0, 0), ncol=4, byrow=TRUE)</span>
    <span class="s5"># rslt1 = cochranq.test(table1)</span>
    <span class="s5"># table2 = matrix(c(0, 0, 1, 1, 0,</span>
    <span class="s5">#                   0, 1, 0, 1, 0,</span>
    <span class="s5">#                   0, 1, 1, 0, 1,</span>
    <span class="s5">#                   1, 0, 0, 0, 1,</span>
    <span class="s5">#                   1, 1, 0, 0, 0,</span>
    <span class="s5">#                   1, 0, 1, 0, 0,</span>
    <span class="s5">#                   0, 1, 0, 0, 0,</span>
    <span class="s5">#                   0, 0, 1, 1, 0,</span>
    <span class="s5">#                   0, 0, 0, 0, 0), ncol=5, byrow=TRUE)</span>
    <span class="s5"># rslt2 = cochranq.test(table2)</span>

    <span class="s1">table = [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">table = np.asarray(table)</span>

    <span class="s1">stat</span><span class="s2">, </span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">df = ctab.cochrans_q(table</span><span class="s2">, </span><span class="s1">return_object=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">assert_allclose(stat</span><span class="s2">, </span><span class="s4">4.2</span><span class="s1">)</span>
    <span class="s1">assert_allclose(df</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">table = [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">table = np.asarray(table)</span>

    <span class="s1">stat</span><span class="s2">, </span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">df = ctab.cochrans_q(table</span><span class="s2">, </span><span class="s1">return_object=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">assert_allclose(stat</span><span class="s2">, </span><span class="s4">1.2174</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>
    <span class="s1">assert_allclose(df</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

    <span class="s5"># Cochran's q and Mcnemar are equivalent for 2x2 tables</span>
    <span class="s1">data = table[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">:</span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">xtab = np.asarray(pd.crosstab(data[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">data[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]))</span>
    <span class="s1">b1 = ctab.cochrans_q(data</span><span class="s2">, </span><span class="s1">return_object=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">b2 = ctab.mcnemar(xtab</span><span class="s2">, </span><span class="s1">exact=</span><span class="s2">False, </span><span class="s1">correction=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">assert_allclose(b1.statistic</span><span class="s2">, </span><span class="s1">b2.statistic)</span>
    <span class="s1">assert_allclose(b1.pvalue</span><span class="s2">, </span><span class="s1">b2.pvalue)</span>

    <span class="s5"># Test for printing bunch</span>
    <span class="s1">assert_equal(str(b1).startswith(</span><span class="s3">&quot;df          1</span><span class="s2">\n</span><span class="s3">pvalue      0.65&quot;</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">CheckStratifiedMixin:</span>

    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">initialize(cls</span><span class="s2">, </span><span class="s1">tables</span><span class="s2">, </span><span class="s1">use_arr=</span><span class="s2">False</span><span class="s1">):</span>
        <span class="s1">tables1 = tables </span><span class="s2">if not </span><span class="s1">use_arr </span><span class="s2">else </span><span class="s1">np.dstack(tables)</span>
        <span class="s1">cls.rslt = ctab.StratifiedTable(tables1)</span>
        <span class="s1">cls.rslt_0 = ctab.StratifiedTable(tables</span><span class="s2">, </span><span class="s1">shift_zeros=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">tables_pandas = [pd.DataFrame(x) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">tables]</span>
        <span class="s1">cls.rslt_pandas = ctab.StratifiedTable(tables_pandas)</span>


    <span class="s2">def </span><span class="s1">test_oddsratio_pooled(self):</span>
        <span class="s1">assert_allclose(self.rslt.oddsratio_pooled</span><span class="s2">, </span><span class="s1">self.oddsratio_pooled</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_logodds_pooled(self):</span>
        <span class="s1">assert_allclose(self.rslt.logodds_pooled</span><span class="s2">, </span><span class="s1">self.logodds_pooled</span><span class="s2">,</span>
                        <span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_null_odds(self):</span>
        <span class="s1">rslt = self.rslt.test_null_odds(correction=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.statistic</span><span class="s2">, </span><span class="s1">self.mh_stat</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-5</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.pvalue</span><span class="s2">, </span><span class="s1">self.mh_pvalue</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_oddsratio_pooled_confint(self):</span>
        <span class="s1">lcb</span><span class="s2">, </span><span class="s1">ucb = self.rslt.oddsratio_pooled_confint()</span>
        <span class="s1">assert_allclose(lcb</span><span class="s2">, </span><span class="s1">self.or_lcb</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(ucb</span><span class="s2">, </span><span class="s1">self.or_ucb</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_logodds_pooled_confint(self):</span>
        <span class="s1">lcb</span><span class="s2">, </span><span class="s1">ucb = self.rslt.logodds_pooled_confint()</span>
        <span class="s1">assert_allclose(lcb</span><span class="s2">, </span><span class="s1">np.log(self.or_lcb)</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">,</span>
                        <span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(ucb</span><span class="s2">, </span><span class="s1">np.log(self.or_ucb)</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">,</span>
                        <span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_equal_odds(self):</span>

        <span class="s2">if not </span><span class="s1">hasattr(self</span><span class="s2">, </span><span class="s3">&quot;or_homog&quot;</span><span class="s1">):</span>
            <span class="s2">return</span>

        <span class="s1">rslt = self.rslt.test_equal_odds(adjust=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.statistic</span><span class="s2">, </span><span class="s1">self.or_homog</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.pvalue</span><span class="s2">, </span><span class="s1">self.or_homog_p</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>

        <span class="s1">rslt = self.rslt.test_equal_odds(adjust=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.statistic</span><span class="s2">, </span><span class="s1">self.or_homog_adj</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>
        <span class="s1">assert_allclose(rslt.pvalue</span><span class="s2">, </span><span class="s1">self.or_homog_adj_p</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol=</span><span class="s4">1e-4</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_pandas(self):</span>

        <span class="s2">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s1">warnings.simplefilter(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">RuntimeWarning)</span>
            <span class="s1">assert_equal(self.rslt.summary().as_text()</span><span class="s2">,</span>
                         <span class="s1">self.rslt_pandas.summary().as_text())</span>


    <span class="s2">def </span><span class="s1">test_from_data(self):</span>

        <span class="s1">np.random.seed(</span><span class="s4">241</span><span class="s1">)</span>
        <span class="s1">df = pd.DataFrame(index=range(</span><span class="s4">100</span><span class="s1">)</span><span class="s2">, </span><span class="s1">columns=(</span><span class="s3">&quot;v1&quot;</span><span class="s2">, </span><span class="s3">&quot;v2&quot;</span><span class="s2">, </span><span class="s3">&quot;strat&quot;</span><span class="s1">))</span>
        <span class="s1">df[</span><span class="s3">&quot;v1&quot;</span><span class="s1">] = np.random.randint(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span>
        <span class="s1">df[</span><span class="s3">&quot;v2&quot;</span><span class="s1">] = np.random.randint(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">100</span><span class="s1">)</span>
        <span class="s1">df[</span><span class="s3">&quot;strat&quot;</span><span class="s1">] = np.kron(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.ones(</span><span class="s4">10</span><span class="s1">))</span>

        <span class="s1">tables = []</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">):</span>
            <span class="s1">ii = np.arange(</span><span class="s4">10</span><span class="s1">*k</span><span class="s2">, </span><span class="s4">10</span><span class="s1">*(k+</span><span class="s4">1</span><span class="s1">))</span>
            <span class="s1">tables.append(pd.crosstab(df.loc[ii</span><span class="s2">, </span><span class="s3">&quot;v1&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">df.loc[ii</span><span class="s2">, </span><span class="s3">&quot;v2&quot;</span><span class="s1">]))</span>

        <span class="s1">rslt1 = ctab.StratifiedTable(tables)</span>
        <span class="s1">rslt2 = ctab.StratifiedTable.from_data(</span><span class="s3">&quot;v1&quot;</span><span class="s2">, </span><span class="s3">&quot;v2&quot;</span><span class="s2">, </span><span class="s3">&quot;strat&quot;</span><span class="s2">, </span><span class="s1">df)</span>

        <span class="s1">assert_equal(rslt1.summary().as_text()</span><span class="s2">, </span><span class="s1">rslt2.summary().as_text())</span>


<span class="s2">class </span><span class="s1">TestStratified1(CheckStratifiedMixin):</span>
    <span class="s0">&quot;&quot;&quot; 
    data = array(c(0, 0, 6, 5, 
                   3, 0, 3, 6, 
                   6, 2, 0, 4, 
                   5, 6, 1, 0, 
                   2, 5, 0, 0), 
                   dim=c(2, 2, 5)) 
    rslt = mantelhaen.test(data) 
    &quot;&quot;&quot;</span>

    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">tables = [</span><span class="s2">None</span><span class="s1">] * </span><span class="s4">5</span>
        <span class="s1">tables[</span><span class="s4">0</span><span class="s1">] = np.array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">1</span><span class="s1">] = np.array([[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">2</span><span class="s1">] = np.array([[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">3</span><span class="s1">] = np.array([[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">4</span><span class="s1">] = np.array([[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>

        <span class="s1">cls.initialize(tables)</span>

        <span class="s1">cls.oddsratio_pooled = </span><span class="s4">7</span>
        <span class="s1">cls.logodds_pooled = np.log(</span><span class="s4">7</span><span class="s1">)</span>
        <span class="s1">cls.mh_stat = </span><span class="s4">3.9286</span>
        <span class="s1">cls.mh_pvalue = </span><span class="s4">0.04747</span>
        <span class="s1">cls.or_lcb = </span><span class="s4">1.026713</span>
        <span class="s1">cls.or_ucb = </span><span class="s4">47.725133</span>


<span class="s2">class </span><span class="s1">TestStratified2(CheckStratifiedMixin):</span>
    <span class="s0">&quot;&quot;&quot; 
    library(DescTools) 
    data = array(c(20, 14, 10, 24, 
                   15, 12, 3, 15, 
                   3, 2, 3, 2, 
                   12, 3, 7, 5, 
                   1, 0, 3, 2), 
                   dim=c(2, 2, 5)) 
    rslt = mantelhaen.test(data) 
    bd1 = BreslowDayTest(data, correct=FALSE) 
    bd2 = BreslowDayTest(data, correct=TRUE) 
    &quot;&quot;&quot;</span>

    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">tables = [</span><span class="s2">None</span><span class="s1">] * </span><span class="s4">5</span>
        <span class="s1">tables[</span><span class="s4">0</span><span class="s1">] = np.array([[</span><span class="s4">20</span><span class="s2">, </span><span class="s4">14</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">24</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">1</span><span class="s1">] = np.array([[</span><span class="s4">15</span><span class="s2">, </span><span class="s4">12</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">15</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">2</span><span class="s1">] = np.array([[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">3</span><span class="s1">] = np.array([[</span><span class="s4">12</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">4</span><span class="s1">] = np.array([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]])</span>

        <span class="s5"># check array of int</span>
        <span class="s1">cls.initialize(tables</span><span class="s2">, </span><span class="s1">use_arr=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">cls.oddsratio_pooled = </span><span class="s4">3.5912</span>
        <span class="s1">cls.logodds_pooled = np.log(</span><span class="s4">3.5912</span><span class="s1">)</span>

        <span class="s1">cls.mh_stat = </span><span class="s4">11.8852</span>
        <span class="s1">cls.mh_pvalue = </span><span class="s4">0.0005658</span>

        <span class="s1">cls.or_lcb = </span><span class="s4">1.781135</span>
        <span class="s1">cls.or_ucb = </span><span class="s4">7.240633</span>

        <span class="s5"># Breslow Day test without Tarone adjustment</span>
        <span class="s1">cls.or_homog = </span><span class="s4">1.8438</span>
        <span class="s1">cls.or_homog_p = </span><span class="s4">0.7645</span>

        <span class="s5"># Breslow Day test with Tarone adjustment</span>
        <span class="s1">cls.or_homog_adj = </span><span class="s4">1.8436</span>
        <span class="s1">cls.or_homog_adj_p = </span><span class="s4">0.7645</span>


<span class="s2">class </span><span class="s1">TestStratified3(CheckStratifiedMixin):</span>
    <span class="s0">&quot;&quot;&quot; 
    library(DescTools) 
    data = array(c(313, 512, 19, 89, 
                   207, 353, 8, 17, 
                   205, 120, 391, 202, 
                   278, 139, 244, 131, 
                   138, 53, 299, 94, 
                   351, 22, 317, 24), 
                   dim=c(2, 2, 6)) 
    rslt = mantelhaen.test(data) 
    bd1 = BreslowDayTest(data, correct=FALSE) 
    bd2 = BreslowDayTest(data, correct=TRUE) 
    &quot;&quot;&quot;</span>

    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">tables = [</span><span class="s2">None</span><span class="s1">] * </span><span class="s4">6</span>
        <span class="s1">tables[</span><span class="s4">0</span><span class="s1">] = np.array([[</span><span class="s4">313</span><span class="s2">, </span><span class="s4">512</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">19</span><span class="s2">, </span><span class="s4">89</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">1</span><span class="s1">] = np.array([[</span><span class="s4">207</span><span class="s2">, </span><span class="s4">353</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">8</span><span class="s2">, </span><span class="s4">17</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">2</span><span class="s1">] = np.array([[</span><span class="s4">205</span><span class="s2">, </span><span class="s4">120</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">391</span><span class="s2">, </span><span class="s4">202</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">3</span><span class="s1">] = np.array([[</span><span class="s4">278</span><span class="s2">, </span><span class="s4">139</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">244</span><span class="s2">, </span><span class="s4">131</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">4</span><span class="s1">] = np.array([[</span><span class="s4">138</span><span class="s2">, </span><span class="s4">53</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">299</span><span class="s2">, </span><span class="s4">94</span><span class="s1">]])</span>
        <span class="s1">tables[</span><span class="s4">5</span><span class="s1">] = np.array([[</span><span class="s4">351</span><span class="s2">, </span><span class="s4">22</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">317</span><span class="s2">, </span><span class="s4">24</span><span class="s1">]])</span>

        <span class="s1">cls.initialize(tables)</span>

        <span class="s1">cls.oddsratio_pooled = </span><span class="s4">1.101879</span>
        <span class="s1">cls.logodds_pooled = np.log(</span><span class="s4">1.101879</span><span class="s1">)</span>

        <span class="s1">cls.mh_stat = </span><span class="s4">1.3368</span>
        <span class="s1">cls.mh_pvalue = </span><span class="s4">0.2476</span>

        <span class="s1">cls.or_lcb = </span><span class="s4">0.9402012</span>
        <span class="s1">cls.or_ucb = </span><span class="s4">1.2913602</span>

        <span class="s5"># Breslow Day test without Tarone adjustment</span>
        <span class="s1">cls.or_homog = </span><span class="s4">18.83297</span>
        <span class="s1">cls.or_homog_p = </span><span class="s4">0.002064786</span>

        <span class="s5"># Breslow Day test with Tarone adjustment</span>
        <span class="s1">cls.or_homog_adj = </span><span class="s4">18.83297</span>
        <span class="s1">cls.or_homog_adj_p = </span><span class="s4">0.002064786</span>

<span class="s2">class </span><span class="s1">Check2x2Mixin:</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">initialize(cls):</span>
        <span class="s1">cls.tbl_obj = ctab.Table2x2(cls.table)</span>
        <span class="s1">cls.tbl_data_obj = ctab.Table2x2.from_data(cls.data)</span>

    <span class="s2">def </span><span class="s1">test_oddsratio(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.oddsratio</span><span class="s2">, </span><span class="s1">self.oddsratio)</span>


    <span class="s2">def </span><span class="s1">test_log_oddsratio(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.log_oddsratio</span><span class="s2">, </span><span class="s1">self.log_oddsratio)</span>


    <span class="s2">def </span><span class="s1">test_log_oddsratio_se(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.log_oddsratio_se</span><span class="s2">, </span><span class="s1">self.log_oddsratio_se)</span>


    <span class="s2">def </span><span class="s1">test_oddsratio_pvalue(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.oddsratio_pvalue()</span><span class="s2">, </span><span class="s1">self.oddsratio_pvalue)</span>


    <span class="s2">def </span><span class="s1">test_oddsratio_confint(self):</span>
        <span class="s1">lcb1</span><span class="s2">, </span><span class="s1">ucb1 = self.tbl_obj.oddsratio_confint(</span><span class="s4">0.05</span><span class="s1">)</span>
        <span class="s1">lcb2</span><span class="s2">, </span><span class="s1">ucb2 = self.oddsratio_confint</span>
        <span class="s1">assert_allclose(lcb1</span><span class="s2">, </span><span class="s1">lcb2)</span>
        <span class="s1">assert_allclose(ucb1</span><span class="s2">, </span><span class="s1">ucb2)</span>


    <span class="s2">def </span><span class="s1">test_riskratio(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.riskratio</span><span class="s2">, </span><span class="s1">self.riskratio)</span>


    <span class="s2">def </span><span class="s1">test_log_riskratio(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.log_riskratio</span><span class="s2">, </span><span class="s1">self.log_riskratio)</span>


    <span class="s2">def </span><span class="s1">test_log_riskratio_se(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.log_riskratio_se</span><span class="s2">, </span><span class="s1">self.log_riskratio_se)</span>


    <span class="s2">def </span><span class="s1">test_riskratio_pvalue(self):</span>
        <span class="s1">assert_allclose(self.tbl_obj.riskratio_pvalue()</span><span class="s2">, </span><span class="s1">self.riskratio_pvalue)</span>


    <span class="s2">def </span><span class="s1">test_riskratio_confint(self):</span>
        <span class="s1">lcb1</span><span class="s2">, </span><span class="s1">ucb1 = self.tbl_obj.riskratio_confint(</span><span class="s4">0.05</span><span class="s1">)</span>
        <span class="s1">lcb2</span><span class="s2">, </span><span class="s1">ucb2 = self.riskratio_confint</span>
        <span class="s1">assert_allclose(lcb1</span><span class="s2">, </span><span class="s1">lcb2)</span>
        <span class="s1">assert_allclose(ucb1</span><span class="s2">, </span><span class="s1">ucb2)</span>


    <span class="s2">def </span><span class="s1">test_log_riskratio_confint(self):</span>
        <span class="s1">lcb1</span><span class="s2">, </span><span class="s1">ucb1 = self.tbl_obj.log_riskratio_confint(</span><span class="s4">0.05</span><span class="s1">)</span>
        <span class="s1">lcb2</span><span class="s2">, </span><span class="s1">ucb2 = self.log_riskratio_confint</span>
        <span class="s1">assert_allclose(lcb1</span><span class="s2">, </span><span class="s1">lcb2)</span>
        <span class="s1">assert_allclose(ucb1</span><span class="s2">, </span><span class="s1">ucb2)</span>


    <span class="s2">def </span><span class="s1">test_from_data(self):</span>
        <span class="s1">assert_equal(self.tbl_obj.summary().as_text()</span><span class="s2">,</span>
                     <span class="s1">self.tbl_data_obj.summary().as_text())</span>

    <span class="s2">def </span><span class="s1">test_summary(self):</span>

        <span class="s1">assert_equal(self.tbl_obj.summary().as_text()</span><span class="s2">,</span>
                     <span class="s1">self.summary_string)</span>


<span class="s2">class </span><span class="s1">Test2x2_1(Check2x2Mixin):</span>

    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">data = np.zeros((</span><span class="s4">8</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">data[:</span><span class="s2">, </span><span class="s4">0</span><span class="s1">] = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">data[:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">] = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">cls.data = np.asarray(data)</span>
        <span class="s1">cls.table = np.asarray([[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]])</span>

        <span class="s1">cls.oddsratio = </span><span class="s4">1.</span>
        <span class="s1">cls.log_oddsratio = </span><span class="s4">0.</span>
        <span class="s1">cls.log_oddsratio_se = np.sqrt(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">cls.oddsratio_confint = [</span><span class="s4">0.062548836166112329</span><span class="s2">, </span><span class="s4">15.987507702689751</span><span class="s1">]</span>
        <span class="s1">cls.oddsratio_pvalue = </span><span class="s4">1.</span>
        <span class="s1">cls.riskratio = </span><span class="s4">1.</span>
        <span class="s1">cls.log_riskratio = </span><span class="s4">0.</span>
        <span class="s1">cls.log_riskratio_se = </span><span class="s4">1 </span><span class="s1">/ np.sqrt(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">cls.riskratio_pvalue = </span><span class="s4">1.</span>
        <span class="s1">cls.riskratio_confint = [</span><span class="s4">0.25009765325990629</span><span class="s2">,</span>
                                  <span class="s4">3.9984381579173824</span><span class="s1">]</span>
        <span class="s1">cls.log_riskratio_confint = [-</span><span class="s4">1.3859038243496782</span><span class="s2">,</span>
                                      <span class="s4">1.3859038243496782</span><span class="s1">]</span>
        <span class="s1">ss = [  </span><span class="s3">'               Estimate   SE   LCB    UCB   p-value'</span><span class="s2">,</span>
                <span class="s3">'---------------------------------------------------'</span><span class="s2">,</span>
                <span class="s3">'Odds ratio        1.000        0.063 15.988   1.000'</span><span class="s2">,</span>
                <span class="s3">'Log odds ratio    0.000 1.414 -2.772  2.772   1.000'</span><span class="s2">,</span>
                <span class="s3">'Risk ratio        1.000        0.250  3.998   1.000'</span><span class="s2">,</span>
                <span class="s3">'Log risk ratio    0.000 0.707 -1.386  1.386   1.000'</span><span class="s2">,</span>
                <span class="s3">'---------------------------------------------------'</span><span class="s1">]</span>
        <span class="s1">cls.summary_string = </span><span class="s3">'</span><span class="s2">\n</span><span class="s3">'</span><span class="s1">.join(ss)</span>
        <span class="s1">cls.initialize()</span>
</pre>
</body>
</html>
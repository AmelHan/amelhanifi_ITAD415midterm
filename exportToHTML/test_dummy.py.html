<html>
<head>
<title>test_dummy.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dummy.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">scipy.sparse </span><span class="s0">as </span><span class="s1">sp</span>

<span class="s0">from </span><span class="s1">sklearn.base </span><span class="s0">import </span><span class="s1">clone</span>
<span class="s0">from </span><span class="s1">sklearn.dummy </span><span class="s0">import </span><span class="s1">DummyClassifier</span><span class="s0">, </span><span class="s1">DummyRegressor</span>
<span class="s0">from </span><span class="s1">sklearn.exceptions </span><span class="s0">import </span><span class="s1">NotFittedError</span>
<span class="s0">from </span><span class="s1">sklearn.utils._testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_equal</span><span class="s0">,</span>
    <span class="s1">ignore_warnings</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">sklearn.utils.stats </span><span class="s0">import </span><span class="s1">_weighted_percentile</span>


<span class="s1">@ignore_warnings</span>
<span class="s0">def </span><span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y):</span>
    <span class="s1">proba = clf.predict_proba(X)</span>
    <span class="s2"># We know that we can have division by zero</span>
    <span class="s1">log_proba = clf.predict_log_proba(X)</span>

    <span class="s1">y = np.atleast_1d(y)</span>
    <span class="s0">if </span><span class="s1">y.ndim == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">y = np.reshape(y</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">n_outputs = y.shape[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">n_samples = len(X)</span>

    <span class="s0">if </span><span class="s1">n_outputs == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">proba = [proba]</span>
        <span class="s1">log_proba = [log_proba]</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(n_outputs):</span>
        <span class="s0">assert </span><span class="s1">proba[k].shape[</span><span class="s3">0</span><span class="s1">] == n_samples</span>
        <span class="s0">assert </span><span class="s1">proba[k].shape[</span><span class="s3">1</span><span class="s1">] == len(np.unique(y[:</span><span class="s0">, </span><span class="s1">k]))</span>
        <span class="s1">assert_array_almost_equal(proba[k].sum(axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.ones(len(X)))</span>
        <span class="s2"># We know that we can have division by zero</span>
        <span class="s1">assert_array_almost_equal(np.log(proba[k])</span><span class="s0">, </span><span class="s1">log_proba[k])</span>


<span class="s0">def </span><span class="s1">_check_behavior_2d(clf):</span>
    <span class="s2"># 1d case</span>
    <span class="s1">X = np.array([[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]])  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">est = clone(clf)</span>
    <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = est.predict(X)</span>
    <span class="s0">assert </span><span class="s1">y.shape == y_pred.shape</span>

    <span class="s2"># 2d case</span>
    <span class="s1">y = np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]])</span>
    <span class="s1">est = clone(clf)</span>
    <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = est.predict(X)</span>
    <span class="s0">assert </span><span class="s1">y.shape == y_pred.shape</span>


<span class="s0">def </span><span class="s1">_check_behavior_2d_for_constant(clf):</span>
    <span class="s2"># 2d case only</span>
    <span class="s1">X = np.array([[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]])  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span>
    <span class="s1">est = clone(clf)</span>
    <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = est.predict(X)</span>
    <span class="s0">assert </span><span class="s1">y.shape == y_pred.shape</span>


<span class="s0">def </span><span class="s1">_check_equality_regressor(statistic</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test):</span>
    <span class="s1">assert_array_almost_equal(np.tile(statistic</span><span class="s0">, </span><span class="s1">(y_learn.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">y_pred_learn)</span>
    <span class="s1">assert_array_almost_equal(np.tile(statistic</span><span class="s0">, </span><span class="s1">(y_test.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">y_pred_test)</span>


<span class="s0">def </span><span class="s1">test_most_frequent_and_prior_strategy():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">strategy </span><span class="s0">in </span><span class="s1">(</span><span class="s4">&quot;most_frequent&quot;</span><span class="s0">, </span><span class="s4">&quot;prior&quot;</span><span class="s1">):</span>
        <span class="s1">clf = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">assert_array_equal(clf.predict(X)</span><span class="s0">, </span><span class="s1">np.ones(len(X)))</span>
        <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s0">if </span><span class="s1">strategy == </span><span class="s4">&quot;prior&quot;</span><span class="s1">:</span>
            <span class="s1">assert_array_almost_equal(</span>
                <span class="s1">clf.predict_proba([X[</span><span class="s3">0</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">clf.class_prior_.reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>
            <span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">assert_array_almost_equal(</span>
                <span class="s1">clf.predict_proba([X[</span><span class="s3">0</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">clf.class_prior_.reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)) &gt; </span><span class="s3">0.5</span>
            <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_most_frequent_and_prior_strategy_with_2d_column_y():</span>
    <span class="s2"># non-regression test added in</span>
    <span class="s2"># https://github.com/scikit-learn/scikit-learn/pull/13545</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]</span>
    <span class="s1">y_1d = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">y_2d = [[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]]</span>

    <span class="s0">for </span><span class="s1">strategy </span><span class="s0">in </span><span class="s1">(</span><span class="s4">&quot;most_frequent&quot;</span><span class="s0">, </span><span class="s4">&quot;prior&quot;</span><span class="s1">):</span>
        <span class="s1">clf_1d = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">clf_2d = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">clf_1d.fit(X</span><span class="s0">, </span><span class="s1">y_1d)</span>
        <span class="s1">clf_2d.fit(X</span><span class="s0">, </span><span class="s1">y_2d)</span>
        <span class="s1">assert_array_equal(clf_1d.predict(X)</span><span class="s0">, </span><span class="s1">clf_2d.predict(X))</span>


<span class="s0">def </span><span class="s1">test_most_frequent_and_prior_strategy_multioutput():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]])</span>

    <span class="s1">n_samples = len(X)</span>

    <span class="s0">for </span><span class="s1">strategy </span><span class="s0">in </span><span class="s1">(</span><span class="s4">&quot;prior&quot;</span><span class="s0">, </span><span class="s4">&quot;most_frequent&quot;</span><span class="s1">):</span>
        <span class="s1">clf = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">clf.predict(X)</span><span class="s0">,</span>
            <span class="s1">np.hstack([np.ones((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">_check_behavior_2d(clf)</span>


<span class="s0">def </span><span class="s1">test_stratified_strategy(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;stratified&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>
    <span class="s1">p = np.bincount(y_pred) / float(len(X))</span>
    <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">3.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(p[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">2.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_stratified_strategy_multioutput(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;stratified&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s1">p = np.bincount(y_pred[:</span><span class="s0">, </span><span class="s1">k]) / float(len(X))</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">3.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">2.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">_check_behavior_2d(clf)</span>


<span class="s0">def </span><span class="s1">test_uniform_strategy(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">4  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;uniform&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>
    <span class="s1">p = np.bincount(y_pred) / float(len(X))</span>
    <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(p[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_uniform_strategy_multioutput(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">4  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;uniform&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s1">p = np.bincount(y_pred[:</span><span class="s0">, </span><span class="s1">k]) / float(len(X))</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">_check_behavior_2d(clf)</span>


<span class="s0">def </span><span class="s1">test_string_labels():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5</span>
    <span class="s1">y = [</span><span class="s4">&quot;paris&quot;</span><span class="s0">, </span><span class="s4">&quot;paris&quot;</span><span class="s0">, </span><span class="s4">&quot;tokyo&quot;</span><span class="s0">, </span><span class="s4">&quot;amsterdam&quot;</span><span class="s0">, </span><span class="s4">&quot;berlin&quot;</span><span class="s1">]</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;most_frequent&quot;</span><span class="s1">)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(clf.predict(X)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;paris&quot;</span><span class="s1">] * </span><span class="s3">5</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;y,y_test&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_classifier_score_with_None(y</span><span class="s0">, </span><span class="s1">y_test):</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;most_frequent&quot;</span><span class="s1">)</span>
    <span class="s1">clf.fit(</span><span class="s0">None, </span><span class="s1">y)</span>
    <span class="s0">assert </span><span class="s1">clf.score(</span><span class="s0">None, </span><span class="s1">y_test) == </span><span class="s3">0.5</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;strategy&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;stratified&quot;</span><span class="s0">, </span><span class="s4">&quot;most_frequent&quot;</span><span class="s0">, </span><span class="s4">&quot;prior&quot;</span><span class="s0">, </span><span class="s4">&quot;uniform&quot;</span><span class="s0">, </span><span class="s4">&quot;constant&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_classifier_prediction_independent_of_X(strategy</span><span class="s0">, </span><span class="s1">global_random_seed):</span>
    <span class="s1">y = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">X1 = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">4</span>
    <span class="s1">clf1 = DummyClassifier(</span>
        <span class="s1">strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=global_random_seed</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">0</span>
    <span class="s1">)</span>
    <span class="s1">clf1.fit(X1</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">predictions1 = clf1.predict(X1)</span>

    <span class="s1">X2 = [[</span><span class="s3">1</span><span class="s1">]] * </span><span class="s3">4</span>
    <span class="s1">clf2 = DummyClassifier(</span>
        <span class="s1">strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=global_random_seed</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">0</span>
    <span class="s1">)</span>
    <span class="s1">clf2.fit(X2</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">predictions2 = clf2.predict(X2)</span>

    <span class="s1">assert_array_equal(predictions1</span><span class="s0">, </span><span class="s1">predictions2)</span>


<span class="s0">def </span><span class="s1">test_mean_strategy_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">4  </span><span class="s2"># ignored</span>
    <span class="s1">y = random_state.randn(</span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">reg = DummyRegressor()</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.mean(y)] * len(X))</span>


<span class="s0">def </span><span class="s1">test_mean_strategy_multioutput_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">mean = np.mean(y_learn</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">).reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">X_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2"># Correctness oracle</span>
    <span class="s1">est = DummyRegressor()</span>
    <span class="s1">est.fit(X_learn</span><span class="s0">, </span><span class="s1">y_learn)</span>
    <span class="s1">y_pred_learn = est.predict(X_learn)</span>
    <span class="s1">y_pred_test = est.predict(X_test)</span>

    <span class="s1">_check_equality_regressor(mean</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test)</span>
    <span class="s1">_check_behavior_2d(est)</span>


<span class="s0">def </span><span class="s1">test_regressor_exceptions():</span>
    <span class="s1">reg = DummyRegressor()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(NotFittedError):</span>
        <span class="s1">reg.predict([])</span>


<span class="s0">def </span><span class="s1">test_median_strategy_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = random_state.randn(</span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;median&quot;</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.median(y)] * len(X))</span>


<span class="s0">def </span><span class="s1">test_median_strategy_multioutput_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">median = np.median(y_learn</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">).reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">X_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2"># Correctness oracle</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;median&quot;</span><span class="s1">)</span>
    <span class="s1">est.fit(X_learn</span><span class="s0">, </span><span class="s1">y_learn)</span>
    <span class="s1">y_pred_learn = est.predict(X_learn)</span>
    <span class="s1">y_pred_test = est.predict(X_test)</span>

    <span class="s1">_check_equality_regressor(median</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test)</span>
    <span class="s1">_check_behavior_2d(est)</span>


<span class="s0">def </span><span class="s1">test_quantile_strategy_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = random_state.randn(</span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.median(y)] * len(X))</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.min(y)] * len(X))</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.max(y)] * len(X))</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[np.percentile(y</span><span class="s0">, </span><span class="s1">q=</span><span class="s3">30</span><span class="s1">)] * len(X))</span>


<span class="s0">def </span><span class="s1">test_quantile_strategy_multioutput_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">median = np.median(y_learn</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">).reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">quantile_values = np.percentile(y_learn</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">q=</span><span class="s3">80</span><span class="s1">).reshape((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">X_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2"># Correctness oracle</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">est.fit(X_learn</span><span class="s0">, </span><span class="s1">y_learn)</span>
    <span class="s1">y_pred_learn = est.predict(X_learn)</span>
    <span class="s1">y_pred_test = est.predict(X_test)</span>

    <span class="s1">_check_equality_regressor(median</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test)</span>
    <span class="s1">_check_behavior_2d(est)</span>

    <span class="s2"># Correctness oracle</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.8</span><span class="s1">)</span>
    <span class="s1">est.fit(X_learn</span><span class="s0">, </span><span class="s1">y_learn)</span>
    <span class="s1">y_pred_learn = est.predict(X_learn)</span>
    <span class="s1">y_pred_test = est.predict(X_test)</span>

    <span class="s1">_check_equality_regressor(</span>
        <span class="s1">quantile_values</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test</span>
    <span class="s1">)</span>
    <span class="s1">_check_behavior_2d(est)</span>


<span class="s0">def </span><span class="s1">test_quantile_invalid():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s3">0</span><span class="s1">] * </span><span class="s3">5  </span><span class="s2"># ignored</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">err_msg = (</span>
        <span class="s4">&quot;When using `strategy='quantile', you have to specify the desired quantile&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=err_msg):</span>
        <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_quantile_strategy_empty_train():</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.4</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">est.fit([]</span><span class="s0">, </span><span class="s1">[])</span>


<span class="s0">def </span><span class="s1">test_constant_strategy_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = random_state.randn(</span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">constant=[</span><span class="s3">43</span><span class="s1">])</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">43</span><span class="s1">] * len(X))</span>

    <span class="s1">reg = DummyRegressor(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">43</span><span class="s1">)</span>
    <span class="s1">reg.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(reg.predict(X)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">43</span><span class="s1">] * len(X))</span>

    <span class="s2"># non-regression test for #22478</span>
    <span class="s0">assert not </span><span class="s1">isinstance(reg.constant</span><span class="s0">, </span><span class="s1">np.ndarray)</span>


<span class="s0">def </span><span class="s1">test_constant_strategy_multioutput_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_learn = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2"># test with 2d array</span>
    <span class="s1">constants = random_state.randn(</span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">X_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y_test = random_state.randn(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2"># Correctness oracle</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">constant=constants)</span>
    <span class="s1">est.fit(X_learn</span><span class="s0">, </span><span class="s1">y_learn)</span>
    <span class="s1">y_pred_learn = est.predict(X_learn)</span>
    <span class="s1">y_pred_test = est.predict(X_test)</span>

    <span class="s1">_check_equality_regressor(constants</span><span class="s0">, </span><span class="s1">y_learn</span><span class="s0">, </span><span class="s1">y_pred_learn</span><span class="s0">, </span><span class="s1">y_test</span><span class="s0">, </span><span class="s1">y_pred_test)</span>
    <span class="s1">_check_behavior_2d_for_constant(est)</span>


<span class="s0">def </span><span class="s1">test_y_mean_attribute_regressor():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span>
    <span class="s2"># when strategy = 'mean'</span>
    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;mean&quot;</span><span class="s1">)</span>
    <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s0">assert </span><span class="s1">est.constant_ == np.mean(y)</span>


<span class="s0">def </span><span class="s1">test_constants_not_specified_regressor():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s1">)</span>
    <span class="s1">err_msg = </span><span class="s4">&quot;Constant target value has to be specified&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=err_msg):</span>
        <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_constant_size_multioutput_regressor(global_random_seed):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>
    <span class="s1">X = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y = random_state.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">constant=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
    <span class="s1">err_msg = </span><span class="s4">r&quot;Constant target value should have shape \(5, 1\).&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=err_msg):</span>
        <span class="s1">est.fit(X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_constant_strategy():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(clf.predict(X)</span><span class="s0">, </span><span class="s1">np.ones(len(X)))</span>
    <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]  </span><span class="s2"># ignored</span>
    <span class="s1">y = [</span><span class="s4">&quot;two&quot;</span><span class="s0">, </span><span class="s4">&quot;one&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s1">]</span>
    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">constant=</span><span class="s4">&quot;one&quot;</span><span class="s1">)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(clf.predict(X)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s4">&quot;one&quot;</span><span class="s1">] * </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_constant_strategy_multioutput():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span>

    <span class="s1">n_samples = len(X)</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">constant=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">assert_array_equal(</span>
        <span class="s1">clf.predict(X)</span><span class="s0">, </span><span class="s1">np.hstack([np.ones((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))])</span>
    <span class="s1">)</span>
    <span class="s1">_check_predict_proba(clf</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;y, params, err_msg&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s4">&quot;random_state&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s1">}</span><span class="s0">, </span><span class="s4">&quot;Constant.*has to be specified&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s4">&quot;constant&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]}</span><span class="s0">, </span><span class="s4">&quot;Constant.*should have shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">np.transpose([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;constant&quot;</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s4">&quot;Constant.*should have shape&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;constant&quot;</span><span class="s1">: </span><span class="s4">&quot;my-constant&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s4">&quot;constant=my-constant.*Possible values.*</span><span class="s0">\\</span><span class="s4">[1, 2]&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">np.transpose([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s4">&quot;constant&quot;</span><span class="s1">: [</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;unknown&quot;</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s4">&quot;constant=</span><span class="s0">\\</span><span class="s4">[2, 'unknown'].*Possible values.*</span><span class="s0">\\</span><span class="s4">[1, 2]&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">ids=[</span>
        <span class="s4">&quot;no-constant&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;too-many-constant&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;not-enough-output&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;single-output&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;multi-output&quot;</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_constant_strategy_exceptions(y</span><span class="s0">, </span><span class="s1">params</span><span class="s0">, </span><span class="s1">err_msg):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]]</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">**params)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=err_msg):</span>
        <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_classification_sample_weight():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]]</span>
    <span class="s1">y = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">sample_weight = [</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">]</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;stratified&quot;</span><span class="s1">).fit(X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sample_weight)</span>
    <span class="s1">assert_array_almost_equal(clf.class_prior_</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2 </span><span class="s1">/ </span><span class="s3">1.2</span><span class="s0">, </span><span class="s3">1.0 </span><span class="s1">/ </span><span class="s3">1.2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_constant_strategy_sparse_target():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = sp.csc_matrix(np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]))</span>

    <span class="s1">n_samples = len(X)</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;constant&quot;</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">constant=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = clf.predict(X)</span>
    <span class="s0">assert </span><span class="s1">sp.issparse(y_pred)</span>
    <span class="s1">assert_array_equal(</span>
        <span class="s1">y_pred.toarray()</span><span class="s0">, </span><span class="s1">np.hstack([np.ones((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))])</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_uniform_strategy_sparse_target_warning(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = sp.csc_matrix(np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]))</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;uniform&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;the uniform strategy would not save memory&quot;</span><span class="s1">):</span>
        <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s1">p = np.bincount(y_pred[:</span><span class="s0">, </span><span class="s1">k]) / float(len(X))</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_stratified_strategy_sparse_target(global_random_seed):</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = sp.csc_matrix(np.array([[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]))</span>

    <span class="s1">clf = DummyClassifier(strategy=</span><span class="s4">&quot;stratified&quot;</span><span class="s0">, </span><span class="s1">random_state=global_random_seed)</span>
    <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">500</span>
    <span class="s1">y_pred = clf.predict(X)</span>
    <span class="s0">assert </span><span class="s1">sp.issparse(y_pred)</span>
    <span class="s1">y_pred = y_pred.toarray()</span>

    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(y.shape[</span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s1">p = np.bincount(y_pred[:</span><span class="s0">, </span><span class="s1">k]) / float(len(X))</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">3.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(p[</span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1.0 </span><span class="s1">/ </span><span class="s3">5</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_most_frequent_and_prior_strategy_sparse_target():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">5  </span><span class="s2"># ignored</span>
    <span class="s1">y = sp.csc_matrix(np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]))</span>

    <span class="s1">n_samples = len(X)</span>
    <span class="s1">y_expected = np.hstack([np.ones((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros((n_samples</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))])</span>
    <span class="s0">for </span><span class="s1">strategy </span><span class="s0">in </span><span class="s1">(</span><span class="s4">&quot;most_frequent&quot;</span><span class="s0">, </span><span class="s4">&quot;prior&quot;</span><span class="s1">):</span>
        <span class="s1">clf = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">clf.fit(X</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s1">y_pred = clf.predict(X)</span>
        <span class="s0">assert </span><span class="s1">sp.issparse(y_pred)</span>
        <span class="s1">assert_array_equal(y_pred.toarray()</span><span class="s0">, </span><span class="s1">y_expected)</span>


<span class="s0">def </span><span class="s1">test_dummy_regressor_sample_weight(global_random_seed</span><span class="s0">, </span><span class="s1">n_samples=</span><span class="s3">10</span><span class="s1">):</span>
    <span class="s1">random_state = np.random.RandomState(seed=global_random_seed)</span>

    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * n_samples</span>
    <span class="s1">y = random_state.rand(n_samples)</span>
    <span class="s1">sample_weight = random_state.rand(n_samples)</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;mean&quot;</span><span class="s1">).fit(X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sample_weight)</span>
    <span class="s0">assert </span><span class="s1">est.constant_ == np.average(y</span><span class="s0">, </span><span class="s1">weights=sample_weight)</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;median&quot;</span><span class="s1">).fit(X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sample_weight)</span>
    <span class="s0">assert </span><span class="s1">est.constant_ == _weighted_percentile(y</span><span class="s0">, </span><span class="s1">sample_weight</span><span class="s0">, </span><span class="s3">50.0</span><span class="s1">)</span>

    <span class="s1">est = DummyRegressor(strategy=</span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.95</span><span class="s1">).fit(X</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sample_weight)</span>
    <span class="s0">assert </span><span class="s1">est.constant_ == _weighted_percentile(y</span><span class="s0">, </span><span class="s1">sample_weight</span><span class="s0">, </span><span class="s3">95.0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_dummy_regressor_on_3D_array():</span>
    <span class="s1">X = np.array([[[</span><span class="s4">&quot;foo&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">&quot;baz&quot;</span><span class="s1">]]])</span>
    <span class="s1">y = np.array([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">y_expected = np.array([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">cls = DummyRegressor()</span>
    <span class="s1">cls.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = cls.predict(X)</span>
    <span class="s1">assert_array_equal(y_pred</span><span class="s0">, </span><span class="s1">y_expected)</span>


<span class="s0">def </span><span class="s1">test_dummy_classifier_on_3D_array():</span>
    <span class="s1">X = np.array([[[</span><span class="s4">&quot;foo&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">&quot;baz&quot;</span><span class="s1">]]])</span>
    <span class="s1">y = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">y_expected = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">y_proba_expected = [[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]]</span>
    <span class="s1">cls = DummyClassifier(strategy=</span><span class="s4">&quot;stratified&quot;</span><span class="s1">)</span>
    <span class="s1">cls.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred = cls.predict(X)</span>
    <span class="s1">y_pred_proba = cls.predict_proba(X)</span>
    <span class="s1">assert_array_equal(y_pred</span><span class="s0">, </span><span class="s1">y_expected)</span>
    <span class="s1">assert_array_equal(y_pred_proba</span><span class="s0">, </span><span class="s1">y_proba_expected)</span>


<span class="s0">def </span><span class="s1">test_dummy_regressor_return_std():</span>
    <span class="s1">X = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">3  </span><span class="s2"># ignored</span>
    <span class="s1">y = np.array([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">y_std_expected = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">cls = DummyRegressor()</span>
    <span class="s1">cls.fit(X</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">y_pred_list = cls.predict(X</span><span class="s0">, </span><span class="s1">return_std=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s2"># there should be two elements when return_std is True</span>
    <span class="s0">assert </span><span class="s1">len(y_pred_list) == </span><span class="s3">2</span>
    <span class="s2"># the second element should be all zeros</span>
    <span class="s1">assert_array_equal(y_pred_list[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y_std_expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;y,y_test&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.25</span><span class="s1">] * </span><span class="s3">4</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.array([[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">1.25</span><span class="s0">, </span><span class="s3">1.25</span><span class="s1">]] * </span><span class="s3">4</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_regressor_score_with_None(y</span><span class="s0">, </span><span class="s1">y_test):</span>
    <span class="s1">reg = DummyRegressor()</span>
    <span class="s1">reg.fit(</span><span class="s0">None, </span><span class="s1">y)</span>
    <span class="s0">assert </span><span class="s1">reg.score(</span><span class="s0">None, </span><span class="s1">y_test) == </span><span class="s3">1.0</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;strategy&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;mean&quot;</span><span class="s0">, </span><span class="s4">&quot;median&quot;</span><span class="s0">, </span><span class="s4">&quot;quantile&quot;</span><span class="s0">, </span><span class="s4">&quot;constant&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_regressor_prediction_independent_of_X(strategy):</span>
    <span class="s1">y = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">X1 = [[</span><span class="s3">0</span><span class="s1">]] * </span><span class="s3">4</span>
    <span class="s1">reg1 = DummyRegressor(strategy=strategy</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.7</span><span class="s1">)</span>
    <span class="s1">reg1.fit(X1</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">predictions1 = reg1.predict(X1)</span>

    <span class="s1">X2 = [[</span><span class="s3">1</span><span class="s1">]] * </span><span class="s3">4</span>
    <span class="s1">reg2 = DummyRegressor(strategy=strategy</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">quantile=</span><span class="s3">0.7</span><span class="s1">)</span>
    <span class="s1">reg2.fit(X2</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">predictions2 = reg2.predict(X2)</span>

    <span class="s1">assert_array_equal(predictions1</span><span class="s0">, </span><span class="s1">predictions2)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;strategy&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;stratified&quot;</span><span class="s0">, </span><span class="s4">&quot;most_frequent&quot;</span><span class="s0">, </span><span class="s4">&quot;prior&quot;</span><span class="s0">, </span><span class="s4">&quot;uniform&quot;</span><span class="s0">, </span><span class="s4">&quot;constant&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_dtype_of_classifier_probas(strategy):</span>
    <span class="s1">y = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">X = np.zeros(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">model = DummyClassifier(strategy=strategy</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">constant=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">probas = model.fit(X</span><span class="s0">, </span><span class="s1">y).predict_proba(X)</span>

    <span class="s0">assert </span><span class="s1">probas.dtype == np.float64</span>
</pre>
</body>
</html>
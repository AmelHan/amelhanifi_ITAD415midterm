<html>
<head>
<title>dotplots.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
dotplots.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">utils</span>


<span class="s0">def </span><span class="s1">dot_plot(points</span><span class="s0">, </span><span class="s1">intervals=</span><span class="s0">None, </span><span class="s1">lines=</span><span class="s0">None, </span><span class="s1">sections=</span><span class="s0">None,</span>
             <span class="s1">styles=</span><span class="s0">None, </span><span class="s1">marker_props=</span><span class="s0">None, </span><span class="s1">line_props=</span><span class="s0">None,</span>
             <span class="s1">split_names=</span><span class="s0">None, </span><span class="s1">section_order=</span><span class="s0">None, </span><span class="s1">line_order=</span><span class="s0">None,</span>
             <span class="s1">stacked=</span><span class="s0">False, </span><span class="s1">styles_order=</span><span class="s0">None, </span><span class="s1">striped=</span><span class="s0">False,</span>
             <span class="s1">horizontal=</span><span class="s0">True, </span><span class="s1">show_names=</span><span class="s2">&quot;both&quot;</span><span class="s0">,</span>
             <span class="s1">fmt_left_name=</span><span class="s0">None, </span><span class="s1">fmt_right_name=</span><span class="s0">None,</span>
             <span class="s1">show_section_titles=</span><span class="s0">None, </span><span class="s1">ax=</span><span class="s0">None</span><span class="s1">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Dot plotting (also known as forest and blobbogram). 
 
    Produce a dotplot similar in style to those in Cleveland's 
    &quot;Visualizing Data&quot; book ([1]_).  These are also known as &quot;forest plots&quot;. 
 
    Parameters 
    ---------- 
    points : array_like 
        The quantitative values to be plotted as markers. 
    intervals : array_like 
        The intervals to be plotted around the points.  The elements 
        of `intervals` are either scalars or sequences of length 2.  A 
        scalar indicates the half width of a symmetric interval.  A 
        sequence of length 2 contains the left and right half-widths 
        (respectively) of a nonsymmetric interval.  If None, no 
        intervals are drawn. 
    lines : array_like 
        A grouping variable indicating which points/intervals are 
        drawn on a common line.  If None, each point/interval appears 
        on its own line. 
    sections : array_like 
        A grouping variable indicating which lines are grouped into 
        sections.  If None, everything is drawn in a single section. 
    styles : array_like 
        A grouping label defining the plotting style of the markers 
        and intervals. 
    marker_props : dict 
        A dictionary mapping style codes (the values in `styles`) to 
        dictionaries defining key/value pairs to be passed as keyword 
        arguments to `plot` when plotting markers.  Useful keyword 
        arguments are &quot;color&quot;, &quot;marker&quot;, and &quot;ms&quot; (marker size). 
    line_props : dict 
        A dictionary mapping style codes (the values in `styles`) to 
        dictionaries defining key/value pairs to be passed as keyword 
        arguments to `plot` when plotting interval lines.  Useful 
        keyword arguments are &quot;color&quot;, &quot;linestyle&quot;, &quot;solid_capstyle&quot;, 
        and &quot;linewidth&quot;. 
    split_names : str 
        If not None, this is used to split the values of `lines` into 
        substrings that are drawn in the left and right margins, 
        respectively.  If None, the values of `lines` are drawn in the 
        left margin. 
    section_order : array_like 
        The section labels in the order in which they appear in the 
        dotplot. 
    line_order : array_like 
        The line labels in the order in which they appear in the 
        dotplot. 
    stacked : bool 
        If True, when multiple points or intervals are drawn on the 
        same line, they are offset from each other. 
    styles_order : array_like 
        If stacked=True, this is the order in which the point styles 
        on a given line are drawn from top to bottom (if horizontal 
        is True) or from left to right (if horizontal is False).  If 
        None (default), the order is lexical. 
    striped : bool 
        If True, every other line is enclosed in a shaded box. 
    horizontal : bool 
        If True (default), the lines are drawn horizontally, otherwise 
        they are drawn vertically. 
    show_names : str 
        Determines whether labels (names) are shown in the left and/or 
        right margins (top/bottom margins if `horizontal` is True). 
        If `both`, labels are drawn in both margins, if 'left', labels 
        are drawn in the left or top margin.  If `right`, labels are 
        drawn in the right or bottom margin. 
    fmt_left_name : callable 
        The left/top margin names are passed through this function 
        before drawing on the plot. 
    fmt_right_name : callable 
        The right/bottom marginnames are passed through this function 
        before drawing on the plot. 
    show_section_titles : bool or None 
        If None, section titles are drawn only if there is more than 
        one section.  If False/True, section titles are never/always 
        drawn, respectively. 
    ax : matplotlib.axes 
        The axes on which the dotplot is drawn.  If None, a new axes 
        is created. 
 
    Returns 
    ------- 
    fig : Figure 
        The figure given by `ax.figure` or a new instance. 
 
    Notes 
    ----- 
    `points`, `intervals`, `lines`, `sections`, `styles` must all have 
    the same length whenever present. 
 
    References 
    ---------- 
    .. [1] Cleveland, William S. (1993). &quot;Visualizing Data&quot;. Hobart Press. 
    .. [2] Jacoby, William G. (2006) &quot;The Dot Plot: A Graphical Display 
       for Labeled Quantitative Values.&quot; The Political Methodologist 
       14(1): 6-14. 
 
    Examples 
    -------- 
    This is a simple dotplot with one point per line: 
 
    &gt;&gt;&gt; dot_plot(points=point_values) 
 
    This dotplot has labels on the lines (if elements in 
    `label_values` are repeated, the corresponding points appear on 
    the same line): 
 
    &gt;&gt;&gt; dot_plot(points=point_values, lines=label_values) 
    &quot;&quot;&quot;</span>

    <span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">transforms</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = utils.create_mpl_ax(ax)</span>

    <span class="s4"># Convert to numpy arrays if that is not what we are given.</span>
    <span class="s1">points = np.asarray(points)</span>
    <span class="s1">asarray_or_none = </span><span class="s0">lambda </span><span class="s1">x : </span><span class="s0">None if </span><span class="s1">x </span><span class="s0">is None else </span><span class="s1">np.asarray(x)</span>
    <span class="s1">intervals = asarray_or_none(intervals)</span>
    <span class="s1">lines = asarray_or_none(lines)</span>
    <span class="s1">sections = asarray_or_none(sections)</span>
    <span class="s1">styles = asarray_or_none(styles)</span>

    <span class="s4"># Total number of points</span>
    <span class="s1">npoint = len(points)</span>

    <span class="s4"># Set default line values if needed</span>
    <span class="s0">if </span><span class="s1">lines </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">lines = np.arange(npoint)</span>

    <span class="s4"># Set default section values if needed</span>
    <span class="s0">if </span><span class="s1">sections </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">sections = np.zeros(npoint)</span>

    <span class="s4"># Set default style values if needed</span>
    <span class="s0">if </span><span class="s1">styles </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">styles = np.zeros(npoint)</span>

    <span class="s4"># The vertical space (in inches) for a section title</span>
    <span class="s1">section_title_space = </span><span class="s5">0.5</span>

    <span class="s4"># The number of sections</span>
    <span class="s1">nsect = len(set(sections))</span>
    <span class="s0">if </span><span class="s1">section_order </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">nsect = len(set(section_order))</span>

    <span class="s4"># The number of section titles</span>
    <span class="s0">if </span><span class="s1">show_section_titles </span><span class="s0">is False</span><span class="s1">:</span>
        <span class="s1">draw_section_titles = </span><span class="s0">False</span>
        <span class="s1">nsect_title = </span><span class="s5">0</span>
    <span class="s0">elif </span><span class="s1">show_section_titles </span><span class="s0">is True</span><span class="s1">:</span>
        <span class="s1">draw_section_titles = </span><span class="s0">True</span>
        <span class="s1">nsect_title = nsect</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">draw_section_titles = nsect &gt; </span><span class="s5">1</span>
        <span class="s1">nsect_title = nsect </span><span class="s0">if </span><span class="s1">nsect &gt; </span><span class="s5">1 </span><span class="s0">else </span><span class="s5">0</span>

    <span class="s4"># The total vertical space devoted to section titles.</span>
    <span class="s1">section_space_total = section_title_space * nsect_title</span>

    <span class="s4"># Add a bit of room so that points that fall at the axis limits</span>
    <span class="s4"># are not cut in half.</span>
    <span class="s1">ax.set_xmargin(</span><span class="s5">0.02</span><span class="s1">)</span>
    <span class="s1">ax.set_ymargin(</span><span class="s5">0.02</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">section_order </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">lines0 = list(set(sections))</span>
        <span class="s1">lines0.sort()</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">lines0 = section_order</span>

    <span class="s0">if </span><span class="s1">line_order </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">lines1 = list(set(lines))</span>
        <span class="s1">lines1.sort()</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">lines1 = line_order</span>

    <span class="s4"># A map from (section,line) codes to index positions.</span>
    <span class="s1">lines_map = {}</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(npoint):</span>
        <span class="s0">if </span><span class="s1">section_order </span><span class="s0">is not None and </span><span class="s1">sections[i] </span><span class="s0">not in </span><span class="s1">section_order:</span>
            <span class="s0">continue</span>
        <span class="s0">if </span><span class="s1">line_order </span><span class="s0">is not None and </span><span class="s1">lines[i] </span><span class="s0">not in </span><span class="s1">line_order:</span>
            <span class="s0">continue</span>
        <span class="s1">ky = (sections[i]</span><span class="s0">, </span><span class="s1">lines[i])</span>
        <span class="s0">if </span><span class="s1">ky </span><span class="s0">not in </span><span class="s1">lines_map:</span>
            <span class="s1">lines_map[ky] = []</span>
        <span class="s1">lines_map[ky].append(i)</span>

    <span class="s4"># Get the size of the axes on the parent figure in inches</span>
    <span class="s1">bbox = ax.get_window_extent().transformed(</span>
        <span class="s1">fig.dpi_scale_trans.inverted())</span>
    <span class="s1">awidth</span><span class="s0">, </span><span class="s1">aheight = bbox.width</span><span class="s0">, </span><span class="s1">bbox.height</span>

    <span class="s4"># The number of lines in the plot.</span>
    <span class="s1">nrows = len(lines_map)</span>

    <span class="s4"># The positions of the lowest and highest guideline in axes</span>
    <span class="s4"># coordinates (for horizontal dotplots), or the leftmost and</span>
    <span class="s4"># rightmost guidelines (for vertical dotplots).</span>
    <span class="s1">bottom</span><span class="s0">, </span><span class="s1">top = </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span>

    <span class="s0">if </span><span class="s1">horizontal:</span>
        <span class="s4"># x coordinate is data, y coordinate is axes</span>
        <span class="s1">trans = transforms.blended_transform_factory(ax.transData</span><span class="s0">,</span>
                                                     <span class="s1">ax.transAxes)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># x coordinate is axes, y coordinate is data</span>
        <span class="s1">trans = transforms.blended_transform_factory(ax.transAxes</span><span class="s0">,</span>
                                                     <span class="s1">ax.transData)</span>

    <span class="s4"># Space used for a section title, in axes coordinates</span>
    <span class="s1">title_space_axes = section_title_space / aheight</span>

    <span class="s4"># Space between lines</span>
    <span class="s0">if </span><span class="s1">horizontal:</span>
        <span class="s1">dpos = (top - bottom - nsect_title*title_space_axes) /\</span>
            <span class="s1">float(nrows)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">dpos = (top - bottom) / float(nrows)</span>

    <span class="s4"># Determine the spacing for stacked points</span>
    <span class="s0">if </span><span class="s1">styles_order </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">style_codes = styles_order</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">style_codes = list(set(styles))</span>
        <span class="s1">style_codes.sort()</span>
    <span class="s4"># Order is top to bottom for horizontal plots, so need to</span>
    <span class="s4"># flip.</span>
    <span class="s0">if </span><span class="s1">horizontal:</span>
        <span class="s1">style_codes = style_codes[::-</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s4"># nval is the maximum number of points on one line.</span>
    <span class="s1">nval = len(style_codes)</span>
    <span class="s0">if </span><span class="s1">nval &gt; </span><span class="s5">1</span><span class="s1">:</span>
        <span class="s1">stackd = dpos / (</span><span class="s5">2.5</span><span class="s1">*(float(nval)-</span><span class="s5">1</span><span class="s1">))</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">stackd = </span><span class="s5">0.</span>

    <span class="s4"># Map from style code to its integer position</span>
    <span class="s1">style_codes_map = {x: style_codes.index(x) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">style_codes}</span>

    <span class="s4"># Setup default marker styles</span>
    <span class="s1">colors = [</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s2">&quot;purple&quot;</span><span class="s0">, </span><span class="s2">&quot;orange&quot;</span><span class="s1">]</span>
    <span class="s0">if </span><span class="s1">marker_props </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">marker_props = {x: {} </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">style_codes}</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(nval):</span>
        <span class="s1">sc = style_codes[j]</span>
        <span class="s0">if </span><span class="s2">&quot;color&quot; </span><span class="s0">not in </span><span class="s1">marker_props[sc]:</span>
            <span class="s1">marker_props[sc][</span><span class="s2">&quot;color&quot;</span><span class="s1">] = colors[j % len(colors)]</span>
        <span class="s0">if </span><span class="s2">&quot;marker&quot; </span><span class="s0">not in </span><span class="s1">marker_props[sc]:</span>
            <span class="s1">marker_props[sc][</span><span class="s2">&quot;marker&quot;</span><span class="s1">] = </span><span class="s2">&quot;o&quot;</span>
        <span class="s0">if </span><span class="s2">&quot;ms&quot; </span><span class="s0">not in </span><span class="s1">marker_props[sc]:</span>
            <span class="s1">marker_props[sc][</span><span class="s2">&quot;ms&quot;</span><span class="s1">] = </span><span class="s5">10 </span><span class="s0">if </span><span class="s1">stackd == </span><span class="s5">0 </span><span class="s0">else </span><span class="s5">6</span>

    <span class="s4"># Setup default line styles</span>
    <span class="s0">if </span><span class="s1">line_props </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">line_props = {x: {} </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">style_codes}</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(nval):</span>
        <span class="s1">sc = style_codes[j]</span>
        <span class="s0">if </span><span class="s2">&quot;color&quot; </span><span class="s0">not in </span><span class="s1">line_props[sc]:</span>
            <span class="s1">line_props[sc][</span><span class="s2">&quot;color&quot;</span><span class="s1">] = </span><span class="s2">&quot;grey&quot;</span>
        <span class="s0">if </span><span class="s2">&quot;linewidth&quot; </span><span class="s0">not in </span><span class="s1">line_props[sc]:</span>
            <span class="s1">line_props[sc][</span><span class="s2">&quot;linewidth&quot;</span><span class="s1">] = </span><span class="s5">2 </span><span class="s0">if </span><span class="s1">stackd &gt; </span><span class="s5">0 </span><span class="s0">else </span><span class="s5">8</span>

    <span class="s0">if </span><span class="s1">horizontal:</span>
        <span class="s4"># The vertical position of the first line.</span>
        <span class="s1">pos = top - dpos/</span><span class="s5">2 </span><span class="s0">if </span><span class="s1">nsect == </span><span class="s5">1 </span><span class="s0">else </span><span class="s1">top</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># The horizontal position of the first line.</span>
        <span class="s1">pos = bottom + dpos/</span><span class="s5">2</span>

    <span class="s4"># Points that have already been labeled</span>
    <span class="s1">labeled = set()</span>

    <span class="s4"># Positions of the y axis grid lines</span>
    <span class="s1">ticks = []</span>

    <span class="s4"># Loop through the sections</span>
    <span class="s0">for </span><span class="s1">k0 </span><span class="s0">in </span><span class="s1">lines0:</span>

        <span class="s4"># Draw a section title</span>
        <span class="s0">if </span><span class="s1">draw_section_titles:</span>

            <span class="s0">if </span><span class="s1">horizontal:</span>

                <span class="s1">y0 = pos + dpos/</span><span class="s5">2 </span><span class="s0">if </span><span class="s1">k0 == lines0[</span><span class="s5">0</span><span class="s1">] </span><span class="s0">else </span><span class="s1">pos</span>

                <span class="s1">ax.fill_between((</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(y0</span><span class="s0">,</span><span class="s1">y0)</span><span class="s0">,</span>
                                <span class="s1">(pos-</span><span class="s5">0.7</span><span class="s1">*title_space_axes</span><span class="s0">,</span>
                                 <span class="s1">pos-</span><span class="s5">0.7</span><span class="s1">*title_space_axes)</span><span class="s0">,</span>
                                <span class="s1">color=</span><span class="s2">'darkgrey'</span><span class="s0">,</span>
                                <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                <span class="s1">zorder=</span><span class="s5">1</span><span class="s1">)</span>

                <span class="s1">txt = ax.text(</span><span class="s5">0.5</span><span class="s0">, </span><span class="s1">pos - </span><span class="s5">0.35</span><span class="s1">*title_space_axes</span><span class="s0">, </span><span class="s1">k0</span><span class="s0">,</span>
                              <span class="s1">horizontalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
                              <span class="s1">verticalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
                              <span class="s1">transform=ax.transAxes)</span>
                <span class="s1">txt.set_fontweight(</span><span class="s2">&quot;bold&quot;</span><span class="s1">)</span>
                <span class="s1">pos -= title_space_axes</span>

            <span class="s0">else</span><span class="s1">:</span>

                <span class="s1">m = len([k </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">lines_map </span><span class="s0">if </span><span class="s1">k[</span><span class="s5">0</span><span class="s1">] == k0])</span>

                <span class="s1">ax.fill_between((pos-dpos/</span><span class="s5">2</span><span class="s1">+</span><span class="s5">0.01</span><span class="s0">,</span>
                                 <span class="s1">pos+(m-</span><span class="s5">1</span><span class="s1">)*dpos+dpos/</span><span class="s5">2</span><span class="s1">-</span><span class="s5">0.01</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">(</span><span class="s5">1.01</span><span class="s0">,</span><span class="s5">1.01</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s5">1.06</span><span class="s0">,</span><span class="s5">1.06</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">color=</span><span class="s2">'darkgrey'</span><span class="s0">,</span>
                                <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                <span class="s1">zorder=</span><span class="s5">1</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">False</span><span class="s1">)</span>

                <span class="s1">txt = ax.text(pos + (m-</span><span class="s5">1</span><span class="s1">)*dpos/</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1.02</span><span class="s0">, </span><span class="s1">k0</span><span class="s0">,</span>
                              <span class="s1">horizontalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
                              <span class="s1">verticalalignment=</span><span class="s2">'bottom'</span><span class="s0">,</span>
                              <span class="s1">transform=ax.transAxes)</span>
                <span class="s1">txt.set_fontweight(</span><span class="s2">&quot;bold&quot;</span><span class="s1">)</span>

        <span class="s1">jrow = </span><span class="s5">0</span>
        <span class="s0">for </span><span class="s1">k1 </span><span class="s0">in </span><span class="s1">lines1:</span>

            <span class="s4"># No data to plot</span>
            <span class="s0">if </span><span class="s1">(k0</span><span class="s0">, </span><span class="s1">k1) </span><span class="s0">not in </span><span class="s1">lines_map:</span>
                <span class="s0">continue</span>

            <span class="s4"># Draw the guideline</span>
            <span class="s0">if </span><span class="s1">horizontal:</span>
                <span class="s1">ax.axhline(pos</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'grey'</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">ax.axvline(pos</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'grey'</span><span class="s1">)</span>

            <span class="s4"># Set up the labels</span>
            <span class="s0">if </span><span class="s1">split_names </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">us = k1.split(split_names)</span>
                <span class="s0">if </span><span class="s1">len(us) &gt;= </span><span class="s5">2</span><span class="s1">:</span>
                    <span class="s1">left_label</span><span class="s0">, </span><span class="s1">right_label = us[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">us[</span><span class="s5">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">left_label</span><span class="s0">, </span><span class="s1">right_label = k1</span><span class="s0">, None</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">left_label</span><span class="s0">, </span><span class="s1">right_label = k1</span><span class="s0">, None</span>

            <span class="s0">if </span><span class="s1">fmt_left_name </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">left_label = fmt_left_name(left_label)</span>

            <span class="s0">if </span><span class="s1">fmt_right_name </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">right_label = fmt_right_name(right_label)</span>

            <span class="s4"># Draw the stripe</span>
            <span class="s0">if </span><span class="s1">striped </span><span class="s0">and </span><span class="s1">jrow % </span><span class="s5">2 </span><span class="s1">== </span><span class="s5">0</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">horizontal:</span>
                    <span class="s1">ax.fill_between((</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(pos-dpos/</span><span class="s5">2</span><span class="s0">, </span><span class="s1">pos-dpos/</span><span class="s5">2</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">(pos+dpos/</span><span class="s5">2</span><span class="s0">, </span><span class="s1">pos+dpos/</span><span class="s5">2</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">color=</span><span class="s2">'lightgrey'</span><span class="s0">,</span>
                                    <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                    <span class="s1">zorder=</span><span class="s5">0</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">ax.fill_between((pos-dpos/</span><span class="s5">2</span><span class="s0">, </span><span class="s1">pos+dpos/</span><span class="s5">2</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">,</span>
                                    <span class="s1">color=</span><span class="s2">'lightgrey'</span><span class="s0">,</span>
                                    <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                    <span class="s1">zorder=</span><span class="s5">0</span><span class="s1">)</span>

            <span class="s1">jrow += </span><span class="s5">1</span>

            <span class="s4"># Draw the left margin label</span>
            <span class="s0">if </span><span class="s1">show_names.lower() </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s2">&quot;both&quot;</span><span class="s1">):</span>
                <span class="s0">if </span><span class="s1">horizontal:</span>
                    <span class="s1">ax.text(-</span><span class="s5">0.1</span><span class="s1">/awidth</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">left_label</span><span class="s0">,</span>
                            <span class="s1">horizontalalignment=</span><span class="s2">&quot;right&quot;</span><span class="s0">,</span>
                            <span class="s1">verticalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
                            <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                            <span class="s1">family=</span><span class="s2">'monospace'</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">ax.text(pos</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.1</span><span class="s1">/aheight</span><span class="s0">, </span><span class="s1">left_label</span><span class="s0">,</span>
                            <span class="s1">horizontalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s0">,</span>
                            <span class="s1">verticalalignment=</span><span class="s2">'top'</span><span class="s0">,</span>
                            <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                            <span class="s1">family=</span><span class="s2">'monospace'</span><span class="s1">)</span>

            <span class="s4"># Draw the right margin label</span>
            <span class="s0">if </span><span class="s1">show_names.lower() </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s2">&quot;both&quot;</span><span class="s1">):</span>
                <span class="s0">if </span><span class="s1">right_label </span><span class="s0">is not None</span><span class="s1">:</span>
                    <span class="s0">if </span><span class="s1">horizontal:</span>
                        <span class="s1">ax.text(</span><span class="s5">1 </span><span class="s1">+ </span><span class="s5">0.1</span><span class="s1">/awidth</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">, </span><span class="s1">right_label</span><span class="s0">,</span>
                                <span class="s1">horizontalalignment=</span><span class="s2">&quot;left&quot;</span><span class="s0">,</span>
                                <span class="s1">verticalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
                                <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                <span class="s1">family=</span><span class="s2">'monospace'</span><span class="s1">)</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">ax.text(pos</span><span class="s0">, </span><span class="s5">1 </span><span class="s1">+ </span><span class="s5">0.1</span><span class="s1">/aheight</span><span class="s0">, </span><span class="s1">right_label</span><span class="s0">,</span>
                                <span class="s1">horizontalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s0">,</span>
                                <span class="s1">verticalalignment=</span><span class="s2">'bottom'</span><span class="s0">,</span>
                                <span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
                                <span class="s1">family=</span><span class="s2">'monospace'</span><span class="s1">)</span>

            <span class="s4"># Save the vertical position so that we can place the</span>
            <span class="s4"># tick marks</span>
            <span class="s1">ticks.append(pos)</span>

            <span class="s4"># Loop over the points in one line</span>
            <span class="s0">for </span><span class="s1">ji</span><span class="s0">,</span><span class="s1">jp </span><span class="s0">in </span><span class="s1">enumerate(lines_map[(k0</span><span class="s0">,</span><span class="s1">k1)]):</span>

                <span class="s4"># Calculate the vertical offset</span>
                <span class="s1">yo = </span><span class="s5">0</span>
                <span class="s0">if </span><span class="s1">stacked:</span>
                    <span class="s1">yo = -dpos/</span><span class="s5">5 </span><span class="s1">+ style_codes_map[styles[jp]]*stackd</span>

                <span class="s1">pt = points[jp]</span>

                <span class="s4"># Plot the interval</span>
                <span class="s0">if </span><span class="s1">intervals </span><span class="s0">is not None</span><span class="s1">:</span>

                    <span class="s4"># Symmetric interval</span>
                    <span class="s0">if </span><span class="s1">np.isscalar(intervals[jp]):</span>
                        <span class="s1">lcb</span><span class="s0">, </span><span class="s1">ucb = pt - intervals[jp]</span><span class="s0">,</span><span class="s1">\</span>
                            <span class="s1">pt + intervals[jp]</span>

                    <span class="s4"># Nonsymmetric interval</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">lcb</span><span class="s0">, </span><span class="s1">ucb = pt - intervals[jp][</span><span class="s5">0</span><span class="s1">]</span><span class="s0">,</span><span class="s1">\</span>
                            <span class="s1">pt + intervals[jp][</span><span class="s5">1</span><span class="s1">]</span>

                    <span class="s4"># Draw the interval</span>
                    <span class="s0">if </span><span class="s1">horizontal:</span>
                        <span class="s1">ax.plot([lcb</span><span class="s0">, </span><span class="s1">ucb]</span><span class="s0">, </span><span class="s1">[pos+yo</span><span class="s0">, </span><span class="s1">pos+yo]</span><span class="s0">, </span><span class="s2">'-'</span><span class="s0">,</span>
                                <span class="s1">transform=trans</span><span class="s0">,</span>
                                <span class="s1">**line_props[styles[jp]])</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">ax.plot([pos+yo</span><span class="s0">, </span><span class="s1">pos+yo]</span><span class="s0">, </span><span class="s1">[lcb</span><span class="s0">, </span><span class="s1">ucb]</span><span class="s0">, </span><span class="s2">'-'</span><span class="s0">,</span>
                                <span class="s1">transform=trans</span><span class="s0">,</span>
                                <span class="s1">**line_props[styles[jp]])</span>


                <span class="s4"># Plot the point</span>
                <span class="s1">sl = styles[jp]</span>
                <span class="s1">sll = sl </span><span class="s0">if </span><span class="s1">sl </span><span class="s0">not in </span><span class="s1">labeled </span><span class="s0">else None</span>
                <span class="s1">labeled.add(sl)</span>
                <span class="s0">if </span><span class="s1">horizontal:</span>
                    <span class="s1">ax.plot([pt</span><span class="s0">,</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[pos+yo</span><span class="s0">,</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ls=</span><span class="s2">'None'</span><span class="s0">,</span>
                            <span class="s1">transform=trans</span><span class="s0">, </span><span class="s1">label=sll</span><span class="s0">,</span>
                            <span class="s1">**marker_props[sl])</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">ax.plot([pos+yo</span><span class="s0">,</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[pt</span><span class="s0">,</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ls=</span><span class="s2">'None'</span><span class="s0">,</span>
                            <span class="s1">transform=trans</span><span class="s0">, </span><span class="s1">label=sll</span><span class="s0">,</span>
                            <span class="s1">**marker_props[sl])</span>

            <span class="s0">if </span><span class="s1">horizontal:</span>
                <span class="s1">pos -= dpos</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">pos += dpos</span>

    <span class="s4"># Set up the axis</span>
    <span class="s0">if </span><span class="s1">horizontal:</span>
        <span class="s1">ax.xaxis.set_ticks_position(</span><span class="s2">&quot;bottom&quot;</span><span class="s1">)</span>
        <span class="s1">ax.yaxis.set_ticks_position(</span><span class="s2">&quot;none&quot;</span><span class="s1">)</span>
        <span class="s1">ax.set_yticklabels([])</span>
        <span class="s1">ax.spines[</span><span class="s2">'left'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'right'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'top'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'bottom'</span><span class="s1">].set_position((</span><span class="s2">'axes'</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.1</span><span class="s1">/aheight))</span>
        <span class="s1">ax.set_ylim(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">ax.yaxis.set_ticks(ticks)</span>
        <span class="s1">ax.autoscale_view(scaley=</span><span class="s0">False, </span><span class="s1">tight=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">ax.yaxis.set_ticks_position(</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
        <span class="s1">ax.xaxis.set_ticks_position(</span><span class="s2">&quot;none&quot;</span><span class="s1">)</span>
        <span class="s1">ax.set_xticklabels([])</span>
        <span class="s1">ax.spines[</span><span class="s2">'bottom'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'right'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'top'</span><span class="s1">].set_color(</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">ax.spines[</span><span class="s2">'left'</span><span class="s1">].set_position((</span><span class="s2">'axes'</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.1</span><span class="s1">/awidth))</span>
        <span class="s1">ax.set_xlim(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">ax.xaxis.set_ticks(ticks)</span>
        <span class="s1">ax.autoscale_view(scalex=</span><span class="s0">False, </span><span class="s1">tight=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">return </span><span class="s1">fig</span>
</pre>
</body>
</html>
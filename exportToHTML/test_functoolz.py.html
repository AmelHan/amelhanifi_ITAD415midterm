<html>
<head>
<title>test_functoolz.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_functoolz.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">inspect</span>
<span class="s0">import </span><span class="s1">toolz</span>
<span class="s0">from </span><span class="s1">toolz.functoolz </span><span class="s0">import </span><span class="s1">(thread_first</span><span class="s0">, </span><span class="s1">thread_last</span><span class="s0">, </span><span class="s1">memoize</span><span class="s0">, </span><span class="s1">curry</span><span class="s0">,</span>
                             <span class="s1">compose</span><span class="s0">, </span><span class="s1">compose_left</span><span class="s0">, </span><span class="s1">pipe</span><span class="s0">, </span><span class="s1">complement</span><span class="s0">, </span><span class="s1">do</span><span class="s0">, </span><span class="s1">juxt</span><span class="s0">,</span>
                             <span class="s1">flip</span><span class="s0">, </span><span class="s1">excepts</span><span class="s0">, </span><span class="s1">apply)</span>
<span class="s0">from </span><span class="s1">operator </span><span class="s0">import </span><span class="s1">add</span><span class="s0">, </span><span class="s1">mul</span><span class="s0">, </span><span class="s1">itemgetter</span>
<span class="s0">from </span><span class="s1">toolz.utils </span><span class="s0">import </span><span class="s1">raises</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>


<span class="s0">def </span><span class="s1">iseven(x):</span>
    <span class="s0">return </span><span class="s1">x % </span><span class="s2">2 </span><span class="s1">== </span><span class="s2">0</span>


<span class="s0">def </span><span class="s1">isodd(x):</span>
    <span class="s0">return </span><span class="s1">x % </span><span class="s2">2 </span><span class="s1">== </span><span class="s2">1</span>


<span class="s0">def </span><span class="s1">inc(x):</span>
    <span class="s0">return </span><span class="s1">x + </span><span class="s2">1</span>


<span class="s0">def </span><span class="s1">double(x):</span>
    <span class="s0">return </span><span class="s2">2 </span><span class="s1">* x</span>


<span class="s0">class </span><span class="s1">AlwaysEquals(object):</span>
    <span class="s3">&quot;&quot;&quot;useful to test correct __eq__ implementation of other objects&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__eq__(self</span><span class="s0">, </span><span class="s1">other):</span>
        <span class="s0">return True</span>

    <span class="s0">def </span><span class="s1">__ne__(self</span><span class="s0">, </span><span class="s1">other):</span>
        <span class="s0">return False</span>


<span class="s0">class </span><span class="s1">NeverEquals(object):</span>
    <span class="s3">&quot;&quot;&quot;useful to test correct __eq__ implementation of other objects&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__eq__(self</span><span class="s0">, </span><span class="s1">other):</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">__ne__(self</span><span class="s0">, </span><span class="s1">other):</span>
        <span class="s0">return True</span>


<span class="s0">def </span><span class="s1">test_apply():</span>
    <span class="s0">assert </span><span class="s1">apply(double</span><span class="s0">, </span><span class="s2">5</span><span class="s1">) == </span><span class="s2">10</span>
    <span class="s0">assert </span><span class="s1">tuple(map(apply</span><span class="s0">, </span><span class="s1">[double</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">double]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">500</span><span class="s0">, </span><span class="s2">8000</span><span class="s1">])) == (</span><span class="s2">20</span><span class="s0">, </span><span class="s2">501</span><span class="s0">, </span><span class="s2">16000</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, </span><span class="s1">apply)</span>


<span class="s0">def </span><span class="s1">test_thread_first():</span>
    <span class="s0">assert </span><span class="s1">thread_first(</span><span class="s2">2</span><span class="s1">) == </span><span class="s2">2</span>
    <span class="s0">assert </span><span class="s1">thread_first(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">inc) == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">thread_first(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">inc) == </span><span class="s2">4</span>
    <span class="s0">assert </span><span class="s1">thread_first(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">double</span><span class="s0">, </span><span class="s1">inc) == </span><span class="s2">5</span>
    <span class="s0">assert </span><span class="s1">thread_first(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">(add</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">double) == </span><span class="s2">14</span>


<span class="s0">def </span><span class="s1">test_thread_last():</span>
    <span class="s0">assert </span><span class="s1">list(thread_last([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(map</span><span class="s0">, </span><span class="s1">inc)</span><span class="s0">, </span><span class="s1">(filter</span><span class="s0">, </span><span class="s1">iseven))) == [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(thread_last([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(map</span><span class="s0">, </span><span class="s1">inc)</span><span class="s0">, </span><span class="s1">(filter</span><span class="s0">, </span><span class="s1">isodd))) == [</span><span class="s2">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">thread_last(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">(add</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">double) == </span><span class="s2">14</span>


<span class="s0">def </span><span class="s1">test_memoize():</span>
    <span class="s1">fn_calls = [</span><span class="s2">0</span><span class="s1">]  </span><span class="s4"># Storage for side effects</span>

    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y):</span>
        <span class="s3">&quot;&quot;&quot; A docstring &quot;&quot;&quot;</span>
        <span class="s1">fn_calls[</span><span class="s2">0</span><span class="s1">] += </span><span class="s2">1</span>
        <span class="s0">return </span><span class="s1">x + y</span>
    <span class="s1">mf = memoize(f)</span>

    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) </span><span class="s0">is </span><span class="s1">mf(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fn_calls == [</span><span class="s2">1</span><span class="s1">]  </span><span class="s4"># function was only called once</span>
    <span class="s0">assert </span><span class="s1">mf.__doc__ == f.__doc__</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">{}))</span>


<span class="s0">def </span><span class="s1">test_memoize_kwargs():</span>
    <span class="s1">fn_calls = [</span><span class="s2">0</span><span class="s1">]  </span><span class="s4"># Storage for side effects</span>

    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s1">mf = memoize(f)</span>

    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">3</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_memoize_curried():</span>
    <span class="s1">@curry</span>
    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s1">f2 = f(y=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">fm2 = memoize(f2)</span>

    <span class="s0">assert </span><span class="s1">fm2(</span><span class="s2">3</span><span class="s1">) == f2(</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fm2(</span><span class="s2">3</span><span class="s1">) == f2(</span><span class="s2">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_memoize_partial():</span>
    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s1">f2 = partial(f</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">fm2 = memoize(f2)</span>

    <span class="s0">assert </span><span class="s1">fm2(</span><span class="s2">3</span><span class="s1">) == f2(</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fm2(</span><span class="s2">3</span><span class="s1">) == f2(</span><span class="s2">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_memoize_key_signature():</span>
    <span class="s4"># Single argument should not be tupled as a key.  No keywords.</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s0">False, </span><span class="s1">cache={</span><span class="s2">1</span><span class="s1">: </span><span class="s0">True</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">2</span><span class="s1">) </span><span class="s0">is False</span>

    <span class="s4"># Single argument must be tupled if signature has varargs.  No keywords.</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">*args: </span><span class="s0">False, </span><span class="s1">cache={(</span><span class="s2">1</span><span class="s0">,</span><span class="s1">): </span><span class="s0">True, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">): </span><span class="s2">2</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">2</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">2</span>
    <span class="s0">assert </span><span class="s1">mf((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)) </span><span class="s0">is False</span>

    <span class="s4"># More than one argument is always tupled.  No keywords.</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y: </span><span class="s0">False, </span><span class="s1">cache={(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">): </span><span class="s0">True</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: mf((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)))</span>

    <span class="s4"># Nullary function (no inputs) uses empty tuple as the key</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">False, </span><span class="s1">cache={(): </span><span class="s0">True</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf() </span><span class="s0">is True</span>

    <span class="s4"># Single argument must be tupled if there are keyword arguments, because</span>
    <span class="s4"># keyword arguments may be passed as unnamed args.</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">: </span><span class="s0">False,</span>
                 <span class="s1">cache={((</span><span class="s2">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">frozenset(((</span><span class="s5">'y'</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">,</span><span class="s1">))): </span><span class="s2">2</span><span class="s0">,</span>
                        <span class="s1">((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">): </span><span class="s2">3</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">) == </span><span class="s2">2</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)) </span><span class="s0">is False</span>

    <span class="s4"># Keyword-only signatures must still have an &quot;args&quot; tuple.</span>
    <span class="s1">mf = memoize(</span><span class="s0">lambda </span><span class="s1">x=</span><span class="s2">0</span><span class="s1">: </span><span class="s0">False, </span><span class="s1">cache={(</span><span class="s0">None, </span><span class="s1">frozenset(((</span><span class="s5">'x'</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span><span class="s1">))): </span><span class="s2">1</span><span class="s0">,</span>
                                           <span class="s1">((</span><span class="s2">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">): </span><span class="s2">2</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">mf() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">mf(x=</span><span class="s2">1</span><span class="s1">) == </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">mf(</span><span class="s2">1</span><span class="s1">) == </span><span class="s2">2</span>


<span class="s0">def </span><span class="s1">test_memoize_curry_cache():</span>
    <span class="s1">@memoize(cache={</span><span class="s2">1</span><span class="s1">: </span><span class="s0">True</span><span class="s1">})</span>
    <span class="s0">def </span><span class="s1">f(x):</span>
        <span class="s0">return False</span>

    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">2</span><span class="s1">) </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_memoize_key():</span>
    <span class="s1">@memoize(key=</span><span class="s0">lambda </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs: args[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) == </span><span class="s2">3</span>


<span class="s0">def </span><span class="s1">test_memoize_wrapped():</span>

    <span class="s0">def </span><span class="s1">foo():</span>
        <span class="s3">&quot;&quot;&quot; 
        Docstring 
        &quot;&quot;&quot;</span>
        <span class="s0">pass</span>
    <span class="s1">memoized_foo = memoize(foo)</span>
    <span class="s0">assert </span><span class="s1">memoized_foo.__wrapped__ </span><span class="s0">is </span><span class="s1">foo</span>


<span class="s0">def </span><span class="s1">test_curry_simple():</span>
    <span class="s1">cmul = curry(mul)</span>
    <span class="s1">double = cmul(</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">callable(double)</span>
    <span class="s0">assert </span><span class="s1">double(</span><span class="s2">10</span><span class="s1">) == </span><span class="s2">20</span>
    <span class="s0">assert </span><span class="s1">repr(cmul) == repr(mul)</span>

    <span class="s1">cmap = curry(map)</span>
    <span class="s0">assert </span><span class="s1">list(cmap(inc)([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])) == [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>

    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: curry())</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: curry({</span><span class="s2">1</span><span class="s1">: </span><span class="s2">2</span><span class="s1">}))</span>


<span class="s0">def </span><span class="s1">test_curry_kwargs():</span>
    <span class="s0">def </span><span class="s1">f(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">10</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">(a + b) * c</span>

    <span class="s1">f = curry(f)</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) == </span><span class="s2">9</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) == </span><span class="s2">9</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">30</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">) == </span><span class="s2">9</span>
    <span class="s0">assert </span><span class="s1">f(c=</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">9</span>

    <span class="s0">def </span><span class="s1">g(a=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">b=</span><span class="s2">10</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">0</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>

    <span class="s1">cg = curry(g</span><span class="s0">, </span><span class="s1">b=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cg() == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">cg(b=</span><span class="s2">3</span><span class="s1">) == </span><span class="s2">4</span>
    <span class="s0">assert </span><span class="s1">cg(a=</span><span class="s2">0</span><span class="s1">) == </span><span class="s2">2</span>
    <span class="s0">assert </span><span class="s1">cg(a=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">b=</span><span class="s2">1</span><span class="s1">) == </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">cg(</span><span class="s2">0</span><span class="s1">) == </span><span class="s2">2  </span><span class="s4"># pass &quot;a&quot; as arg, not kwarg</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: cg(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))  </span><span class="s4"># pass &quot;b&quot; as arg AND kwarg</span>

    <span class="s0">def </span><span class="s1">h(x</span><span class="s0">, </span><span class="s1">func=int):</span>
        <span class="s0">return </span><span class="s1">func(x)</span>

    <span class="s4"># __init__ must not pick func as positional arg</span>
    <span class="s0">assert </span><span class="s1">curry(h)(</span><span class="s2">0.0</span><span class="s1">) == </span><span class="s2">0</span>
    <span class="s0">assert </span><span class="s1">curry(h)(func=str)(</span><span class="s2">0.0</span><span class="s1">) == </span><span class="s5">'0.0'</span>
    <span class="s0">assert </span><span class="s1">curry(h</span><span class="s0">, </span><span class="s1">func=str)(</span><span class="s2">0.0</span><span class="s1">) == </span><span class="s5">'0.0'</span>


<span class="s0">def </span><span class="s1">test_curry_passes_errors():</span>
    <span class="s1">@curry</span>
    <span class="s0">def </span><span class="s1">f(a</span><span class="s0">, </span><span class="s1">b):</span>
        <span class="s0">if not </span><span class="s1">isinstance(a</span><span class="s0">, </span><span class="s1">int):</span>
            <span class="s0">raise </span><span class="s1">TypeError()</span>
        <span class="s0">return </span><span class="s1">a + b</span>

    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: f(</span><span class="s5">'1'</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: f(</span><span class="s5">'1'</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_curry_docstring():</span>
    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y):</span>
        <span class="s3">&quot;&quot;&quot; A docstring &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">x</span>

    <span class="s1">g = curry(f)</span>
    <span class="s0">assert </span><span class="s1">g.__doc__ == f.__doc__</span>
    <span class="s0">assert </span><span class="s1">str(g) == str(f)</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == g(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_is_like_partial():</span>
    <span class="s0">def </span><span class="s1">foo(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>

    <span class="s1">p</span><span class="s0">, </span><span class="s1">c = partial(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">curry(foo)(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">p.keywords == c.keywords</span>
    <span class="s0">assert </span><span class="s1">p.args == c.args</span>
    <span class="s0">assert </span><span class="s1">p(</span><span class="s2">3</span><span class="s1">) == c(</span><span class="s2">3</span><span class="s1">)</span>

    <span class="s1">p</span><span class="s0">, </span><span class="s1">c = partial(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">curry(foo)(</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">p.keywords == c.keywords</span>
    <span class="s0">assert </span><span class="s1">p.args == c.args</span>
    <span class="s0">assert </span><span class="s1">p(</span><span class="s2">3</span><span class="s1">) == c(</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">p(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">) == c(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>

    <span class="s1">p</span><span class="s0">, </span><span class="s1">c = partial(foo</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">curry(foo)(c=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">p.keywords == c.keywords</span>
    <span class="s0">assert </span><span class="s1">p.args == c.args</span>
    <span class="s0">assert </span><span class="s1">p(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">) == c(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_is_idempotent():</span>
    <span class="s0">def </span><span class="s1">foo(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>

    <span class="s1">f = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">g = curry(f)</span>
    <span class="s0">assert </span><span class="s1">isinstance(f</span><span class="s0">, </span><span class="s1">curry)</span>
    <span class="s0">assert </span><span class="s1">isinstance(g</span><span class="s0">, </span><span class="s1">curry)</span>
    <span class="s0">assert not </span><span class="s1">isinstance(g.func</span><span class="s0">, </span><span class="s1">curry)</span>
    <span class="s0">assert not </span><span class="s1">hasattr(g.func</span><span class="s0">, </span><span class="s5">'func'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">f.func == g.func</span>
    <span class="s0">assert </span><span class="s1">f.args == g.args</span>
    <span class="s0">assert </span><span class="s1">f.keywords == g.keywords</span>


<span class="s0">def </span><span class="s1">test_curry_attributes_readonly():</span>
    <span class="s0">def </span><span class="s1">foo(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>

    <span class="s1">f = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: setattr(f</span><span class="s0">, </span><span class="s5">'args'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: setattr(f</span><span class="s0">, </span><span class="s5">'keywords'</span><span class="s0">, </span><span class="s1">{</span><span class="s5">'c'</span><span class="s1">: </span><span class="s2">3</span><span class="s1">}))</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: setattr(f</span><span class="s0">, </span><span class="s5">'func'</span><span class="s0">, </span><span class="s1">f))</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: delattr(f</span><span class="s0">, </span><span class="s5">'args'</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: delattr(f</span><span class="s0">, </span><span class="s5">'keywords'</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(AttributeError</span><span class="s0">, lambda</span><span class="s1">: delattr(f</span><span class="s0">, </span><span class="s5">'func'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_curry_attributes_writable():</span>
    <span class="s0">def </span><span class="s1">foo(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>
    <span class="s1">foo.__qualname__ = </span><span class="s5">'this.is.foo'</span>
    <span class="s1">f = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">f.__qualname__ == </span><span class="s5">'this.is.foo'</span>
    <span class="s1">f.__name__ = </span><span class="s5">'newname'</span>
    <span class="s1">f.__doc__ = </span><span class="s5">'newdoc'</span>
    <span class="s1">f.__module__ = </span><span class="s5">'newmodule'</span>
    <span class="s1">f.__qualname__ = </span><span class="s5">'newqualname'</span>
    <span class="s0">assert </span><span class="s1">f.__name__ == </span><span class="s5">'newname'</span>
    <span class="s0">assert </span><span class="s1">f.__doc__ == </span><span class="s5">'newdoc'</span>
    <span class="s0">assert </span><span class="s1">f.__module__ == </span><span class="s5">'newmodule'</span>
    <span class="s0">assert </span><span class="s1">f.__qualname__ == </span><span class="s5">'newqualname'</span>
    <span class="s0">if </span><span class="s1">hasattr(f</span><span class="s0">, </span><span class="s5">'func_name'</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">f.__name__ == f.func_name</span>


<span class="s0">def </span><span class="s1">test_curry_module():</span>
    <span class="s0">from </span><span class="s1">toolz.curried.exceptions </span><span class="s0">import </span><span class="s1">merge</span>
    <span class="s0">assert </span><span class="s1">merge.__module__ == </span><span class="s5">'toolz.curried.exceptions'</span>


<span class="s0">def </span><span class="s1">test_curry_comparable():</span>
    <span class="s0">def </span><span class="s1">foo(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>
    <span class="s1">f1 = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">f2 = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">g1 = curry(foo</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s1">h1 = curry(foo</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">h2 = h1(c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">h3 = h1()</span>
    <span class="s0">assert </span><span class="s1">f1 == f2</span>
    <span class="s0">assert not </span><span class="s1">(f1 != f2)</span>
    <span class="s0">assert </span><span class="s1">f1 != g1</span>
    <span class="s0">assert not </span><span class="s1">(f1 == g1)</span>
    <span class="s0">assert </span><span class="s1">f1 != h1</span>
    <span class="s0">assert </span><span class="s1">h1 == h2</span>
    <span class="s0">assert </span><span class="s1">h1 == h3</span>

    <span class="s4"># test function comparison works</span>
    <span class="s0">def </span><span class="s1">bar(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">a + b + c</span>
    <span class="s1">b1 = curry(bar</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">b1 != f1</span>

    <span class="s0">assert </span><span class="s1">{f1</span><span class="s0">, </span><span class="s1">f2</span><span class="s0">, </span><span class="s1">g1</span><span class="s0">, </span><span class="s1">h1</span><span class="s0">, </span><span class="s1">h2</span><span class="s0">, </span><span class="s1">h3</span><span class="s0">, </span><span class="s1">b1</span><span class="s0">, </span><span class="s1">b1()} == {f1</span><span class="s0">, </span><span class="s1">g1</span><span class="s0">, </span><span class="s1">h1</span><span class="s0">, </span><span class="s1">b1}</span>

    <span class="s4"># test unhashable input</span>
    <span class="s1">unhash1 = curry(foo</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: hash(unhash1))</span>
    <span class="s1">unhash2 = curry(foo</span><span class="s0">, </span><span class="s1">c=[])</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: hash(unhash2))</span>


<span class="s0">def </span><span class="s1">test_curry_doesnot_transmogrify():</span>
    <span class="s4"># Early versions of `curry` transmogrified to `partial` objects if</span>
    <span class="s4"># only one positional argument remained even if keyword arguments</span>
    <span class="s4"># were present.  Now, `curry` should always remain `curry`.</span>
    <span class="s0">def </span><span class="s1">f(x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s1">cf = curry(f)</span>
    <span class="s0">assert </span><span class="s1">cf(y=</span><span class="s2">1</span><span class="s1">)(y=</span><span class="s2">2</span><span class="s1">)(y=</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">1</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_on_classmethods():</span>
    <span class="s0">class </span><span class="s1">A(object):</span>
        <span class="s1">BASE = </span><span class="s2">10</span>

        <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">base):</span>
            <span class="s1">self.BASE = base</span>

        <span class="s1">@curry</span>
        <span class="s0">def </span><span class="s1">addmethod(self</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">self.BASE + x + y</span>

        <span class="s1">@classmethod</span>
        <span class="s1">@curry</span>
        <span class="s0">def </span><span class="s1">addclass(cls</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">cls.BASE + x + y</span>

        <span class="s1">@staticmethod</span>
        <span class="s1">@curry</span>
        <span class="s0">def </span><span class="s1">addstatic(x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">x + y</span>

    <span class="s1">a = A(</span><span class="s2">100</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">a.addmethod(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>
    <span class="s0">assert </span><span class="s1">a.addmethod(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>
    <span class="s0">assert </span><span class="s1">A.addmethod(a</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>
    <span class="s0">assert </span><span class="s1">A.addmethod(a)(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>

    <span class="s0">assert </span><span class="s1">a.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s0">assert </span><span class="s1">a.addclass(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s0">assert </span><span class="s1">A.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s0">assert </span><span class="s1">A.addclass(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>

    <span class="s0">assert </span><span class="s1">a.addstatic(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>
    <span class="s0">assert </span><span class="s1">a.addstatic(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>
    <span class="s0">assert </span><span class="s1">A.addstatic(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>
    <span class="s0">assert </span><span class="s1">A.addstatic(</span><span class="s2">3</span><span class="s1">)(</span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>

    <span class="s4"># we want this to be of type curry</span>
    <span class="s0">assert </span><span class="s1">isinstance(a.addmethod</span><span class="s0">, </span><span class="s1">curry)</span>
    <span class="s0">assert </span><span class="s1">isinstance(A.addmethod</span><span class="s0">, </span><span class="s1">curry)</span>


<span class="s0">def </span><span class="s1">test_memoize_on_classmethods():</span>
    <span class="s0">class </span><span class="s1">A(object):</span>
        <span class="s1">BASE = </span><span class="s2">10</span>
        <span class="s1">HASH = </span><span class="s2">10</span>

        <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">base):</span>
            <span class="s1">self.BASE = base</span>

        <span class="s1">@memoize</span>
        <span class="s0">def </span><span class="s1">addmethod(self</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">self.BASE + x + y</span>

        <span class="s1">@classmethod</span>
        <span class="s1">@memoize</span>
        <span class="s0">def </span><span class="s1">addclass(cls</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">cls.BASE + x + y</span>

        <span class="s1">@staticmethod</span>
        <span class="s1">@memoize</span>
        <span class="s0">def </span><span class="s1">addstatic(x</span><span class="s0">, </span><span class="s1">y):</span>
            <span class="s0">return </span><span class="s1">x + y</span>

        <span class="s0">def </span><span class="s1">__hash__(self):</span>
            <span class="s0">return </span><span class="s1">self.HASH</span>

    <span class="s1">a = A(</span><span class="s2">100</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">a.addmethod(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>
    <span class="s0">assert </span><span class="s1">A.addmethod(a</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>

    <span class="s1">a.BASE = </span><span class="s2">200</span>
    <span class="s0">assert </span><span class="s1">a.addmethod(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">107</span>
    <span class="s1">a.HASH = </span><span class="s2">200</span>
    <span class="s0">assert </span><span class="s1">a.addmethod(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">207</span>

    <span class="s0">assert </span><span class="s1">a.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s0">assert </span><span class="s1">A.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s1">A.BASE = </span><span class="s2">20</span>
    <span class="s0">assert </span><span class="s1">A.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17</span>
    <span class="s1">A.HASH = </span><span class="s2">20  </span><span class="s4"># hashing of class is handled by metaclass</span>
    <span class="s0">assert </span><span class="s1">A.addclass(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">17  </span><span class="s4"># hence, != 27</span>

    <span class="s0">assert </span><span class="s1">a.addstatic(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>
    <span class="s0">assert </span><span class="s1">A.addstatic(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == </span><span class="s2">7</span>


<span class="s0">def </span><span class="s1">test_curry_call():</span>
    <span class="s1">@curry</span>
    <span class="s0">def </span><span class="s1">add(x</span><span class="s0">, </span><span class="s1">y):</span>
        <span class="s0">return </span><span class="s1">x + y</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: add.call(</span><span class="s2">1</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">add(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">) == add.call(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">add(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">) == add(</span><span class="s2">1</span><span class="s1">).call(</span><span class="s2">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_bind():</span>
    <span class="s1">@curry</span>
    <span class="s0">def </span><span class="s1">add(x=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">x + y</span>
    <span class="s0">assert </span><span class="s1">add() == add(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">add.bind(</span><span class="s2">10</span><span class="s1">)(</span><span class="s2">20</span><span class="s1">) == add(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">add.bind(</span><span class="s2">10</span><span class="s1">).bind(</span><span class="s2">20</span><span class="s1">)() == add(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">add.bind(x=</span><span class="s2">10</span><span class="s1">)(y=</span><span class="s2">20</span><span class="s1">) == add(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">add.bind(x=</span><span class="s2">10</span><span class="s1">).bind(y=</span><span class="s2">20</span><span class="s1">)() == add(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_unknown_args():</span>
    <span class="s0">def </span><span class="s1">add3(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z):</span>
        <span class="s0">return </span><span class="s1">x + y + z</span>

    <span class="s1">@curry</span>
    <span class="s0">def </span><span class="s1">f(*args):</span>
        <span class="s0">return </span><span class="s1">add3(*args)</span>

    <span class="s0">assert </span><span class="s1">f()(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">)(</span><span class="s2">3</span><span class="s1">) == </span><span class="s2">6</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">)(</span><span class="s2">3</span><span class="s1">) == </span><span class="s2">6</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)(</span><span class="s2">3</span><span class="s1">) == </span><span class="s2">6</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">) == </span><span class="s2">6</span>
    <span class="s0">assert </span><span class="s1">f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) == f(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_curry_bad_types():</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: curry(</span><span class="s2">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_curry_subclassable():</span>
    <span class="s0">class </span><span class="s1">mycurry(curry):</span>
        <span class="s0">pass</span>

    <span class="s1">add = mycurry(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y: x+y)</span>
    <span class="s0">assert </span><span class="s1">isinstance(add</span><span class="s0">, </span><span class="s1">curry)</span>
    <span class="s0">assert </span><span class="s1">isinstance(add</span><span class="s0">, </span><span class="s1">mycurry)</span>
    <span class="s0">assert </span><span class="s1">isinstance(add(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mycurry)</span>
    <span class="s0">assert </span><span class="s1">isinstance(add()(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mycurry)</span>
    <span class="s0">assert </span><span class="s1">add(</span><span class="s2">1</span><span class="s1">)(</span><span class="s2">2</span><span class="s1">) == </span><span class="s2">3</span>

    <span class="s4"># Should we make `_should_curry` public?</span>
    <span class="s5">&quot;&quot;&quot; 
    class curry2(curry): 
        def _should_curry(self, args, kwargs, exc=None): 
            return len(self.args) + len(args) &lt; 2 
 
    add = curry2(lambda x, y: x+y) 
    assert isinstance(add(1), curry2) 
    assert add(1)(2) == 3 
    assert isinstance(add(1)(x=2), curry2) 
    assert raises(TypeError, lambda: add(1)(x=2)(3)) 
    &quot;&quot;&quot;</span>


<span class="s0">def </span><span class="s1">generate_compose_test_cases():</span>
    <span class="s3">&quot;&quot;&quot; 
    Generate test cases for parametrized tests of the compose function. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">add_then_multiply(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">10</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">(a + b) * c</span>

    <span class="s0">return </span><span class="s1">(</span>
        <span class="s1">(</span>
            <span class="s1">()</span><span class="s0">,        </span><span class="s4"># arguments to compose()</span>
            <span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,  </span><span class="s4"># positional and keyword args to the Composed object</span>
            <span class="s2">0          </span><span class="s4"># expected result</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(inc</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
            <span class="s2">1</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(double</span><span class="s0">, </span><span class="s1">inc)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
            <span class="s2">2</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(str</span><span class="s0">, </span><span class="s1">iseven</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">double)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
            <span class="s5">&quot;False&quot;</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(str</span><span class="s0">, </span><span class="s1">add)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
            <span class="s5">'3'</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(str</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">add_then_multiply)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s5">&quot;c&quot;</span><span class="s1">: </span><span class="s2">3</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s5">'10'</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_compose():</span>
    <span class="s0">for </span><span class="s1">(compose_args</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kw</span><span class="s0">, </span><span class="s1">expected) </span><span class="s0">in </span><span class="s1">generate_compose_test_cases():</span>
        <span class="s0">assert </span><span class="s1">compose(*compose_args)(*args</span><span class="s0">, </span><span class="s1">**kw) == expected</span>


<span class="s0">def </span><span class="s1">test_compose_metadata():</span>

    <span class="s4"># Define two functions with different names</span>
    <span class="s0">def </span><span class="s1">f(a):</span>
        <span class="s0">return </span><span class="s1">a</span>

    <span class="s0">def </span><span class="s1">g(a):</span>
        <span class="s0">return </span><span class="s1">a</span>

    <span class="s1">composed = compose(f</span><span class="s0">, </span><span class="s1">g)</span>
    <span class="s0">assert </span><span class="s1">composed.__name__ == </span><span class="s5">'f_of_g'</span>
    <span class="s0">assert </span><span class="s1">composed.__doc__ == </span><span class="s5">'lambda *args, **kwargs: f(g(*args, **kwargs))'</span>

    <span class="s4"># Create an object with no __name__.</span>
    <span class="s1">h = object()</span>

    <span class="s1">composed = compose(f</span><span class="s0">, </span><span class="s1">h)</span>
    <span class="s0">assert </span><span class="s1">composed.__name__ == </span><span class="s5">'Compose'</span>
    <span class="s0">assert </span><span class="s1">composed.__doc__ == </span><span class="s5">'A composition of functions'</span>

    <span class="s0">assert </span><span class="s1">repr(composed) == </span><span class="s5">'Compose({!r}, {!r})'</span><span class="s1">.format(f</span><span class="s0">, </span><span class="s1">h)</span>

    <span class="s0">assert </span><span class="s1">composed == compose(f</span><span class="s0">, </span><span class="s1">h)</span>
    <span class="s0">assert </span><span class="s1">composed == AlwaysEquals()</span>
    <span class="s0">assert not </span><span class="s1">composed == compose(h</span><span class="s0">, </span><span class="s1">f)</span>
    <span class="s0">assert not </span><span class="s1">composed == object()</span>
    <span class="s0">assert not </span><span class="s1">composed == NeverEquals()</span>

    <span class="s0">assert </span><span class="s1">composed != compose(h</span><span class="s0">, </span><span class="s1">f)</span>
    <span class="s0">assert </span><span class="s1">composed != NeverEquals()</span>
    <span class="s0">assert </span><span class="s1">composed != object()</span>
    <span class="s0">assert not </span><span class="s1">composed != compose(f</span><span class="s0">, </span><span class="s1">h)</span>
    <span class="s0">assert not </span><span class="s1">composed != AlwaysEquals()</span>

    <span class="s0">assert </span><span class="s1">hash(composed) == hash(compose(f</span><span class="s0">, </span><span class="s1">h))</span>
    <span class="s0">assert </span><span class="s1">hash(composed) != hash(compose(h</span><span class="s0">, </span><span class="s1">f))</span>

    <span class="s1">bindable = compose(str</span><span class="s0">, lambda </span><span class="s1">x: x*</span><span class="s2">2</span><span class="s0">, lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0</span><span class="s1">: int(x) + y)</span>

    <span class="s0">class </span><span class="s1">MyClass:</span>

        <span class="s0">def </span><span class="s1">__int__(self):</span>
            <span class="s0">return </span><span class="s2">8</span>

        <span class="s1">my_method = bindable</span>
        <span class="s1">my_static_method = staticmethod(bindable)</span>

    <span class="s0">assert </span><span class="s1">MyClass.my_method(</span><span class="s2">3</span><span class="s1">) == </span><span class="s5">'6'</span>
    <span class="s0">assert </span><span class="s1">MyClass.my_method(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">2</span><span class="s1">) == </span><span class="s5">'10'</span>
    <span class="s0">assert </span><span class="s1">MyClass.my_static_method(</span><span class="s2">2</span><span class="s1">) == </span><span class="s5">'4'</span>
    <span class="s0">assert </span><span class="s1">MyClass().my_method() == </span><span class="s5">'16'</span>
    <span class="s0">assert </span><span class="s1">MyClass().my_method(y=</span><span class="s2">3</span><span class="s1">) == </span><span class="s5">'22'</span>
    <span class="s0">assert </span><span class="s1">MyClass().my_static_method(</span><span class="s2">0</span><span class="s1">) == </span><span class="s5">'0'</span>
    <span class="s0">assert </span><span class="s1">MyClass().my_static_method(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) == </span><span class="s5">'2'</span>

    <span class="s0">assert </span><span class="s1">compose(f</span><span class="s0">, </span><span class="s1">h).__wrapped__ </span><span class="s0">is </span><span class="s1">h</span>
    <span class="s0">if </span><span class="s1">hasattr(toolz</span><span class="s0">, </span><span class="s5">'sandbox'</span><span class="s1">):  </span><span class="s4"># only test this with Python version (i.e., not Cython)</span>
        <span class="s0">assert </span><span class="s1">compose(f</span><span class="s0">, </span><span class="s1">h).__class__.__wrapped__ </span><span class="s0">is None</span>

    <span class="s4"># __signature__ is python3 only</span>

    <span class="s0">def </span><span class="s1">myfunc(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">*d</span><span class="s0">, </span><span class="s1">**e):</span>
        <span class="s0">return </span><span class="s2">4</span>

    <span class="s0">def </span><span class="s1">otherfunc(f):</span>
        <span class="s0">return </span><span class="s5">'result: {}'</span><span class="s1">.format(f)</span>

    <span class="s4"># set annotations compatibly with python2 syntax</span>
    <span class="s1">myfunc.__annotations__ = {</span>
        <span class="s5">'a'</span><span class="s1">: int</span><span class="s0">,</span>
        <span class="s5">'b'</span><span class="s1">: str</span><span class="s0">,</span>
        <span class="s5">'c'</span><span class="s1">: float</span><span class="s0">,</span>
        <span class="s5">'d'</span><span class="s1">: int</span><span class="s0">,</span>
        <span class="s5">'e'</span><span class="s1">: bool</span><span class="s0">,</span>
        <span class="s5">'return'</span><span class="s1">: int</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">otherfunc.__annotations__ = {</span><span class="s5">'f'</span><span class="s1">: int</span><span class="s0">, </span><span class="s5">'return'</span><span class="s1">: str}</span>

    <span class="s1">composed = compose(otherfunc</span><span class="s0">, </span><span class="s1">myfunc)</span>
    <span class="s1">sig = inspect.signature(composed)</span>
    <span class="s0">assert </span><span class="s1">sig.parameters == inspect.signature(myfunc).parameters</span>
    <span class="s0">assert </span><span class="s1">sig.return_annotation == str</span>

    <span class="s0">class </span><span class="s1">MyClass:</span>
        <span class="s1">method = composed</span>

    <span class="s0">assert </span><span class="s1">len(inspect.signature(MyClass().method).parameters) == </span><span class="s2">4</span>


<span class="s0">def </span><span class="s1">generate_compose_left_test_cases():</span>
    <span class="s3">&quot;&quot;&quot; 
    Generate test cases for parametrized tests of the compose function. 
 
    These are based on, and equivalent to, those produced by 
    enerate_compose_test_cases(). 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">tuple(</span>
        <span class="s1">(tuple(reversed(compose_args))</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">for </span><span class="s1">(compose_args</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">in </span><span class="s1">generate_compose_test_cases()</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_compose_left():</span>
    <span class="s0">for </span><span class="s1">(compose_left_args</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kw</span><span class="s0">, </span><span class="s1">expected) </span><span class="s0">in </span><span class="s1">generate_compose_left_test_cases():</span>
        <span class="s0">assert </span><span class="s1">compose_left(*compose_left_args)(*args</span><span class="s0">, </span><span class="s1">**kw) == expected</span>


<span class="s0">def </span><span class="s1">test_pipe():</span>
    <span class="s0">assert </span><span class="s1">pipe(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">inc) == </span><span class="s2">2</span>
    <span class="s0">assert </span><span class="s1">pipe(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">inc) == </span><span class="s2">3</span>
    <span class="s0">assert </span><span class="s1">pipe(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">double</span><span class="s0">, </span><span class="s1">inc</span><span class="s0">, </span><span class="s1">iseven) </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_complement():</span>
    <span class="s4"># No args:</span>
    <span class="s0">assert </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">False</span><span class="s1">)()</span>
    <span class="s0">assert not </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">True</span><span class="s1">)()</span>

    <span class="s4"># Single arity:</span>
    <span class="s0">assert </span><span class="s1">complement(iseven)(</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">complement(iseven)(</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">complement(complement(iseven))(</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">complement(complement(isodd))(</span><span class="s2">2</span><span class="s1">)</span>

    <span class="s4"># Multiple arities:</span>
    <span class="s1">both_even = </span><span class="s0">lambda </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b: iseven(a) </span><span class="s0">and </span><span class="s1">iseven(b)</span>
    <span class="s0">assert </span><span class="s1">complement(both_even)(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">complement(both_even)(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>

    <span class="s4"># Generic truthiness:</span>
    <span class="s0">assert </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s5">&quot;&quot;</span><span class="s1">)()</span>
    <span class="s0">assert </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s2">0</span><span class="s1">)()</span>
    <span class="s0">assert </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">None</span><span class="s1">)()</span>
    <span class="s0">assert </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: [])()</span>

    <span class="s0">assert not </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s5">&quot;x&quot;</span><span class="s1">)()</span>
    <span class="s0">assert not </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s2">1</span><span class="s1">)()</span>
    <span class="s0">assert not </span><span class="s1">complement(</span><span class="s0">lambda</span><span class="s1">: [</span><span class="s2">1</span><span class="s1">])()</span>


<span class="s0">def </span><span class="s1">test_do():</span>
    <span class="s1">inc = </span><span class="s0">lambda </span><span class="s1">x: x + </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">do(inc</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) == </span><span class="s2">1</span>

    <span class="s1">log = []</span>
    <span class="s0">assert </span><span class="s1">do(log.append</span><span class="s0">, </span><span class="s2">1</span><span class="s1">) == </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">log == [</span><span class="s2">1</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_juxt_generator_input():</span>
    <span class="s1">data = list(range(</span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">juxtfunc = juxt(itemgetter(</span><span class="s2">2</span><span class="s1">*i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">5</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">juxtfunc(data) == (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">juxtfunc(data) == (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_flip():</span>
    <span class="s0">def </span><span class="s1">f(a</span><span class="s0">, </span><span class="s1">b):</span>
        <span class="s0">return </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span>

    <span class="s0">assert </span><span class="s1">flip(f</span><span class="s0">, </span><span class="s5">'a'</span><span class="s0">, </span><span class="s5">'b'</span><span class="s1">) == (</span><span class="s5">'b'</span><span class="s0">, </span><span class="s5">'a'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_excepts():</span>
    <span class="s4"># These are descriptors, make sure this works correctly.</span>
    <span class="s0">assert </span><span class="s1">excepts.__name__ == </span><span class="s5">'excepts'</span>
    <span class="s0">assert </span><span class="s1">(</span>
        <span class="s5">'A wrapper around a function to catch exceptions and</span><span class="s0">\n</span><span class="s5">'</span>
        <span class="s5">'    dispatch to a handler.</span><span class="s0">\n</span><span class="s5">'</span>
    <span class="s1">) </span><span class="s0">in </span><span class="s1">excepts.__doc__</span>

    <span class="s0">def </span><span class="s1">idx(a):</span>
        <span class="s3">&quot;&quot;&quot;idx docstring 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">].index(a)</span>

    <span class="s0">def </span><span class="s1">handler(e):</span>
        <span class="s3">&quot;&quot;&quot;handler docstring 
        &quot;&quot;&quot;</span>
        <span class="s0">assert </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">ValueError)</span>
        <span class="s0">return </span><span class="s1">-</span><span class="s2">1</span>

    <span class="s1">excepting = excepts(ValueError</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">handler)</span>
    <span class="s0">assert </span><span class="s1">excepting(</span><span class="s2">1</span><span class="s1">) == </span><span class="s2">0</span>
    <span class="s0">assert </span><span class="s1">excepting(</span><span class="s2">2</span><span class="s1">) == </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">excepting(</span><span class="s2">3</span><span class="s1">) == -</span><span class="s2">1</span>

    <span class="s0">assert </span><span class="s1">excepting.__name__ == </span><span class="s5">'idx_excepting_ValueError'</span>
    <span class="s0">assert </span><span class="s5">'idx docstring' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>
    <span class="s0">assert </span><span class="s5">'ValueError' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>
    <span class="s0">assert </span><span class="s5">'handler docstring' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>

    <span class="s0">def </span><span class="s1">getzero(a):</span>
        <span class="s3">&quot;&quot;&quot;getzero docstring 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">a[</span><span class="s2">0</span><span class="s1">]</span>

    <span class="s1">excepting = excepts((IndexError</span><span class="s0">, </span><span class="s1">KeyError)</span><span class="s0">, </span><span class="s1">getzero)</span>
    <span class="s0">assert </span><span class="s1">excepting([]) </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">excepting([</span><span class="s2">1</span><span class="s1">]) == </span><span class="s2">1</span>
    <span class="s0">assert </span><span class="s1">excepting({}) </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">excepting({</span><span class="s2">0</span><span class="s1">: </span><span class="s2">1</span><span class="s1">}) == </span><span class="s2">1</span>

    <span class="s0">assert </span><span class="s1">excepting.__name__ == </span><span class="s5">'getzero_excepting_IndexError_or_KeyError'</span>
    <span class="s0">assert </span><span class="s5">'getzero docstring' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>
    <span class="s0">assert </span><span class="s5">'return_none' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>
    <span class="s0">assert </span><span class="s5">'Returns None' </span><span class="s0">in </span><span class="s1">excepting.__doc__</span>

    <span class="s0">def </span><span class="s1">raise_(a):</span>
        <span class="s3">&quot;&quot;&quot;A function that raises an instance of the exception type given. 
        &quot;&quot;&quot;</span>
        <span class="s0">raise </span><span class="s1">a()</span>

    <span class="s1">excepting = excepts((ValueError</span><span class="s0">, </span><span class="s1">KeyError)</span><span class="s0">, </span><span class="s1">raise_)</span>
    <span class="s0">assert </span><span class="s1">excepting(ValueError) </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">excepting(KeyError) </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: excepting(TypeError))</span>
    <span class="s0">assert </span><span class="s1">raises(NotImplementedError</span><span class="s0">, lambda</span><span class="s1">: excepting(NotImplementedError))</span>

    <span class="s1">excepting = excepts(object()</span><span class="s0">, </span><span class="s1">object()</span><span class="s0">, </span><span class="s1">object())</span>
    <span class="s0">assert </span><span class="s1">excepting.__name__ == </span><span class="s5">'excepting'</span>
    <span class="s0">assert </span><span class="s1">excepting.__doc__ == excepts.__doc__</span>
</pre>
</body>
</html>
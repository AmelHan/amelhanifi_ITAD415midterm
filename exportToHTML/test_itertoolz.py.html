<html>
<head>
<title>test_itertoolz.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_itertoolz.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">itertools</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">starmap</span>
<span class="s0">from </span><span class="s1">toolz.utils </span><span class="s0">import </span><span class="s1">raises</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>
<span class="s0">from </span><span class="s1">random </span><span class="s0">import </span><span class="s1">Random</span>
<span class="s0">from </span><span class="s1">pickle </span><span class="s0">import </span><span class="s1">dumps</span><span class="s0">, </span><span class="s1">loads</span>
<span class="s0">from </span><span class="s1">toolz.itertoolz </span><span class="s0">import </span><span class="s1">(remove</span><span class="s0">, </span><span class="s1">groupby</span><span class="s0">, </span><span class="s1">merge_sorted</span><span class="s0">,</span>
                             <span class="s1">concat</span><span class="s0">, </span><span class="s1">concatv</span><span class="s0">, </span><span class="s1">interleave</span><span class="s0">, </span><span class="s1">unique</span><span class="s0">,</span>
                             <span class="s1">isiterable</span><span class="s0">, </span><span class="s1">getter</span><span class="s0">,</span>
                             <span class="s1">mapcat</span><span class="s0">, </span><span class="s1">isdistinct</span><span class="s0">, </span><span class="s1">first</span><span class="s0">, </span><span class="s1">second</span><span class="s0">,</span>
                             <span class="s1">nth</span><span class="s0">, </span><span class="s1">take</span><span class="s0">, </span><span class="s1">tail</span><span class="s0">, </span><span class="s1">drop</span><span class="s0">, </span><span class="s1">interpose</span><span class="s0">, </span><span class="s1">get</span><span class="s0">,</span>
                             <span class="s1">rest</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">cons</span><span class="s0">, </span><span class="s1">frequencies</span><span class="s0">,</span>
                             <span class="s1">reduceby</span><span class="s0">, </span><span class="s1">iterate</span><span class="s0">, </span><span class="s1">accumulate</span><span class="s0">,</span>
                             <span class="s1">sliding_window</span><span class="s0">, </span><span class="s1">count</span><span class="s0">, </span><span class="s1">partition</span><span class="s0">,</span>
                             <span class="s1">partition_all</span><span class="s0">, </span><span class="s1">take_nth</span><span class="s0">, </span><span class="s1">pluck</span><span class="s0">, </span><span class="s1">join</span><span class="s0">,</span>
                             <span class="s1">diff</span><span class="s0">, </span><span class="s1">topk</span><span class="s0">, </span><span class="s1">peek</span><span class="s0">, </span><span class="s1">peekn</span><span class="s0">, </span><span class="s1">random_sample)</span>
<span class="s0">from </span><span class="s1">operator </span><span class="s0">import </span><span class="s1">add</span><span class="s0">, </span><span class="s1">mul</span>


<span class="s2"># is comparison will fail between this and no_default</span>
<span class="s1">no_default2 = loads(dumps(</span><span class="s3">'__no__default__'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">identity(x):</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">iseven(x):</span>
    <span class="s0">return </span><span class="s1">x % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">0</span>


<span class="s0">def </span><span class="s1">isodd(x):</span>
    <span class="s0">return </span><span class="s1">x % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">1</span>


<span class="s0">def </span><span class="s1">inc(x):</span>
    <span class="s0">return </span><span class="s1">x + </span><span class="s4">1</span>


<span class="s0">def </span><span class="s1">double(x):</span>
    <span class="s0">return </span><span class="s4">2 </span><span class="s1">* x</span>


<span class="s0">def </span><span class="s1">test_remove():</span>
    <span class="s1">r = remove(iseven</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">type(r) </span><span class="s0">is not </span><span class="s1">list</span>
    <span class="s0">assert </span><span class="s1">list(r) == list(filter(isodd</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">)))</span>


<span class="s0">def </span><span class="s1">test_groupby():</span>
    <span class="s0">assert </span><span class="s1">groupby(iseven</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]) == {</span><span class="s0">True</span><span class="s1">: [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, False</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span>


<span class="s0">def </span><span class="s1">test_groupby_non_callable():</span>
    <span class="s0">assert </span><span class="s1">groupby(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]) == \</span>
        <span class="s1">{</span><span class="s4">1</span><span class="s1">: [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span><span class="s0">,</span>
         <span class="s4">2</span><span class="s1">: [(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]}</span>

    <span class="s0">assert </span><span class="s1">groupby([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]) == \</span>
        <span class="s1">{(</span><span class="s4">1</span><span class="s0">,</span><span class="s1">): [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s4">2</span><span class="s0">,</span><span class="s1">): [(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]}</span>

    <span class="s0">assert </span><span class="s1">groupby([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]) == \</span>
        <span class="s1">{(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">): [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">): [(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]}</span>


<span class="s0">def </span><span class="s1">test_merge_sorted():</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">6</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">,</span>
                             <span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: -x)) == [</span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: x // </span><span class="s4">3</span><span class="s1">)) == [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: x // </span><span class="s4">3</span><span class="s1">)) == [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s3">''</span><span class="s1">.join(merge_sorted(</span><span class="s3">'abc'</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s1">)) == </span><span class="s3">'aaabbbccc'</span>
    <span class="s0">assert </span><span class="s3">''</span><span class="s1">.join(merge_sorted(</span><span class="s3">'abc'</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s1">key=ord)) == </span><span class="s3">'aaabbbccc'</span>
    <span class="s0">assert </span><span class="s3">''</span><span class="s1">.join(merge_sorted(</span><span class="s3">'cba'</span><span class="s0">, </span><span class="s3">'cba'</span><span class="s0">, </span><span class="s3">'cba'</span><span class="s0">,</span>
                                <span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: -ord(x))) == </span><span class="s3">'cccbbbaaa'</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">key=identity)) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>

    <span class="s1">data = [[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">8</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)]]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted(*data</span><span class="s0">, </span><span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: x[</span><span class="s4">1</span><span class="s1">])) == [</span>
        <span class="s1">(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">8</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted()) == []</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">key=identity)) == [</span>
        <span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(merge_sorted([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">key=identity)) == [</span>
        <span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_interleave():</span>
    <span class="s0">assert </span><span class="s3">''</span><span class="s1">.join(interleave((</span><span class="s3">'ABC'</span><span class="s0">, </span><span class="s3">'123'</span><span class="s1">))) == </span><span class="s3">'A1B2C3'</span>
    <span class="s0">assert </span><span class="s3">''</span><span class="s1">.join(interleave((</span><span class="s3">'ABC'</span><span class="s0">, </span><span class="s3">'1'</span><span class="s1">))) == </span><span class="s3">'A1BC'</span>


<span class="s0">def </span><span class="s1">test_unique():</span>
    <span class="s0">assert </span><span class="s1">tuple(unique((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tuple(unique((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tuple(unique((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">key=iseven)) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_isiterable():</span>
    <span class="s0">assert </span><span class="s1">isiterable([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">isiterable(</span><span class="s3">'abc'</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">isiterable(</span><span class="s4">5</span><span class="s1">) </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_isdistinct():</span>
    <span class="s0">assert </span><span class="s1">isdistinct([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">isdistinct([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]) </span><span class="s0">is False</span>

    <span class="s0">assert </span><span class="s1">isdistinct(</span><span class="s3">&quot;Hello&quot;</span><span class="s1">) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">isdistinct(</span><span class="s3">&quot;World&quot;</span><span class="s1">) </span><span class="s0">is True</span>

    <span class="s0">assert </span><span class="s1">isdistinct(iter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])) </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">isdistinct(iter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])) </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_nth():</span>
    <span class="s0">assert </span><span class="s1">nth(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'C'</span>
    <span class="s0">assert </span><span class="s1">nth(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">iter(</span><span class="s3">'ABCDE'</span><span class="s1">)) == </span><span class="s3">'C'</span>
    <span class="s0">assert </span><span class="s1">nth(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)) == </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">nth(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'foo'</span><span class="s1">: </span><span class="s3">'bar'</span><span class="s1">}) == </span><span class="s3">'foo'</span>
    <span class="s0">assert </span><span class="s1">raises(StopIteration</span><span class="s0">, lambda</span><span class="s1">: nth(</span><span class="s4">10</span><span class="s0">, </span><span class="s1">{</span><span class="s4">10</span><span class="s1">: </span><span class="s3">'foo'</span><span class="s1">}))</span>
    <span class="s0">assert </span><span class="s1">nth(-</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'D'</span>
    <span class="s0">assert </span><span class="s1">raises(ValueError</span><span class="s0">, lambda</span><span class="s1">: nth(-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">iter(</span><span class="s3">'ABCDE'</span><span class="s1">)))</span>


<span class="s0">def </span><span class="s1">test_first():</span>
    <span class="s0">assert </span><span class="s1">first(</span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'A'</span>
    <span class="s0">assert </span><span class="s1">first((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)) == </span><span class="s4">3</span>
    <span class="s0">assert </span><span class="s1">isinstance(first({</span><span class="s4">0</span><span class="s1">: </span><span class="s3">'zero'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: </span><span class="s3">'one'</span><span class="s1">})</span><span class="s0">, </span><span class="s1">int)</span>


<span class="s0">def </span><span class="s1">test_second():</span>
    <span class="s0">assert </span><span class="s1">second(</span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'B'</span>
    <span class="s0">assert </span><span class="s1">second((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)) == </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">isinstance(second({</span><span class="s4">0</span><span class="s1">: </span><span class="s3">'zero'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: </span><span class="s3">'one'</span><span class="s1">})</span><span class="s0">, </span><span class="s1">int)</span>


<span class="s0">def </span><span class="s1">test_last():</span>
    <span class="s0">assert </span><span class="s1">last(</span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'E'</span>
    <span class="s0">assert </span><span class="s1">last((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)) == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">isinstance(last({</span><span class="s4">0</span><span class="s1">: </span><span class="s3">'zero'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: </span><span class="s3">'one'</span><span class="s1">})</span><span class="s0">, </span><span class="s1">int)</span>


<span class="s0">def </span><span class="s1">test_rest():</span>
    <span class="s0">assert </span><span class="s1">list(rest(</span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'BCDE'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(rest((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))) == list((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_take():</span>
    <span class="s0">assert </span><span class="s1">list(take(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'ABC'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(take(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))) == list((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_tail():</span>
    <span class="s0">assert </span><span class="s1">list(tail(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'CDE'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(tail(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">iter(</span><span class="s3">'ABCDE'</span><span class="s1">))) == list(</span><span class="s3">'CDE'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(tail(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))) == list((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_drop():</span>
    <span class="s0">assert </span><span class="s1">list(drop(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'DE'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(drop(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))) == list((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_take_nth():</span>
    <span class="s0">assert </span><span class="s1">list(take_nth(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'ACE'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_get():</span>
    <span class="s0">assert </span><span class="s1">get(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">) == </span><span class="s3">'B'</span>
    <span class="s0">assert </span><span class="s1">list(get([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'ABCDE'</span><span class="s1">)) == list(</span><span class="s3">'BD'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">get(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">: </span><span class="s4">3</span><span class="s1">}) == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">get([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">: </span><span class="s4">3</span><span class="s1">}) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">get(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s1">default=</span><span class="s3">'bar'</span><span class="s1">) == </span><span class="s3">'bar'</span>
    <span class="s0">assert </span><span class="s1">get({}</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">default=</span><span class="s3">'bar'</span><span class="s1">) == </span><span class="s3">'bar'</span>
    <span class="s0">assert </span><span class="s1">get([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'AB'</span><span class="s0">, </span><span class="s3">'C'</span><span class="s1">) == (</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'C'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">get([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'AB'</span><span class="s1">) == (</span><span class="s3">'A'</span><span class="s0">,</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">get([]</span><span class="s0">, </span><span class="s3">'AB'</span><span class="s1">) == ()</span>

    <span class="s0">assert </span><span class="s1">raises(IndexError</span><span class="s0">, lambda</span><span class="s1">: get(</span><span class="s4">10</span><span class="s0">, </span><span class="s3">'ABC'</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(KeyError</span><span class="s0">, lambda</span><span class="s1">: get(</span><span class="s4">10</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: get({}</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: get([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, None</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">raises(KeyError</span><span class="s0">, lambda</span><span class="s1">: get(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s1">default=no_default2))</span>


<span class="s0">def </span><span class="s1">test_mapcat():</span>
    <span class="s0">assert </span><span class="s1">(list(mapcat(identity</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]])) ==</span>
            <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>

    <span class="s0">assert </span><span class="s1">(list(mapcat(reversed</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]])) ==</span>
            <span class="s1">list(range(</span><span class="s4">10</span><span class="s1">)))</span>

    <span class="s1">inc = </span><span class="s0">lambda </span><span class="s1">i: i + </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">9</span><span class="s1">] ==</span>
            <span class="s1">list(mapcat(partial(map</span><span class="s0">, </span><span class="s1">inc)</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s1">]])))</span>


<span class="s0">def </span><span class="s1">test_cons():</span>
    <span class="s0">assert </span><span class="s1">list(cons(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_concat():</span>
    <span class="s0">assert </span><span class="s1">list(concat([[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]])) == []</span>
    <span class="s0">assert </span><span class="s1">(list(take(</span><span class="s4">5</span><span class="s0">, </span><span class="s1">concat([[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">1000000000</span><span class="s1">)]))) ==</span>
            <span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_concatv():</span>
    <span class="s0">assert </span><span class="s1">list(concatv([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])) == []</span>
    <span class="s0">assert </span><span class="s1">(list(take(</span><span class="s4">5</span><span class="s0">, </span><span class="s1">concatv([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">1000000000</span><span class="s1">)))) ==</span>
            <span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_interpose():</span>
    <span class="s0">assert </span><span class="s3">&quot;a&quot; </span><span class="s1">== first(rest(interpose(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">1000000000</span><span class="s1">))))</span>
    <span class="s0">assert </span><span class="s3">&quot;tXaXrXzXaXn&quot; </span><span class="s1">== </span><span class="s3">&quot;&quot;</span><span class="s1">.join(interpose(</span><span class="s3">&quot;X&quot;</span><span class="s0">, </span><span class="s3">&quot;tarzan&quot;</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">list(interpose(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">itertools.repeat(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(interpose(</span><span class="s3">'.'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">])) == [</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'.'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'.'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_frequencies():</span>
    <span class="s0">assert </span><span class="s1">(frequencies([</span><span class="s3">&quot;cat&quot;</span><span class="s0">, </span><span class="s3">&quot;pig&quot;</span><span class="s0">, </span><span class="s3">&quot;cat&quot;</span><span class="s0">, </span><span class="s3">&quot;eel&quot;</span><span class="s0">,</span>
                        <span class="s3">&quot;pig&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s1">]) ==</span>
            <span class="s1">{</span><span class="s3">&quot;cat&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;eel&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;pig&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">frequencies([]) == {}</span>
    <span class="s0">assert </span><span class="s1">frequencies(</span><span class="s3">&quot;onomatopoeia&quot;</span><span class="s1">) == {</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;i&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;m&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                                           <span class="s3">&quot;o&quot;</span><span class="s1">: </span><span class="s4">4</span><span class="s0">, </span><span class="s3">&quot;n&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;p&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;t&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span>


<span class="s0">def </span><span class="s1">test_reduceby():</span>
    <span class="s1">data = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">iseven = </span><span class="s0">lambda </span><span class="s1">x: x % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">reduceby(iseven</span><span class="s0">, </span><span class="s1">add</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s4">0</span><span class="s1">) == {</span><span class="s0">False</span><span class="s1">: </span><span class="s4">9</span><span class="s0">, True</span><span class="s1">: </span><span class="s4">6</span><span class="s1">}</span>
    <span class="s0">assert </span><span class="s1">reduceby(iseven</span><span class="s0">, </span><span class="s1">mul</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s4">1</span><span class="s1">) == {</span><span class="s0">False</span><span class="s1">: </span><span class="s4">15</span><span class="s0">, True</span><span class="s1">: </span><span class="s4">8</span><span class="s1">}</span>

    <span class="s1">projects = [{</span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'build roads'</span><span class="s0">, </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">'CA'</span><span class="s0">, </span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">1000000</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'fight crime'</span><span class="s0">, </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">'IL'</span><span class="s0">, </span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">100000</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'help farmers'</span><span class="s0">, </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">'IL'</span><span class="s0">, </span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">2000000</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'help farmers'</span><span class="s0">, </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">'CA'</span><span class="s0">, </span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">200000</span><span class="s1">}]</span>
    <span class="s0">assert </span><span class="s1">reduceby(</span><span class="s0">lambda </span><span class="s1">x: x[</span><span class="s3">'state'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s0">lambda </span><span class="s1">acc</span><span class="s0">, </span><span class="s1">x: acc + x[</span><span class="s3">'cost'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">projects</span><span class="s0">, </span><span class="s4">0</span><span class="s1">) == {</span><span class="s3">'CA'</span><span class="s1">: </span><span class="s4">1200000</span><span class="s0">, </span><span class="s3">'IL'</span><span class="s1">: </span><span class="s4">2100000</span><span class="s1">}</span>

    <span class="s0">assert </span><span class="s1">reduceby(</span><span class="s3">'state'</span><span class="s0">,</span>
                    <span class="s0">lambda </span><span class="s1">acc</span><span class="s0">, </span><span class="s1">x: acc + x[</span><span class="s3">'cost'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">projects</span><span class="s0">, </span><span class="s4">0</span><span class="s1">) == {</span><span class="s3">'CA'</span><span class="s1">: </span><span class="s4">1200000</span><span class="s0">, </span><span class="s3">'IL'</span><span class="s1">: </span><span class="s4">2100000</span><span class="s1">}</span>


<span class="s0">def </span><span class="s1">test_reduce_by_init():</span>
    <span class="s0">assert </span><span class="s1">reduceby(iseven</span><span class="s0">, </span><span class="s1">add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]) == {</span><span class="s0">True</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">4</span><span class="s0">, False</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">+ </span><span class="s4">3</span><span class="s1">}</span>
    <span class="s0">assert </span><span class="s1">reduceby(iseven</span><span class="s0">, </span><span class="s1">add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">no_default2) == {</span><span class="s0">True</span><span class="s1">: </span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">4</span><span class="s0">,</span>
                                                                <span class="s0">False</span><span class="s1">: </span><span class="s4">1 </span><span class="s1">+ </span><span class="s4">3</span><span class="s1">}</span>


<span class="s0">def </span><span class="s1">test_reduce_by_callable_default():</span>
    <span class="s0">def </span><span class="s1">set_add(s</span><span class="s0">, </span><span class="s1">i):</span>
        <span class="s1">s.add(i)</span>
        <span class="s0">return </span><span class="s1">s</span>

    <span class="s0">assert </span><span class="s1">reduceby(iseven</span><span class="s0">, </span><span class="s1">set_add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">set) == \</span>
        <span class="s1">{</span><span class="s0">True</span><span class="s1">: {</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">}</span><span class="s0">, False</span><span class="s1">: {</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">}}</span>


<span class="s0">def </span><span class="s1">test_iterate():</span>
    <span class="s0">assert </span><span class="s1">list(itertools.islice(iterate(inc</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)) == [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(take(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">iterate(double</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_accumulate():</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">15</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(mul</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">120</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)) == [-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">14</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">binop(a</span><span class="s0">, </span><span class="s1">b):</span>
        <span class="s0">raise </span><span class="s1">AssertionError(</span><span class="s3">'binop should not be called'</span><span class="s1">)</span>

    <span class="s1">start = object()</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(binop</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">start)) == [start]</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(binop</span><span class="s0">, </span><span class="s1">[])) == []</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(add</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">no_default2)) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_accumulate_works_on_consumable_iterables():</span>
    <span class="s0">assert </span><span class="s1">list(accumulate(add</span><span class="s0">, </span><span class="s1">iter((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)))) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_sliding_window():</span>
    <span class="s0">assert </span><span class="s1">list(sliding_window(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(sliding_window(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>


<span class="s0">def </span><span class="s1">test_sliding_window_of_short_iterator():</span>
    <span class="s0">assert </span><span class="s1">list(sliding_window(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])) == []</span>
    <span class="s0">assert </span><span class="s1">list(sliding_window(</span><span class="s4">7</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])) == []</span>


<span class="s0">def </span><span class="s1">test_partition():</span>
    <span class="s0">assert </span><span class="s1">list(partition(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(partition(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">7</span><span class="s1">))) == [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(partition(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pad=-</span><span class="s4">1</span><span class="s1">)) == [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                                                    <span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(partition(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[])) == []</span>


<span class="s0">def </span><span class="s1">test_partition_all():</span>
    <span class="s0">assert </span><span class="s1">list(partition_all(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(partition_all(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">))) == [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(partition_all(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[])) == []</span>

    <span class="s2"># Regression test: https://github.com/pytoolz/toolz/issues/387</span>
    <span class="s0">class </span><span class="s1">NoCompare(object):</span>
        <span class="s0">def </span><span class="s1">__eq__(self</span><span class="s0">, </span><span class="s1">other):</span>
            <span class="s0">if </span><span class="s1">self.__class__ == other.__class__:</span>
                <span class="s0">return True</span>
            <span class="s0">raise </span><span class="s1">ValueError()</span>
    <span class="s1">obj = NoCompare()</span>
    <span class="s1">result = [(obj</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">obj)</span><span class="s0">, </span><span class="s1">(obj</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">obj)]</span>
    <span class="s0">assert </span><span class="s1">list(partition_all(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">[obj]*</span><span class="s4">7</span><span class="s1">)) == result</span>
    <span class="s0">assert </span><span class="s1">list(partition_all(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">iter([obj]*</span><span class="s4">7</span><span class="s1">))) == result</span>


<span class="s0">def </span><span class="s1">test_count():</span>
    <span class="s0">assert </span><span class="s1">count((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)) == </span><span class="s4">3</span>
    <span class="s0">assert </span><span class="s1">count([]) == </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">count(iter((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))) == </span><span class="s4">4</span>

    <span class="s0">assert </span><span class="s1">count(</span><span class="s3">'hello'</span><span class="s1">) == </span><span class="s4">5</span>
    <span class="s0">assert </span><span class="s1">count(iter(</span><span class="s3">'hello'</span><span class="s1">)) == </span><span class="s4">5</span>


<span class="s0">def </span><span class="s1">test_pluck():</span>
    <span class="s0">assert </span><span class="s1">list(pluck(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]])) == [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(pluck([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]])) == [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(pluck(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)) == [</span><span class="s0">None, </span><span class="s4">1</span><span class="s1">]</span>

    <span class="s1">data = [{</span><span class="s3">'id'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'cheese'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'id'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'name'</span><span class="s1">: </span><span class="s3">'pies'</span><span class="s0">, </span><span class="s3">'price'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}]</span>
    <span class="s0">assert </span><span class="s1">list(pluck(</span><span class="s3">'id'</span><span class="s0">, </span><span class="s1">data)) == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(pluck(</span><span class="s3">'price'</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)) == [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(pluck([</span><span class="s3">'id'</span><span class="s0">, </span><span class="s3">'name'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'cheese'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'pies'</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(pluck([</span><span class="s3">'name'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data)) == [(</span><span class="s3">'cheese'</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'pies'</span><span class="s0">,</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(pluck([</span><span class="s3">'price'</span><span class="s0">, </span><span class="s3">'other'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)) == [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)]</span>

    <span class="s0">assert </span><span class="s1">raises(IndexError</span><span class="s0">, lambda</span><span class="s1">: list(pluck(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s1">]])))</span>
    <span class="s0">assert </span><span class="s1">raises(KeyError</span><span class="s0">, lambda</span><span class="s1">: list(pluck(</span><span class="s3">'name'</span><span class="s0">, </span><span class="s1">[{</span><span class="s3">'id'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}])))</span>

    <span class="s0">assert </span><span class="s1">list(pluck(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">no_default2)) == [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">raises(IndexError</span><span class="s0">, lambda</span><span class="s1">: list(pluck(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">no_default2)))</span>


<span class="s0">def </span><span class="s1">test_join():</span>
    <span class="s1">names = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'three'</span><span class="s1">)]</span>
    <span class="s1">fruit = [(</span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'banana'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'coconut'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>

    <span class="s0">def </span><span class="s1">addpair(pair):</span>
        <span class="s0">return </span><span class="s1">pair[</span><span class="s4">0</span><span class="s1">] + pair[</span><span class="s4">1</span><span class="s1">]</span>

    <span class="s1">result = set(starmap(add</span><span class="s0">, </span><span class="s1">join(first</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">second</span><span class="s0">, </span><span class="s1">fruit)))</span>

    <span class="s1">expected = {(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s0">, </span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s0">, </span><span class="s3">'banana'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s0">, </span><span class="s3">'coconut'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">result = set(starmap(add</span><span class="s0">, </span><span class="s1">join(first</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">second</span><span class="s0">, </span><span class="s1">fruit</span><span class="s0">,</span>
                                   <span class="s1">left_default=no_default2</span><span class="s0">,</span>
                                   <span class="s1">right_default=no_default2)))</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_getter():</span>
    <span class="s0">assert </span><span class="s1">getter(</span><span class="s4">0</span><span class="s1">)(</span><span class="s3">'Alice'</span><span class="s1">) == </span><span class="s3">'A'</span>
    <span class="s0">assert </span><span class="s1">getter([</span><span class="s4">0</span><span class="s1">])(</span><span class="s3">'Alice'</span><span class="s1">) == (</span><span class="s3">'A'</span><span class="s0">,</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">getter([])(</span><span class="s3">'Alice'</span><span class="s1">) == ()</span>


<span class="s0">def </span><span class="s1">test_key_as_getter():</span>
    <span class="s1">squares = [(i</span><span class="s0">, </span><span class="s1">i**</span><span class="s4">2</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">)]</span>
    <span class="s1">pows = [(i</span><span class="s0">, </span><span class="s1">i**</span><span class="s4">2</span><span class="s0">, </span><span class="s1">i**</span><span class="s4">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">)]</span>

    <span class="s0">assert </span><span class="s1">set(join(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">pows)) == set(join(</span><span class="s0">lambda </span><span class="s1">x: x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">,</span>
                                                      <span class="s0">lambda </span><span class="s1">x: x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pows))</span>

    <span class="s1">get = </span><span class="s0">lambda </span><span class="s1">x: (x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">set(join([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pows)) == set(join(get</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">,</span>
                                                                <span class="s1">get</span><span class="s0">, </span><span class="s1">pows))</span>

    <span class="s1">get = </span><span class="s0">lambda </span><span class="s1">x: (x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">set(join([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pows)) == set(join(get</span><span class="s0">, </span><span class="s1">squares</span><span class="s0">,</span>
                                                          <span class="s1">get</span><span class="s0">, </span><span class="s1">pows))</span>


<span class="s0">def </span><span class="s1">test_join_double_repeats():</span>
    <span class="s1">names = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'three'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'uno'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'dos'</span><span class="s1">)]</span>
    <span class="s1">fruit = [(</span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'banana'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'coconut'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>

    <span class="s1">result = set(starmap(add</span><span class="s0">, </span><span class="s1">join(first</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">second</span><span class="s0">, </span><span class="s1">fruit)))</span>

    <span class="s1">expected = {(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s0">, </span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s0">, </span><span class="s3">'banana'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s0">, </span><span class="s3">'coconut'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'uno'</span><span class="s0">, </span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'uno'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'dos'</span><span class="s0">, </span><span class="s3">'banana'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'dos'</span><span class="s0">, </span><span class="s3">'coconut'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_join_missing_element():</span>
    <span class="s1">names = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s3">'two'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'three'</span><span class="s1">)]</span>
    <span class="s1">fruit = [(</span><span class="s3">'apple'</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span>

    <span class="s1">result = set(starmap(add</span><span class="s0">, </span><span class="s1">join(first</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">second</span><span class="s0">, </span><span class="s1">fruit)))</span>

    <span class="s1">expected = {(</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'one'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_left_outer_join():</span>
    <span class="s1">result = set(join(identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">left_default=</span><span class="s0">None</span><span class="s1">))</span>
    <span class="s1">expected = {(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, </span><span class="s4">3</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_right_outer_join():</span>
    <span class="s1">result = set(join(identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">right_default=</span><span class="s0">None</span><span class="s1">))</span>
    <span class="s1">expected = {(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, None</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_outer_join():</span>
    <span class="s1">result = set(join(identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">identity</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">left_default=</span><span class="s0">None, </span><span class="s1">right_default=</span><span class="s0">None</span><span class="s1">))</span>
    <span class="s1">expected = {(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, </span><span class="s4">3</span><span class="s1">)}</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_diff():</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff()))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">iter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]))) == []</span>
    <span class="s0">assert </span><span class="s1">list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">iter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]))) == [</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s1">])) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">list(diff([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">default=</span><span class="s0">None</span><span class="s1">)) == [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, None</span><span class="s1">)]</span>
    <span class="s2"># non-variadic usage</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([])))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([[]])))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]])))</span>
    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: list(diff([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])))</span>
    <span class="s0">assert </span><span class="s1">list(diff([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)])) == [(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span>

    <span class="s1">data1 = [{</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'dollar'</span><span class="s1">}</span><span class="s0">,</span>
             <span class="s1">{</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'dollar'</span><span class="s1">}]</span>

    <span class="s1">data2 = [{</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">100</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'yen'</span><span class="s1">}</span><span class="s0">,</span>
             <span class="s1">{</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">300</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'yen'</span><span class="s1">}]</span>

    <span class="s1">conversions = {</span><span class="s3">'dollar'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'yen'</span><span class="s1">: </span><span class="s4">0.01</span><span class="s1">}</span>

    <span class="s0">def </span><span class="s1">indollars(item):</span>
        <span class="s0">return </span><span class="s1">conversions[item[</span><span class="s3">'currency'</span><span class="s1">]] * item[</span><span class="s3">'cost'</span><span class="s1">]</span>

    <span class="s1">list(diff(data1</span><span class="s0">, </span><span class="s1">data2</span><span class="s0">, </span><span class="s1">key=indollars)) == [</span>
        <span class="s1">({</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'dollar'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'cost'</span><span class="s1">: </span><span class="s4">300</span><span class="s0">, </span><span class="s3">'currency'</span><span class="s1">: </span><span class="s3">'yen'</span><span class="s1">})]</span>


<span class="s0">def </span><span class="s1">test_topk():</span>
    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]) == (</span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: -x) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">iter([</span><span class="s4">5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: -x) == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">10</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">9</span><span class="s1">}</span><span class="s0">,</span>
                    <span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">10</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">9</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}]</span><span class="s0">, </span><span class="s1">key=</span><span class="s3">'a'</span><span class="s1">) == \</span>
        <span class="s1">({</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">10</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">9</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span>

    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">10</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">9</span><span class="s1">}</span><span class="s0">,</span>
                    <span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">10</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">9</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}]</span><span class="s0">, </span><span class="s1">key=</span><span class="s3">'b'</span><span class="s1">) == \</span>
        <span class="s1">({</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">10</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'a'</span><span class="s1">: </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">9</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s0">, </span><span class="s4">0</span><span class="s1">) == \</span>
        <span class="s1">((</span><span class="s4">4</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_topk_is_stable():</span>
    <span class="s0">assert </span><span class="s1">topk(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s4">1</span><span class="s1">) == (</span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_peek():</span>
    <span class="s1">alist = [</span><span class="s3">&quot;Alice&quot;</span><span class="s0">, </span><span class="s3">&quot;Bob&quot;</span><span class="s0">, </span><span class="s3">&quot;Carol&quot;</span><span class="s1">]</span>
    <span class="s1">element</span><span class="s0">, </span><span class="s1">blist = peek(alist)</span>
    <span class="s0">assert </span><span class="s1">element == alist[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(blist) == alist</span>

    <span class="s0">assert </span><span class="s1">raises(StopIteration</span><span class="s0">, lambda</span><span class="s1">: peek([]))</span>


<span class="s0">def </span><span class="s1">test_peekn():</span>
    <span class="s1">alist = (</span><span class="s3">&quot;Alice&quot;</span><span class="s0">, </span><span class="s3">&quot;Bob&quot;</span><span class="s0">, </span><span class="s3">&quot;Carol&quot;</span><span class="s1">)</span>
    <span class="s1">elements</span><span class="s0">, </span><span class="s1">blist = peekn(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">alist)</span>
    <span class="s0">assert </span><span class="s1">elements == alist[:</span><span class="s4">2</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">tuple(blist) == alist</span>

    <span class="s1">elements</span><span class="s0">, </span><span class="s1">blist = peekn(len(alist) * </span><span class="s4">4</span><span class="s0">, </span><span class="s1">alist)</span>
    <span class="s0">assert </span><span class="s1">elements == alist</span>
    <span class="s0">assert </span><span class="s1">tuple(blist) == alist</span>


<span class="s0">def </span><span class="s1">test_random_sample():</span>
    <span class="s1">alist = list(range(</span><span class="s4">100</span><span class="s1">))</span>

    <span class="s0">assert </span><span class="s1">list(random_sample(prob=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">seq=alist</span><span class="s0">, </span><span class="s1">random_state=</span><span class="s4">2016</span><span class="s1">)) == alist</span>

    <span class="s1">mk_rsample = </span><span class="s0">lambda </span><span class="s1">rs=</span><span class="s4">1</span><span class="s1">: list(random_sample(prob=</span><span class="s4">0.1</span><span class="s0">,</span>
                                                 <span class="s1">seq=alist</span><span class="s0">,</span>
                                                 <span class="s1">random_state=rs))</span>
    <span class="s1">rsample1 = mk_rsample()</span>
    <span class="s0">assert </span><span class="s1">rsample1 == mk_rsample()</span>

    <span class="s1">rsample2 = mk_rsample(</span><span class="s4">1984</span><span class="s1">)</span>
    <span class="s1">randobj = Random(</span><span class="s4">1984</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">rsample2 == mk_rsample(randobj)</span>

    <span class="s0">assert </span><span class="s1">rsample1 != rsample2</span>

    <span class="s0">assert </span><span class="s1">mk_rsample(hash(object)) == mk_rsample(hash(object))</span>
    <span class="s0">assert </span><span class="s1">mk_rsample(hash(object)) != mk_rsample(hash(object()))</span>
    <span class="s0">assert </span><span class="s1">mk_rsample(</span><span class="s5">b&quot;a&quot;</span><span class="s1">) == mk_rsample(</span><span class="s3">u&quot;a&quot;</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">raises(TypeError</span><span class="s0">, lambda</span><span class="s1">: mk_rsample([]))</span>
</pre>
</body>
</html>
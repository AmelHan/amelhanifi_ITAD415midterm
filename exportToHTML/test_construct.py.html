<html>
<head>
<title>test_construct.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_construct.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;test sparse matrix construction functions&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">array</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">(assert_equal</span><span class="s2">, </span><span class="s1">assert_</span><span class="s2">,</span>
        <span class="s1">assert_array_equal</span><span class="s2">, </span><span class="s1">assert_array_almost_equal_nulp)</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>
<span class="s2">from </span><span class="s1">scipy._lib._testutils </span><span class="s2">import </span><span class="s1">check_free_memory</span>
<span class="s2">from </span><span class="s1">scipy._lib._util </span><span class="s2">import </span><span class="s1">check_random_state</span>

<span class="s2">from </span><span class="s1">scipy.sparse </span><span class="s2">import </span><span class="s1">(csr_matrix</span><span class="s2">, </span><span class="s1">coo_matrix</span><span class="s2">,</span>
                          <span class="s1">_construct </span><span class="s2">as </span><span class="s1">construct)</span>
<span class="s2">from </span><span class="s1">scipy.sparse._construct </span><span class="s2">import </span><span class="s1">rand </span><span class="s2">as </span><span class="s1">sprand</span>
<span class="s2">from </span><span class="s1">scipy.sparse._sputils </span><span class="s2">import </span><span class="s1">matrix</span>

<span class="s1">sparse_formats = [</span><span class="s3">'csr'</span><span class="s2">,</span><span class="s3">'csc'</span><span class="s2">,</span><span class="s3">'coo'</span><span class="s2">,</span><span class="s3">'bsr'</span><span class="s2">,</span><span class="s3">'dia'</span><span class="s2">,</span><span class="s3">'lil'</span><span class="s2">,</span><span class="s3">'dok'</span><span class="s1">]</span>

<span class="s4">#TODO check whether format=XXX is respected</span>


<span class="s2">def </span><span class="s1">_sprandn(m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.01</span><span class="s2">, </span><span class="s1">format=</span><span class="s3">&quot;coo&quot;</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s2">None, </span><span class="s1">random_state=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s4"># Helper function for testing.</span>
    <span class="s1">random_state = check_random_state(random_state)</span>
    <span class="s1">data_rvs = random_state.standard_normal</span>
    <span class="s2">return </span><span class="s1">construct.random(m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">density</span><span class="s2">, </span><span class="s1">format</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">,</span>
                            <span class="s1">random_state</span><span class="s2">, </span><span class="s1">data_rvs)</span>


<span class="s2">class </span><span class="s1">TestConstructUtils:</span>
    <span class="s2">def </span><span class="s1">test_spdiags(self):</span>
        <span class="s1">diags1 = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]])</span>
        <span class="s1">diags2 = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">,</span><span class="s5">10</span><span class="s1">]])</span>
        <span class="s1">diags3 = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">,</span><span class="s5">10</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s5">11</span><span class="s2">,</span><span class="s5">12</span><span class="s2">,</span><span class="s5">13</span><span class="s2">,</span><span class="s5">14</span><span class="s2">,</span><span class="s5">15</span><span class="s1">]])</span>

        <span class="s1">cases = []</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">,</span><span class="s1">[-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">,</span><span class="s1">[-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags1</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">4</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">5</span><span class="s1">]]))</span>

        <span class="s1">cases.append((diags2</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">8</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags2</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">7</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags2</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                              <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">4</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                              <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">5</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                              <span class="s1">[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                              <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">7</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                              <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>

        <span class="s1">cases.append((diags3</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">12</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">7</span><span class="s2">,</span><span class="s5">13</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">8</span><span class="s2">,</span><span class="s5">14</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">,</span><span class="s5">15</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">,</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags3</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                 <span class="s1">[</span><span class="s5">11</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                 <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">12</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">10</span><span class="s1">]</span><span class="s2">,</span>
                                                 <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">13</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                 <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">14</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                 <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">15</span><span class="s1">]]))</span>
        <span class="s1">cases.append((diags3</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">len(diags3[</span><span class="s5">0</span><span class="s1">])</span><span class="s2">, </span><span class="s1">len(diags3[</span><span class="s5">0</span><span class="s1">])</span><span class="s2">,</span>
                      <span class="s1">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">15</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s1">]</span><span class="s2">,</span>
                       <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]))</span>

        <span class="s2">for </span><span class="s1">d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">result </span><span class="s2">in </span><span class="s1">cases:</span>
            <span class="s2">if </span><span class="s1">len(d[</span><span class="s5">0</span><span class="s1">]) == m </span><span class="s2">and </span><span class="s1">m == n:</span>
                <span class="s1">assert_equal(construct.spdiags(d</span><span class="s2">, </span><span class="s1">o).toarray()</span><span class="s2">, </span><span class="s1">result)</span>
            <span class="s1">assert_equal(construct.spdiags(d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">n).toarray()</span><span class="s2">, </span><span class="s1">result)</span>
            <span class="s1">assert_equal(construct.spdiags(d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">(m</span><span class="s2">, </span><span class="s1">n)).toarray()</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s2">def </span><span class="s1">test_diags(self):</span>
        <span class="s1">a = array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s1">])</span>
        <span class="s1">c = array([</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">15</span><span class="s1">])</span>

        <span class="s1">cases = []</span>
        <span class="s1">cases.append((a[:</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">,</span><span class="s1">[-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>

        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">6</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">7</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                     <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                     <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                     <span class="s1">[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span>
                                                     <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">7</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                     <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>

        <span class="s1">cases.append(([a[:</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b</span><span class="s2">,</span><span class="s1">c[:</span><span class="s5">4</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">11</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                            <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">7</span><span class="s2">,</span><span class="s5">12</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                            <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">8</span><span class="s2">,</span><span class="s5">13</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                            <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">,</span><span class="s5">14</span><span class="s1">]</span><span class="s2">,</span>
                                                            <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">,</span><span class="s5">10</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">c]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                          <span class="s1">[</span><span class="s5">11</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                          <span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">12</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">8</span><span class="s1">]</span><span class="s2">,</span>
                                                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">13</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                          <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">14</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span><span class="s5">15</span><span class="s1">]]))</span>

        <span class="s4"># too long arrays are OK</span>
        <span class="s1">cases.append(([a]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]]))</span>
        <span class="s1">cases.append((np.array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]])</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]]))</span>

        <span class="s4"># scalar case: broadcasting</span>
        <span class="s1">cases.append(([</span><span class="s5">1</span><span class="s2">,</span><span class="s1">-</span><span class="s5">2</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                                                    <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
                                                    <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">-</span><span class="s5">2</span><span class="s1">]]))</span>

        <span class="s2">for </span><span class="s1">d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">result </span><span class="s2">in </span><span class="s1">cases:</span>
            <span class="s1">err_msg = </span><span class="s3">f&quot;</span><span class="s2">{</span><span class="s1">d</span><span class="s2">!r} {</span><span class="s1">o</span><span class="s2">!r} {</span><span class="s1">shape</span><span class="s2">!r} {</span><span class="s1">result</span><span class="s2">!r}</span><span class="s3">&quot;</span>
            <span class="s1">assert_equal(construct.diags(d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">shape=shape).toarray()</span><span class="s2">,</span>
                         <span class="s1">result</span><span class="s2">, </span><span class="s1">err_msg=err_msg)</span>

            <span class="s2">if </span><span class="s1">shape[</span><span class="s5">0</span><span class="s1">] == shape[</span><span class="s5">1</span><span class="s1">] </span><span class="s2">and </span><span class="s1">hasattr(d[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s3">'__len__'</span><span class="s1">) </span><span class="s2">and </span><span class="s1">len(d[</span><span class="s5">0</span><span class="s1">]) &lt;= max(shape):</span>
                <span class="s4"># should be able to find the shape automatically</span>
                <span class="s1">assert_equal(construct.diags(d</span><span class="s2">, </span><span class="s1">o).toarray()</span><span class="s2">, </span><span class="s1">result</span><span class="s2">,</span>
                             <span class="s1">err_msg=err_msg)</span>

    <span class="s2">def </span><span class="s1">test_diags_default(self):</span>
        <span class="s1">a = array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(construct.diags(a).toarray()</span><span class="s2">, </span><span class="s1">np.diag(a))</span>

    <span class="s2">def </span><span class="s1">test_diags_default_bad(self):</span>
        <span class="s1">a = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">construct.diags</span><span class="s2">, </span><span class="s1">a)</span>

    <span class="s2">def </span><span class="s1">test_diags_bad(self):</span>
        <span class="s1">a = array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s1">])</span>
        <span class="s1">c = array([</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">15</span><span class="s1">])</span>

        <span class="s1">cases = []</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">0</span><span class="s1">]]</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">b</span><span class="s2">,</span><span class="s1">c[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">c</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)))</span>
        <span class="s1">cases.append(([a[:</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">c</span><span class="s2">,</span><span class="s1">b[:</span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, None</span><span class="s1">))</span>
        <span class="s1">cases.append(([]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">4</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, None</span><span class="s1">))</span>
        <span class="s1">cases.append(([</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[-</span><span class="s5">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)))</span>
        <span class="s1">cases.append(([a]</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, None</span><span class="s1">))</span>

        <span class="s2">for </span><span class="s1">d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">shape </span><span class="s2">in </span><span class="s1">cases:</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">construct.diags</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">o</span><span class="s2">, </span><span class="s1">shape)</span>

        <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">construct.diags</span><span class="s2">, </span><span class="s1">[[</span><span class="s2">None</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_diags_vs_diag(self):</span>
        <span class="s4"># Check that</span>
        <span class="s4">#</span>
        <span class="s4">#    diags([a, b, ...], [i, j, ...]) == diag(a, i) + diag(b, j) + ...</span>
        <span class="s4">#</span>

        <span class="s1">np.random.seed(</span><span class="s5">1234</span><span class="s1">)</span>

        <span class="s2">for </span><span class="s1">n_diags </span><span class="s2">in </span><span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s1">]:</span>
            <span class="s1">n = </span><span class="s5">1 </span><span class="s1">+ n_diags//</span><span class="s5">2 </span><span class="s1">+ np.random.randint(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s1">)</span>

            <span class="s1">offsets = np.arange(-n+</span><span class="s5">1</span><span class="s2">, </span><span class="s1">n-</span><span class="s5">1</span><span class="s1">)</span>
            <span class="s1">np.random.shuffle(offsets)</span>
            <span class="s1">offsets = offsets[:n_diags]</span>

            <span class="s1">diagonals = [np.random.rand(n - abs(q)) </span><span class="s2">for </span><span class="s1">q </span><span class="s2">in </span><span class="s1">offsets]</span>

            <span class="s1">mat = construct.diags(diagonals</span><span class="s2">, </span><span class="s1">offsets)</span>
            <span class="s1">dense_mat = sum([np.diag(x</span><span class="s2">, </span><span class="s1">j) </span><span class="s2">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">j </span><span class="s2">in </span><span class="s1">zip(diagonals</span><span class="s2">, </span><span class="s1">offsets)])</span>

            <span class="s1">assert_array_almost_equal_nulp(mat.toarray()</span><span class="s2">, </span><span class="s1">dense_mat)</span>

            <span class="s2">if </span><span class="s1">len(offsets) == </span><span class="s5">1</span><span class="s1">:</span>
                <span class="s1">mat = construct.diags(diagonals[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">offsets[</span><span class="s5">0</span><span class="s1">])</span>
                <span class="s1">dense_mat = np.diag(diagonals[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">offsets[</span><span class="s5">0</span><span class="s1">])</span>
                <span class="s1">assert_array_almost_equal_nulp(mat.toarray()</span><span class="s2">, </span><span class="s1">dense_mat)</span>

    <span class="s2">def </span><span class="s1">test_diags_dtype(self):</span>
        <span class="s1">x = construct.diags([</span><span class="s5">2.2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=int)</span>
        <span class="s1">assert_equal(x.dtype</span><span class="s2">, </span><span class="s1">int)</span>
        <span class="s1">assert_equal(x.toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_diags_one_diagonal(self):</span>
        <span class="s1">d = list(range(</span><span class="s5">5</span><span class="s1">))</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(-</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s1">):</span>
            <span class="s1">assert_equal(construct.diags(d</span><span class="s2">, </span><span class="s1">k).toarray()</span><span class="s2">,</span>
                         <span class="s1">construct.diags([d]</span><span class="s2">, </span><span class="s1">[k]).toarray())</span>

    <span class="s2">def </span><span class="s1">test_diags_empty(self):</span>
        <span class="s1">x = construct.diags([])</span>
        <span class="s1">assert_equal(x.shape</span><span class="s2">, </span><span class="s1">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_identity(self):</span>
        <span class="s1">assert_equal(construct.identity(</span><span class="s5">1</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.identity(</span><span class="s5">2</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]])</span>

        <span class="s1">I = construct.identity(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">'int8'</span><span class="s2">, </span><span class="s1">format=</span><span class="s3">'dia'</span><span class="s1">)</span>
        <span class="s1">assert_equal(I.dtype</span><span class="s2">, </span><span class="s1">np.dtype(</span><span class="s3">'int8'</span><span class="s1">))</span>
        <span class="s1">assert_equal(I.format</span><span class="s2">, </span><span class="s3">'dia'</span><span class="s1">)</span>

        <span class="s2">for </span><span class="s1">fmt </span><span class="s2">in </span><span class="s1">sparse_formats:</span>
            <span class="s1">I = construct.identity(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">format=fmt)</span>
            <span class="s1">assert_equal(I.format</span><span class="s2">, </span><span class="s1">fmt)</span>
            <span class="s1">assert_equal(I.toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_eye(self):</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">1</span><span class="s2">,</span><span class="s5">1</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">2</span><span class="s2">,</span><span class="s5">3</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">3</span><span class="s2">,</span><span class="s5">2</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">3</span><span class="s2">,</span><span class="s5">3</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]])</span>

        <span class="s1">assert_equal(construct.eye(</span><span class="s5">3</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s1">dtype=</span><span class="s3">'int16'</span><span class="s1">).dtype</span><span class="s2">, </span><span class="s1">np.dtype(</span><span class="s3">'int16'</span><span class="s1">))</span>

        <span class="s2">for </span><span class="s1">m </span><span class="s2">in </span><span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]:</span>
            <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]:</span>
                <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(-</span><span class="s5">5</span><span class="s2">,</span><span class="s5">6</span><span class="s1">):</span>
                    <span class="s1">assert_equal(construct.eye(m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">k=k).toarray()</span><span class="s2">, </span><span class="s1">np.eye(m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">k=k))</span>
                    <span class="s2">if </span><span class="s1">m == n:</span>
                        <span class="s1">assert_equal(construct.eye(m</span><span class="s2">, </span><span class="s1">k=k).toarray()</span><span class="s2">, </span><span class="s1">np.eye(m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">k=k))</span>

    <span class="s2">def </span><span class="s1">test_eye_one(self):</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">1</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.eye(</span><span class="s5">2</span><span class="s1">).toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]])</span>

        <span class="s1">I = construct.eye(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">'int8'</span><span class="s2">, </span><span class="s1">format=</span><span class="s3">'dia'</span><span class="s1">)</span>
        <span class="s1">assert_equal(I.dtype</span><span class="s2">, </span><span class="s1">np.dtype(</span><span class="s3">'int8'</span><span class="s1">))</span>
        <span class="s1">assert_equal(I.format</span><span class="s2">, </span><span class="s3">'dia'</span><span class="s1">)</span>

        <span class="s2">for </span><span class="s1">fmt </span><span class="s2">in </span><span class="s1">sparse_formats:</span>
            <span class="s1">I = construct.eye(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">format=fmt)</span>
            <span class="s1">assert_equal(I.format</span><span class="s2">, </span><span class="s1">fmt)</span>
            <span class="s1">assert_equal(I.toarray()</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_kron(self):</span>
        <span class="s1">cases = []</span>

        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[-</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">4</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">10</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">6</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">14</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">4</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">8</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">5</span><span class="s2">,</span><span class="s5">8</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0.5</span><span class="s2">,</span><span class="s5">0.125</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3.25</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2.5</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>

        <span class="s2">for </span><span class="s1">a </span><span class="s2">in </span><span class="s1">cases:</span>
            <span class="s2">for </span><span class="s1">b </span><span class="s2">in </span><span class="s1">cases:</span>
                <span class="s1">expected = np.kron(a</span><span class="s2">, </span><span class="s1">b)</span>
                <span class="s2">for </span><span class="s1">fmt </span><span class="s2">in </span><span class="s1">sparse_formats:</span>
                    <span class="s1">result = construct.kron(csr_matrix(a)</span><span class="s2">, </span><span class="s1">csr_matrix(b)</span><span class="s2">, </span><span class="s1">format=fmt) </span>
                    <span class="s1">assert_equal(result.format</span><span class="s2">, </span><span class="s1">fmt)</span>
                    <span class="s1">assert_array_equal(result.toarray()</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_kron_large(self):</span>
        <span class="s1">n = </span><span class="s5">2</span><span class="s1">**</span><span class="s5">16</span>
        <span class="s1">a = construct.eye(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">n-</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = construct.eye(n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">-n)</span>

        <span class="s1">construct.kron(a</span><span class="s2">, </span><span class="s1">a)</span>
        <span class="s1">construct.kron(b</span><span class="s2">, </span><span class="s1">b)</span>

    <span class="s2">def </span><span class="s1">test_kronsum(self):</span>
        <span class="s1">cases = []</span>

        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[-</span><span class="s5">1</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">4</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">10</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s1">-</span><span class="s5">6</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">8</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">14</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">cases.append(array([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">5</span><span class="s2">,</span><span class="s1">-</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">4</span><span class="s2">,</span><span class="s1">-</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s1">]]))</span>

        <span class="s2">for </span><span class="s1">a </span><span class="s2">in </span><span class="s1">cases:</span>
            <span class="s2">for </span><span class="s1">b </span><span class="s2">in </span><span class="s1">cases:</span>
                <span class="s1">result = construct.kronsum(</span>
                    <span class="s1">csr_matrix(a)</span><span class="s2">, </span><span class="s1">csr_matrix(b)).toarray()</span>
                <span class="s1">expected = np.kron(np.eye(len(b))</span><span class="s2">, </span><span class="s1">a) + \</span>
                        <span class="s1">np.kron(b</span><span class="s2">, </span><span class="s1">np.eye(len(a)))</span>
                <span class="s1">assert_array_equal(result</span><span class="s2">,</span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_vstack(self):</span>

        <span class="s1">A = coo_matrix([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]])</span>
        <span class="s1">B = coo_matrix([[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">6</span><span class="s1">]])</span>

        <span class="s1">expected = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.vstack([A</span><span class="s2">, </span><span class="s1">B]).toarray()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.vstack([A</span><span class="s2">, </span><span class="s1">B]</span><span class="s2">, </span><span class="s1">dtype=np.float32).dtype</span><span class="s2">,</span>
                     <span class="s1">np.float32)</span>

        <span class="s1">assert_equal(construct.vstack([A.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">result = construct.vstack([A.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]</span><span class="s2">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">assert_equal(result.dtype</span><span class="s2">, </span><span class="s1">np.float32)</span>
        <span class="s1">assert_equal(result.indices.dtype</span><span class="s2">, </span><span class="s1">np.int32)</span>
        <span class="s1">assert_equal(result.indptr.dtype</span><span class="s2">, </span><span class="s1">np.int32)</span>

        <span class="s1">assert_equal(construct.vstack([A.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">result = construct.vstack([A.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]</span><span class="s2">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">assert_equal(result.dtype</span><span class="s2">, </span><span class="s1">np.float32)</span>
        <span class="s1">assert_equal(result.indices.dtype</span><span class="s2">, </span><span class="s1">np.int32)</span>
        <span class="s1">assert_equal(result.indptr.dtype</span><span class="s2">, </span><span class="s1">np.int32)</span>

    <span class="s2">def </span><span class="s1">test_hstack(self):</span>

        <span class="s1">A = coo_matrix([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]])</span>
        <span class="s1">B = coo_matrix([[</span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">6</span><span class="s1">]])</span>

        <span class="s1">expected = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.hstack([A</span><span class="s2">, </span><span class="s1">B]).toarray()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.hstack([A</span><span class="s2">, </span><span class="s1">B]</span><span class="s2">, </span><span class="s1">dtype=np.float32).dtype</span><span class="s2">,</span>
                     <span class="s1">np.float32)</span>
        <span class="s1">assert_equal(construct.hstack([A.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.hstack([A.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]</span><span class="s2">,</span>
                                      <span class="s1">dtype=np.float32).dtype</span><span class="s2">,</span>
                     <span class="s1">np.float32)</span>
        <span class="s1">assert_equal(construct.hstack([A.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.hstack([A.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]</span><span class="s2">,</span>
                                      <span class="s1">dtype=np.float32).dtype</span><span class="s2">,</span>
                     <span class="s1">np.float32)</span>

    <span class="s2">def </span><span class="s1">test_bmat(self):</span>

        <span class="s1">A = coo_matrix([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]])</span>
        <span class="s1">B = coo_matrix([[</span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">6</span><span class="s1">]])</span>
        <span class="s1">C = coo_matrix([[</span><span class="s5">7</span><span class="s1">]])</span>
        <span class="s1">D = coo_matrix((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">))</span>

        <span class="s1">expected = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.bmat([[A</span><span class="s2">, </span><span class="s1">B]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s1">C]]).toarray()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">E = csr_matrix((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.int32)</span>
        <span class="s1">assert_equal(construct.bmat([[A.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]</span><span class="s2">,</span>
                                     <span class="s1">[E</span><span class="s2">, </span><span class="s1">C.tocsr()]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[A.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]</span><span class="s2">,</span>
                                     <span class="s1">[E.tocsc()</span><span class="s2">, </span><span class="s1">C.tocsc()]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>

        <span class="s1">expected = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.bmat([[A</span><span class="s2">, None</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s1">C]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[A.tocsr()</span><span class="s2">, </span><span class="s1">E.T.tocsr()]</span><span class="s2">,</span>
                                     <span class="s1">[E</span><span class="s2">, </span><span class="s1">C.tocsr()]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[A.tocsc()</span><span class="s2">, </span><span class="s1">E.T.tocsc()]</span><span class="s2">,</span>
                                     <span class="s1">[E.tocsc()</span><span class="s2">, </span><span class="s1">C.tocsc()]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>

        <span class="s1">Z = csr_matrix((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.int32)</span>
        <span class="s1">expected = array([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">7</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.bmat([[</span><span class="s2">None, </span><span class="s1">B]</span><span class="s2">, </span><span class="s1">[C</span><span class="s2">, None</span><span class="s1">]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[E.T.tocsr()</span><span class="s2">, </span><span class="s1">B.tocsr()]</span><span class="s2">,</span>
                                     <span class="s1">[C.tocsr()</span><span class="s2">, </span><span class="s1">Z]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[E.T.tocsc()</span><span class="s2">, </span><span class="s1">B.tocsc()]</span><span class="s2">,</span>
                                     <span class="s1">[C.tocsc()</span><span class="s2">, </span><span class="s1">Z.tocsc()]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>

        <span class="s1">expected = matrix(np.empty((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)))</span>
        <span class="s1">assert_equal(construct.bmat([[</span><span class="s2">None, None</span><span class="s1">]]).toarray()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">assert_equal(construct.bmat([[</span><span class="s2">None, </span><span class="s1">D]</span><span class="s2">, </span><span class="s1">[D</span><span class="s2">, None</span><span class="s1">]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>

        <span class="s4"># test bug reported in gh-5976</span>
        <span class="s1">expected = array([[</span><span class="s5">7</span><span class="s1">]])</span>
        <span class="s1">assert_equal(construct.bmat([[</span><span class="s2">None, </span><span class="s1">D]</span><span class="s2">, </span><span class="s1">[C</span><span class="s2">, None</span><span class="s1">]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">expected)</span>

        <span class="s4"># test failure cases</span>
        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A]</span><span class="s2">, </span><span class="s1">[B]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'Got blocks\[1,0\]\.shape\[1\] == 1, expected 2'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A.tocsr()]</span><span class="s2">, </span><span class="s1">[B.tocsr()]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'incompatible dimensions for axis 1'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A.tocsc()]</span><span class="s2">, </span><span class="s1">[B.tocsc()]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'Mismatching dimensions along axis 1: ({1, 2}|{2, 1})'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A</span><span class="s2">, </span><span class="s1">C]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'Got blocks\[0,1\]\.shape\[0\] == 1, expected 2'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A.tocsr()</span><span class="s2">, </span><span class="s1">C.tocsr()]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'Mismatching dimensions along axis 0: ({1, 2}|{2, 1})'</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">assert_raises(ValueError) </span><span class="s2">as </span><span class="s1">excinfo:</span>
            <span class="s1">construct.bmat([[A.tocsc()</span><span class="s2">, </span><span class="s1">C.tocsc()]])</span>
        <span class="s1">excinfo.match(</span><span class="s3">r'incompatible dimensions for axis 0'</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s1">@pytest.mark.xfail_on_32bit(</span><span class="s3">&quot;Can't create large array for test&quot;</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_concatenate_int32_overflow(self):</span>
        <span class="s0">&quot;&quot;&quot; test for indptr overflow when concatenating matrices &quot;&quot;&quot;</span>
        <span class="s1">check_free_memory(</span><span class="s5">30000</span><span class="s1">)</span>

        <span class="s1">n = </span><span class="s5">33000</span>
        <span class="s1">A = csr_matrix(np.ones((n</span><span class="s2">, </span><span class="s1">n)</span><span class="s2">, </span><span class="s1">dtype=bool))</span>
        <span class="s1">B = A.copy()</span>
        <span class="s1">C = construct._compressed_sparse_stack((A</span><span class="s2">,</span><span class="s1">B)</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span>

        <span class="s1">assert_(np.all(np.equal(np.diff(C.indptr)</span><span class="s2">, </span><span class="s1">n)))</span>
        <span class="s1">assert_equal(C.indices.dtype</span><span class="s2">, </span><span class="s1">np.int64)</span>
        <span class="s1">assert_equal(C.indptr.dtype</span><span class="s2">, </span><span class="s1">np.int64)</span>

    <span class="s2">def </span><span class="s1">test_block_diag_basic(self):</span>
        <span class="s0">&quot;&quot;&quot; basic test for block_diag &quot;&quot;&quot;</span>
        <span class="s1">A = coo_matrix([[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s1">]])</span>
        <span class="s1">B = coo_matrix([[</span><span class="s5">5</span><span class="s1">]</span><span class="s2">,</span><span class="s1">[</span><span class="s5">6</span><span class="s1">]])</span>
        <span class="s1">C = coo_matrix([[</span><span class="s5">7</span><span class="s1">]])</span>

        <span class="s1">expected = array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
                          <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s1">]])</span>

        <span class="s1">assert_equal(construct.block_diag((A</span><span class="s2">, </span><span class="s1">B</span><span class="s2">, </span><span class="s1">C)).toarray()</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_block_diag_scalar_1d_args(self):</span>
        <span class="s0">&quot;&quot;&quot; block_diag with scalar and 1d arguments &quot;&quot;&quot;</span>
        <span class="s4"># one 1d matrix and a scalar</span>
        <span class="s1">assert_array_equal(construct.block_diag([[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]).toarray()</span><span class="s2">,</span>
                           <span class="s1">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_block_diag_1(self):</span>
        <span class="s0">&quot;&quot;&quot; block_diag with one matrix &quot;&quot;&quot;</span>
        <span class="s1">assert_equal(construct.block_diag([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(construct.block_diag([[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s1">assert_equal(construct.block_diag([[[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]]]).toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s1">]]))</span>
        <span class="s4"># just on scalar</span>
        <span class="s1">assert_equal(construct.block_diag([</span><span class="s5">1</span><span class="s1">]).toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s1">]]))</span>

    <span class="s2">def </span><span class="s1">test_block_diag_sparse_matrices(self):</span>
        <span class="s0">&quot;&quot;&quot; block_diag with sparse matrices &quot;&quot;&quot;</span>

        <span class="s1">sparse_col_matrices = [coo_matrix(([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]])</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s1">))</span><span class="s2">,</span>
                               <span class="s1">coo_matrix(([[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]])</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">))]</span>
        <span class="s1">block_sparse_cols_matrices = construct.block_diag(sparse_col_matrices)</span>
        <span class="s1">assert_equal(block_sparse_cols_matrices.toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]]))</span>

        <span class="s1">sparse_row_matrices = [coo_matrix(([[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s1">]])</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s1">))</span><span class="s2">,</span>
                               <span class="s1">coo_matrix(([[</span><span class="s5">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">5</span><span class="s1">]])</span><span class="s2">, </span><span class="s1">shape=(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s1">))]</span>
        <span class="s1">block_sparse_row_matrices = construct.block_diag(sparse_row_matrices)</span>
        <span class="s1">assert_equal(block_sparse_row_matrices.toarray()</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s1">]]))</span>

    <span class="s2">def </span><span class="s1">test_random_sampling(self):</span>
        <span class="s4"># Simple sanity checks for sparse random sampling.</span>
        <span class="s2">for </span><span class="s1">f </span><span class="s2">in </span><span class="s1">sprand</span><span class="s2">, </span><span class="s1">_sprandn:</span>
            <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">[np.float32</span><span class="s2">, </span><span class="s1">np.float64</span><span class="s2">, </span><span class="s1">np.longdouble</span><span class="s2">,</span>
                      <span class="s1">np.int32</span><span class="s2">, </span><span class="s1">np.int64</span><span class="s2">, </span><span class="s1">np.complex64</span><span class="s2">, </span><span class="s1">np.complex128]:</span>
                <span class="s1">x = f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.1</span><span class="s2">, </span><span class="s1">dtype=t)</span>
                <span class="s1">assert_equal(x.dtype</span><span class="s2">, </span><span class="s1">t)</span>
                <span class="s1">assert_equal(x.shape</span><span class="s2">, </span><span class="s1">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s1">))</span>
                <span class="s1">assert_equal(x.nnz</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span>

            <span class="s1">x1 = f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.1</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">4321</span><span class="s1">)</span>
            <span class="s1">assert_equal(x1.dtype</span><span class="s2">, </span><span class="s1">np.double)</span>

            <span class="s1">x2 = f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.1</span><span class="s2">,</span>
                   <span class="s1">random_state=np.random.RandomState(</span><span class="s5">4321</span><span class="s1">))</span>

            <span class="s1">assert_array_equal(x1.data</span><span class="s2">, </span><span class="s1">x2.data)</span>
            <span class="s1">assert_array_equal(x1.row</span><span class="s2">, </span><span class="s1">x2.row)</span>
            <span class="s1">assert_array_equal(x1.col</span><span class="s2">, </span><span class="s1">x2.col)</span>

            <span class="s2">for </span><span class="s1">density </span><span class="s2">in </span><span class="s1">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">]:</span>
                <span class="s1">x = f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">density=density)</span>
                <span class="s1">assert_equal(x.nnz</span><span class="s2">, </span><span class="s1">int(density * np.prod(x.shape)))</span>

            <span class="s2">for </span><span class="s1">fmt </span><span class="s2">in </span><span class="s1">[</span><span class="s3">'coo'</span><span class="s2">, </span><span class="s3">'csc'</span><span class="s2">, </span><span class="s3">'csr'</span><span class="s2">, </span><span class="s3">'lil'</span><span class="s1">]:</span>
                <span class="s1">x = f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">format=fmt)</span>
                <span class="s1">assert_equal(x.format</span><span class="s2">, </span><span class="s1">fmt)</span>

            <span class="s1">assert_raises(ValueError</span><span class="s2">, lambda</span><span class="s1">: f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">1.1</span><span class="s1">))</span>
            <span class="s1">assert_raises(ValueError</span><span class="s2">, lambda</span><span class="s1">: f(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">-</span><span class="s5">0.1</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_rand(self):</span>
        <span class="s4"># Simple distributional checks for sparse.rand.</span>
        <span class="s1">random_states = [</span><span class="s2">None, </span><span class="s5">4321</span><span class="s2">, </span><span class="s1">np.random.RandomState()]</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">gen = np.random.default_rng()</span>
            <span class="s1">random_states.append(gen)</span>
        <span class="s2">except </span><span class="s1">AttributeError:</span>
            <span class="s2">pass</span>

        <span class="s2">for </span><span class="s1">random_state </span><span class="s2">in </span><span class="s1">random_states:</span>
            <span class="s1">x = sprand(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">dtype=np.float64</span><span class="s2">,</span>
                       <span class="s1">random_state=random_state)</span>
            <span class="s1">assert_(np.all(np.less_equal(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">x.data)))</span>
            <span class="s1">assert_(np.all(np.less_equal(x.data</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_randn(self):</span>
        <span class="s4"># Simple distributional checks for sparse.randn.</span>
        <span class="s4"># Statistically, some of these should be negative</span>
        <span class="s4"># and some should be greater than 1.</span>
        <span class="s1">random_states = [</span><span class="s2">None, </span><span class="s5">4321</span><span class="s2">, </span><span class="s1">np.random.RandomState()]</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">gen = np.random.default_rng()</span>
            <span class="s1">random_states.append(gen)</span>
        <span class="s2">except </span><span class="s1">AttributeError:</span>
            <span class="s2">pass</span>

        <span class="s2">for </span><span class="s1">random_state </span><span class="s2">in </span><span class="s1">random_states:</span>
            <span class="s1">x = _sprandn(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">dtype=np.float64</span><span class="s2">,</span>
                         <span class="s1">random_state=random_state)</span>
            <span class="s1">assert_(np.any(np.less(x.data</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)))</span>
            <span class="s1">assert_(np.any(np.less(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">x.data)))</span>

    <span class="s2">def </span><span class="s1">test_random_accept_str_dtype(self):</span>
        <span class="s4"># anything that np.dtype can convert to a dtype should be accepted</span>
        <span class="s4"># for the dtype</span>
        <span class="s1">construct.random(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">'d'</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_random_sparse_matrix_returns_correct_number_of_non_zero_elements(self):</span>
        <span class="s4"># A 10 x 10 matrix, with density of 12.65%, should have 13 nonzero elements.</span>
        <span class="s4"># 10 x 10 x 0.1265 = 12.65, which should be rounded up to 13, not 12.</span>
        <span class="s1">sparse_matrix = construct.random(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s1">density=</span><span class="s5">0.1265</span><span class="s1">)</span>
        <span class="s1">assert_equal(sparse_matrix.count_nonzero()</span><span class="s2">,</span><span class="s5">13</span><span class="s1">)</span>

</pre>
</body>
</html>
<html>
<head>
<title>test_mosaicplot.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_mosaicplot.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">statsmodels.compat.python </span><span class="s0">import </span><span class="s1">lrange</span>

<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">BytesIO</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_raises</span>
<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">statsmodels.api </span><span class="s0">import </span><span class="s1">datasets</span>

<span class="s2"># utilities for the tests</span>

<span class="s0">try</span><span class="s1">:</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt  </span><span class="s2"># noqa:F401</span>
<span class="s0">except </span><span class="s1">ImportError:</span>
    <span class="s0">pass</span>

<span class="s2"># other functions to be tested for accuracy</span>
<span class="s2"># the main drawing function</span>
<span class="s0">from </span><span class="s1">statsmodels.graphics.mosaicplot </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">_hierarchical_split</span><span class="s0">,</span>
    <span class="s1">_key_splitting</span><span class="s0">,</span>
    <span class="s1">_normalize_split</span><span class="s0">,</span>
    <span class="s1">_reduce_dict</span><span class="s0">,</span>
    <span class="s1">_split_rect</span><span class="s0">,</span>
    <span class="s1">mosaic</span><span class="s0">,</span>
<span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_data_conversion(close_figures):</span>
    <span class="s2"># It will not reorder the elements</span>
    <span class="s2"># so the dictionary will look odd</span>
    <span class="s2"># as it key order has the c and b</span>
    <span class="s2"># keys swapped</span>
    <span class="s0">import </span><span class="s1">pandas</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">data = {</span><span class="s4">'ax'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s4">'bx'</span><span class="s1">: </span><span class="s3">2</span><span class="s0">, </span><span class="s4">'cx'</span><span class="s1">: </span><span class="s3">3</span><span class="s1">}</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'basic dict'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">data = pandas.Series(data)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'basic series'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">data = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'basic list'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">data = np.asarray(data)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'basic array'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s4">&quot;all&quot;</span><span class="s1">)</span>

    <span class="s1">data = {(</span><span class="s4">'ax'</span><span class="s0">, </span><span class="s4">'cx'</span><span class="s1">): </span><span class="s3">1</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'bx'</span><span class="s0">, </span><span class="s4">'cx'</span><span class="s1">): </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'ax'</span><span class="s0">, </span><span class="s4">'dx'</span><span class="s1">): </span><span class="s3">3</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'bx'</span><span class="s0">, </span><span class="s4">'dx'</span><span class="s1">): </span><span class="s3">4</span><span class="s1">}</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'compound dict'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'inverted keys dict'</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">data = pandas.Series(data)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'compound series'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'inverted keys series'</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">data = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]]</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'compound list'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'inverted keys list'</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">data = np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]])</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'compound array'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'inverted keys array'</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s4">&quot;all&quot;</span><span class="s1">)</span>

    <span class="s1">gender = [</span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s1">]</span>
    <span class="s1">pet = [</span><span class="s4">'cat'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s1">]</span>
    <span class="s1">data = pandas.DataFrame({</span><span class="s4">'gender'</span><span class="s1">: gender</span><span class="s0">, </span><span class="s4">'pet'</span><span class="s1">: pet})</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'gender'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'dataframe by key 1'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'pet'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'dataframe by key 2'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'gender'</span><span class="s0">, </span><span class="s4">'pet'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'both keys'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'pet'</span><span class="s0">, </span><span class="s4">'gender'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'keys inverted'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s4">&quot;all&quot;</span><span class="s1">)</span>
    <span class="s1">plt.suptitle(</span><span class="s4">'testing data conversion (plot 1 of 4)'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_mosaic_simple(close_figures):</span>
    <span class="s2"># display a simple plot of 4 categories of data, splitted in four</span>
    <span class="s2"># levels with increasing size for each group</span>
    <span class="s2"># creation of the levels</span>
    <span class="s1">key_set = ([</span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'old'</span><span class="s0">, </span><span class="s4">'adult'</span><span class="s0">, </span><span class="s4">'young'</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">'worker'</span><span class="s0">, </span><span class="s4">'unemployed'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'healty'</span><span class="s0">, </span><span class="s4">'ill'</span><span class="s1">])</span>
    <span class="s2"># the cartesian product of all the categories is</span>
    <span class="s2"># the complete set of categories</span>
    <span class="s1">keys = list(product(*key_set))</span>
    <span class="s1">data = dict(zip(keys</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">+ len(keys))))</span>
    <span class="s2"># which colours should I use for the various categories?</span>
    <span class="s2"># put it into a dict</span>
    <span class="s1">props = {}</span>
    <span class="s2">#males and females in blue and red</span>
    <span class="s1">props[(</span><span class="s4">'male'</span><span class="s0">,</span><span class="s1">)] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'b'</span><span class="s1">}</span>
    <span class="s1">props[(</span><span class="s4">'female'</span><span class="s0">,</span><span class="s1">)] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'r'</span><span class="s1">}</span>
    <span class="s2"># all the groups corresponding to ill groups have a different color</span>
    <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">keys:</span>
        <span class="s0">if </span><span class="s4">'ill' </span><span class="s0">in </span><span class="s1">key:</span>
            <span class="s0">if </span><span class="s4">'male' </span><span class="s0">in </span><span class="s1">key:</span>
                <span class="s1">props[key] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'BlueViolet' </span><span class="s0">, </span><span class="s4">'hatch'</span><span class="s1">: </span><span class="s4">'+'</span><span class="s1">}</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">props[key] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'Crimson' </span><span class="s0">, </span><span class="s4">'hatch'</span><span class="s1">: </span><span class="s4">'+'</span><span class="s1">}</span>
    <span class="s2"># mosaic of the data, with given gaps and colors</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">properties=props</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.suptitle(</span><span class="s4">'syntetic data, 4 categories (plot 2 of 4)'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_mosaic(close_figures):</span>
    <span class="s2"># make the same analysis on a known dataset</span>

    <span class="s2"># load the data and clean it a bit</span>
    <span class="s1">affairs = datasets.fair.load_pandas()</span>
    <span class="s1">datas = affairs.exog</span>
    <span class="s2"># any time greater than 0 is cheating</span>
    <span class="s1">datas[</span><span class="s4">'cheated'</span><span class="s1">] = affairs.endog &gt; </span><span class="s3">0</span>
    <span class="s2"># sort by the marriage quality and give meaningful name</span>
    <span class="s2"># [rate_marriage, age, yrs_married, children,</span>
    <span class="s2"># religious, educ, occupation, occupation_husb]</span>
    <span class="s1">datas = datas.sort_values([</span><span class="s4">'rate_marriage'</span><span class="s0">, </span><span class="s4">'religious'</span><span class="s1">])</span>

    <span class="s1">num_to_desc = {</span><span class="s3">1</span><span class="s1">: </span><span class="s4">'awful'</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s4">'bad'</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s4">'intermediate'</span><span class="s0">,</span>
                   <span class="s3">4</span><span class="s1">: </span><span class="s4">'good'</span><span class="s0">, </span><span class="s3">5</span><span class="s1">: </span><span class="s4">'wonderful'</span><span class="s1">}</span>
    <span class="s1">datas[</span><span class="s4">'rate_marriage'</span><span class="s1">] = datas[</span><span class="s4">'rate_marriage'</span><span class="s1">].map(num_to_desc)</span>
    <span class="s1">num_to_faith = {</span><span class="s3">1</span><span class="s1">: </span><span class="s4">'non religious'</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s4">'poorly religious'</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s4">'religious'</span><span class="s0">,</span>
                    <span class="s3">4</span><span class="s1">: </span><span class="s4">'very religious'</span><span class="s1">}</span>
    <span class="s1">datas[</span><span class="s4">'religious'</span><span class="s1">] = datas[</span><span class="s4">'religious'</span><span class="s1">].map(num_to_faith)</span>
    <span class="s1">num_to_cheat = {</span><span class="s0">False</span><span class="s1">: </span><span class="s4">'faithful'</span><span class="s0">, True</span><span class="s1">: </span><span class="s4">'cheated'</span><span class="s1">}</span>
    <span class="s1">datas[</span><span class="s4">'cheated'</span><span class="s1">] = datas[</span><span class="s4">'cheated'</span><span class="s1">].map(num_to_cheat)</span>
    <span class="s2"># finished cleaning</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">mosaic(datas</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'rate_marriage'</span><span class="s0">, </span><span class="s4">'cheated'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">title=</span><span class="s4">'by marriage happiness'</span><span class="s1">)</span>
    <span class="s1">mosaic(datas</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'religious'</span><span class="s0">, </span><span class="s4">'cheated'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">title=</span><span class="s4">'by religiosity'</span><span class="s1">)</span>
    <span class="s1">mosaic(datas</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'rate_marriage'</span><span class="s0">, </span><span class="s4">'religious'</span><span class="s0">, </span><span class="s4">'cheated'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">title=</span><span class="s4">'by both'</span><span class="s0">, </span><span class="s1">labelizer=</span><span class="s0">lambda </span><span class="s1">k:</span><span class="s4">''</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">].set_xlabel(</span><span class="s4">'marriage rating'</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">].set_ylabel(</span><span class="s4">'religion status'</span><span class="s1">)</span>
    <span class="s1">mosaic(datas</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'religious'</span><span class="s0">, </span><span class="s4">'rate_marriage'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">title=</span><span class="s4">'inter-dependence'</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.suptitle(</span><span class="s4">&quot;extramarital affairs (plot 3 of 4)&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_mosaic_very_complex(close_figures):</span>
    <span class="s2"># make a scattermatrix of mosaic plots to show the correlations between</span>
    <span class="s2"># each pair of variable in a dataset. Could be easily converted into a</span>
    <span class="s2"># new function that does this automatically based on the type of data</span>
    <span class="s1">key_name = [</span><span class="s4">'gender'</span><span class="s0">, </span><span class="s4">'age'</span><span class="s0">, </span><span class="s4">'health'</span><span class="s0">, </span><span class="s4">'work'</span><span class="s1">]</span>
    <span class="s1">key_base = ([</span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'old'</span><span class="s0">, </span><span class="s4">'young'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'healty'</span><span class="s0">, </span><span class="s4">'ill'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'work'</span><span class="s0">, </span><span class="s4">'unemployed'</span><span class="s1">])</span>
    <span class="s1">keys = list(product(*key_base))</span>
    <span class="s1">data = dict(zip(keys</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">+ len(keys))))</span>
    <span class="s1">props = {}</span>
    <span class="s1">props[(</span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'old'</span><span class="s1">)] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'r'</span><span class="s1">}</span>
    <span class="s1">props[(</span><span class="s4">'female'</span><span class="s0">,</span><span class="s1">)] = {</span><span class="s4">'color'</span><span class="s1">: </span><span class="s4">'pink'</span><span class="s1">}</span>
    <span class="s1">L = len(key_base)</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">axes = plt.subplots(L</span><span class="s0">, </span><span class="s1">L)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(L):</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(L):</span>
            <span class="s1">m = set(range(L)).difference(set((i</span><span class="s0">, </span><span class="s1">j)))</span>
            <span class="s0">if </span><span class="s1">i == j:</span>
                <span class="s1">axes[i</span><span class="s0">, </span><span class="s1">i].text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">key_name[i]</span><span class="s0">,</span>
                                <span class="s1">ha=</span><span class="s4">'center'</span><span class="s0">, </span><span class="s1">va=</span><span class="s4">'center'</span><span class="s1">)</span>
                <span class="s1">axes[i</span><span class="s0">, </span><span class="s1">i].set_xticks([])</span>
                <span class="s1">axes[i</span><span class="s0">, </span><span class="s1">i].set_xticklabels([])</span>
                <span class="s1">axes[i</span><span class="s0">, </span><span class="s1">i].set_yticks([])</span>
                <span class="s1">axes[i</span><span class="s0">, </span><span class="s1">i].set_yticklabels([])</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">ji = max(i</span><span class="s0">, </span><span class="s1">j)</span>
                <span class="s1">ij = min(i</span><span class="s0">, </span><span class="s1">j)</span>
                <span class="s1">temp_data = dict([((k[ij]</span><span class="s0">, </span><span class="s1">k[ji]) + tuple(k[r] </span><span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">m)</span><span class="s0">, </span><span class="s1">v)</span>
                                  <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">data.items()])</span>

                <span class="s1">keys = list(temp_data.keys())</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">keys:</span>
                    <span class="s1">value = _reduce_dict(temp_data</span><span class="s0">, </span><span class="s1">k[:</span><span class="s3">2</span><span class="s1">])</span>
                    <span class="s1">temp_data[k[:</span><span class="s3">2</span><span class="s1">]] = value</span>
                    <span class="s0">del </span><span class="s1">temp_data[k]</span>
                <span class="s1">mosaic(temp_data</span><span class="s0">, </span><span class="s1">ax=axes[i</span><span class="s0">, </span><span class="s1">j]</span><span class="s0">, </span><span class="s1">axes_label=</span><span class="s0">False,</span>
                       <span class="s1">properties=props</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">horizontal=i &gt; j)</span>
    <span class="s1">plt.suptitle(</span><span class="s4">'old males should look bright red,  (plot 4 of 4)'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_axes_labeling(close_figures):</span>
    <span class="s0">from </span><span class="s1">numpy.random </span><span class="s0">import </span><span class="s1">rand</span>
    <span class="s1">key_set = ([</span><span class="s4">'male'</span><span class="s0">, </span><span class="s4">'female'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'old'</span><span class="s0">, </span><span class="s4">'adult'</span><span class="s0">, </span><span class="s4">'young'</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">'worker'</span><span class="s0">, </span><span class="s4">'unemployed'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'yes'</span><span class="s0">, </span><span class="s4">'no'</span><span class="s1">])</span>
    <span class="s2"># the cartesian product of all the categories is</span>
    <span class="s2"># the complete set of categories</span>
    <span class="s1">keys = list(product(*key_set))</span>
    <span class="s1">data = dict(zip(keys</span><span class="s0">, </span><span class="s1">rand(len(keys))))</span>
    <span class="s1">lab = </span><span class="s0">lambda </span><span class="s1">k: </span><span class="s4">''</span><span class="s1">.join(s[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">k)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">16</span><span class="s0">, </span><span class="s3">8</span><span class="s1">))</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax1</span><span class="s0">, </span><span class="s1">labelizer=lab</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True, </span><span class="s1">label_rotation=</span><span class="s3">45</span><span class="s1">)</span>
    <span class="s1">mosaic(data</span><span class="s0">, </span><span class="s1">ax=ax2</span><span class="s0">, </span><span class="s1">labelizer=lab</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False,</span>
           <span class="s1">label_rotation=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">45</span><span class="s0">, </span><span class="s3">90</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s2">#fig.tight_layout()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;correct alignment of the axes labels&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.smoke</span>
<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_mosaic_empty_cells(close_figures):</span>
    <span class="s2"># GH#2286</span>
    <span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
    <span class="s1">mydata = pd.DataFrame({</span><span class="s4">'id2'</span><span class="s1">: {</span><span class="s3">64</span><span class="s1">: </span><span class="s4">'Angelica'</span><span class="s0">,</span>
                                   <span class="s3">65</span><span class="s1">: </span><span class="s4">'DXW_UID'</span><span class="s0">, </span><span class="s3">66</span><span class="s1">: </span><span class="s4">'casuid01'</span><span class="s0">,</span>
                                   <span class="s3">67</span><span class="s1">: </span><span class="s4">'casuid01'</span><span class="s0">, </span><span class="s3">68</span><span class="s1">: </span><span class="s4">'EC93_uid'</span><span class="s0">,</span>
                                   <span class="s3">69</span><span class="s1">: </span><span class="s4">'EC93_uid'</span><span class="s0">, </span><span class="s3">70</span><span class="s1">: </span><span class="s4">'EC93_uid'</span><span class="s0">,</span>
                                   <span class="s3">60</span><span class="s1">: </span><span class="s4">'DXW_UID'</span><span class="s0">,  </span><span class="s3">61</span><span class="s1">: </span><span class="s4">'AtmosFox'</span><span class="s0">,</span>
                                   <span class="s3">62</span><span class="s1">: </span><span class="s4">'DXW_UID'</span><span class="s0">, </span><span class="s3">63</span><span class="s1">: </span><span class="s4">'DXW_UID'</span><span class="s1">}</span><span class="s0">,</span>
                           <span class="s4">'id1'</span><span class="s1">: {</span><span class="s3">64</span><span class="s1">: </span><span class="s4">'TGP'</span><span class="s0">,</span>
                                   <span class="s3">65</span><span class="s1">: </span><span class="s4">'Retention01'</span><span class="s0">, </span><span class="s3">66</span><span class="s1">: </span><span class="s4">'default'</span><span class="s0">,</span>
                                   <span class="s3">67</span><span class="s1">: </span><span class="s4">'default'</span><span class="s0">, </span><span class="s3">68</span><span class="s1">: </span><span class="s4">'Musa_EC_9_3'</span><span class="s0">,</span>
                                   <span class="s3">69</span><span class="s1">: </span><span class="s4">'Musa_EC_9_3'</span><span class="s0">, </span><span class="s3">70</span><span class="s1">: </span><span class="s4">'Musa_EC_9_3'</span><span class="s0">,</span>
                                   <span class="s3">60</span><span class="s1">: </span><span class="s4">'default'</span><span class="s0">, </span><span class="s3">61</span><span class="s1">: </span><span class="s4">'default'</span><span class="s0">,</span>
                                   <span class="s3">62</span><span class="s1">: </span><span class="s4">'default'</span><span class="s0">, </span><span class="s3">63</span><span class="s1">: </span><span class="s4">'default'</span><span class="s1">}})</span>

    <span class="s1">ct = pd.crosstab(mydata.id1</span><span class="s0">, </span><span class="s1">mydata.id2)</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">vals = mosaic(ct.T.unstack())</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">vals = mosaic(mydata</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'id1'</span><span class="s0">,</span><span class="s4">'id2'</span><span class="s1">])</span>


<span class="s1">eq = </span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y: assert_(np.allclose(x</span><span class="s0">, </span><span class="s1">y))</span>


<span class="s0">def </span><span class="s1">test_recursive_split():</span>
    <span class="s1">keys = list(product(</span><span class="s4">'mf'</span><span class="s1">))</span>
    <span class="s1">data = dict(zip(keys</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">] * len(keys)))</span>
    <span class="s1">res = _hierarchical_split(data</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">assert_(list(res.keys()) == keys)</span>
    <span class="s1">res[(</span><span class="s4">'m'</span><span class="s0">,</span><span class="s1">)] = (</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'f'</span><span class="s0">,</span><span class="s1">)] = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s1">keys = list(product(</span><span class="s4">'mf'</span><span class="s0">, </span><span class="s4">'yao'</span><span class="s1">))</span>
    <span class="s1">data = dict(zip(keys</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">] * len(keys)))</span>
    <span class="s1">res = _hierarchical_split(data</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">assert_(list(res.keys()) == keys)</span>
    <span class="s1">res[(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'y'</span><span class="s1">)] = (</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'a'</span><span class="s1">)] = (</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">)] = (</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'f'</span><span class="s0">, </span><span class="s4">'y'</span><span class="s1">)] = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'f'</span><span class="s0">, </span><span class="s4">'a'</span><span class="s1">)] = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">res[(</span><span class="s4">'f'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">)] = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test__reduce_dict():</span>
    <span class="s1">data = dict(zip(list(product(</span><span class="s4">'mf'</span><span class="s0">, </span><span class="s4">'oy'</span><span class="s0">, </span><span class="s4">'wn'</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">] * </span><span class="s3">8</span><span class="s1">))</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">,</span><span class="s1">))</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s4">'w'</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">data = dict(zip(list(product(</span><span class="s4">'mf'</span><span class="s0">, </span><span class="s4">'oy'</span><span class="s0">, </span><span class="s4">'wn'</span><span class="s1">))</span><span class="s0">, </span><span class="s1">lrange(</span><span class="s3">8</span><span class="s1">)))</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">,</span><span class="s1">))</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">eq(_reduce_dict(data</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'m'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s4">'w'</span><span class="s1">))</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test__key_splitting():</span>
    <span class="s2"># subdivide starting with an empty tuple</span>
    <span class="s1">base_rect = {tuple(): (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)}</span>
    <span class="s1">res = _key_splitting(base_rect</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, True, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">assert_(list(res.keys()) == [(</span><span class="s4">'a'</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'b'</span><span class="s0">,</span><span class="s1">)])</span>
    <span class="s1">eq(res[(</span><span class="s4">'a'</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">eq(res[(</span><span class="s4">'b'</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s2"># subdivide a in two sublevel</span>
    <span class="s1">res_bis = _key_splitting(res</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'c'</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'a'</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, False, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">assert_(list(res_bis.keys()) == [(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'c'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'b'</span><span class="s0">,</span><span class="s1">)])</span>
    <span class="s1">eq(res_bis[(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'c'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">eq(res_bis[(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">eq(res_bis[(</span><span class="s4">'b'</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s2"># starting with a non empty tuple and uneven distribution</span>
    <span class="s1">base_rect = {(</span><span class="s4">'total'</span><span class="s0">,</span><span class="s1">): (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)}</span>
    <span class="s1">res = _key_splitting(base_rect</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'total'</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, True, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">assert_(list(res.keys()) == [(</span><span class="s4">'total'</span><span class="s0">,</span><span class="s1">) + (e</span><span class="s0">,</span><span class="s1">) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]])</span>
    <span class="s1">eq(res[(</span><span class="s4">'total'</span><span class="s0">, </span><span class="s4">'a'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">eq(res[(</span><span class="s4">'total'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_proportion_normalization():</span>
    <span class="s2"># extremes should give the whole set, as well</span>
    <span class="s2"># as if 0 is inserted</span>
    <span class="s1">eq(_normalize_split(</span><span class="s3">0.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s1">eq(_normalize_split(</span><span class="s3">1.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s1">eq(_normalize_split(</span><span class="s3">2.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s2"># negative values should raise ValueError</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_normalize_split</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_normalize_split</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_normalize_split</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">])</span>
    <span class="s2"># if everything is zero it will complain</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_normalize_split</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s1">])</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_normalize_split</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">])</span>
    <span class="s2"># one-element array should return the whole interval</span>
    <span class="s1">eq(_normalize_split([</span><span class="s3">0.5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s1">eq(_normalize_split([</span><span class="s3">1.</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s1">eq(_normalize_split([</span><span class="s3">2.</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s2"># simple division should give two pieces</span>
    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]:</span>
        <span class="s1">eq(_normalize_split(x)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s2"># multiple division should split as the sum of the components</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">[(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">30.</span><span class="s1">)]:</span>
        <span class="s1">eq(_normalize_split([x</span><span class="s0">, </span><span class="s1">y])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s1">x / (x + y)</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z </span><span class="s0">in </span><span class="s1">[(</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">30.</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)]:</span>
        <span class="s1">eq(_normalize_split(</span>
            <span class="s1">[x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s1">x / (x + y + z)</span><span class="s0">, </span><span class="s1">(x + y) / (x + y + z)</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_false_split():</span>
    <span class="s2"># if you ask it to be divided in only one piece, just return the original</span>
    <span class="s2"># one</span>
    <span class="s1">pure_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">pure_square)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">pure_square)</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">pure_square)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">pure_square)</span>

    <span class="s2"># identity on a void rectangle should not give anything strange</span>
    <span class="s1">null_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">]</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*null_square</span><span class="s0">, </span><span class="s1">**conf)</span><span class="s0">, </span><span class="s1">null_square)</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*null_square</span><span class="s0">, </span><span class="s1">**conf)</span><span class="s0">, </span><span class="s1">null_square)</span>

    <span class="s2"># splitting a negative rectangle should raise error</span>
    <span class="s1">neg_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">]</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_split_rect</span><span class="s0">, </span><span class="s1">*neg_square</span><span class="s0">, </span><span class="s1">**conf)</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_split_rect</span><span class="s0">, </span><span class="s1">*neg_square</span><span class="s0">, </span><span class="s1">**conf)</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_split_rect</span><span class="s0">, </span><span class="s1">*neg_square</span><span class="s0">, </span><span class="s1">**conf)</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">_split_rect</span><span class="s0">, </span><span class="s1">*neg_square</span><span class="s0">, </span><span class="s1">**conf)</span>


<span class="s0">def </span><span class="s1">test_rect_pure_split():</span>
    <span class="s1">pure_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span>
    <span class="s2"># division in two equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>

    <span class="s2"># division in two non-equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>

    <span class="s2"># division in three equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">,</span>
                 <span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">,</span>
                 <span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>

    <span class="s2"># division in three non-equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">,</span>
                 <span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">3 </span><span class="s1">/ </span><span class="s3">4</span><span class="s0">,</span>
                 <span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">4</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>

    <span class="s2"># splitting on a void rectangle should give multiple void</span>
    <span class="s1">null_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">]</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*null_square</span><span class="s0">, </span><span class="s1">**conf)</span><span class="s0">, </span><span class="s1">[null_square</span><span class="s0">, </span><span class="s1">null_square])</span>
    <span class="s1">conf = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*null_square</span><span class="s0">, </span><span class="s1">**conf)</span><span class="s0">, </span><span class="s1">[null_square</span><span class="s0">, </span><span class="s1">null_square])</span>


<span class="s0">def </span><span class="s1">test_rect_deformed_split():</span>
    <span class="s1">non_pure_square = [</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s2"># division in two equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*non_pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*non_pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>

    <span class="s2"># division in two non-equal pieces from the perfect square</span>
    <span class="s1">h_2split = [(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1 </span><span class="s1">+ </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*non_pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s1">v_2split = [(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">6 </span><span class="s1">- </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">/ </span><span class="s3">6</span><span class="s1">)]</span>
    <span class="s1">conf_v = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*non_pure_square</span><span class="s0">, </span><span class="s1">**conf_v)</span><span class="s0">, </span><span class="s1">v_2split)</span>


<span class="s0">def </span><span class="s1">test_gap_split():</span>
    <span class="s1">pure_square = [</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span>

    <span class="s2"># null split</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">pure_square)</span>

    <span class="s2"># equal split</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>

    <span class="s2"># disequal split</span>
    <span class="s1">h_2split = [(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">6</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5 </span><span class="s1">+ </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">6</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1 </span><span class="s1">/ </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span>
    <span class="s1">conf_h = dict(proportion=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gap=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">horizontal=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">eq(_split_rect(*pure_square</span><span class="s0">, </span><span class="s1">**conf_h)</span><span class="s0">, </span><span class="s1">h_2split)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_default_arg_index(close_figures):</span>
    <span class="s2"># 2116</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s4">'size' </span><span class="s1">: [</span><span class="s4">'small'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">, </span><span class="s4">'small'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">,</span>
                                 <span class="s4">'small'</span><span class="s1">]</span><span class="s0">,</span>
                       <span class="s4">'length' </span><span class="s1">: [</span><span class="s4">'long'</span><span class="s0">, </span><span class="s4">'short'</span><span class="s0">, </span><span class="s4">'short'</span><span class="s0">, </span><span class="s4">'long'</span><span class="s0">, </span><span class="s4">'long'</span><span class="s0">,</span>
                                   <span class="s4">'short'</span><span class="s1">]})</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">mosaic</span><span class="s0">, </span><span class="s1">data=df</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">'foobar'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.matplotlib</span>
<span class="s0">def </span><span class="s1">test_missing_category(close_figures):</span>
    <span class="s2"># GH5639</span>
    <span class="s1">animal = [</span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s0">,</span>
              <span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'dog'</span><span class="s0">, </span><span class="s4">'cat'</span><span class="s1">]</span>
    <span class="s1">size = [</span><span class="s4">'medium'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s0">,</span>
            <span class="s4">'large'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s0">, </span><span class="s4">'small'</span><span class="s1">]</span>
    <span class="s1">testdata = pd.DataFrame({</span><span class="s4">'animal'</span><span class="s1">: animal</span><span class="s0">, </span><span class="s4">'size'</span><span class="s1">: size})</span>
    <span class="s1">testdata[</span><span class="s4">'size'</span><span class="s1">] = pd.Categorical(testdata[</span><span class="s4">'size'</span><span class="s1">]</span><span class="s0">,</span>
                                      <span class="s1">categories=[</span><span class="s4">'small'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s0">, </span><span class="s4">'large'</span><span class="s1">])</span>
    <span class="s1">testdata = testdata.sort_values(</span><span class="s4">'size'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">_ = mosaic(testdata</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'animal'</span><span class="s0">, </span><span class="s4">'size'</span><span class="s1">])</span>
    <span class="s1">bio = BytesIO()</span>
    <span class="s1">fig.savefig(bio</span><span class="s0">, </span><span class="s1">format=</span><span class="s4">'png'</span><span class="s1">)</span>
</pre>
</body>
</html>
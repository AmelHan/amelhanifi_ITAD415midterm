<html>
<head>
<title>test_odr.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_odr.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">tempfile</span>
<span class="s0">import </span><span class="s1">shutil</span>
<span class="s0">import </span><span class="s1">os</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">pi</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(assert_array_almost_equal</span><span class="s0">,</span>
                           <span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_warns</span><span class="s0">,</span>
                           <span class="s1">assert_allclose)</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy.odr </span><span class="s0">import </span><span class="s1">(Data</span><span class="s0">, </span><span class="s1">Model</span><span class="s0">, </span><span class="s1">ODR</span><span class="s0">, </span><span class="s1">RealData</span><span class="s0">, </span><span class="s1">OdrStop</span><span class="s0">, </span><span class="s1">OdrWarning</span><span class="s0">,</span>
                       <span class="s1">multilinear</span><span class="s0">, </span><span class="s1">exponential</span><span class="s0">, </span><span class="s1">unilinear</span><span class="s0">, </span><span class="s1">quadratic</span><span class="s0">,</span>
                       <span class="s1">polynomial)</span>


<span class="s0">class </span><span class="s1">TestODR:</span>

    <span class="s2"># Bad Data for 'x'</span>

    <span class="s0">def </span><span class="s1">test_bad_data(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">Data</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">RealData</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2"># Empty Data for 'x'</span>
    <span class="s0">def </span><span class="s1">empty_data_func(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s0">return </span><span class="s1">B[</span><span class="s3">0</span><span class="s1">]*x + B[</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_empty_data(self):</span>
        <span class="s1">beta0 = [</span><span class="s3">0.02</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]</span>
        <span class="s1">linear = Model(self.empty_data_func)</span>

        <span class="s1">empty_dat = Data([]</span><span class="s0">, </span><span class="s1">[])</span>
        <span class="s1">assert_warns(OdrWarning</span><span class="s0">, </span><span class="s1">ODR</span><span class="s0">,</span>
                     <span class="s1">empty_dat</span><span class="s0">, </span><span class="s1">linear</span><span class="s0">, </span><span class="s1">beta0=beta0)</span>

        <span class="s1">empty_dat = RealData([]</span><span class="s0">, </span><span class="s1">[])</span>
        <span class="s1">assert_warns(OdrWarning</span><span class="s0">, </span><span class="s1">ODR</span><span class="s0">,</span>
                     <span class="s1">empty_dat</span><span class="s0">, </span><span class="s1">linear</span><span class="s0">, </span><span class="s1">beta0=beta0)</span>

    <span class="s2"># Explicit Example</span>

    <span class="s0">def </span><span class="s1">explicit_fcn(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s1">ret = B[</span><span class="s3">0</span><span class="s1">] + B[</span><span class="s3">1</span><span class="s1">] * np.power(np.exp(B[</span><span class="s3">2</span><span class="s1">]*x) - </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">ret</span>

    <span class="s0">def </span><span class="s1">explicit_fjd(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s1">eBx = np.exp(B[</span><span class="s3">2</span><span class="s1">]*x)</span>
        <span class="s1">ret = B[</span><span class="s3">1</span><span class="s1">] * </span><span class="s3">2.0 </span><span class="s1">* (eBx-</span><span class="s3">1.0</span><span class="s1">) * B[</span><span class="s3">2</span><span class="s1">] * eBx</span>
        <span class="s0">return </span><span class="s1">ret</span>

    <span class="s0">def </span><span class="s1">explicit_fjb(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s1">eBx = np.exp(B[</span><span class="s3">2</span><span class="s1">]*x)</span>
        <span class="s1">res = np.vstack([np.ones(x.shape[-</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
                         <span class="s1">np.power(eBx-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                         <span class="s1">B[</span><span class="s3">1</span><span class="s1">]*</span><span class="s3">2.0</span><span class="s1">*(eBx-</span><span class="s3">1.0</span><span class="s1">)*eBx*x])</span>
        <span class="s0">return </span><span class="s1">res</span>

    <span class="s0">def </span><span class="s1">test_explicit(self):</span>
        <span class="s1">explicit_mod = Model(</span>
            <span class="s1">self.explicit_fcn</span><span class="s0">,</span>
            <span class="s1">fjacb=self.explicit_fjb</span><span class="s0">,</span>
            <span class="s1">fjacd=self.explicit_fjd</span><span class="s0">,</span>
            <span class="s1">meta=dict(name=</span><span class="s4">'Sample Explicit Model'</span><span class="s0">,</span>
                      <span class="s1">ref=</span><span class="s4">'ODRPACK UG, pg. 39'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">explicit_dat = Data([</span><span class="s3">0.</span><span class="s0">,</span><span class="s3">0.</span><span class="s0">,</span><span class="s3">5.</span><span class="s0">,</span><span class="s3">7.</span><span class="s0">,</span><span class="s3">7.5</span><span class="s0">,</span><span class="s3">10.</span><span class="s0">,</span><span class="s3">16.</span><span class="s0">,</span><span class="s3">26.</span><span class="s0">,</span><span class="s3">30.</span><span class="s0">,</span><span class="s3">34.</span><span class="s0">,</span><span class="s3">34.5</span><span class="s0">,</span><span class="s3">100.</span><span class="s1">]</span><span class="s0">,</span>
                        <span class="s1">[</span><span class="s3">1265.</span><span class="s0">,</span><span class="s3">1263.6</span><span class="s0">,</span><span class="s3">1258.</span><span class="s0">,</span><span class="s3">1254.</span><span class="s0">,</span><span class="s3">1253.</span><span class="s0">,</span><span class="s3">1249.8</span><span class="s0">,</span><span class="s3">1237.</span><span class="s0">,</span><span class="s3">1218.</span><span class="s0">,</span><span class="s3">1220.6</span><span class="s0">,</span>
                         <span class="s3">1213.8</span><span class="s0">,</span><span class="s3">1215.5</span><span class="s0">,</span><span class="s3">1212.</span><span class="s1">])</span>
        <span class="s1">explicit_odr = ODR(explicit_dat</span><span class="s0">, </span><span class="s1">explicit_mod</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">1500.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">50.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s1">]</span><span class="s0">,</span>
                       <span class="s1">ifixx=[</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">explicit_odr.set_job(deriv=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">explicit_odr.set_iprint(init=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">iter=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">final=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">out = explicit_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">1.2646548050648876e+03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5.4018409956678255e+01</span><span class="s0">,</span>
                <span class="s1">-</span><span class="s3">8.7849712165253724e-02</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">1.0349270280543437</span><span class="s0">, </span><span class="s3">1.583997785262061</span><span class="s0">, </span><span class="s3">0.0063321988657267</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">4.4949592379003039e-01</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3.7421976890364739e-01</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">8.0978217468468912e-04</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">3.7421976890364739e-01</span><span class="s0">, </span><span class="s3">1.0529686462751804e+00</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">1.9453521827942002e-03</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">8.0978217468468912e-04</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.9453521827942002e-03</span><span class="s0">,</span>
                  <span class="s3">1.6827336938454476e-05</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s2"># Implicit Example</span>

    <span class="s0">def </span><span class="s1">implicit_fcn(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s0">return </span><span class="s1">(B[</span><span class="s3">2</span><span class="s1">]*np.power(x[</span><span class="s3">0</span><span class="s1">]-B[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">2</span><span class="s1">) +</span>
                <span class="s3">2.0</span><span class="s1">*B[</span><span class="s3">3</span><span class="s1">]*(x[</span><span class="s3">0</span><span class="s1">]-B[</span><span class="s3">0</span><span class="s1">])*(x[</span><span class="s3">1</span><span class="s1">]-B[</span><span class="s3">1</span><span class="s1">]) +</span>
                <span class="s1">B[</span><span class="s3">4</span><span class="s1">]*np.power(x[</span><span class="s3">1</span><span class="s1">]-B[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">2</span><span class="s1">) - </span><span class="s3">1.0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_implicit(self):</span>
        <span class="s1">implicit_mod = Model(</span>
            <span class="s1">self.implicit_fcn</span><span class="s0">,</span>
            <span class="s1">implicit=</span><span class="s3">1</span><span class="s0">,</span>
            <span class="s1">meta=dict(name=</span><span class="s4">'Sample Implicit Model'</span><span class="s0">,</span>
                      <span class="s1">ref=</span><span class="s4">'ODRPACK UG, pg. 49'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">implicit_dat = Data([</span>
            <span class="s1">[</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">1.2</span><span class="s0">,</span><span class="s3">1.6</span><span class="s0">,</span><span class="s3">1.86</span><span class="s0">,</span><span class="s3">2.12</span><span class="s0">,</span><span class="s3">2.36</span><span class="s0">,</span><span class="s3">2.44</span><span class="s0">,</span><span class="s3">2.36</span><span class="s0">,</span><span class="s3">2.06</span><span class="s0">,</span><span class="s3">1.74</span><span class="s0">,</span><span class="s3">1.34</span><span class="s0">,</span><span class="s3">0.9</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.28</span><span class="s0">,</span>
             <span class="s1">-</span><span class="s3">0.78</span><span class="s0">,</span><span class="s1">-</span><span class="s3">1.36</span><span class="s0">,</span><span class="s1">-</span><span class="s3">1.9</span><span class="s0">,</span><span class="s1">-</span><span class="s3">2.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">2.88</span><span class="s0">,</span><span class="s1">-</span><span class="s3">3.18</span><span class="s0">,</span><span class="s1">-</span><span class="s3">3.44</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">0.12</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.6</span><span class="s0">,</span><span class="s1">-</span><span class="s3">1.</span><span class="s0">,</span><span class="s1">-</span><span class="s3">1.4</span><span class="s0">,</span><span class="s1">-</span><span class="s3">2.54</span><span class="s0">,</span><span class="s1">-</span><span class="s3">3.36</span><span class="s0">,</span><span class="s1">-</span><span class="s3">4.</span><span class="s0">,</span><span class="s1">-</span><span class="s3">4.75</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.25</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.64</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.97</span><span class="s0">,</span><span class="s1">-</span><span class="s3">6.32</span><span class="s0">,</span>
             <span class="s1">-</span><span class="s3">6.44</span><span class="s0">,</span><span class="s1">-</span><span class="s3">6.44</span><span class="s0">,</span><span class="s1">-</span><span class="s3">6.41</span><span class="s0">,</span><span class="s1">-</span><span class="s3">6.25</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.88</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">5.24</span><span class="s0">,</span><span class="s1">-</span><span class="s3">4.86</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">1</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">implicit_odr = ODR(implicit_dat</span><span class="s0">, </span><span class="s1">implicit_mod</span><span class="s0">,</span>
            <span class="s1">beta0=[-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">0.09</span><span class="s0">, </span><span class="s3">0.02</span><span class="s0">, </span><span class="s3">0.08</span><span class="s1">])</span>

        <span class="s1">out = implicit_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.beta</span><span class="s0">,</span>
            <span class="s1">np.array([-</span><span class="s3">0.9993809167281279</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.9310484652026476</span><span class="s0">, </span><span class="s3">0.0875730502693354</span><span class="s0">,</span>
                <span class="s3">0.0162299708984738</span><span class="s0">, </span><span class="s3">0.0797537982976416</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">0.1113840353364371</span><span class="s0">, </span><span class="s3">0.1097673310686467</span><span class="s0">, </span><span class="s3">0.0041060738314314</span><span class="s0">,</span>
                <span class="s3">0.0027500347539902</span><span class="s0">, </span><span class="s3">0.0034962501532468</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">out.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">2.1089274602333052e+00</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.9437686411979040e+00</span><span class="s0">,</span>
                  <span class="s3">7.0263550868344446e-02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.7175267373474862e-02</span><span class="s0">,</span>
                  <span class="s3">5.2515575927380355e-02</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">1.9437686411979040e+00</span><span class="s0">, </span><span class="s3">2.0481509222414456e+00</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">6.1600515853057307e-02</span><span class="s0">, </span><span class="s3">4.6268827806232933e-02</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">5.8822307501391467e-02</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s3">7.0263550868344446e-02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6.1600515853057307e-02</span><span class="s0">,</span>
                  <span class="s3">2.8659542561579308e-03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.4628662260014491e-03</span><span class="s0">,</span>
                  <span class="s3">1.4528860663055824e-03</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">4.7175267373474862e-02</span><span class="s0">, </span><span class="s3">4.6268827806232933e-02</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">1.4628662260014491e-03</span><span class="s0">, </span><span class="s3">1.2855592885514335e-03</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">1.2692942951415293e-03</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s3">5.2515575927380355e-02</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5.8822307501391467e-02</span><span class="s0">,</span>
                  <span class="s3">1.4528860663055824e-03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.2692942951415293e-03</span><span class="s0">,</span>
                  <span class="s3">2.0778813389755596e-03</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">rtol=</span><span class="s3">1e-6</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">2e-6</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s2"># Multi-variable Example</span>

    <span class="s0">def </span><span class="s1">multi_fcn(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s0">if </span><span class="s1">(x &lt; </span><span class="s3">0.0</span><span class="s1">).any():</span>
            <span class="s0">raise </span><span class="s1">OdrStop</span>
        <span class="s1">theta = pi*B[</span><span class="s3">3</span><span class="s1">]/</span><span class="s3">2.</span>
        <span class="s1">ctheta = np.cos(theta)</span>
        <span class="s1">stheta = np.sin(theta)</span>
        <span class="s1">omega = np.power(</span><span class="s3">2.</span><span class="s1">*pi*x*np.exp(-B[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">B[</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">phi = np.arctan2((omega*stheta)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.0 </span><span class="s1">+ omega*ctheta))</span>
        <span class="s1">r = (B[</span><span class="s3">0</span><span class="s1">] - B[</span><span class="s3">1</span><span class="s1">]) * np.power(np.sqrt(np.power(</span><span class="s3">1.0 </span><span class="s1">+ omega*ctheta</span><span class="s0">, </span><span class="s3">2</span><span class="s1">) +</span>
             <span class="s1">np.power(omega*stheta</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">-B[</span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">ret = np.vstack([B[</span><span class="s3">1</span><span class="s1">] + r*np.cos(B[</span><span class="s3">4</span><span class="s1">]*phi)</span><span class="s0">,</span>
                         <span class="s1">r*np.sin(B[</span><span class="s3">4</span><span class="s1">]*phi)])</span>
        <span class="s0">return </span><span class="s1">ret</span>

    <span class="s0">def </span><span class="s1">test_multi(self):</span>
        <span class="s1">multi_mod = Model(</span>
            <span class="s1">self.multi_fcn</span><span class="s0">,</span>
            <span class="s1">meta=dict(name=</span><span class="s4">'Sample Multi-Response Model'</span><span class="s0">,</span>
                      <span class="s1">ref=</span><span class="s4">'ODRPACK UG, pg. 56'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">multi_x = np.array([</span><span class="s3">30.0</span><span class="s0">, </span><span class="s3">50.0</span><span class="s0">, </span><span class="s3">70.0</span><span class="s0">, </span><span class="s3">100.0</span><span class="s0">, </span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">200.0</span><span class="s0">, </span><span class="s3">300.0</span><span class="s0">, </span><span class="s3">500.0</span><span class="s0">,</span>
            <span class="s3">700.0</span><span class="s0">, </span><span class="s3">1000.0</span><span class="s0">, </span><span class="s3">1500.0</span><span class="s0">, </span><span class="s3">2000.0</span><span class="s0">, </span><span class="s3">3000.0</span><span class="s0">, </span><span class="s3">5000.0</span><span class="s0">, </span><span class="s3">7000.0</span><span class="s0">, </span><span class="s3">10000.0</span><span class="s0">,</span>
            <span class="s3">15000.0</span><span class="s0">, </span><span class="s3">20000.0</span><span class="s0">, </span><span class="s3">30000.0</span><span class="s0">, </span><span class="s3">50000.0</span><span class="s0">, </span><span class="s3">70000.0</span><span class="s0">, </span><span class="s3">100000.0</span><span class="s0">, </span><span class="s3">150000.0</span><span class="s1">])</span>
        <span class="s1">multi_y = np.array([</span>
            <span class="s1">[</span><span class="s3">4.22</span><span class="s0">, </span><span class="s3">4.167</span><span class="s0">, </span><span class="s3">4.132</span><span class="s0">, </span><span class="s3">4.038</span><span class="s0">, </span><span class="s3">4.019</span><span class="s0">, </span><span class="s3">3.956</span><span class="s0">, </span><span class="s3">3.884</span><span class="s0">, </span><span class="s3">3.784</span><span class="s0">, </span><span class="s3">3.713</span><span class="s0">,</span>
             <span class="s3">3.633</span><span class="s0">, </span><span class="s3">3.54</span><span class="s0">, </span><span class="s3">3.433</span><span class="s0">, </span><span class="s3">3.358</span><span class="s0">, </span><span class="s3">3.258</span><span class="s0">, </span><span class="s3">3.193</span><span class="s0">, </span><span class="s3">3.128</span><span class="s0">, </span><span class="s3">3.059</span><span class="s0">, </span><span class="s3">2.984</span><span class="s0">,</span>
             <span class="s3">2.934</span><span class="s0">, </span><span class="s3">2.876</span><span class="s0">, </span><span class="s3">2.838</span><span class="s0">, </span><span class="s3">2.798</span><span class="s0">, </span><span class="s3">2.759</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">0.136</span><span class="s0">, </span><span class="s3">0.167</span><span class="s0">, </span><span class="s3">0.188</span><span class="s0">, </span><span class="s3">0.212</span><span class="s0">, </span><span class="s3">0.236</span><span class="s0">, </span><span class="s3">0.257</span><span class="s0">, </span><span class="s3">0.276</span><span class="s0">, </span><span class="s3">0.297</span><span class="s0">, </span><span class="s3">0.309</span><span class="s0">,</span>
             <span class="s3">0.311</span><span class="s0">, </span><span class="s3">0.314</span><span class="s0">, </span><span class="s3">0.311</span><span class="s0">, </span><span class="s3">0.305</span><span class="s0">, </span><span class="s3">0.289</span><span class="s0">, </span><span class="s3">0.277</span><span class="s0">, </span><span class="s3">0.255</span><span class="s0">, </span><span class="s3">0.24</span><span class="s0">, </span><span class="s3">0.218</span><span class="s0">,</span>
             <span class="s3">0.202</span><span class="s0">, </span><span class="s3">0.182</span><span class="s0">, </span><span class="s3">0.168</span><span class="s0">, </span><span class="s3">0.153</span><span class="s0">, </span><span class="s3">0.139</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">])</span>
        <span class="s1">n = len(multi_x)</span>
        <span class="s1">multi_we = np.zeros((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">n)</span><span class="s0">, </span><span class="s1">dtype=float)</span>
        <span class="s1">multi_ifixx = np.ones(n</span><span class="s0">, </span><span class="s1">dtype=int)</span>
        <span class="s1">multi_delta = np.zeros(n</span><span class="s0">, </span><span class="s1">dtype=float)</span>

        <span class="s1">multi_we[</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s0">,</span><span class="s1">:] = </span><span class="s3">559.6</span>
        <span class="s1">multi_we[</span><span class="s3">1</span><span class="s0">,</span><span class="s3">0</span><span class="s0">,</span><span class="s1">:] = multi_we[</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s1">:] = -</span><span class="s3">1634.0</span>
        <span class="s1">multi_we[</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s0">,</span><span class="s1">:] = </span><span class="s3">8397.0</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(n):</span>
            <span class="s0">if </span><span class="s1">multi_x[i] &lt; </span><span class="s3">100.0</span><span class="s1">:</span>
                <span class="s1">multi_ifixx[i] = </span><span class="s3">0</span>
            <span class="s0">elif </span><span class="s1">multi_x[i] &lt;= </span><span class="s3">150.0</span><span class="s1">:</span>
                <span class="s0">pass  </span><span class="s2"># defaults are fine</span>
            <span class="s0">elif </span><span class="s1">multi_x[i] &lt;= </span><span class="s3">1000.0</span><span class="s1">:</span>
                <span class="s1">multi_delta[i] = </span><span class="s3">25.0</span>
            <span class="s0">elif </span><span class="s1">multi_x[i] &lt;= </span><span class="s3">10000.0</span><span class="s1">:</span>
                <span class="s1">multi_delta[i] = </span><span class="s3">560.0</span>
            <span class="s0">elif </span><span class="s1">multi_x[i] &lt;= </span><span class="s3">100000.0</span><span class="s1">:</span>
                <span class="s1">multi_delta[i] = </span><span class="s3">9500.0</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">multi_delta[i] = </span><span class="s3">144000.0</span>
            <span class="s0">if </span><span class="s1">multi_x[i] == </span><span class="s3">100.0 </span><span class="s0">or </span><span class="s1">multi_x[i] == </span><span class="s3">150.0</span><span class="s1">:</span>
                <span class="s1">multi_we[:</span><span class="s0">,</span><span class="s1">:</span><span class="s0">,</span><span class="s1">i] = </span><span class="s3">0.0</span>

        <span class="s1">multi_dat = Data(multi_x</span><span class="s0">, </span><span class="s1">multi_y</span><span class="s0">, </span><span class="s1">wd=</span><span class="s3">1e-4</span><span class="s1">/np.power(multi_x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">we=multi_we)</span>
        <span class="s1">multi_odr = ODR(multi_dat</span><span class="s0">, </span><span class="s1">multi_mod</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">4.</span><span class="s0">,</span><span class="s3">2.</span><span class="s0">,</span><span class="s3">7.</span><span class="s0">,</span><span class="s3">.4</span><span class="s0">,</span><span class="s3">.5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">delta0=multi_delta</span><span class="s0">, </span><span class="s1">ifixx=multi_ifixx)</span>
        <span class="s1">multi_odr.set_job(deriv=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">del_init=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">out = multi_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">4.3799880305938963</span><span class="s0">, </span><span class="s3">2.4333057577497703</span><span class="s0">, </span><span class="s3">8.0028845899503978</span><span class="s0">,</span>
                <span class="s3">0.5101147161764654</span><span class="s0">, </span><span class="s3">0.5173902330489161</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">0.0130625231081944</span><span class="s0">, </span><span class="s3">0.0130499785273277</span><span class="s0">, </span><span class="s3">0.1167085962217757</span><span class="s0">,</span>
                <span class="s3">0.0132642749596149</span><span class="s0">, </span><span class="s3">0.0288529201353984</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">0.0064918418231375</span><span class="s0">, </span><span class="s3">0.0036159705923791</span><span class="s0">, </span><span class="s3">0.0438637051470406</span><span class="s0">,</span>
                <span class="s1">-</span><span class="s3">0.0058700836512467</span><span class="s0">, </span><span class="s3">0.011281212888768</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s3">0.0036159705923791</span><span class="s0">, </span><span class="s3">0.0064793789429006</span><span class="s0">, </span><span class="s3">0.0517610978353126</span><span class="s0">,</span>
                <span class="s1">-</span><span class="s3">0.0051181304940204</span><span class="s0">, </span><span class="s3">0.0130726943624117</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s3">0.0438637051470406</span><span class="s0">, </span><span class="s3">0.0517610978353126</span><span class="s0">, </span><span class="s3">0.5182263323095322</span><span class="s0">,</span>
                <span class="s1">-</span><span class="s3">0.0563083340093696</span><span class="s0">, </span><span class="s3">0.1269490939468611</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">0.0058700836512467</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0051181304940204</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0563083340093696</span><span class="s0">,</span>
                 <span class="s3">0.0066939246261263</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0140184391377962</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s3">0.011281212888768</span><span class="s0">, </span><span class="s3">0.0130726943624117</span><span class="s0">, </span><span class="s3">0.1269490939468611</span><span class="s0">,</span>
                <span class="s1">-</span><span class="s3">0.0140184391377962</span><span class="s0">, </span><span class="s3">0.0316733013820852</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s2"># Pearson's Data</span>
    <span class="s2"># K. Pearson, Philosophical Magazine, 2, 559 (1901)</span>

    <span class="s0">def </span><span class="s1">pearson_fcn(self</span><span class="s0">, </span><span class="s1">B</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s0">return </span><span class="s1">B[</span><span class="s3">0</span><span class="s1">] + B[</span><span class="s3">1</span><span class="s1">]*x</span>

    <span class="s0">def </span><span class="s1">test_pearson(self):</span>
        <span class="s1">p_x = np.array([</span><span class="s3">0.</span><span class="s0">,</span><span class="s3">.9</span><span class="s0">,</span><span class="s3">1.8</span><span class="s0">,</span><span class="s3">2.6</span><span class="s0">,</span><span class="s3">3.3</span><span class="s0">,</span><span class="s3">4.4</span><span class="s0">,</span><span class="s3">5.2</span><span class="s0">,</span><span class="s3">6.1</span><span class="s0">,</span><span class="s3">6.5</span><span class="s0">,</span><span class="s3">7.4</span><span class="s1">])</span>
        <span class="s1">p_y = np.array([</span><span class="s3">5.9</span><span class="s0">,</span><span class="s3">5.4</span><span class="s0">,</span><span class="s3">4.4</span><span class="s0">,</span><span class="s3">4.6</span><span class="s0">,</span><span class="s3">3.5</span><span class="s0">,</span><span class="s3">3.7</span><span class="s0">,</span><span class="s3">2.8</span><span class="s0">,</span><span class="s3">2.8</span><span class="s0">,</span><span class="s3">2.4</span><span class="s0">,</span><span class="s3">1.5</span><span class="s1">])</span>
        <span class="s1">p_sx = np.array([</span><span class="s3">.03</span><span class="s0">,</span><span class="s3">.03</span><span class="s0">,</span><span class="s3">.04</span><span class="s0">,</span><span class="s3">.035</span><span class="s0">,</span><span class="s3">.07</span><span class="s0">,</span><span class="s3">.11</span><span class="s0">,</span><span class="s3">.13</span><span class="s0">,</span><span class="s3">.22</span><span class="s0">,</span><span class="s3">.74</span><span class="s0">,</span><span class="s3">1.</span><span class="s1">])</span>
        <span class="s1">p_sy = np.array([</span><span class="s3">1.</span><span class="s0">,</span><span class="s3">.74</span><span class="s0">,</span><span class="s3">.5</span><span class="s0">,</span><span class="s3">.35</span><span class="s0">,</span><span class="s3">.22</span><span class="s0">,</span><span class="s3">.22</span><span class="s0">,</span><span class="s3">.12</span><span class="s0">,</span><span class="s3">.12</span><span class="s0">,</span><span class="s3">.1</span><span class="s0">,</span><span class="s3">.04</span><span class="s1">])</span>

        <span class="s1">p_dat = RealData(p_x</span><span class="s0">, </span><span class="s1">p_y</span><span class="s0">, </span><span class="s1">sx=p_sx</span><span class="s0">, </span><span class="s1">sy=p_sy)</span>

        <span class="s2"># Reverse the data to test invariance of results</span>
        <span class="s1">pr_dat = RealData(p_y</span><span class="s0">, </span><span class="s1">p_x</span><span class="s0">, </span><span class="s1">sx=p_sy</span><span class="s0">, </span><span class="s1">sy=p_sx)</span>

        <span class="s1">p_mod = Model(self.pearson_fcn</span><span class="s0">, </span><span class="s1">meta=dict(name=</span><span class="s4">'Uni-linear Fit'</span><span class="s1">))</span>

        <span class="s1">p_odr = ODR(p_dat</span><span class="s0">, </span><span class="s1">p_mod</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">1.</span><span class="s0">,</span><span class="s3">1.</span><span class="s1">])</span>
        <span class="s1">pr_odr = ODR(pr_dat</span><span class="s0">, </span><span class="s1">p_mod</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">1.</span><span class="s0">,</span><span class="s3">1.</span><span class="s1">])</span>

        <span class="s1">out = p_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">5.4767400299231674</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.4796082367610305</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">0.3590121690702467</span><span class="s0">, </span><span class="s3">0.0706291186037444</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">0.0854275622946333</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0161807025443155</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">0.0161807025443155</span><span class="s0">, </span><span class="s3">0.003306337993922</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">rout = pr_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">rout.beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">11.4192022410781231</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.0850374506165474</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">rout.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">0.9820231665657161</span><span class="s0">, </span><span class="s3">0.3070515616198911</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">rout.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">0.6391799462548782</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1955657291119177</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">0.1955657291119177</span><span class="s0">, </span><span class="s3">0.0624888159223392</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s2"># Lorentz Peak</span>
    <span class="s2"># The data is taken from one of the undergraduate physics labs I performed.</span>

    <span class="s0">def </span><span class="s1">lorentz(self</span><span class="s0">, </span><span class="s1">beta</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s0">return </span><span class="s1">(beta[</span><span class="s3">0</span><span class="s1">]*beta[</span><span class="s3">1</span><span class="s1">]*beta[</span><span class="s3">2</span><span class="s1">] / np.sqrt(np.power(x*x -</span>
            <span class="s1">beta[</span><span class="s3">2</span><span class="s1">]*beta[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">) + np.power(beta[</span><span class="s3">1</span><span class="s1">]*x</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_lorentz(self):</span>
        <span class="s1">l_sy = np.array([</span><span class="s3">.29</span><span class="s1">]*</span><span class="s3">18</span><span class="s1">)</span>
        <span class="s1">l_sx = np.array([</span><span class="s3">.000972971</span><span class="s0">,</span><span class="s3">.000948268</span><span class="s0">,</span><span class="s3">.000707632</span><span class="s0">,</span><span class="s3">.000706679</span><span class="s0">,</span>
            <span class="s3">.000706074</span><span class="s0">, </span><span class="s3">.000703918</span><span class="s0">,</span><span class="s3">.000698955</span><span class="s0">,</span><span class="s3">.000456856</span><span class="s0">,</span>
            <span class="s3">.000455207</span><span class="s0">,</span><span class="s3">.000662717</span><span class="s0">,</span><span class="s3">.000654619</span><span class="s0">,</span><span class="s3">.000652694</span><span class="s0">,</span>
            <span class="s3">.000000859202</span><span class="s0">,</span><span class="s3">.00106589</span><span class="s0">,</span><span class="s3">.00106378</span><span class="s0">,</span><span class="s3">.00125483</span><span class="s0">, </span><span class="s3">.00140818</span><span class="s0">,</span><span class="s3">.00241839</span><span class="s1">])</span>

        <span class="s1">l_dat = RealData(</span>
            <span class="s1">[</span><span class="s3">3.9094</span><span class="s0">, </span><span class="s3">3.85945</span><span class="s0">, </span><span class="s3">3.84976</span><span class="s0">, </span><span class="s3">3.84716</span><span class="s0">, </span><span class="s3">3.84551</span><span class="s0">, </span><span class="s3">3.83964</span><span class="s0">, </span><span class="s3">3.82608</span><span class="s0">,</span>
             <span class="s3">3.78847</span><span class="s0">, </span><span class="s3">3.78163</span><span class="s0">, </span><span class="s3">3.72558</span><span class="s0">, </span><span class="s3">3.70274</span><span class="s0">, </span><span class="s3">3.6973</span><span class="s0">, </span><span class="s3">3.67373</span><span class="s0">, </span><span class="s3">3.65982</span><span class="s0">,</span>
             <span class="s3">3.6562</span><span class="s0">, </span><span class="s3">3.62498</span><span class="s0">, </span><span class="s3">3.55525</span><span class="s0">, </span><span class="s3">3.41886</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">652</span><span class="s0">, </span><span class="s3">910.5</span><span class="s0">, </span><span class="s3">984</span><span class="s0">, </span><span class="s3">1000</span><span class="s0">, </span><span class="s3">1007.5</span><span class="s0">, </span><span class="s3">1053</span><span class="s0">, </span><span class="s3">1160.5</span><span class="s0">, </span><span class="s3">1409.5</span><span class="s0">, </span><span class="s3">1430</span><span class="s0">, </span><span class="s3">1122</span><span class="s0">,</span>
             <span class="s3">957.5</span><span class="s0">, </span><span class="s3">920</span><span class="s0">, </span><span class="s3">777.5</span><span class="s0">, </span><span class="s3">709.5</span><span class="s0">, </span><span class="s3">698</span><span class="s0">, </span><span class="s3">578.5</span><span class="s0">, </span><span class="s3">418.5</span><span class="s0">, </span><span class="s3">275.5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">sx=l_sx</span><span class="s0">,</span>
            <span class="s1">sy=l_sy</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">l_mod = Model(self.lorentz</span><span class="s0">, </span><span class="s1">meta=dict(name=</span><span class="s4">'Lorentz Peak'</span><span class="s1">))</span>
        <span class="s1">l_odr = ODR(l_dat</span><span class="s0">, </span><span class="s1">l_mod</span><span class="s0">, </span><span class="s1">beta0=(</span><span class="s3">1000.</span><span class="s0">, </span><span class="s3">.1</span><span class="s0">, </span><span class="s3">3.8</span><span class="s1">))</span>

        <span class="s1">out = l_odr.run()</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">1.4306780846149925e+03</span><span class="s0">, </span><span class="s3">1.3390509034538309e-01</span><span class="s0">,</span>
                 <span class="s3">3.7798193600109009e+00</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.sd_beta</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s3">7.3621186811330963e-01</span><span class="s0">, </span><span class="s3">3.5068899941471650e-04</span><span class="s0">,</span>
                 <span class="s3">2.4451209281408992e-04</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">out.cov_beta</span><span class="s0">,</span>
            <span class="s1">np.array([[</span><span class="s3">2.4714409064597873e-01</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6.9067261911110836e-05</span><span class="s0">,</span>
                 <span class="s1">-</span><span class="s3">3.1236953270424990e-05</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">6.9067261911110836e-05</span><span class="s0">, </span><span class="s3">5.6077531517333009e-08</span><span class="s0">,</span>
                  <span class="s3">3.6133261832722601e-08</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[-</span><span class="s3">3.1236953270424990e-05</span><span class="s0">, </span><span class="s3">3.6133261832722601e-08</span><span class="s0">,</span>
                  <span class="s3">2.7261220025171730e-08</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_ticket_1253(self):</span>
        <span class="s0">def </span><span class="s1">linear(c</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s0">return </span><span class="s1">c[</span><span class="s3">0</span><span class="s1">]*x+c[</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">c = [</span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">y = linear(c</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s1">model = Model(linear)</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">wd=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">we=</span><span class="s3">1.0</span><span class="s1">)</span>
        <span class="s1">job = ODR(data</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>
        <span class="s1">result = job.run()</span>
        <span class="s1">assert_equal(result.info</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2"># Verify fix for gh-9140</span>

    <span class="s0">def </span><span class="s1">test_ifixx(self):</span>
        <span class="s1">x1 = [-</span><span class="s3">2.01</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.99</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.001</span><span class="s0">, </span><span class="s3">1.02</span><span class="s0">, </span><span class="s3">1.98</span><span class="s1">]</span>
        <span class="s1">x2 = [</span><span class="s3">3.98</span><span class="s0">, </span><span class="s3">1.01</span><span class="s0">, </span><span class="s3">0.001</span><span class="s0">, </span><span class="s3">0.998</span><span class="s0">, </span><span class="s3">4.01</span><span class="s1">]</span>
        <span class="s1">fix = np.vstack((np.zeros_like(x1</span><span class="s0">, </span><span class="s1">dtype=int)</span><span class="s0">, </span><span class="s1">np.ones_like(x2</span><span class="s0">, </span><span class="s1">dtype=int)))</span>
        <span class="s1">data = Data(np.vstack((x1</span><span class="s0">, </span><span class="s1">x2))</span><span class="s0">, </span><span class="s1">y=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">fix=fix)</span>
        <span class="s1">model = Model(</span><span class="s0">lambda </span><span class="s1">beta</span><span class="s0">, </span><span class="s1">x: x[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:] - beta[</span><span class="s3">0</span><span class="s1">] * x[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:]**</span><span class="s3">2.</span><span class="s0">, </span><span class="s1">implicit=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">odr1 = ODR(data</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">beta0=np.array([</span><span class="s3">1.</span><span class="s1">]))</span>
        <span class="s1">sol1 = odr1.run()</span>
        <span class="s1">odr2 = ODR(data</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">beta0=np.array([</span><span class="s3">1.</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ifixx=fix)</span>
        <span class="s1">sol2 = odr2.run()</span>
        <span class="s1">assert_equal(sol1.beta</span><span class="s0">, </span><span class="s1">sol2.beta)</span>

    <span class="s2"># verify bugfix for #11800 in #11802</span>
    <span class="s0">def </span><span class="s1">test_ticket_11800(self):</span>
        <span class="s2"># parameters</span>
        <span class="s1">beta_true = np.array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.3</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.3</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>
        <span class="s1">nr_measurements = </span><span class="s3">10</span>

        <span class="s1">std_dev_x = </span><span class="s3">0.01</span>
        <span class="s1">x_error = np.array([[</span><span class="s3">0.00063445</span><span class="s0">, </span><span class="s3">0.00515731</span><span class="s0">, </span><span class="s3">0.00162719</span><span class="s0">, </span><span class="s3">0.01022866</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">0.01624845</span><span class="s0">, </span><span class="s3">0.00482652</span><span class="s0">, </span><span class="s3">0.00275988</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00714734</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00929201</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00687301</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">0.00831623</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00821211</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00203459</span><span class="s0">, </span><span class="s3">0.00938266</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00701829</span><span class="s0">,</span>
            <span class="s3">0.0032169</span><span class="s0">, </span><span class="s3">0.00259194</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00581017</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0030283</span><span class="s0">, </span><span class="s3">0.01014164</span><span class="s1">]])</span>

        <span class="s1">std_dev_y = </span><span class="s3">0.05</span>
        <span class="s1">y_error = np.array([[</span><span class="s3">0.05275304</span><span class="s0">, </span><span class="s3">0.04519563</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.07524086</span><span class="s0">, </span><span class="s3">0.03575642</span><span class="s0">,</span>
            <span class="s3">0.04745194</span><span class="s0">, </span><span class="s3">0.03806645</span><span class="s0">, </span><span class="s3">0.07061601</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.00753604</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.02592543</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.02394929</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">0.03632366</span><span class="s0">, </span><span class="s3">0.06642266</span><span class="s0">, </span><span class="s3">0.08373122</span><span class="s0">, </span><span class="s3">0.03988822</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.0092536</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">0.03750469</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.03198903</span><span class="s0">, </span><span class="s3">0.01642066</span><span class="s0">, </span><span class="s3">0.01293648</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.05627085</span><span class="s1">]])</span>

        <span class="s1">beta_solution = np.array([</span>
            <span class="s3">2.62920235756665876536e+00</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.26608484996299608838e+02</span><span class="s0">, </span><span class="s3">1.29703572775403074502e+02</span><span class="s0">,</span>
            <span class="s1">-</span><span class="s3">1.88560985401185465804e+00</span><span class="s0">, </span><span class="s3">7.83834160771274923718e+01</span><span class="s0">, </span><span class="s1">-</span><span class="s3">7.64124076838087091801e+01</span><span class="s1">])</span>

        <span class="s2"># model's function and Jacobians</span>
        <span class="s0">def </span><span class="s1">func(beta</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s1">y0 = beta[</span><span class="s3">0</span><span class="s1">] + beta[</span><span class="s3">1</span><span class="s1">] * x[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:] + beta[</span><span class="s3">2</span><span class="s1">] * x[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:]</span>
            <span class="s1">y1 = beta[</span><span class="s3">3</span><span class="s1">] + beta[</span><span class="s3">4</span><span class="s1">] * x[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:] + beta[</span><span class="s3">5</span><span class="s1">] * x[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:]</span>

            <span class="s0">return </span><span class="s1">np.vstack((y0</span><span class="s0">, </span><span class="s1">y1))</span>

        <span class="s0">def </span><span class="s1">df_dbeta_odr(beta</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s1">nr_meas = np.shape(x)[</span><span class="s3">1</span><span class="s1">]</span>
            <span class="s1">zeros = np.zeros(nr_meas)</span>
            <span class="s1">ones = np.ones(nr_meas)</span>

            <span class="s1">dy0 = np.array([ones</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">zeros</span><span class="s0">, </span><span class="s1">zeros</span><span class="s0">, </span><span class="s1">zeros])</span>
            <span class="s1">dy1 = np.array([zeros</span><span class="s0">, </span><span class="s1">zeros</span><span class="s0">, </span><span class="s1">zeros</span><span class="s0">, </span><span class="s1">ones</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:]])</span>

            <span class="s0">return </span><span class="s1">np.stack((dy0</span><span class="s0">, </span><span class="s1">dy1))</span>

        <span class="s0">def </span><span class="s1">df_dx_odr(beta</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s1">nr_meas = np.shape(x)[</span><span class="s3">1</span><span class="s1">]</span>
            <span class="s1">ones = np.ones(nr_meas)</span>

            <span class="s1">dy0 = np.array([beta[</span><span class="s3">1</span><span class="s1">] * ones</span><span class="s0">, </span><span class="s1">beta[</span><span class="s3">2</span><span class="s1">] * ones])</span>
            <span class="s1">dy1 = np.array([beta[</span><span class="s3">4</span><span class="s1">] * ones</span><span class="s0">, </span><span class="s1">beta[</span><span class="s3">5</span><span class="s1">] * ones])</span>
            <span class="s0">return </span><span class="s1">np.stack((dy0</span><span class="s0">, </span><span class="s1">dy1))</span>

        <span class="s2"># do measurements with errors in independent and dependent variables</span>
        <span class="s1">x0_true = np.linspace(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">nr_measurements)</span>
        <span class="s1">x1_true = np.linspace(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">nr_measurements)</span>
        <span class="s1">x_true = np.array([x0_true</span><span class="s0">, </span><span class="s1">x1_true])</span>

        <span class="s1">y_true = func(beta_true</span><span class="s0">, </span><span class="s1">x_true)</span>

        <span class="s1">x_meas = x_true + x_error</span>
        <span class="s1">y_meas = y_true + y_error</span>

        <span class="s2"># estimate model's parameters</span>
        <span class="s1">model_f = Model(func</span><span class="s0">, </span><span class="s1">fjacb=df_dbeta_odr</span><span class="s0">, </span><span class="s1">fjacd=df_dx_odr)</span>

        <span class="s1">data = RealData(x_meas</span><span class="s0">, </span><span class="s1">y_meas</span><span class="s0">, </span><span class="s1">sx=std_dev_x</span><span class="s0">, </span><span class="s1">sy=std_dev_y)</span>

        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">model_f</span><span class="s0">, </span><span class="s1">beta0=</span><span class="s3">0.9 </span><span class="s1">* beta_true</span><span class="s0">, </span><span class="s1">maxit=</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s2">#odr_obj.set_iprint(init=2, iter=0, iter_step=1, final=1)</span>
        <span class="s1">odr_obj.set_job(deriv=</span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">odr_out = odr_obj.run()</span>

        <span class="s2"># check results</span>
        <span class="s1">assert_equal(odr_out.info</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(odr_out.beta</span><span class="s0">, </span><span class="s1">beta_solution)</span>

    <span class="s0">def </span><span class="s1">test_multilinear_model(self):</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">y = </span><span class="s3">10.0 </span><span class="s1">+ </span><span class="s3">5.0 </span><span class="s1">* x</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">multilinear)</span>
        <span class="s1">output = odr_obj.run()</span>
        <span class="s1">assert_array_almost_equal(output.beta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_exponential_model(self):</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">y = -</span><span class="s3">10.0 </span><span class="s1">+ np.exp(</span><span class="s3">0.5</span><span class="s1">*x)</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">exponential)</span>
        <span class="s1">output = odr_obj.run()</span>
        <span class="s1">assert_array_almost_equal(output.beta</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">10.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_polynomial_model(self):</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">y = </span><span class="s3">1.0 </span><span class="s1">+ </span><span class="s3">2.0 </span><span class="s1">* x + </span><span class="s3">3.0 </span><span class="s1">* x ** </span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">4.0 </span><span class="s1">* x ** </span><span class="s3">3</span>
        <span class="s1">poly_model = polynomial(</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">poly_model)</span>
        <span class="s1">output = odr_obj.run()</span>
        <span class="s1">assert_array_almost_equal(output.beta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_unilinear_model(self):</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">y = </span><span class="s3">1.0 </span><span class="s1">* x + </span><span class="s3">2.0</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">unilinear)</span>
        <span class="s1">output = odr_obj.run()</span>
        <span class="s1">assert_array_almost_equal(output.beta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_quadratic_model(self):</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">y = </span><span class="s3">1.0 </span><span class="s1">* x ** </span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">2.0 </span><span class="s1">* x + </span><span class="s3">3.0</span>
        <span class="s1">data = Data(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">odr_obj = ODR(data</span><span class="s0">, </span><span class="s1">quadratic)</span>
        <span class="s1">output = odr_obj.run()</span>
        <span class="s1">assert_array_almost_equal(output.beta</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_work_ind(self):</span>

        <span class="s0">def </span><span class="s1">func(par</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s1">b0</span><span class="s0">, </span><span class="s1">b1 = par</span>
            <span class="s0">return </span><span class="s1">b0 + b1 * x</span>

        <span class="s2"># generate some data</span>
        <span class="s1">n_data = </span><span class="s3">4</span>
        <span class="s1">x = np.arange(n_data)</span>
        <span class="s1">y = np.where(x % </span><span class="s3">2</span><span class="s0">, </span><span class="s1">x + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">x - </span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">x_err = np.full(n_data</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">y_err = np.full(n_data</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>

        <span class="s2"># do the fitting</span>
        <span class="s1">linear_model = Model(func)</span>
        <span class="s1">real_data = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">sy=y_err)</span>
        <span class="s1">odr_obj = ODR(real_data</span><span class="s0">, </span><span class="s1">linear_model</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">])</span>
        <span class="s1">odr_obj.set_job(fit_type=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">out = odr_obj.run()</span>

        <span class="s1">sd_ind = out.work_ind[</span><span class="s4">'sd'</span><span class="s1">]</span>
        <span class="s1">assert_array_almost_equal(out.sd_beta</span><span class="s0">,</span>
                                  <span class="s1">out.work[sd_ind:sd_ind + len(out.sd_beta)])</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s0">True, </span><span class="s1">reason=</span><span class="s4">&quot;Fortran I/O prone to crashing so better &quot;</span>
                                     <span class="s4">&quot;not to run this test, see gh-13127&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_output_file_overwrite(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Verify fix for gh-1892 
        &quot;&quot;&quot;</span>
        <span class="s0">def </span><span class="s1">func(b</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s0">return </span><span class="s1">b[</span><span class="s3">0</span><span class="s1">] + b[</span><span class="s3">1</span><span class="s1">] * x</span>

        <span class="s1">p = Model(func)</span>
        <span class="s1">data = Data(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s3">12 </span><span class="s1">* np.arange(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">tmp_dir = tempfile.mkdtemp()</span>
        <span class="s1">error_file_path = os.path.join(tmp_dir</span><span class="s0">, </span><span class="s4">&quot;error.dat&quot;</span><span class="s1">)</span>
        <span class="s1">report_file_path = os.path.join(tmp_dir</span><span class="s0">, </span><span class="s4">&quot;report.dat&quot;</span><span class="s1">)</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">ODR(data</span><span class="s0">, </span><span class="s1">p</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">errfile=error_file_path</span><span class="s0">,</span>
                <span class="s1">rptfile=report_file_path).run()</span>
            <span class="s1">ODR(data</span><span class="s0">, </span><span class="s1">p</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">errfile=error_file_path</span><span class="s0">,</span>
                <span class="s1">rptfile=report_file_path</span><span class="s0">, </span><span class="s1">overwrite=</span><span class="s0">True</span><span class="s1">).run()</span>
        <span class="s0">finally</span><span class="s1">:</span>
            <span class="s2"># remove output files for clean up</span>
            <span class="s1">shutil.rmtree(tmp_dir)</span>

    <span class="s0">def </span><span class="s1">test_odr_model_default_meta(self):</span>
        <span class="s0">def </span><span class="s1">func(b</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s0">return </span><span class="s1">b[</span><span class="s3">0</span><span class="s1">] + b[</span><span class="s3">1</span><span class="s1">] * x</span>

        <span class="s1">p = Model(func)</span>
        <span class="s1">p.set_meta(name=</span><span class="s4">'Sample Model Meta'</span><span class="s0">, </span><span class="s1">ref=</span><span class="s4">'ODRPACK'</span><span class="s1">)</span>
        <span class="s1">assert_equal(p.meta</span><span class="s0">, </span><span class="s1">{</span><span class="s4">'name'</span><span class="s1">: </span><span class="s4">'Sample Model Meta'</span><span class="s0">, </span><span class="s4">'ref'</span><span class="s1">: </span><span class="s4">'ODRPACK'</span><span class="s1">})</span>

    <span class="s0">def </span><span class="s1">test_work_array_del_init(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Verify fix for gh-18739 where del_init=1 fails. 
        &quot;&quot;&quot;</span>
        <span class="s0">def </span><span class="s1">func(b</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s0">return </span><span class="s1">b[</span><span class="s3">0</span><span class="s1">] + b[</span><span class="s3">1</span><span class="s1">] * x</span>

        <span class="s2"># generate some data</span>
        <span class="s1">n_data = </span><span class="s3">4</span>
        <span class="s1">x = np.arange(n_data)</span>
        <span class="s1">y = np.where(x % </span><span class="s3">2</span><span class="s0">, </span><span class="s1">x + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">x - </span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">x_err = np.full(n_data</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">y_err = np.full(n_data</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>

        <span class="s1">linear_model = Model(func)</span>
        <span class="s2"># Try various shapes of the `we` array from various `sy` and `covy`</span>
        <span class="s1">rd0 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">sy=y_err)</span>
        <span class="s1">rd1 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">sy=</span><span class="s3">0.1</span><span class="s1">)</span>
        <span class="s1">rd2 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">sy=[</span><span class="s3">0.1</span><span class="s1">])</span>
        <span class="s1">rd3 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">sy=np.full((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">n_data)</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">))</span>
        <span class="s1">rd4 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">covy=[[</span><span class="s3">0.01</span><span class="s1">]])</span>
        <span class="s1">rd5 = RealData(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">sx=x_err</span><span class="s0">, </span><span class="s1">covy=np.full((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">n_data)</span><span class="s0">, </span><span class="s3">0.01</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">rd </span><span class="s0">in </span><span class="s1">[rd0</span><span class="s0">, </span><span class="s1">rd1</span><span class="s0">, </span><span class="s1">rd2</span><span class="s0">, </span><span class="s1">rd3</span><span class="s0">, </span><span class="s1">rd4</span><span class="s0">, </span><span class="s1">rd5]:</span>
            <span class="s1">odr_obj = ODR(rd</span><span class="s0">, </span><span class="s1">linear_model</span><span class="s0">, </span><span class="s1">beta0=[</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">]</span><span class="s0">,</span>
                          <span class="s1">delta0=np.full(n_data</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.1</span><span class="s1">))</span>
            <span class="s1">odr_obj.set_job(fit_type=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">del_init=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s2"># Just make sure that it runs without raising an exception.</span>
            <span class="s1">odr_obj.run()</span>
</pre>
</body>
</html>
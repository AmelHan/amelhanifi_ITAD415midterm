<html>
<head>
<title>results_proportion.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
results_proportion.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">&quot;&quot;&quot; 
 
Created on Fri Mar 01 14:48:59 2013 
 
Author: Josef Perktold 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">collections</span>
<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>

<span class="s3">from </span><span class="s1">statsmodels.tools.testing </span><span class="s3">import </span><span class="s1">Holder</span>

<span class="s0"># numbers from R package `pwr` pwr.chisq.test</span>
<span class="s1">res_binom = collections.defaultdict(Holder)</span>
<span class="s1">res_binom_methods = [</span><span class="s4">&quot;agresti-coull&quot;</span><span class="s3">, </span><span class="s4">&quot;asymptotic&quot;</span><span class="s3">, </span><span class="s4">&quot;bayes&quot;</span><span class="s3">,  </span><span class="s4">&quot;cloglog&quot;</span><span class="s3">,</span>
                     <span class="s4">&quot;exact&quot;</span><span class="s3">, </span><span class="s4">&quot;logit&quot;</span><span class="s3">, </span><span class="s4">&quot;probit&quot;</span><span class="s3">, </span><span class="s4">&quot;profile&quot;</span><span class="s3">, </span><span class="s4">&quot;lrt&quot;</span><span class="s3">, </span><span class="s4">&quot;prop.test&quot;</span><span class="s3">,</span>
                     <span class="s4">&quot;wilson&quot;</span><span class="s1">]</span>


<span class="s0"># &gt; bci = binom.confint(x = c(18), n = 20, tol = 1e-8)</span>
<span class="s0"># &gt; mkarray2(bci$lower, &quot;res_binom[(18, 20)].ci_low&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">18</span><span class="s3">, </span><span class="s5">20</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.6867561125596077</span><span class="s3">, </span><span class="s5">0.768521618913513</span><span class="s3">, </span><span class="s5">0.716146742695748</span><span class="s3">,</span>
    <span class="s5">0.656030707261567</span><span class="s3">, </span><span class="s5">0.6830172859809176</span><span class="s3">, </span><span class="s5">0.676197991611287</span><span class="s3">,</span>
    <span class="s5">0.7027685414174645</span><span class="s3">, </span><span class="s5">0.722052946372325</span><span class="s3">, </span><span class="s5">0.7220576251734515</span><span class="s3">,</span>
    <span class="s5">0.668722403162941</span><span class="s3">, </span><span class="s5">0.6989663547715128</span>
    <span class="s1">])</span>
<span class="s0"># &gt; mkarray2(bci$upper, &quot;res_binom[(18, 20)].ci_upp&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">18</span><span class="s3">, </span><span class="s5">20</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.984343760998137</span><span class="s3">, </span><span class="s5">1.031478381086487</span><span class="s3">, </span><span class="s5">0.97862751197755</span><span class="s3">,</span>
    <span class="s5">0.974010174395775</span><span class="s3">, </span><span class="s5">0.9876514728297052</span><span class="s3">, </span><span class="s5">0.974866415649319</span><span class="s3">,</span>
    <span class="s5">0.978858461808406</span><span class="s3">, </span><span class="s5">0.982318186566456</span><span class="s3">, </span><span class="s5">0.982639913376776</span><span class="s3">,</span>
    <span class="s5">0.982487361226571</span><span class="s3">, </span><span class="s5">0.972133518786232</span>
    <span class="s1">])</span>
<span class="s0"># &gt;</span>
<span class="s0"># &gt; bci = binom.confint(x = c(4), n = 20, tol = 1e-8)</span>
<span class="s0"># &gt; mkarray2(bci$lower, &quot;res_binom[(4, 20)].ci_low&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">4</span><span class="s3">, </span><span class="s5">20</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.0749115102767071</span><span class="s3">, </span><span class="s5">0.0246954918846837</span><span class="s3">, </span><span class="s5">0.07152005247873425</span><span class="s3">,</span>
    <span class="s5">0.0623757232566298</span><span class="s3">, </span><span class="s5">0.05733399705003284</span><span class="s3">, </span><span class="s5">0.0771334546771001</span><span class="s3">,</span>
    <span class="s5">0.0710801045992076</span><span class="s3">, </span><span class="s5">0.0668624655835687</span><span class="s3">, </span><span class="s5">0.0668375191189685</span><span class="s3">,</span>
    <span class="s5">0.0661062308910436</span><span class="s3">, </span><span class="s5">0.0806576625797981</span>
    <span class="s1">])</span>
<span class="s0"># &gt; mkarray2(bci$upper, &quot;res_binom[(4, 20)].ci_upp&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">4</span><span class="s3">, </span><span class="s5">20</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.4217635845549845</span><span class="s3">, </span><span class="s5">0.3753045081153163</span><span class="s3">, </span><span class="s5">0.4082257625169254</span><span class="s3">,</span>
    <span class="s5">0.393143902056907</span><span class="s3">, </span><span class="s5">0.436614002996668</span><span class="s3">, </span><span class="s5">0.427846901518118</span><span class="s3">,</span>
    <span class="s5">0.4147088121599544</span><span class="s3">, </span><span class="s5">0.405367872119342</span><span class="s3">, </span><span class="s5">0.405364309586823</span><span class="s3">,</span>
    <span class="s5">0.442686245059445</span><span class="s3">, </span><span class="s5">0.4160174322518935</span>
    <span class="s1">])</span>
<span class="s0"># &gt;</span>
<span class="s0"># &gt; bci = binom.confint(x = c(4), n = 200, tol = 1e-8)</span>
<span class="s0"># &gt; mkarray2(bci$lower, &quot;res_binom[(4, 200)].ci_low&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">4</span><span class="s3">, </span><span class="s5">200</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.005991954548218395</span><span class="s3">, </span><span class="s5">0.000597346459104517</span><span class="s3">, </span><span class="s5">0.00678759879519299</span><span class="s3">,</span>
    <span class="s5">0.006650668467968445</span><span class="s3">, </span><span class="s5">0.005475565879556443</span><span class="s3">, </span><span class="s5">0.00752663882411158</span><span class="s3">,</span>
    <span class="s5">0.00705442514086136</span><span class="s3">, </span><span class="s5">0.00625387073493174</span><span class="s3">, </span><span class="s5">0.00625223049303646</span><span class="s3">,</span>
    <span class="s5">0.00642601313670221</span><span class="s3">, </span><span class="s5">0.00780442641634947</span>
    <span class="s1">])</span>
<span class="s0"># &gt; mkarray2(bci$upper, &quot;res_binom[(4, 200)].ci_upp&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">4</span><span class="s3">, </span><span class="s5">200</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.0520995587739575</span><span class="s3">, </span><span class="s5">0.0394026535408955</span><span class="s3">, </span><span class="s5">0.0468465669668423</span><span class="s3">,</span>
    <span class="s5">0.04722535678688564</span><span class="s3">, </span><span class="s5">0.05041360908989634</span><span class="s3">, </span><span class="s5">0.05206026227201098</span><span class="s3">,</span>
    <span class="s5">0.04916362085874019</span><span class="s3">, </span><span class="s5">0.04585048214247203</span><span class="s3">, </span><span class="s5">0.0458490848884339</span><span class="s3">,</span>
    <span class="s5">0.0537574613520185</span><span class="s3">, </span><span class="s5">0.05028708690582643</span>
    <span class="s1">])</span>
<span class="s0"># &gt; bci = binom.confint(x = c(190), n = 200, tol = 1e-8)</span>
<span class="s0"># Warning message:</span>
<span class="s0"># In binom.bayes(x, n, conf.level = conf.level, ...) :</span>
<span class="s0">#  1 confidence interval failed to converge (marked by '*').</span>
<span class="s0">#  Try changing 'tol' to a different value.</span>
<span class="s0"># JP: I replace 0.02094150654714356 by np.nan in Bayes</span>
<span class="s0"># &gt; mkarray2(bci$lower, &quot;res_binom[(190, 200)].ci_low&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">190</span><span class="s3">, </span><span class="s5">200</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.909307307911624</span><span class="s3">, </span><span class="s5">0.919794926420966</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">,</span>
    <span class="s5">0.909066091776046</span><span class="s3">, </span><span class="s5">0.9099724622986486</span><span class="s3">, </span><span class="s5">0.9095820742314172</span><span class="s3">,</span>
    <span class="s5">0.9118101288857796</span><span class="s3">, </span><span class="s5">0.913954651984184</span><span class="s3">, </span><span class="s5">0.913956305842353</span><span class="s3">,</span>
    <span class="s5">0.9073089225133698</span><span class="s3">, </span><span class="s5">0.910421851861224</span>
    <span class="s1">])</span>
<span class="s0"># &gt; mkarray2(bci$upper, &quot;res_binom[(190, 200)].ci_upp&quot;)</span>
<span class="s1">res_binom[(</span><span class="s5">190</span><span class="s3">, </span><span class="s5">200</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.973731898348837</span><span class="s3">, </span><span class="s5">0.980205073579034</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.972780587302479</span><span class="s3">,</span>
    <span class="s5">0.975765834527891</span><span class="s3">, </span><span class="s5">0.9728891271086528</span><span class="s3">, </span><span class="s5">0.973671370402242</span><span class="s3">,</span>
    <span class="s5">0.974623779100809</span><span class="s3">, </span><span class="s5">0.974626983311416</span><span class="s3">, </span><span class="s5">0.974392083257476</span><span class="s3">,</span>
    <span class="s5">0.972617354399236</span>
    <span class="s1">])</span>

<span class="s0"># &gt; bci = binom.confint(x = c(1), n = 30, tol = 1e-8)</span>
<span class="s1">res_binom[(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s1">-</span><span class="s5">8.305484e-03</span><span class="s3">, </span><span class="s1">-</span><span class="s5">3.090070e-02</span><span class="s3">,  </span><span class="s5">6.903016e-05</span><span class="s3">, </span><span class="s5">2.494567e-03</span><span class="s3">,</span>
    <span class="s5">8.435709e-04</span><span class="s3">,  </span><span class="s5">4.675346e-03</span><span class="s3">,  </span><span class="s5">3.475014e-03</span><span class="s3">, </span><span class="s5">3.012987e-03</span><span class="s3">,</span>
    <span class="s5">1.932430e-03</span><span class="s3">,  </span><span class="s5">1.742467e-03</span><span class="s3">,  </span><span class="s5">5.908590e-03</span><span class="s1">])</span>

<span class="s1">res_binom[(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.18091798</span><span class="s3">, </span><span class="s5">0.09756737</span><span class="s3">, </span><span class="s5">0.12314380</span><span class="s3">, </span><span class="s5">0.14513807</span><span class="s3">,</span>
    <span class="s5">0.17216946</span><span class="s3">, </span><span class="s5">0.20200244</span><span class="s3">, </span><span class="s5">0.16637241</span><span class="s3">, </span><span class="s5">0.13868254</span><span class="s3">,</span>
    <span class="s5">0.13868375</span><span class="s3">, </span><span class="s5">0.19053022</span><span class="s3">, </span><span class="s5">0.16670391</span><span class="s1">])</span>

<span class="s0"># &gt; bci = binom.confint(x = c(29), n = 30, tol = 1e-8)</span>
<span class="s1">res_binom[(</span><span class="s5">29</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.8190820</span><span class="s3">, </span><span class="s5">0.9024326</span><span class="s3">, </span><span class="s5">0.8768562</span><span class="s3">, </span><span class="s5">0.7860836</span><span class="s3">,</span>
    <span class="s5">0.8278305</span><span class="s3">, </span><span class="s5">0.7979976</span><span class="s3">, </span><span class="s5">0.8336276</span><span class="s3">, </span><span class="s5">0.8613175</span><span class="s3">,</span>
    <span class="s5">0.8613162</span><span class="s3">, </span><span class="s5">0.8094698</span><span class="s3">, </span><span class="s5">0.8332961</span><span class="s1">])</span>
<span class="s1">res_binom[(</span><span class="s5">29</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">1.0083055</span><span class="s3">, </span><span class="s5">1.0309007</span><span class="s3">, </span><span class="s5">0.9999310</span><span class="s3">, </span><span class="s5">0.9952363</span><span class="s3">,</span>
    <span class="s5">0.9991564</span><span class="s3">, </span><span class="s5">0.9953247</span><span class="s3">, </span><span class="s5">0.9965250</span><span class="s3">, </span><span class="s5">0.9969870</span><span class="s3">,</span>
    <span class="s5">0.9980676</span><span class="s3">, </span><span class="s5">0.9982575</span><span class="s3">, </span><span class="s5">0.9940914</span><span class="s1">])</span>

<span class="s0"># &gt; bci = binom.confint(x = c(0), n = 30, tol = 1e-8)</span>
<span class="s0"># Note: this ci_low clips one negative value to 0</span>
<span class="s1">res_binom[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_low = np.zeros(</span><span class="s5">11</span><span class="s1">)</span>
<span class="s1">res_binom[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_upp = np.array([</span>
    <span class="s5">0.13471170</span><span class="s3">, </span><span class="s5">0.00000000</span><span class="s3">, </span><span class="s5">0.06151672</span><span class="s3">, </span><span class="s5">0.11570331</span><span class="s3">,</span>
    <span class="s5">0.11570331</span><span class="s3">, </span><span class="s5">0.11570331</span><span class="s3">, </span><span class="s5">0.11570331</span><span class="s3">, </span><span class="s5">0.10402893</span><span class="s3">,</span>
    <span class="s5">0.06201781</span><span class="s3">, </span><span class="s5">0.14132048</span><span class="s3">, </span><span class="s5">0.11351339</span><span class="s1">])</span>

<span class="s0"># &gt; bci = binom.confint(x = c(30), n = 30, tol = 1e-8)</span>
<span class="s1">res_binom[(</span><span class="s5">30</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_low = np.array([</span>
    <span class="s5">0.8652883</span><span class="s3">, </span><span class="s5">1.0000000</span><span class="s3">, </span><span class="s5">0.9384833</span><span class="s3">, </span><span class="s5">0.8842967</span><span class="s3">,</span>
    <span class="s5">0.8842967</span><span class="s3">, </span><span class="s5">0.8842967</span><span class="s3">, </span><span class="s5">0.8842967</span><span class="s3">, </span><span class="s5">0.8959711</span><span class="s3">,</span>
    <span class="s5">0.9379822</span><span class="s3">, </span><span class="s5">0.8586795</span><span class="s3">, </span><span class="s5">0.8864866</span><span class="s1">])</span>
<span class="s0"># Note: this ci_upp clips one value &gt; 1</span>
<span class="s1">res_binom[(</span><span class="s5">30</span><span class="s3">, </span><span class="s5">30</span><span class="s1">)].ci_upp = np.ones(</span><span class="s5">11</span><span class="s1">)</span>
</pre>
</body>
</html>
<html>
<head>
<title>test_sas7bdat.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_sas7bdat.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>

<span class="s0">import </span><span class="s1">dateutil.parser</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.errors </span><span class="s0">import </span><span class="s1">EmptyDataError</span>
<span class="s0">import </span><span class="s1">pandas.util._test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">dirpath(datapath):</span>
    <span class="s0">return </span><span class="s1">datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.fixture(params=[(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">16</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">[</span><span class="s3">16</span><span class="s1">])])</span>
<span class="s0">def </span><span class="s1">data_test_ix(request</span><span class="s0">, </span><span class="s1">dirpath):</span>
    <span class="s1">i</span><span class="s0">, </span><span class="s1">test_ix = request.param</span>
    <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test_sas7bdat_</span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s2">.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_csv(fname)</span>
    <span class="s1">epoch = datetime(</span><span class="s3">1960</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">t1 = pd.to_timedelta(df[</span><span class="s2">&quot;Column4&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">unit=</span><span class="s2">&quot;d&quot;</span><span class="s1">)</span>
    <span class="s1">df[</span><span class="s2">&quot;Column4&quot;</span><span class="s1">] = epoch + t1</span>
    <span class="s1">t2 = pd.to_timedelta(df[</span><span class="s2">&quot;Column12&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">unit=</span><span class="s2">&quot;d&quot;</span><span class="s1">)</span>
    <span class="s1">df[</span><span class="s2">&quot;Column12&quot;</span><span class="s1">] = epoch + t2</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(df.shape[</span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s1">col = df.iloc[:</span><span class="s0">, </span><span class="s1">k]</span>
        <span class="s0">if </span><span class="s1">col.dtype == np.int64:</span>
            <span class="s1">df.isetitem(k</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s1">k].astype(np.float64))</span>
    <span class="s0">return </span><span class="s1">df</span><span class="s0">, </span><span class="s1">test_ix</span>


<span class="s4"># https://github.com/cython/cython/issues/1720</span>
<span class="s0">class </span><span class="s1">TestSAS7BDAT:</span>
    <span class="s1">@pytest.mark.slow</span>
    <span class="s0">def </span><span class="s1">test_from_file(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">data_test_ix):</span>
        <span class="s1">df0</span><span class="s0">, </span><span class="s1">test_ix = data_test_ix</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">test_ix:</span>
            <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">)</span>
            <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
            <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s0">def </span><span class="s1">test_from_buffer(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">data_test_ix):</span>
        <span class="s1">df0</span><span class="s0">, </span><span class="s1">test_ix = data_test_ix</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">test_ix:</span>
            <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">)</span>
            <span class="s0">with </span><span class="s1">open(fname</span><span class="s0">, </span><span class="s2">&quot;rb&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f:</span>
                <span class="s1">byts = f.read()</span>
            <span class="s1">buf = io.BytesIO(byts)</span>
            <span class="s0">with </span><span class="s1">pd.read_sas(</span>
                <span class="s1">buf</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;sas7bdat&quot;</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="s1">) </span><span class="s0">as </span><span class="s1">rdr:</span>
                <span class="s1">df = rdr.read()</span>
            <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0</span><span class="s0">, </span><span class="s1">check_exact=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s0">def </span><span class="s1">test_from_iterator(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">data_test_ix):</span>
        <span class="s1">df0</span><span class="s0">, </span><span class="s1">test_ix = data_test_ix</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">test_ix:</span>
            <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">)</span>
            <span class="s0">with </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">rdr:</span>
                <span class="s1">df = rdr.read(</span><span class="s3">2</span><span class="s1">)</span>
                <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0.iloc[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">2</span><span class="s0">, </span><span class="s1">:])</span>
                <span class="s1">df = rdr.read(</span><span class="s3">3</span><span class="s1">)</span>
                <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0.iloc[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">5</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s0">def </span><span class="s1">test_path_pathlib(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">data_test_ix):</span>
        <span class="s1">df0</span><span class="s0">, </span><span class="s1">test_ix = data_test_ix</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">test_ix:</span>
            <span class="s1">fname = Path(os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">))</span>
            <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
            <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>

    <span class="s1">@td.skip_if_no(</span><span class="s2">&quot;py.path&quot;</span><span class="s1">)</span>
    <span class="s1">@pytest.mark.slow</span>
    <span class="s0">def </span><span class="s1">test_path_localpath(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">data_test_ix):</span>
        <span class="s0">from </span><span class="s1">py.path </span><span class="s0">import </span><span class="s1">local </span><span class="s0">as </span><span class="s1">LocalPath</span>

        <span class="s1">df0</span><span class="s0">, </span><span class="s1">test_ix = data_test_ix</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">test_ix:</span>
            <span class="s1">fname = LocalPath(os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">))</span>
            <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
            <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;chunksize&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s1">))</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">17</span><span class="s1">))</span>
    <span class="s0">def </span><span class="s1">test_iterator_loop(self</span><span class="s0">, </span><span class="s1">dirpath</span><span class="s0">, </span><span class="s1">k</span><span class="s0">, </span><span class="s1">chunksize):</span>
        <span class="s4"># github #13654</span>
        <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">f&quot;test</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s2">.sas7bdat&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">chunksize=chunksize</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">rdr:</span>
            <span class="s1">y = </span><span class="s3">0</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">rdr:</span>
                <span class="s1">y += x.shape[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">y == rdr.row_count</span>

    <span class="s0">def </span><span class="s1">test_iterator_read_too_much(self</span><span class="s0">, </span><span class="s1">dirpath):</span>
        <span class="s4"># github #14734</span>
        <span class="s1">fname = os.path.join(dirpath</span><span class="s0">, </span><span class="s2">&quot;test1.sas7bdat&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pd.read_sas(</span>
            <span class="s1">fname</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;sas7bdat&quot;</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span>
        <span class="s1">) </span><span class="s0">as </span><span class="s1">rdr:</span>
            <span class="s1">d1 = rdr.read(rdr.row_count + </span><span class="s3">20</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">rdr:</span>
            <span class="s1">d2 = rdr.read(rdr.row_count + </span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(d1</span><span class="s0">, </span><span class="s1">d2)</span>


<span class="s0">def </span><span class="s1">test_encoding_options(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;test1.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df1 = pd.read_sas(fname)</span>
    <span class="s1">df2 = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">df1.columns:</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">df1[col] = df1[col].str.decode(</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
        <span class="s0">except </span><span class="s1">AttributeError:</span>
            <span class="s0">pass</span>
    <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2)</span>

    <span class="s0">from </span><span class="s1">pandas.io.sas.sas7bdat </span><span class="s0">import </span><span class="s1">SAS7BDATReader</span>

    <span class="s0">with </span><span class="s1">contextlib.closing(SAS7BDATReader(fname</span><span class="s0">, </span><span class="s1">convert_header_text=</span><span class="s0">False</span><span class="s1">)) </span><span class="s0">as </span><span class="s1">rdr:</span>
        <span class="s1">df3 = rdr.read()</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">zip(df1.columns</span><span class="s0">, </span><span class="s1">df3.columns):</span>
        <span class="s0">assert </span><span class="s1">x == y.decode()</span>


<span class="s0">def </span><span class="s1">test_encoding_infer(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;test1.sas7bdat&quot;</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;infer&quot;</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">df1_reader:</span>
        <span class="s4"># check: is encoding inferred correctly from file</span>
        <span class="s0">assert </span><span class="s1">df1_reader.inferred_encoding == </span><span class="s2">&quot;cp1252&quot;</span>
        <span class="s1">df1 = df1_reader.read()</span>

    <span class="s0">with </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;cp1252&quot;</span><span class="s0">, </span><span class="s1">iterator=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">df2_reader:</span>
        <span class="s1">df2 = df2_reader.read()</span>

    <span class="s4"># check: reader reads correct information</span>
    <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2)</span>


<span class="s0">def </span><span class="s1">test_productsales(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;productsales.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;productsales.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(fname</span><span class="s0">, </span><span class="s1">parse_dates=[</span><span class="s2">&quot;MONTH&quot;</span><span class="s1">])</span>
    <span class="s1">vn = [</span><span class="s2">&quot;ACTUAL&quot;</span><span class="s0">, </span><span class="s2">&quot;PREDICT&quot;</span><span class="s0">, </span><span class="s2">&quot;QUARTER&quot;</span><span class="s0">, </span><span class="s2">&quot;YEAR&quot;</span><span class="s1">]</span>
    <span class="s1">df0[vn] = df0[vn].astype(np.float64)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>


<span class="s0">def </span><span class="s1">test_12659(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;test_12659.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;test_12659.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(fname)</span>
    <span class="s1">df0 = df0.astype(np.float64)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>


<span class="s0">def </span><span class="s1">test_airline(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;airline.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;airline.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(fname)</span>
    <span class="s1">df0 = df0.astype(np.float64)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0</span><span class="s0">, </span><span class="s1">check_exact=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_date_time(datapath):</span>
    <span class="s4"># Support of different SAS date/datetime formats (PR #15871)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;datetime.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;datetime.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(</span>
        <span class="s1">fname</span><span class="s0">, </span><span class="s1">parse_dates=[</span><span class="s2">&quot;Date1&quot;</span><span class="s0">, </span><span class="s2">&quot;Date2&quot;</span><span class="s0">, </span><span class="s2">&quot;DateTime&quot;</span><span class="s0">, </span><span class="s2">&quot;DateTimeHi&quot;</span><span class="s0">, </span><span class="s2">&quot;Taiw&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s4"># GH 19732: Timestamps imported from sas will incur floating point errors</span>
    <span class="s1">df[df.columns[</span><span class="s3">3</span><span class="s1">]] = df.iloc[:</span><span class="s0">, </span><span class="s3">3</span><span class="s1">].dt.round(</span><span class="s2">&quot;us&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;column&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;WGT&quot;</span><span class="s0">, </span><span class="s2">&quot;CYL&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_compact_numerical_values(datapath</span><span class="s0">, </span><span class="s1">column):</span>
    <span class="s4"># Regression test for #21616</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;cars.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;latin-1&quot;</span><span class="s1">)</span>
    <span class="s4"># The two columns CYL and WGT in cars.sas7bdat have column</span>
    <span class="s4"># width &lt; 8 and only contain integral values.</span>
    <span class="s4"># Test that pandas doesn't corrupt the numbers by adding</span>
    <span class="s4"># decimals.</span>
    <span class="s1">result = df[column]</span>
    <span class="s1">expected = df[column].round()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">check_exact=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_many_columns(datapath):</span>
    <span class="s4"># Test for looking for column information in more places (PR #22628)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;many_columns.sas7bdat&quot;</span><span class="s1">)</span>

    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;latin-1&quot;</span><span class="s1">)</span>

    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;many_columns.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;latin-1&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>


<span class="s0">def </span><span class="s1">test_inconsistent_number_of_rows(datapath):</span>
    <span class="s4"># Regression test for issue #16615. (PR #22628)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;load_log.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;latin-1&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(df) == </span><span class="s3">2097</span>


<span class="s0">def </span><span class="s1">test_zero_variables(datapath):</span>
    <span class="s4"># Check if the SAS file has zero variables (PR #18184)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;zero_variables.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(EmptyDataError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;No columns to parse from file&quot;</span><span class="s1">):</span>
        <span class="s1">pd.read_sas(fname)</span>


<span class="s0">def </span><span class="s1">test_zero_rows(datapath):</span>
    <span class="s4"># GH 18198</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;zero_rows.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">result = pd.read_sas(fname)</span>
    <span class="s1">expected = pd.DataFrame([{</span><span class="s2">&quot;char_field&quot;</span><span class="s1">: </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;num_field&quot;</span><span class="s1">: </span><span class="s3">1.0</span><span class="s1">}]).iloc[:</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_corrupt_read(datapath):</span>
    <span class="s4"># We don't really care about the exact failure, the important thing is</span>
    <span class="s4"># that the resource should be cleaned up afterwards (BUG #35566)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;corrupt.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">msg = </span><span class="s2">&quot;'SAS7BDATReader' object has no attribute 'row_count'&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">pd.read_sas(fname)</span>


<span class="s0">def </span><span class="s1">round_datetime_to_ms(ts):</span>
    <span class="s0">if </span><span class="s1">isinstance(ts</span><span class="s0">, </span><span class="s1">datetime):</span>
        <span class="s0">return </span><span class="s1">ts.replace(microsecond=int(round(ts.microsecond</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">) / </span><span class="s3">1000</span><span class="s1">) * </span><span class="s3">1000</span><span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">isinstance(ts</span><span class="s0">, </span><span class="s1">str):</span>
        <span class="s1">_ts = dateutil.parser.parse(timestr=ts)</span>
        <span class="s0">return </span><span class="s1">_ts.replace(microsecond=int(round(_ts.microsecond</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">) / </span><span class="s3">1000</span><span class="s1">) * </span><span class="s3">1000</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">ts</span>


<span class="s0">def </span><span class="s1">test_max_sas_date(datapath):</span>
    <span class="s4"># GH 20927</span>
    <span class="s4"># NB. max datetime in SAS dataset is 31DEC9999:23:59:59.999</span>
    <span class="s4">#    but this is read as 29DEC9999:23:59:59.998993 by a buggy</span>
    <span class="s4">#    sas7bdat module</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;max_sas_date.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;iso-8859-1&quot;</span><span class="s1">)</span>

    <span class="s4"># SAS likes to left pad strings with spaces - lstrip before comparing</span>
    <span class="s1">df = df.map(</span><span class="s0">lambda </span><span class="s1">x: x.lstrip() </span><span class="s0">if </span><span class="s1">isinstance(x</span><span class="s0">, </span><span class="s1">str) </span><span class="s0">else </span><span class="s1">x)</span>
    <span class="s4"># GH 19732: Timestamps imported from sas will incur floating point errors</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">].dt.round(</span><span class="s2">&quot;us&quot;</span><span class="s1">)</span>
    <span class="s0">except </span><span class="s1">pd._libs.tslibs.np_datetime.OutOfBoundsDatetime:</span>
        <span class="s1">df = df.map(round_datetime_to_ms)</span>
    <span class="s0">except </span><span class="s1">AttributeError:</span>
        <span class="s1">df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">].apply(round_datetime_to_ms)</span>
    <span class="s4"># if there are any date/times &gt; pandas.Timestamp.max then ALL in that chunk</span>
    <span class="s4"># are returned as datetime.datetime</span>
    <span class="s1">expected = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;text&quot;</span><span class="s1">: [</span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;normal&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt_as_float&quot;</span><span class="s1">: [</span><span class="s3">253717747199.999</span><span class="s0">, </span><span class="s3">1880323199.999</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s0">, </span><span class="s3">23</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">999000</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">datetime(</span><span class="s3">2019</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">23</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">999000</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;date_as_float&quot;</span><span class="s1">: [</span><span class="s3">2936547.0</span><span class="s0">, </span><span class="s3">21762.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;date_as_date&quot;</span><span class="s1">: [datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2019</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">columns=[</span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;dt_as_float&quot;</span><span class="s0">, </span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s0">, </span><span class="s2">&quot;date_as_float&quot;</span><span class="s0">, </span><span class="s2">&quot;date_as_date&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_max_sas_date_iterator(datapath):</span>
    <span class="s4"># GH 20927</span>
    <span class="s4"># when called as an iterator, only those chunks with a date &gt; pd.Timestamp.max</span>
    <span class="s4"># are returned as datetime.datetime, if this happens that whole chunk is returned</span>
    <span class="s4"># as datetime.datetime</span>
    <span class="s1">col_order = [</span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;dt_as_float&quot;</span><span class="s0">, </span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s0">, </span><span class="s2">&quot;date_as_float&quot;</span><span class="s0">, </span><span class="s2">&quot;date_as_date&quot;</span><span class="s1">]</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;max_sas_date.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">results = []</span>
    <span class="s0">for </span><span class="s1">df </span><span class="s0">in </span><span class="s1">pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;iso-8859-1&quot;</span><span class="s0">, </span><span class="s1">chunksize=</span><span class="s3">1</span><span class="s1">):</span>
        <span class="s4"># SAS likes to left pad strings with spaces - lstrip before comparing</span>
        <span class="s1">df = df.map(</span><span class="s0">lambda </span><span class="s1">x: x.lstrip() </span><span class="s0">if </span><span class="s1">isinstance(x</span><span class="s0">, </span><span class="s1">str) </span><span class="s0">else </span><span class="s1">x)</span>
        <span class="s4"># GH 19732: Timestamps imported from sas will incur floating point errors</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">].dt.round(</span><span class="s2">&quot;us&quot;</span><span class="s1">)</span>
        <span class="s0">except </span><span class="s1">pd._libs.tslibs.np_datetime.OutOfBoundsDatetime:</span>
            <span class="s1">df = df.map(round_datetime_to_ms)</span>
        <span class="s0">except </span><span class="s1">AttributeError:</span>
            <span class="s1">df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">].apply(round_datetime_to_ms)</span>
        <span class="s1">df.reset_index(inplace=</span><span class="s0">True, </span><span class="s1">drop=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">results.append(df)</span>
    <span class="s1">expected = [</span>
        <span class="s1">pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;text&quot;</span><span class="s1">: [</span><span class="s2">&quot;max&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;dt_as_float&quot;</span><span class="s1">: [</span><span class="s3">253717747199.999</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">: [datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s0">, </span><span class="s3">23</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">999000</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s2">&quot;date_as_float&quot;</span><span class="s1">: [</span><span class="s3">2936547.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;date_as_date&quot;</span><span class="s1">: [datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">columns=col_order</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;text&quot;</span><span class="s1">: [</span><span class="s2">&quot;normal&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;dt_as_float&quot;</span><span class="s1">: [</span><span class="s3">1880323199.999</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;dt_as_dt&quot;</span><span class="s1">: [np.datetime64(</span><span class="s2">&quot;2019-08-01 23:59:59.999&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s2">&quot;date_as_float&quot;</span><span class="s1">: [</span><span class="s3">21762.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;date_as_date&quot;</span><span class="s1">: [np.datetime64(</span><span class="s2">&quot;2019-08-01&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">columns=col_order</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">result</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">zip(results</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_null_date(datapath):</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;dates_null.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>

    <span class="s1">expected = pd.DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;datecol&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;datetimecol&quot;</span><span class="s1">: [</span>
                <span class="s1">datetime(</span><span class="s3">9999</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">29</span><span class="s0">, </span><span class="s3">23</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">59</span><span class="s0">, </span><span class="s3">998993</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_meta2_page(datapath):</span>
    <span class="s4"># GH 35545</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;test_meta2_page.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname)</span>
    <span class="s0">assert </span><span class="s1">len(df) == </span><span class="s3">1000</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;test_file, override_offset, override_value, expected_msg&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;test2.sas7bdat&quot;</span><span class="s0">, </span><span class="s3">0x10000 </span><span class="s1">+ </span><span class="s3">55229</span><span class="s0">, </span><span class="s3">0x80 </span><span class="s1">| </span><span class="s3">0x0F</span><span class="s0">, </span><span class="s2">&quot;Out of bounds&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;test2.sas7bdat&quot;</span><span class="s0">, </span><span class="s3">0x10000 </span><span class="s1">+ </span><span class="s3">55229</span><span class="s0">, </span><span class="s3">0x10</span><span class="s0">, </span><span class="s2">&quot;unknown control byte&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;test3.sas7bdat&quot;</span><span class="s0">, </span><span class="s3">118170</span><span class="s0">, </span><span class="s3">184</span><span class="s0">, </span><span class="s2">&quot;Out of bounds&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_rle_rdc_exceptions(</span>
    <span class="s1">datapath</span><span class="s0">, </span><span class="s1">test_file</span><span class="s0">, </span><span class="s1">override_offset</span><span class="s0">, </span><span class="s1">override_value</span><span class="s0">, </span><span class="s1">expected_msg</span>
<span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot;Errors in RLE/RDC decompression should propagate.&quot;&quot;&quot;</span>
    <span class="s0">with </span><span class="s1">open(datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s1">test_file)</span><span class="s0">, </span><span class="s2">&quot;rb&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">fd:</span>
        <span class="s1">data = bytearray(fd.read())</span>
    <span class="s1">data[override_offset] = override_value</span>
    <span class="s0">with </span><span class="s1">pytest.raises(Exception</span><span class="s0">, </span><span class="s1">match=expected_msg):</span>
        <span class="s1">pd.read_sas(io.BytesIO(data)</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;sas7bdat&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_0x40_control_byte(datapath):</span>
    <span class="s4"># GH 31243</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;0x40controlbyte.sas7bdat&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_sas(fname</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;ascii&quot;</span><span class="s1">)</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;0x40controlbyte.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df0 = pd.read_csv(fname</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df0)</span>


<span class="s0">def </span><span class="s1">test_0x00_control_byte(datapath):</span>
    <span class="s4"># GH 47099</span>
    <span class="s1">fname = datapath(</span><span class="s2">&quot;io&quot;</span><span class="s0">, </span><span class="s2">&quot;sas&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;0x00controlbyte.sas7bdat.bz2&quot;</span><span class="s1">)</span>
    <span class="s1">df = next(pd.read_sas(fname</span><span class="s0">, </span><span class="s1">chunksize=</span><span class="s3">11_000</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">df.shape == (</span><span class="s3">11_000</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
</pre>
</body>
</html>
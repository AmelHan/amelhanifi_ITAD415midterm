<html>
<head>
<title>test_pairwise.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_pairwise.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">&quot;&quot;&quot; 
 
Created on Wed Mar 28 15:34:18 2012 
 
Author: Josef Perktold 
&quot;&quot;&quot;</span>
<span class="s3">from </span><span class="s1">statsmodels.compat.python </span><span class="s3">import </span><span class="s1">asbytes</span>

<span class="s3">from </span><span class="s1">io </span><span class="s3">import </span><span class="s1">BytesIO</span>
<span class="s3">import </span><span class="s1">warnings</span>

<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">import </span><span class="s1">pandas </span><span class="s3">as </span><span class="s1">pd</span>
<span class="s3">import </span><span class="s1">pytest</span>
<span class="s3">from </span><span class="s1">numpy.testing </span><span class="s3">import </span><span class="s1">assert_</span><span class="s3">, </span><span class="s1">assert_allclose</span><span class="s3">, </span><span class="s1">assert_almost_equal</span><span class="s3">, </span><span class="s1">assert_equal</span><span class="s3">, </span><span class="s1">\</span>
    <span class="s1">assert_raises</span>

<span class="s3">from </span><span class="s1">statsmodels.stats.libqsturng </span><span class="s3">import </span><span class="s1">qsturng</span>
<span class="s3">from </span><span class="s1">statsmodels.stats.multicomp </span><span class="s3">import </span><span class="s1">(tukeyhsd</span><span class="s3">, </span><span class="s1">pairwise_tukeyhsd</span><span class="s3">,</span>
                                         <span class="s1">MultiComparison)</span>

<span class="s1">ss = </span><span class="s4">'''</span><span class="s3">\ 
  </span><span class="s4">43.9  1   1 
  39.0  1   2 
  46.7  1   3 
  43.8  1   4 
  44.2  1   5 
  47.7  1   6 
  43.6  1   7 
  38.9  1   8 
  43.6  1   9 
  40.0  1  10 
  89.8  2   1 
  87.1  2   2 
  92.7  2   3 
  90.6  2   4 
  87.7  2   5 
  92.4  2   6 
  86.1  2   7 
  88.1  2   8 
  90.8  2   9 
  89.1  2  10 
  68.4  3   1 
  69.3  3   2 
  68.5  3   3 
  66.4  3   4 
  70.0  3   5 
  68.1  3   6 
  70.6  3   7 
  65.2  3   8 
  63.8  3   9 
  69.2  3  10 
  36.2  4   1 
  45.2  4   2 
  40.7  4   3 
  40.5  4   4 
  39.3  4   5 
  40.3  4   6 
  43.2  4   7 
  38.7  4   8 
  40.9  4   9 
  39.7  4  10'''</span>

<span class="s0">#idx   Treatment StressReduction</span>
<span class="s1">ss2 = </span><span class="s4">'''</span><span class="s3">\ 
</span><span class="s4">1     mental               2 
2     mental               2 
3     mental               3 
4     mental               4 
5     mental               4 
6     mental               5 
7     mental               3 
8     mental               4 
9     mental               4 
10    mental               4 
11  physical               4 
12  physical               4 
13  physical               3 
14  physical               5 
15  physical               4 
16  physical               1 
17  physical               1 
18  physical               2 
19  physical               3 
20  physical               3 
21   medical               1 
22   medical               2 
23   medical               2 
24   medical               2 
25   medical               3 
26   medical               2 
27   medical               3 
28   medical               1 
29   medical               3 
30   medical               1'''</span>

<span class="s1">ss3 = </span><span class="s4">'''</span><span class="s3">\ 
</span><span class="s4">1 24.5 
1 23.5 
1 26.4 
1 27.1 
1 29.9 
2 28.4 
2 34.2 
2 29.5 
2 32.2 
2 30.1 
3 26.1 
3 28.3 
3 24.3 
3 26.2 
3 27.8'''</span>

<span class="s1">ss5 = </span><span class="s4">'''</span><span class="s3">\ 
</span><span class="s4">2 - 3</span><span class="s3">\t</span><span class="s4">4.340</span><span class="s3">\t</span><span class="s4">0.691</span><span class="s3">\t</span><span class="s4">7.989</span><span class="s3">\t</span><span class="s4">*** 
2 - 1</span><span class="s3">\t</span><span class="s4">4.600</span><span class="s3">\t</span><span class="s4">0.951</span><span class="s3">\t</span><span class="s4">8.249</span><span class="s3">\t</span><span class="s4">*** 
3 - 2</span><span class="s3">\t</span><span class="s4">-4.340</span><span class="s3">\t</span><span class="s4">-7.989</span><span class="s3">\t</span><span class="s4">-0.691</span><span class="s3">\t</span><span class="s4">*** 
3 - 1</span><span class="s3">\t</span><span class="s4">0.260</span><span class="s3">\t</span><span class="s4">-3.389</span><span class="s3">\t</span><span class="s4">3.909</span><span class="s3">\t</span><span class="s4">- 
1 - 2</span><span class="s3">\t</span><span class="s4">-4.600</span><span class="s3">\t</span><span class="s4">-8.249</span><span class="s3">\t</span><span class="s4">-0.951</span><span class="s3">\t</span><span class="s4">*** 
1 - 3</span><span class="s3">\t</span><span class="s4">-0.260</span><span class="s3">\t</span><span class="s4">-3.909</span><span class="s3">\t</span><span class="s4">3.389</span><span class="s3">\t</span><span class="s4">- 
'''</span>

<span class="s1">cylinders = np.array([</span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">,</span>
                    <span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">,</span>
                    <span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">,</span>
                    <span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s3">, </span><span class="s5">4</span><span class="s1">])</span>
<span class="s1">cyl_labels = np.array([</span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'France'</span><span class="s3">,</span>
    <span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">,</span>
    <span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'France'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'Sweden'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">,</span>
    <span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'France'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">,</span>
    <span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Sweden'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'France'</span><span class="s3">,</span>
    <span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">,</span>
    <span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">,</span>
    <span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Japan'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'Germany'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s3">, </span><span class="s4">'USA'</span><span class="s1">])</span>

<span class="s0">#accommodate recfromtxt for python 3.2, requires bytes</span>
<span class="s1">ss = asbytes(ss)</span>
<span class="s1">ss2 = asbytes(ss2)</span>
<span class="s1">ss3 = asbytes(ss3)</span>
<span class="s1">ss5 = asbytes(ss5)</span>

<span class="s1">dta = pd.read_csv(BytesIO(ss)</span><span class="s3">, </span><span class="s1">sep=</span><span class="s4">r'\s+'</span><span class="s3">, </span><span class="s1">header=</span><span class="s3">None, </span><span class="s1">engine=</span><span class="s4">'python'</span><span class="s1">)</span>
<span class="s1">dta.columns = </span><span class="s4">&quot;Rust&quot;</span><span class="s3">, </span><span class="s4">&quot;Brand&quot;</span><span class="s3">, </span><span class="s4">&quot;Replication&quot;</span>
<span class="s1">dta2 = pd.read_csv(BytesIO(ss2)</span><span class="s3">, </span><span class="s1">sep=</span><span class="s4">r'\s+'</span><span class="s3">, </span><span class="s1">header=</span><span class="s3">None, </span><span class="s1">engine=</span><span class="s4">'python'</span><span class="s1">)</span>
<span class="s1">dta2.columns = </span><span class="s4">&quot;idx&quot;</span><span class="s3">, </span><span class="s4">&quot;Treatment&quot;</span><span class="s3">, </span><span class="s4">&quot;StressReduction&quot;</span>
<span class="s1">dta2[</span><span class="s4">&quot;Treatment&quot;</span><span class="s1">] = dta2[</span><span class="s4">&quot;Treatment&quot;</span><span class="s1">].map(</span><span class="s3">lambda </span><span class="s1">v: v.encode(</span><span class="s4">'utf-8'</span><span class="s1">))</span>
<span class="s1">dta3 = pd.read_csv(BytesIO(ss3)</span><span class="s3">, </span><span class="s1">sep=</span><span class="s4">r'\s+'</span><span class="s3">, </span><span class="s1">header=</span><span class="s3">None, </span><span class="s1">engine=</span><span class="s4">'python'</span><span class="s1">)</span>
<span class="s1">dta3.columns = [</span><span class="s4">&quot;Brand&quot;</span><span class="s3">, </span><span class="s4">&quot;Relief&quot;</span><span class="s1">]</span>
<span class="s1">dta5 = pd.read_csv(BytesIO(ss5)</span><span class="s3">, </span><span class="s1">sep=</span><span class="s4">r'\t'</span><span class="s3">, </span><span class="s1">header=</span><span class="s3">None, </span><span class="s1">engine=</span><span class="s4">'python'</span><span class="s1">)</span>
<span class="s1">dta5.columns = [</span><span class="s4">'pair'</span><span class="s3">, </span><span class="s4">'mean'</span><span class="s3">, </span><span class="s4">'lower'</span><span class="s3">, </span><span class="s4">'upper'</span><span class="s3">, </span><span class="s4">'sig'</span><span class="s1">]</span>
<span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">(</span><span class="s4">'pair'</span><span class="s3">, </span><span class="s4">'sig'</span><span class="s1">):</span>
    <span class="s1">dta5[col] = dta5[col].map(</span><span class="s3">lambda </span><span class="s1">v: v.encode(</span><span class="s4">'utf-8'</span><span class="s1">))</span>
<span class="s1">sas_ = dta5.iloc[[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">2</span><span class="s1">]]</span>


<span class="s3">def </span><span class="s1">get_thsd(mci</span><span class="s3">, </span><span class="s1">alpha=</span><span class="s5">0.05</span><span class="s1">):</span>
    <span class="s1">var_ = np.var(mci.groupstats.groupdemean()</span><span class="s3">, </span><span class="s1">ddof=len(mci.groupsunique))</span>
    <span class="s1">means = mci.groupstats.groupmean</span>
    <span class="s1">nobs = mci.groupstats.groupnobs</span>
    <span class="s1">resi = tukeyhsd(means</span><span class="s3">, </span><span class="s1">nobs</span><span class="s3">, </span><span class="s1">var_</span><span class="s3">, </span><span class="s1">df=</span><span class="s3">None, </span><span class="s1">alpha=alpha</span><span class="s3">,</span>
                    <span class="s1">q_crit=qsturng(</span><span class="s5">1</span><span class="s1">-alpha</span><span class="s3">, </span><span class="s1">len(means)</span><span class="s3">, </span><span class="s1">(nobs-</span><span class="s5">1</span><span class="s1">).sum()))</span>
    <span class="s0">#print resi[4]</span>
    <span class="s1">var2 = (mci.groupstats.groupvarwithin() * (nobs - </span><span class="s5">1.</span><span class="s1">)).sum() \</span>
                                                        <span class="s1">/ (nobs - </span><span class="s5">1.</span><span class="s1">).sum()</span>
    <span class="s0">#print nobs, (nobs - 1).sum()</span>
    <span class="s0">#print mci.groupstats.groupvarwithin()</span>
    <span class="s1">assert_almost_equal(var_</span><span class="s3">, </span><span class="s1">var2</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s5">14</span><span class="s1">)</span>
    <span class="s3">return </span><span class="s1">resi</span>

<span class="s3">class </span><span class="s1">CheckTuckeyHSDMixin:</span>

    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class_(cls):</span>
        <span class="s1">cls.mc = MultiComparison(cls.endog</span><span class="s3">, </span><span class="s1">cls.groups)</span>
        <span class="s1">cls.res = cls.mc.tukeyhsd(alpha=cls.alpha)</span>

    <span class="s3">def </span><span class="s1">test_multicomptukey(self):</span>
        <span class="s1">assert_almost_equal(self.res.meandiffs</span><span class="s3">, </span><span class="s1">self.meandiff2</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s5">14</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(self.res.confint</span><span class="s3">, </span><span class="s1">self.confint2</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(self.res.reject</span><span class="s3">, </span><span class="s1">self.reject2)</span>

    <span class="s3">def </span><span class="s1">test_group_tukey(self):</span>
        <span class="s1">res_t = get_thsd(self.mc</span><span class="s3">, </span><span class="s1">alpha=self.alpha)</span>
        <span class="s1">assert_almost_equal(res_t[</span><span class="s5">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">self.confint2</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_shortcut_function(self):</span>
        <span class="s0">#check wrapper function</span>
        <span class="s1">res = pairwise_tukeyhsd(self.endog</span><span class="s3">, </span><span class="s1">self.groups</span><span class="s3">, </span><span class="s1">alpha=self.alpha)</span>
        <span class="s1">assert_almost_equal(res.confint</span><span class="s3">, </span><span class="s1">self.res.confint</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s5">14</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.smoke</span>
    <span class="s1">@pytest.mark.matplotlib</span>
    <span class="s3">def </span><span class="s1">test_plot_simultaneous_ci(self</span><span class="s3">, </span><span class="s1">close_figures):</span>
        <span class="s1">self.res._simultaneous_ci()</span>
        <span class="s1">reference = self.res.groupsunique[</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">self.res.plot_simultaneous(comparison_name=reference)</span>


<span class="s3">class </span><span class="s1">TestTuckeyHSD2(CheckTuckeyHSDMixin):</span>

    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s0">#balanced case</span>
        <span class="s1">cls.endog = dta2[</span><span class="s4">'StressReduction'</span><span class="s1">]</span>
        <span class="s1">cls.groups = dta2[</span><span class="s4">'Treatment'</span><span class="s1">]</span>
        <span class="s1">cls.alpha = </span><span class="s5">0.05</span>
        <span class="s1">cls.setup_class_() </span><span class="s0">#in super</span>

        <span class="s0">#from R</span>
        <span class="s1">tukeyhsd2s = np.array([ </span><span class="s5">1.5</span><span class="s3">,</span><span class="s5">1</span><span class="s3">,</span><span class="s1">-</span><span class="s5">0.5</span><span class="s3">,</span><span class="s5">0.3214915</span><span class="s3">,</span>
                               <span class="s1">-</span><span class="s5">0.1785085</span><span class="s3">,</span><span class="s1">-</span><span class="s5">1.678509</span><span class="s3">,</span><span class="s5">2.678509</span><span class="s3">,</span><span class="s5">2.178509</span><span class="s3">,</span>
                                <span class="s5">0.6785085</span><span class="s3">,</span><span class="s5">0.01056279</span><span class="s3">,</span><span class="s5">0.1079035</span><span class="s3">,</span><span class="s5">0.5513904</span><span class="s1">]</span>
                              <span class="s1">).reshape(</span><span class="s5">3</span><span class="s3">,</span><span class="s5">4</span><span class="s3">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span>
        <span class="s1">cls.meandiff2 = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">0</span><span class="s1">]</span>
        <span class="s1">cls.confint2 = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">1</span><span class="s1">:</span><span class="s5">3</span><span class="s1">]</span>
        <span class="s1">pvals = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">3</span><span class="s1">]</span>
        <span class="s1">cls.reject2 = pvals &lt; </span><span class="s5">0.05</span>

    <span class="s3">def </span><span class="s1">test_table_names_default_group_order(self):</span>
        <span class="s1">t = self.res._results_table</span>
        <span class="s0"># if the group_order parameter is not used, the groups should</span>
        <span class="s0"># be reported in alphabetical order</span>
        <span class="s1">expected_order = [(</span><span class="s6">b'medical'</span><span class="s3">, </span><span class="s6">b'mental'</span><span class="s1">)</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s6">b'medical'</span><span class="s3">, </span><span class="s6">b'physical'</span><span class="s1">)</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s6">b'mental'</span><span class="s3">, </span><span class="s6">b'physical'</span><span class="s1">)]</span>
        <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">4</span><span class="s1">):</span>
            <span class="s1">first_group = t[i][</span><span class="s5">0</span><span class="s1">].data</span>
            <span class="s1">second_group = t[i][</span><span class="s5">1</span><span class="s1">].data</span>
            <span class="s1">assert_((first_group</span><span class="s3">, </span><span class="s1">second_group) == expected_order[i - </span><span class="s5">1</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_table_names_custom_group_order(self):</span>
        <span class="s0"># if the group_order parameter is used, the groups should</span>
        <span class="s0"># be reported in the specified order</span>
        <span class="s1">mc = MultiComparison(self.endog</span><span class="s3">, </span><span class="s1">self.groups</span><span class="s3">,</span>
                             <span class="s1">group_order=[</span><span class="s6">b'physical'</span><span class="s3">, </span><span class="s6">b'medical'</span><span class="s3">, </span><span class="s6">b'mental'</span><span class="s1">])</span>
        <span class="s1">res = mc.tukeyhsd(alpha=self.alpha)</span>
        <span class="s0">#print(res)</span>
        <span class="s1">t = res._results_table</span>
        <span class="s1">expected_order = [(</span><span class="s6">b'physical'</span><span class="s3">,</span><span class="s6">b'medical'</span><span class="s1">)</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s6">b'physical'</span><span class="s3">,</span><span class="s6">b'mental'</span><span class="s1">)</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s6">b'medical'</span><span class="s3">, </span><span class="s6">b'mental'</span><span class="s1">)]</span>
        <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">4</span><span class="s1">):</span>
            <span class="s1">first_group = t[i][</span><span class="s5">0</span><span class="s1">].data</span>
            <span class="s1">second_group = t[i][</span><span class="s5">1</span><span class="s1">].data</span>
            <span class="s1">assert_((first_group</span><span class="s3">, </span><span class="s1">second_group) == expected_order[i - </span><span class="s5">1</span><span class="s1">])</span>


<span class="s3">class </span><span class="s1">TestTuckeyHSD2Pandas(TestTuckeyHSD2):</span>

    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">super(TestTuckeyHSD2Pandas</span><span class="s3">, </span><span class="s1">cls).setup_class()</span>

        <span class="s1">cls.endog = pd.Series(cls.endog)</span>
        <span class="s0"># we are working with bytes on python 3, not with strings in this case</span>
        <span class="s1">cls.groups = pd.Series(cls.groups</span><span class="s3">, </span><span class="s1">dtype=object)</span>

    <span class="s3">def </span><span class="s1">test_incorrect_output(self):</span>
        <span class="s0"># too few groups</span>
        <span class="s3">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">MultiComparison(np.array([</span><span class="s5">1</span><span class="s1">] * </span><span class="s5">10</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s1">] * </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s0"># too many groups</span>
        <span class="s3">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">MultiComparison(np.array([</span><span class="s5">1</span><span class="s1">] * </span><span class="s5">10</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s1">] * </span><span class="s5">6</span><span class="s1">)</span>
        <span class="s0"># just one group</span>
        <span class="s3">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">MultiComparison(np.array([</span><span class="s5">1</span><span class="s1">] * </span><span class="s5">10</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s5">1</span><span class="s1">] * </span><span class="s5">10</span><span class="s1">)</span>

        <span class="s0"># group_order does not select all observations, only one group left</span>
        <span class="s3">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s3">True</span><span class="s1">) </span><span class="s3">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s4">'always'</span><span class="s1">)</span>
            <span class="s1">assert_raises(ValueError</span><span class="s3">, </span><span class="s1">MultiComparison</span><span class="s3">, </span><span class="s1">np.array([</span><span class="s5">1</span><span class="s1">] * </span><span class="s5">10</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s1">] * </span><span class="s5">5</span><span class="s3">, </span><span class="s1">group_order=[</span><span class="s5">1</span><span class="s1">])</span>

        <span class="s0"># group_order does not select all observations,</span>
        <span class="s0"># we do tukey_hsd with reduced set of observations</span>
        <span class="s1">data = np.arange(</span><span class="s5">15</span><span class="s1">)</span>
        <span class="s1">groups = np.repeat([</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s1">]</span><span class="s3">, </span><span class="s5">5</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s3">True</span><span class="s1">) </span><span class="s3">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s4">'always'</span><span class="s1">)</span>
            <span class="s1">mod1 = MultiComparison(np.array(data)</span><span class="s3">, </span><span class="s1">groups</span><span class="s3">, </span><span class="s1">group_order=[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s1">])</span>
            <span class="s1">assert_equal(len(w)</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
            <span class="s3">assert </span><span class="s1">issubclass(w[</span><span class="s5">0</span><span class="s1">].category</span><span class="s3">, </span><span class="s1">UserWarning)</span>

        <span class="s1">res1 = mod1.tukeyhsd(alpha=</span><span class="s5">0.01</span><span class="s1">)</span>
        <span class="s1">mod2 = MultiComparison(np.array(data[:</span><span class="s5">10</span><span class="s1">])</span><span class="s3">, </span><span class="s1">groups[:</span><span class="s5">10</span><span class="s1">])</span>
        <span class="s1">res2 = mod2.tukeyhsd(alpha=</span><span class="s5">0.01</span><span class="s1">)</span>

        <span class="s1">attributes = [</span><span class="s4">'confint'</span><span class="s3">, </span><span class="s4">'data'</span><span class="s3">, </span><span class="s4">'df_total'</span><span class="s3">, </span><span class="s4">'groups'</span><span class="s3">, </span><span class="s4">'groupsunique'</span><span class="s3">,</span>
                     <span class="s4">'meandiffs'</span><span class="s3">, </span><span class="s4">'q_crit'</span><span class="s3">, </span><span class="s4">'reject'</span><span class="s3">, </span><span class="s4">'reject2'</span><span class="s3">, </span><span class="s4">'std_pairs'</span><span class="s3">,</span>
                     <span class="s4">'variance'</span><span class="s1">]</span>
        <span class="s3">for </span><span class="s1">att </span><span class="s3">in </span><span class="s1">attributes:</span>
            <span class="s1">err_msg = att + </span><span class="s4">'failed'</span>
            <span class="s1">assert_allclose(getattr(res1</span><span class="s3">, </span><span class="s1">att)</span><span class="s3">, </span><span class="s1">getattr(res2</span><span class="s3">, </span><span class="s1">att)</span><span class="s3">, </span><span class="s1">rtol=</span><span class="s5">1e-14</span><span class="s3">,</span>
                            <span class="s1">err_msg=err_msg)</span>

        <span class="s1">attributes = [</span><span class="s4">'data'</span><span class="s3">, </span><span class="s4">'datali'</span><span class="s3">, </span><span class="s4">'groupintlab'</span><span class="s3">, </span><span class="s4">'groups'</span><span class="s3">, </span><span class="s4">'groupsunique'</span><span class="s3">,</span>
                      <span class="s4">'ngroups'</span><span class="s3">, </span><span class="s4">'nobs'</span><span class="s3">, </span><span class="s4">'pairindices'</span><span class="s1">]</span>
        <span class="s3">for </span><span class="s1">att </span><span class="s3">in </span><span class="s1">attributes:</span>
            <span class="s1">err_msg = att + </span><span class="s4">'failed'</span>
            <span class="s1">assert_allclose(getattr(mod1</span><span class="s3">, </span><span class="s1">att)</span><span class="s3">, </span><span class="s1">getattr(mod2</span><span class="s3">, </span><span class="s1">att)</span><span class="s3">, </span><span class="s1">rtol=</span><span class="s5">1e-14</span><span class="s3">,</span>
                            <span class="s1">err_msg=err_msg)</span>


<span class="s3">class </span><span class="s1">TestTuckeyHSD2s(CheckTuckeyHSDMixin):</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s0">#unbalanced case</span>
        <span class="s1">cls.endog = dta2[</span><span class="s4">'StressReduction'</span><span class="s1">][</span><span class="s5">3</span><span class="s1">:</span><span class="s5">29</span><span class="s1">]</span>
        <span class="s1">cls.groups = dta2[</span><span class="s4">'Treatment'</span><span class="s1">][</span><span class="s5">3</span><span class="s1">:</span><span class="s5">29</span><span class="s1">]</span>
        <span class="s1">cls.alpha = </span><span class="s5">0.01</span>
        <span class="s1">cls.setup_class_()</span>

        <span class="s0">#from R</span>
        <span class="s1">tukeyhsd2s = np.array(</span>
                <span class="s1">[</span><span class="s5">1.8888888888888889</span><span class="s3">, </span><span class="s5">0.888888888888889</span><span class="s3">, </span><span class="s1">-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.2658549</span><span class="s3">,</span>
                 <span class="s1">-</span><span class="s5">0.5908785</span><span class="s3">, </span><span class="s1">-</span><span class="s5">2.587133</span><span class="s3">, </span><span class="s5">3.511923</span><span class="s3">, </span><span class="s5">2.368656</span><span class="s3">,</span>
                 <span class="s5">0.5871331</span><span class="s3">, </span><span class="s5">0.002837638</span><span class="s3">, </span><span class="s5">0.150456</span><span class="s3">, </span><span class="s5">0.1266072</span><span class="s1">]</span>
                <span class="s1">).reshape(</span><span class="s5">3</span><span class="s3">,</span><span class="s5">4</span><span class="s3">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span>
        <span class="s1">cls.meandiff2 = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">0</span><span class="s1">]</span>
        <span class="s1">cls.confint2 = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">1</span><span class="s1">:</span><span class="s5">3</span><span class="s1">]</span>
        <span class="s1">pvals = tukeyhsd2s[:</span><span class="s3">, </span><span class="s5">3</span><span class="s1">]</span>
        <span class="s1">cls.reject2 = pvals &lt; </span><span class="s5">0.01</span>


<span class="s3">class </span><span class="s1">TestTuckeyHSD3(CheckTuckeyHSDMixin):</span>

    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s0">#SAS case</span>
        <span class="s1">cls.endog = dta3[</span><span class="s4">'Relief'</span><span class="s1">]</span>
        <span class="s1">cls.groups = dta3[</span><span class="s4">'Brand'</span><span class="s1">]</span>
        <span class="s1">cls.alpha = </span><span class="s5">0.05</span>
        <span class="s1">cls.setup_class_()</span>
        <span class="s0">#super(cls, cls).setup_class_()</span>
        <span class="s0">#CheckTuckeyHSD.setup_class_()</span>
        <span class="s1">cls.meandiff2 = sas_[</span><span class="s4">'mean'</span><span class="s1">]</span>
        <span class="s1">cls.confint2 = sas_[[</span><span class="s4">'lower'</span><span class="s3">,</span><span class="s4">'upper'</span><span class="s1">]].astype(float).values.reshape((</span><span class="s5">3</span><span class="s3">, </span><span class="s5">2</span><span class="s1">))</span>
        <span class="s1">cls.reject2 = sas_[</span><span class="s4">'sig'</span><span class="s1">] == asbytes(</span><span class="s4">'***'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">TestTuckeyHSD4(CheckTuckeyHSDMixin):</span>

    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s0">#unbalanced case verified in Matlab</span>
        <span class="s1">cls.endog = cylinders</span>
        <span class="s1">cls.groups = cyl_labels</span>
        <span class="s1">cls.alpha = </span><span class="s5">0.05</span>
        <span class="s1">cls.setup_class_()</span>
        <span class="s1">cls.res._simultaneous_ci()</span>

        <span class="s0">#from Matlab</span>
        <span class="s1">cls.halfwidth2 = np.array([</span><span class="s5">1.5228335685980883</span><span class="s3">, </span><span class="s5">0.9794949704444682</span><span class="s3">, </span><span class="s5">0.78673802805533644</span><span class="s3">,</span>
                                    <span class="s5">2.3321237694566364</span><span class="s3">, </span><span class="s5">0.57355135882752939</span><span class="s1">])</span>
        <span class="s1">cls.meandiff2 = np.array([</span><span class="s5">0.22222222222222232</span><span class="s3">, </span><span class="s5">0.13333333333333375</span><span class="s3">, </span><span class="s5">0.0</span><span class="s3">, </span><span class="s5">2.2898550724637685</span><span class="s3">,</span>
                            <span class="s1">-</span><span class="s5">0.088888888888888573</span><span class="s3">, </span><span class="s1">-</span><span class="s5">0.22222222222222232</span><span class="s3">, </span><span class="s5">2.0676328502415462</span><span class="s3">,</span>
                            <span class="s1">-</span><span class="s5">0.13333333333333375</span><span class="s3">, </span><span class="s5">2.1565217391304348</span><span class="s3">, </span><span class="s5">2.2898550724637685</span><span class="s1">])</span>
        <span class="s1">cls.confint2 = np.array([-</span><span class="s5">2.32022210717</span><span class="s3">, </span><span class="s5">2.76466655161</span><span class="s3">, </span><span class="s1">-</span><span class="s5">2.247517583</span><span class="s3">, </span><span class="s5">2.51418424967</span><span class="s3">,</span>
                            <span class="s1">-</span><span class="s5">3.66405224956</span><span class="s3">, </span><span class="s5">3.66405224956</span><span class="s3">, </span><span class="s5">0.113960166573</span><span class="s3">, </span><span class="s5">4.46574997835</span><span class="s3">,</span>
                            <span class="s1">-</span><span class="s5">1.87278583908</span><span class="s3">, </span><span class="s5">1.6950080613</span><span class="s3">, </span><span class="s1">-</span><span class="s5">3.529655688</span><span class="s3">, </span><span class="s5">3.08521124356</span><span class="s3">, </span><span class="s5">0.568180988881</span><span class="s3">,</span>
                            <span class="s5">3.5670847116</span><span class="s3">, </span><span class="s1">-</span><span class="s5">3.31822643175</span><span class="s3">, </span><span class="s5">3.05155976508</span><span class="s3">, </span><span class="s5">0.951206924521</span><span class="s3">, </span><span class="s5">3.36183655374</span><span class="s3">,</span>
                             <span class="s1">-</span><span class="s5">0.74487911754</span><span class="s3">, </span><span class="s5">5.32458926247</span><span class="s1">]).reshape(</span><span class="s5">10</span><span class="s3">,</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">cls.reject2 = np.array([</span><span class="s3">False, False, False,  True, False, False,  True, False,  True, False</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_hochberg_intervals(self):</span>
        <span class="s1">assert_almost_equal(self.res.halfwidths</span><span class="s3">, </span><span class="s1">self.halfwidth2</span><span class="s3">, </span><span class="s5">4</span><span class="s1">)</span>
</pre>
</body>
</html>
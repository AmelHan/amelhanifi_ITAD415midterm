<html>
<head>
<title>test_holtwinters.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_holtwinters.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Author: Terence L van Zyl 
Modified: Kevin Sheppard 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">statsmodels.compat.pytest </span><span class="s2">import </span><span class="s1">pytest_warns</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">re</span>
<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_almost_equal</span>
<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">scipy.stats</span>

<span class="s2">from </span><span class="s1">statsmodels.tools.sm_exceptions </span><span class="s2">import </span><span class="s1">ConvergenceWarning</span><span class="s2">, </span><span class="s1">ValueWarning</span>
<span class="s2">from </span><span class="s1">statsmodels.tsa.holtwinters </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">PY_SMOOTHERS</span><span class="s2">,</span>
    <span class="s1">SMOOTHERS</span><span class="s2">,</span>
    <span class="s1">ExponentialSmoothing</span><span class="s2">,</span>
    <span class="s1">Holt</span><span class="s2">,</span>
    <span class="s1">SimpleExpSmoothing</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">statsmodels.tsa.holtwinters._exponential_smoothers </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">HoltWintersArgs</span><span class="s2">,</span>
    <span class="s1">_test_to_restricted</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">statsmodels.tsa.holtwinters._smoothers </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">HoltWintersArgs </span><span class="s2">as </span><span class="s1">PyHoltWintersArgs</span><span class="s2">,</span>
    <span class="s1">to_restricted</span><span class="s2">,</span>
    <span class="s1">to_unrestricted</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s1">base</span><span class="s2">, </span><span class="s1">_ = os.path.split(os.path.abspath(__file__))</span>
<span class="s1">housing_data = pd.read_csv(</span>
    <span class="s1">os.path.join(base</span><span class="s2">, </span><span class="s3">&quot;results&quot;</span><span class="s2">, </span><span class="s3">&quot;housing-data.csv&quot;</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">index_col=</span><span class="s3">&quot;DATE&quot;</span><span class="s2">,</span>
    <span class="s1">parse_dates=</span><span class="s2">True,</span>
<span class="s1">)</span>
<span class="s1">housing_data = housing_data.asfreq(</span><span class="s3">&quot;MS&quot;</span><span class="s1">)</span>

<span class="s1">SEASONALS = (</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s2">, None</span><span class="s1">)</span>
<span class="s1">TRENDS = (</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s2">, None</span><span class="s1">)</span>

<span class="s4"># aust = pd.read_json(aust_json, typ='Series').sort_index()</span>
<span class="s1">data = [</span>
    <span class="s5">41.727457999999999</span><span class="s2">,</span>
    <span class="s5">24.04185</span><span class="s2">,</span>
    <span class="s5">32.328102999999999</span><span class="s2">,</span>
    <span class="s5">37.328707999999999</span><span class="s2">,</span>
    <span class="s5">46.213152999999998</span><span class="s2">,</span>
    <span class="s5">29.346326000000001</span><span class="s2">,</span>
    <span class="s5">36.482909999999997</span><span class="s2">,</span>
    <span class="s5">42.977719</span><span class="s2">,</span>
    <span class="s5">48.901524999999999</span><span class="s2">,</span>
    <span class="s5">31.180221</span><span class="s2">,</span>
    <span class="s5">37.717880999999998</span><span class="s2">,</span>
    <span class="s5">40.420211000000002</span><span class="s2">,</span>
    <span class="s5">51.206862999999998</span><span class="s2">,</span>
    <span class="s5">31.887228</span><span class="s2">,</span>
    <span class="s5">40.978262999999998</span><span class="s2">,</span>
    <span class="s5">43.772491000000002</span><span class="s2">,</span>
    <span class="s5">55.558566999999996</span><span class="s2">,</span>
    <span class="s5">33.850915000000001</span><span class="s2">,</span>
    <span class="s5">42.076383</span><span class="s2">,</span>
    <span class="s5">45.642291999999998</span><span class="s2">,</span>
    <span class="s5">59.766779999999997</span><span class="s2">,</span>
    <span class="s5">35.191876999999998</span><span class="s2">,</span>
    <span class="s5">44.319737000000003</span><span class="s2">,</span>
    <span class="s5">47.913736</span><span class="s2">,</span>
<span class="s1">]</span>
<span class="s1">index = [</span>
    <span class="s3">&quot;2005-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2005-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2005-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2005-12-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2006-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2006-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2006-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2006-12-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2007-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2007-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2007-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2007-12-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2008-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2008-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2008-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2008-12-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2009-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2009-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2009-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2009-12-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2010-03-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2010-06-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2010-09-01 00:00:00&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;2010-12-01 00:00:00&quot;</span><span class="s2">,</span>
<span class="s1">]</span>
<span class="s1">idx = pd.to_datetime(index)</span>
<span class="s1">aust = pd.Series(data</span><span class="s2">, </span><span class="s1">index=pd.DatetimeIndex(idx</span><span class="s2">, </span><span class="s1">freq=pd.infer_freq(idx)))</span>


<span class="s1">@pytest.fixture(scope=</span><span class="s3">&quot;module&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">ses():</span>
    <span class="s1">rs = np.random.RandomState(</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">e = rs.standard_normal(</span><span class="s5">1200</span><span class="s1">)</span>
    <span class="s1">y = e.copy()</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1200</span><span class="s1">):</span>
        <span class="s1">y[i] = y[i - </span><span class="s5">1</span><span class="s1">] + e[i] - </span><span class="s5">0.2 </span><span class="s1">* e[i - </span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">y = y[</span><span class="s5">200</span><span class="s1">:]</span>
    <span class="s1">index = pd.date_range(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=y.shape[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">pd.Series(y</span><span class="s2">, </span><span class="s1">index=index</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;y&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">_simple_dbl_exp_smoother(x</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">, </span><span class="s1">beta</span><span class="s2">, </span><span class="s1">l0</span><span class="s2">, </span><span class="s1">b0</span><span class="s2">, </span><span class="s1">nforecast=</span><span class="s5">0</span><span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Simple, slow, direct implementation of double exp smoothing for testing 
    &quot;&quot;&quot;</span>
    <span class="s1">n = x.shape[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">lvals = np.zeros(n)</span>
    <span class="s1">b = np.zeros(n)</span>
    <span class="s1">xhat = np.zeros(n)</span>
    <span class="s1">f = np.zeros(nforecast)</span>
    <span class="s1">lvals[</span><span class="s5">0</span><span class="s1">] = l0</span>
    <span class="s1">b[</span><span class="s5">0</span><span class="s1">] = b0</span>
    <span class="s4"># Special case the 0 observations since index -1 is not available</span>
    <span class="s1">xhat[</span><span class="s5">0</span><span class="s1">] = l0 + b0</span>
    <span class="s1">lvals[</span><span class="s5">0</span><span class="s1">] = alpha * x[</span><span class="s5">0</span><span class="s1">] + (</span><span class="s5">1 </span><span class="s1">- alpha) * (l0 + b0)</span>
    <span class="s1">b[</span><span class="s5">0</span><span class="s1">] = beta * (lvals[</span><span class="s5">0</span><span class="s1">] - l0) + (</span><span class="s5">1 </span><span class="s1">- beta) * b0</span>
    <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">range(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">n):</span>
        <span class="s4"># Obs in index t is the time t forecast for t + 1</span>
        <span class="s1">lvals[t] = alpha * x[t] + (</span><span class="s5">1 </span><span class="s1">- alpha) * (lvals[t - </span><span class="s5">1</span><span class="s1">] + b[t - </span><span class="s5">1</span><span class="s1">])</span>
        <span class="s1">b[t] = beta * (lvals[t] - lvals[t - </span><span class="s5">1</span><span class="s1">]) + (</span><span class="s5">1 </span><span class="s1">- beta) * b[t - </span><span class="s5">1</span><span class="s1">]</span>

    <span class="s1">xhat[</span><span class="s5">1</span><span class="s1">:] = lvals[</span><span class="s5">0</span><span class="s1">:-</span><span class="s5">1</span><span class="s1">] + b[</span><span class="s5">0</span><span class="s1">:-</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">f[:] = lvals[-</span><span class="s5">1</span><span class="s1">] + np.arange(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">nforecast + </span><span class="s5">1</span><span class="s1">) * b[-</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">err = x - xhat</span>
    <span class="s2">return </span><span class="s1">lvals</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">err</span><span class="s2">, </span><span class="s1">xhat</span>


<span class="s2">class </span><span class="s1">TestHoltWinters:</span>
    <span class="s1">@classmethod</span>
    <span class="s2">def </span><span class="s1">setup_class(cls):</span>
        <span class="s4"># Changed for backwards compatibility with pandas</span>

        <span class="s4"># oildata_oil = pd.read_json(oildata_oil_json,</span>
        <span class="s4">#                            typ='Series').sort_index()</span>
        <span class="s1">data = [</span>
            <span class="s5">446.65652290000003</span><span class="s2">,</span>
            <span class="s5">454.47330649999998</span><span class="s2">,</span>
            <span class="s5">455.66297400000002</span><span class="s2">,</span>
            <span class="s5">423.63223879999998</span><span class="s2">,</span>
            <span class="s5">456.27132790000002</span><span class="s2">,</span>
            <span class="s5">440.58805009999998</span><span class="s2">,</span>
            <span class="s5">425.33252010000001</span><span class="s2">,</span>
            <span class="s5">485.14944789999998</span><span class="s2">,</span>
            <span class="s5">506.04816210000001</span><span class="s2">,</span>
            <span class="s5">526.79198329999997</span><span class="s2">,</span>
            <span class="s5">514.26888899999994</span><span class="s2">,</span>
            <span class="s5">494.21101929999998</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">index = [</span>
            <span class="s3">&quot;1996-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1997-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1998-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1999-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2000-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2001-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2002-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2003-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2004-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2005-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2006-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2007-12-31 00:00:00&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">oildata_oil = pd.Series(data</span><span class="s2">, </span><span class="s1">index)</span>
        <span class="s1">oildata_oil.index = pd.DatetimeIndex(</span>
            <span class="s1">oildata_oil.index</span><span class="s2">, </span><span class="s1">freq=pd.infer_freq(oildata_oil.index)</span>
        <span class="s1">)</span>
        <span class="s1">cls.oildata_oil = oildata_oil</span>

        <span class="s4"># air_ausair = pd.read_json(air_ausair_json,</span>
        <span class="s4">#                           typ='Series').sort_index()</span>
        <span class="s1">data = [</span>
            <span class="s5">17.5534</span><span class="s2">,</span>
            <span class="s5">21.860099999999999</span><span class="s2">,</span>
            <span class="s5">23.886600000000001</span><span class="s2">,</span>
            <span class="s5">26.929300000000001</span><span class="s2">,</span>
            <span class="s5">26.888500000000001</span><span class="s2">,</span>
            <span class="s5">28.831399999999999</span><span class="s2">,</span>
            <span class="s5">30.075099999999999</span><span class="s2">,</span>
            <span class="s5">30.953499999999998</span><span class="s2">,</span>
            <span class="s5">30.185700000000001</span><span class="s2">,</span>
            <span class="s5">31.579699999999999</span><span class="s2">,</span>
            <span class="s5">32.577568999999997</span><span class="s2">,</span>
            <span class="s5">33.477398000000001</span><span class="s2">,</span>
            <span class="s5">39.021580999999998</span><span class="s2">,</span>
            <span class="s5">41.386431999999999</span><span class="s2">,</span>
            <span class="s5">41.596552000000003</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">index = [</span>
            <span class="s3">&quot;1990-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1991-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1992-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1993-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1994-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1995-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1996-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1997-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1998-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1999-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2000-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2001-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2002-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2003-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2004-12-31 00:00:00&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">air_ausair = pd.Series(data</span><span class="s2">, </span><span class="s1">index)</span>
        <span class="s1">air_ausair.index = pd.DatetimeIndex(</span>
            <span class="s1">air_ausair.index</span><span class="s2">, </span><span class="s1">freq=pd.infer_freq(air_ausair.index)</span>
        <span class="s1">)</span>
        <span class="s1">cls.air_ausair = air_ausair</span>

        <span class="s4"># livestock2_livestock = pd.read_json(livestock2_livestock_json,</span>
        <span class="s4">#                                     typ='Series').sort_index()</span>
        <span class="s1">data = [</span>
            <span class="s5">263.91774700000002</span><span class="s2">,</span>
            <span class="s5">268.30722200000002</span><span class="s2">,</span>
            <span class="s5">260.662556</span><span class="s2">,</span>
            <span class="s5">266.63941899999998</span><span class="s2">,</span>
            <span class="s5">277.51577800000001</span><span class="s2">,</span>
            <span class="s5">283.834045</span><span class="s2">,</span>
            <span class="s5">290.30902800000001</span><span class="s2">,</span>
            <span class="s5">292.474198</span><span class="s2">,</span>
            <span class="s5">300.83069399999999</span><span class="s2">,</span>
            <span class="s5">309.28665699999999</span><span class="s2">,</span>
            <span class="s5">318.33108099999998</span><span class="s2">,</span>
            <span class="s5">329.37239</span><span class="s2">,</span>
            <span class="s5">338.88399800000002</span><span class="s2">,</span>
            <span class="s5">339.24412599999999</span><span class="s2">,</span>
            <span class="s5">328.60063200000002</span><span class="s2">,</span>
            <span class="s5">314.25538499999999</span><span class="s2">,</span>
            <span class="s5">314.45969500000001</span><span class="s2">,</span>
            <span class="s5">321.41377899999998</span><span class="s2">,</span>
            <span class="s5">329.78929199999999</span><span class="s2">,</span>
            <span class="s5">346.38516499999997</span><span class="s2">,</span>
            <span class="s5">352.29788200000002</span><span class="s2">,</span>
            <span class="s5">348.37051500000001</span><span class="s2">,</span>
            <span class="s5">417.56292200000001</span><span class="s2">,</span>
            <span class="s5">417.12356999999997</span><span class="s2">,</span>
            <span class="s5">417.749459</span><span class="s2">,</span>
            <span class="s5">412.233904</span><span class="s2">,</span>
            <span class="s5">411.94681700000001</span><span class="s2">,</span>
            <span class="s5">394.69707499999998</span><span class="s2">,</span>
            <span class="s5">401.49927000000002</span><span class="s2">,</span>
            <span class="s5">408.27046799999999</span><span class="s2">,</span>
            <span class="s5">414.24279999999999</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">index = [</span>
            <span class="s3">&quot;1970-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1971-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1972-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1973-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1974-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1975-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1976-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1977-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1978-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1979-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1980-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1981-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1982-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1983-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1984-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1985-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1986-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1987-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1988-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1989-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1990-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1991-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1992-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1993-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1994-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1995-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1996-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1997-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1998-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;1999-12-31 00:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2000-12-31 00:00:00&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">livestock2_livestock = pd.Series(data</span><span class="s2">, </span><span class="s1">index)</span>
        <span class="s1">livestock2_livestock.index = pd.DatetimeIndex(</span>
            <span class="s1">livestock2_livestock.index</span><span class="s2">,</span>
            <span class="s1">freq=pd.infer_freq(livestock2_livestock.index)</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">cls.livestock2_livestock = livestock2_livestock</span>

        <span class="s1">cls.aust = aust</span>
        <span class="s1">cls.start_params = [</span>
            <span class="s5">1.5520372162082909e-09</span><span class="s2">,</span>
            <span class="s5">2.066338221674873e-18</span><span class="s2">,</span>
            <span class="s5">1.727109018250519e-09</span><span class="s2">,</span>
            <span class="s5">50.568333479425036</span><span class="s2">,</span>
            <span class="s5">0.9129273810171223</span><span class="s2">,</span>
            <span class="s5">0.83535867</span><span class="s2">,</span>
            <span class="s5">0.50297119</span><span class="s2">,</span>
            <span class="s5">0.62439273</span><span class="s2">,</span>
            <span class="s5">0.67723128</span><span class="s2">,</span>
        <span class="s1">]</span>

    <span class="s2">def </span><span class="s1">test_predict(self):</span>
        <span class="s1">fit1 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(start_params=self.start_params)</span>
        <span class="s1">fit2 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(start_params=self.start_params)</span>
        <span class="s4"># fit3 = ExponentialSmoothing(self.aust, seasonal_periods=4,</span>
        <span class="s4"># trend='add', seasonal='mul').fit(remove_bias=True,</span>
        <span class="s4"># use_basinhopping=True)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.predict(</span><span class="s3">&quot;2011-03-01 00:00:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-12-01 00:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s5">61.3083</span><span class="s2">, </span><span class="s5">37.3730</span><span class="s2">, </span><span class="s5">46.9652</span><span class="s2">, </span><span class="s5">51.5578</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">3</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit2.predict(end=</span><span class="s3">&quot;2011-12-01 00:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s5">61.3083</span><span class="s2">, </span><span class="s5">37.3730</span><span class="s2">, </span><span class="s5">46.9652</span><span class="s2">, </span><span class="s5">51.5578</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">3</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s4"># assert_almost_equal(fit3.predict('2010-10-01 00:00:00',</span>
    <span class="s4">#                                  '2010-10-01 00:00:00'),</span>
    <span class="s4">#                                  [49.087], 3)</span>

    <span class="s2">def </span><span class="s1">test_ndarray(self):</span>
        <span class="s1">fit1 = ExponentialSmoothing(</span>
            <span class="s1">self.aust.values</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(start_params=self.start_params)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.forecast(</span><span class="s5">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">61.3083</span><span class="s2">, </span><span class="s5">37.3730</span><span class="s2">, </span><span class="s5">46.9652</span><span class="s2">, </span><span class="s5">51.5578</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span>
        <span class="s1">)</span>

    <span class="s4"># FIXME: this is passing 2019-05-22 on some platforms; what has changed?</span>
    <span class="s1">@pytest.mark.xfail(reason=</span><span class="s3">&quot;Optimizer does not converge&quot;</span><span class="s2">, </span><span class="s1">strict=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_forecast(self):</span>
        <span class="s1">fit1 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(method=</span><span class="s3">&quot;bh&quot;</span><span class="s2">, </span><span class="s1">use_brute=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.forecast(steps=</span><span class="s5">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">60.9542</span><span class="s2">, </span><span class="s5">36.8505</span><span class="s2">, </span><span class="s5">46.1628</span><span class="s2">, </span><span class="s5">50.1272</span><span class="s1">]</span><span class="s2">, </span><span class="s5">3</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_simple_exp_smoothing(self):</span>
        <span class="s1">fit1 = SimpleExpSmoothing(</span>
            <span class="s1">self.oildata_oil</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span>
        <span class="s1">).fit(</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">optimized=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">fit2 = SimpleExpSmoothing(</span>
            <span class="s1">self.oildata_oil</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span>
        <span class="s1">).fit(</span><span class="s5">0.6</span><span class="s2">, </span><span class="s1">optimized=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">fit3 = SimpleExpSmoothing(</span>
            <span class="s1">self.oildata_oil</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
        <span class="s1">).fit()</span>
        <span class="s1">assert_almost_equal(fit1.forecast(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">484.802468</span><span class="s1">]</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.level</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s5">446.65652290</span><span class="s2">,</span>
                <span class="s5">448.21987962</span><span class="s2">,</span>
                <span class="s5">449.7084985</span><span class="s2">,</span>
                <span class="s5">444.49324656</span><span class="s2">,</span>
                <span class="s5">446.84886283</span><span class="s2">,</span>
                <span class="s5">445.59670028</span><span class="s2">,</span>
                <span class="s5">441.54386424</span><span class="s2">,</span>
                <span class="s5">450.26498098</span><span class="s2">,</span>
                <span class="s5">461.4216172</span><span class="s2">,</span>
                <span class="s5">474.49569042</span><span class="s2">,</span>
                <span class="s5">482.45033014</span><span class="s2">,</span>
                <span class="s5">484.80246797</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s5">4</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit2.forecast(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">501.837461</span><span class="s1">]</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit3.forecast(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">496.493543</span><span class="s1">]</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit3.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.891998</span><span class="s2">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit3.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">447.478440</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_holt(self):</span>
        <span class="s1">fit1 = Holt(</span>
            <span class="s1">self.air_ausair</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span>
        <span class="s1">).fit(smoothing_level=</span><span class="s5">0.8</span><span class="s2">, </span><span class="s1">smoothing_trend=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">optimized=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">fit2 = Holt(</span>
            <span class="s1">self.air_ausair</span><span class="s2">,</span>
            <span class="s1">exponential=</span><span class="s2">True,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(smoothing_level=</span><span class="s5">0.8</span><span class="s2">, </span><span class="s1">smoothing_trend=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">optimized=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">fit3 = Holt(</span>
            <span class="s1">self.air_ausair</span><span class="s2">,</span>
            <span class="s1">damped_trend=</span><span class="s2">True,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">).fit(smoothing_level=</span><span class="s5">0.8</span><span class="s2">, </span><span class="s1">smoothing_trend=</span><span class="s5">0.2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.forecast(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">43.76</span><span class="s2">, </span><span class="s5">45.59</span><span class="s2">, </span><span class="s5">47.43</span><span class="s2">, </span><span class="s5">49.27</span><span class="s2">, </span><span class="s5">51.10</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.trend</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s5">3.617628</span><span class="s2">,</span>
                <span class="s5">3.59006512</span><span class="s2">,</span>
                <span class="s5">3.33438212</span><span class="s2">,</span>
                <span class="s5">3.23657639</span><span class="s2">,</span>
                <span class="s5">2.69263502</span><span class="s2">,</span>
                <span class="s5">2.46388914</span><span class="s2">,</span>
                <span class="s5">2.2229097</span><span class="s2">,</span>
                <span class="s5">1.95959226</span><span class="s2">,</span>
                <span class="s5">1.47054601</span><span class="s2">,</span>
                <span class="s5">1.3604894</span><span class="s2">,</span>
                <span class="s5">1.28045881</span><span class="s2">,</span>
                <span class="s5">1.20355193</span><span class="s2">,</span>
                <span class="s5">1.88267152</span><span class="s2">,</span>
                <span class="s5">2.09564416</span><span class="s2">,</span>
                <span class="s5">1.83655482</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s5">4</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.fittedfcast</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s5">21.8601</span><span class="s2">,</span>
                <span class="s5">22.032368</span><span class="s2">,</span>
                <span class="s5">25.48461872</span><span class="s2">,</span>
                <span class="s5">27.54058587</span><span class="s2">,</span>
                <span class="s5">30.28813356</span><span class="s2">,</span>
                <span class="s5">30.26106173</span><span class="s2">,</span>
                <span class="s5">31.58122149</span><span class="s2">,</span>
                <span class="s5">32.599234</span><span class="s2">,</span>
                <span class="s5">33.24223906</span><span class="s2">,</span>
                <span class="s5">32.26755382</span><span class="s2">,</span>
                <span class="s5">33.07776017</span><span class="s2">,</span>
                <span class="s5">33.95806605</span><span class="s2">,</span>
                <span class="s5">34.77708354</span><span class="s2">,</span>
                <span class="s5">40.05535303</span><span class="s2">,</span>
                <span class="s5">43.21586036</span><span class="s2">,</span>
                <span class="s5">43.75696849</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s5">4</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit2.forecast(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">44.60</span><span class="s2">, </span><span class="s5">47.24</span><span class="s2">, </span><span class="s5">50.04</span><span class="s2">, </span><span class="s5">53.01</span><span class="s2">, </span><span class="s5">56.15</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span>
        <span class="s1">)</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit3.forecast(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">42.85</span><span class="s2">, </span><span class="s5">43.81</span><span class="s2">, </span><span class="s5">44.66</span><span class="s2">, </span><span class="s5">45.41</span><span class="s2">, </span><span class="s5">46.06</span><span class="s1">]</span><span class="s2">, </span><span class="s5">2</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.smoke</span>
    <span class="s2">def </span><span class="s1">test_holt_damp_fit(self):</span>
        <span class="s4"># Smoke test for parameter estimation</span>
        <span class="s1">fit1 = SimpleExpSmoothing(</span>
            <span class="s1">self.livestock2_livestock</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
        <span class="s1">).fit()</span>
        <span class="s1">mod4 = Holt(</span>
            <span class="s1">self.livestock2_livestock</span><span class="s2">,</span>
            <span class="s1">damped_trend=</span><span class="s2">True,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">fit4 = mod4.fit(damping_trend=</span><span class="s5">0.98</span><span class="s2">, </span><span class="s1">method=</span><span class="s3">&quot;least_squares&quot;</span><span class="s1">)</span>
        <span class="s1">mod5 = Holt(</span>
            <span class="s1">self.livestock2_livestock</span><span class="s2">,</span>
            <span class="s1">exponential=</span><span class="s2">True,</span>
            <span class="s1">damped_trend=</span><span class="s2">True,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">fit5 = mod5.fit()</span>
        <span class="s4"># We accept the below values as we getting a better SSE than text book</span>
        <span class="s1">assert_almost_equal(fit1.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1.00</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit1.params[</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">np.NaN</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit1.params[</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">np.NaN</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit1.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">263.96</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit1.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">np.NaN</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit1.sse</span><span class="s2">, </span><span class="s5">6761.35</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)  </span><span class="s4"># 6080.26</span>
        <span class="s2">assert </span><span class="s1">isinstance(fit1.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

        <span class="s1">assert_almost_equal(fit4.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.98</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit4.params[</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit4.params[</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.98</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit4.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">257.36</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit4.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">6.64</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit4.sse</span><span class="s2">, </span><span class="s5">6036.56</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)  </span><span class="s4"># 6080.26</span>
        <span class="s2">assert </span><span class="s1">isinstance(fit4.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

        <span class="s1">assert_almost_equal(fit5.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.97</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit5.params[</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit5.params[</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.98</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit5.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">258.95</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit5.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1.04</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(fit5.sse</span><span class="s2">, </span><span class="s5">6082.00</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)  </span><span class="s4"># 6100.11</span>
        <span class="s2">assert </span><span class="s1">isinstance(fit5.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

    <span class="s2">def </span><span class="s1">test_holt_damp_r(self):</span>
        <span class="s4"># Test the damping parameters against the R forecast packages `ets`</span>
        <span class="s4"># library(ets)</span>
        <span class="s4"># livestock2_livestock &lt;- c(...)</span>
        <span class="s4"># res &lt;- ets(livestock2_livestock, model='AAN', damped_trend=TRUE,</span>
        <span class="s4">#            phi=0.98)</span>
        <span class="s1">mod = Holt(</span>
            <span class="s1">self.livestock2_livestock</span><span class="s2">,</span>
            <span class="s1">damped_trend=</span><span class="s2">True,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">params = {</span>
            <span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.97402626</span><span class="s2">,</span>
            <span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">: </span><span class="s5">0.00010006</span><span class="s2">,</span>
            <span class="s3">&quot;damping_trend&quot;</span><span class="s1">: </span><span class="s5">0.98</span><span class="s2">,</span>
            <span class="s3">&quot;initial_level&quot;</span><span class="s1">: </span><span class="s5">252.59039965</span><span class="s2">,</span>
            <span class="s3">&quot;initial_trend&quot;</span><span class="s1">: </span><span class="s5">6.90265918</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">with </span><span class="s1">mod.fix_params(params):</span>
            <span class="s1">fit = mod.fit(optimized=</span><span class="s2">False</span><span class="s1">)</span>

        <span class="s4"># Check that we captured the parameters correctly</span>
        <span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">params.keys():</span>
            <span class="s1">assert_allclose(fit.params[key]</span><span class="s2">, </span><span class="s1">params[key])</span>

        <span class="s2">with </span><span class="s1">mod.fix_params(params):</span>
            <span class="s1">opt_fit = mod.fit(optimized=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_allclose(fit.sse</span><span class="s2">, </span><span class="s1">opt_fit.sse)</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">opt_fit.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">alt_params = {k: v </span><span class="s2">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">params.items() </span><span class="s2">if </span><span class="s3">&quot;level&quot; </span><span class="s2">not in </span><span class="s1">k}</span>
        <span class="s2">with </span><span class="s1">mod.fix_params(alt_params):</span>
            <span class="s1">alt_fit = mod.fit(optimized=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">assert not </span><span class="s1">np.allclose(alt_fit.trend[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">opt_fit.trend[</span><span class="s5">0</span><span class="s1">])</span>
        <span class="s4"># Summary output</span>
        <span class="s4"># print(res$mse)</span>
        <span class="s1">assert_allclose(fit.sse / mod.nobs</span><span class="s2">, </span><span class="s5">195.4397924865488</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-3</span><span class="s1">)</span>
        <span class="s4"># print(res$aicc)</span>
        <span class="s4"># TODO: this fails - different AICC definition?</span>
        <span class="s4"># assert_allclose(fit.aicc, 282.386426659408, atol=1e-3)</span>
        <span class="s4"># print(res$bic)</span>
        <span class="s4"># TODO: this fails - different BIC definition?</span>
        <span class="s4"># assert_allclose(fit.bic, 287.1563626818338)</span>

        <span class="s4"># print(res$states[,'l'])</span>
        <span class="s4"># note: this array includes the initial level</span>
        <span class="s1">desired = [</span>
            <span class="s5">252.5903996514365</span><span class="s2">,</span>
            <span class="s5">263.7992355246843</span><span class="s2">,</span>
            <span class="s5">268.3623324350207</span><span class="s2">,</span>
            <span class="s5">261.0312983437606</span><span class="s2">,</span>
            <span class="s5">266.6590942700923</span><span class="s2">,</span>
            <span class="s5">277.3958197247272</span><span class="s2">,</span>
            <span class="s5">283.8256217863908</span><span class="s2">,</span>
            <span class="s5">290.2962560621914</span><span class="s2">,</span>
            <span class="s5">292.5701438129583</span><span class="s2">,</span>
            <span class="s5">300.7655919939834</span><span class="s2">,</span>
            <span class="s5">309.2118057241649</span><span class="s2">,</span>
            <span class="s5">318.2377698496536</span><span class="s2">,</span>
            <span class="s5">329.2238709362550</span><span class="s2">,</span>
            <span class="s5">338.7709778307978</span><span class="s2">,</span>
            <span class="s5">339.3669793596703</span><span class="s2">,</span>
            <span class="s5">329.0127022356033</span><span class="s2">,</span>
            <span class="s5">314.7684267018998</span><span class="s2">,</span>
            <span class="s5">314.5948077575944</span><span class="s2">,</span>
            <span class="s5">321.3612035017972</span><span class="s2">,</span>
            <span class="s5">329.6924360833211</span><span class="s2">,</span>
            <span class="s5">346.0712138652086</span><span class="s2">,</span>
            <span class="s5">352.2534120008911</span><span class="s2">,</span>
            <span class="s5">348.5862874190927</span><span class="s2">,</span>
            <span class="s5">415.8839400693967</span><span class="s2">,</span>
            <span class="s5">417.2018843196238</span><span class="s2">,</span>
            <span class="s5">417.8435306633725</span><span class="s2">,</span>
            <span class="s5">412.4857261252961</span><span class="s2">,</span>
            <span class="s5">412.0647865321129</span><span class="s2">,</span>
            <span class="s5">395.2500605270393</span><span class="s2">,</span>
            <span class="s5">401.4367438266322</span><span class="s2">,</span>
            <span class="s5">408.1907701386275</span><span class="s2">,</span>
            <span class="s5">414.1814574903921</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">assert_allclose(np.r_[fit.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">fit.level]</span><span class="s2">, </span><span class="s1">desired)</span>

        <span class="s4"># print(res$states[,'b'])</span>
        <span class="s4"># note: this array includes the initial slope</span>
        <span class="s1">desired = [</span>
            <span class="s5">6.902659175332394</span><span class="s2">,</span>
            <span class="s5">6.765062519124909</span><span class="s2">,</span>
            <span class="s5">6.629548973536494</span><span class="s2">,</span>
            <span class="s5">6.495537532917715</span><span class="s2">,</span>
            <span class="s5">6.365550989616566</span><span class="s2">,</span>
            <span class="s5">6.238702070454378</span><span class="s2">,</span>
            <span class="s5">6.113960476763530</span><span class="s2">,</span>
            <span class="s5">5.991730467006233</span><span class="s2">,</span>
            <span class="s5">5.871526257315264</span><span class="s2">,</span>
            <span class="s5">5.754346516684953</span><span class="s2">,</span>
            <span class="s5">5.639547926790058</span><span class="s2">,</span>
            <span class="s5">5.527116419415724</span><span class="s2">,</span>
            <span class="s5">5.417146212898857</span><span class="s2">,</span>
            <span class="s5">5.309238662451385</span><span class="s2">,</span>
            <span class="s5">5.202580636191761</span><span class="s2">,</span>
            <span class="s5">5.096941655567694</span><span class="s2">,</span>
            <span class="s5">4.993026494493987</span><span class="s2">,</span>
            <span class="s5">4.892645486210410</span><span class="s2">,</span>
            <span class="s5">4.794995106664251</span><span class="s2">,</span>
            <span class="s5">4.699468310763351</span><span class="s2">,</span>
            <span class="s5">4.606688340205792</span><span class="s2">,</span>
            <span class="s5">4.514725879754355</span><span class="s2">,</span>
            <span class="s5">4.423600168391240</span><span class="s2">,</span>
            <span class="s5">4.341595902295941</span><span class="s2">,</span>
            <span class="s5">4.254462303550087</span><span class="s2">,</span>
            <span class="s5">4.169010676686062</span><span class="s2">,</span>
            <span class="s5">4.084660399498803</span><span class="s2">,</span>
            <span class="s5">4.002512751871354</span><span class="s2">,</span>
            <span class="s5">3.920332298146730</span><span class="s2">,</span>
            <span class="s5">3.842166514133902</span><span class="s2">,</span>
            <span class="s5">3.765630194200260</span><span class="s2">,</span>
            <span class="s5">3.690553892582855</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s4"># TODO: not sure why the precision is so low here...</span>
        <span class="s1">assert_allclose(</span>
            <span class="s1">np.r_[fit.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">fit.trend]</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-3</span>
        <span class="s1">)</span>

        <span class="s4"># print(res$fitted)</span>
        <span class="s1">desired = [</span>
            <span class="s5">259.3550056432622</span><span class="s2">,</span>
            <span class="s5">270.4289967934267</span><span class="s2">,</span>
            <span class="s5">274.8592904290865</span><span class="s2">,</span>
            <span class="s5">267.3969251260200</span><span class="s2">,</span>
            <span class="s5">272.8973342399166</span><span class="s2">,</span>
            <span class="s5">283.5097477537724</span><span class="s2">,</span>
            <span class="s5">289.8173030536191</span><span class="s2">,</span>
            <span class="s5">296.1681519198575</span><span class="s2">,</span>
            <span class="s5">298.3242395451272</span><span class="s2">,</span>
            <span class="s5">306.4048515803347</span><span class="s2">,</span>
            <span class="s5">314.7385626924191</span><span class="s2">,</span>
            <span class="s5">323.6543439406810</span><span class="s2">,</span>
            <span class="s5">334.5326742248959</span><span class="s2">,</span>
            <span class="s5">343.9740317200002</span><span class="s2">,</span>
            <span class="s5">344.4655083831382</span><span class="s2">,</span>
            <span class="s5">334.0077050580596</span><span class="s2">,</span>
            <span class="s5">319.6615926665040</span><span class="s2">,</span>
            <span class="s5">319.3896003340806</span><span class="s2">,</span>
            <span class="s5">326.0602987063282</span><span class="s2">,</span>
            <span class="s5">334.2979150278692</span><span class="s2">,</span>
            <span class="s5">350.5857684386102</span><span class="s2">,</span>
            <span class="s5">356.6778433630504</span><span class="s2">,</span>
            <span class="s5">352.9214155841161</span><span class="s2">,</span>
            <span class="s5">420.1387040536467</span><span class="s2">,</span>
            <span class="s5">421.3712573771029</span><span class="s2">,</span>
            <span class="s5">421.9291611265248</span><span class="s2">,</span>
            <span class="s5">416.4886933168049</span><span class="s2">,</span>
            <span class="s5">415.9872490289468</span><span class="s2">,</span>
            <span class="s5">399.0919861792231</span><span class="s2">,</span>
            <span class="s5">405.2020670104834</span><span class="s2">,</span>
            <span class="s5">411.8810877289437</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">assert_allclose(fit.fittedvalues</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-3</span><span class="s1">)</span>

        <span class="s4"># print(forecast(res)$mean)</span>
        <span class="s1">desired = [</span>
            <span class="s5">417.7982003051233</span><span class="s2">,</span>
            <span class="s5">421.3426082635598</span><span class="s2">,</span>
            <span class="s5">424.8161280628277</span><span class="s2">,</span>
            <span class="s5">428.2201774661102</span><span class="s2">,</span>
            <span class="s5">431.5561458813270</span><span class="s2">,</span>
            <span class="s5">434.8253949282395</span><span class="s2">,</span>
            <span class="s5">438.0292589942138</span><span class="s2">,</span>
            <span class="s5">441.1690457788685</span><span class="s2">,</span>
            <span class="s5">444.2460368278302</span><span class="s2">,</span>
            <span class="s5">447.2614880558126</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">assert_allclose(fit.forecast(</span><span class="s5">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-4</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_hw_seasonal(self):</span>
        <span class="s1">mod = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;additive&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;additive&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s2">True,</span>
        <span class="s1">)</span>
        <span class="s1">fit1 = mod.fit()</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit1.forecast(</span><span class="s5">8</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s5">59.96</span><span class="s2">, </span><span class="s5">38.63</span><span class="s2">, </span><span class="s5">47.48</span><span class="s2">, </span><span class="s5">51.89</span><span class="s2">, </span><span class="s5">62.81</span><span class="s2">, </span><span class="s5">41.0</span><span class="s2">, </span><span class="s5">50.06</span><span class="s2">, </span><span class="s5">54.57</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">2</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_hw_seasonal_add_mul(self):</span>
        <span class="s1">mod2 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s2">True,</span>
        <span class="s1">)</span>
        <span class="s1">fit2 = mod2.fit()</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit2.forecast(</span><span class="s5">8</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s5">61.69</span><span class="s2">, </span><span class="s5">37.37</span><span class="s2">, </span><span class="s5">47.22</span><span class="s2">, </span><span class="s5">52.03</span><span class="s2">, </span><span class="s5">65.08</span><span class="s2">, </span><span class="s5">39.34</span><span class="s2">, </span><span class="s5">49.72</span><span class="s2">, </span><span class="s5">54.79</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s5">2</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s5">0.0</span><span class="s2">,</span>
        <span class="s1">).fit()</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;multiplicative&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;multiplicative&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s5">0.0</span><span class="s2">,</span>
        <span class="s1">).fit()</span>
        <span class="s4"># Skip since estimator is unstable</span>
        <span class="s4"># assert_almost_equal(fit5.forecast(1), [60.60], 2)</span>
        <span class="s4"># assert_almost_equal(fit6.forecast(1), [61.47], 2)</span>

    <span class="s2">def </span><span class="s1">test_hw_seasonal_buggy(self):</span>
        <span class="s1">fit3 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s2">True,</span>
        <span class="s1">).fit()</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit3.forecast(</span><span class="s5">8</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s5">59.487190</span><span class="s2">,</span>
                <span class="s5">35.758854</span><span class="s2">,</span>
                <span class="s5">44.600641</span><span class="s2">,</span>
                <span class="s5">47.751384</span><span class="s2">,</span>
                <span class="s5">59.487190</span><span class="s2">,</span>
                <span class="s5">35.758854</span><span class="s2">,</span>
                <span class="s5">44.600641</span><span class="s2">,</span>
                <span class="s5">47.751384</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s5">2</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">fit4 = ExponentialSmoothing(</span>
            <span class="s1">self.aust</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
            <span class="s1">use_boxcox=</span><span class="s2">True,</span>
        <span class="s1">).fit()</span>
        <span class="s1">assert_almost_equal(</span>
            <span class="s1">fit4.forecast(</span><span class="s5">8</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s5">59.26155037</span><span class="s2">,</span>
                <span class="s5">35.27811302</span><span class="s2">,</span>
                <span class="s5">44.00438543</span><span class="s2">,</span>
                <span class="s5">47.97732693</span><span class="s2">,</span>
                <span class="s5">59.26155037</span><span class="s2">,</span>
                <span class="s5">35.27811302</span><span class="s2">,</span>
                <span class="s5">44.00438543</span><span class="s2">,</span>
                <span class="s5">47.97732693</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s5">2</span><span class="s2">,</span>
        <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;trend_seasonal&quot;</span><span class="s2">, </span><span class="s1">((</span><span class="s3">&quot;mul&quot;</span><span class="s2">, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s2">None, </span><span class="s3">&quot;mul&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;mul&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s1">))</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_negative_multipliative(trend_seasonal):</span>
    <span class="s1">trend</span><span class="s2">, </span><span class="s1">seasonal = trend_seasonal</span>
    <span class="s1">y = -np.ones(</span><span class="s5">100</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">y</span><span class="s2">, </span><span class="s1">trend=trend</span><span class="s2">, </span><span class="s1">seasonal=seasonal</span><span class="s2">, </span><span class="s1">seasonal_periods=</span><span class="s5">10</span>
        <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">SEASONALS)</span>
<span class="s2">def </span><span class="s1">test_dampen_no_trend(seasonal):</span>
    <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">housing_data</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s2">False,</span>
            <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
            <span class="s1">damped_trend=</span><span class="s2">True,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">10</span><span class="s2">,</span>
        <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">test_invalid_seasonal(seasonal):</span>
    <span class="s1">y = pd.Series(</span>
        <span class="s1">-np.ones(</span><span class="s5">100</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=pd.date_range(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">100</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;MS&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(y</span><span class="s2">, </span><span class="s1">seasonal=seasonal</span><span class="s2">, </span><span class="s1">seasonal_periods=</span><span class="s5">1</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_2d_data():</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">pd.concat([housing_data</span><span class="s2">, </span><span class="s1">housing_data]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">).fit()</span>


<span class="s2">def </span><span class="s1">test_infer_freq():</span>
    <span class="s1">hd2 = housing_data.copy()</span>
    <span class="s1">hd2.index = list(hd2.index)</span>
    <span class="s2">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s2">True</span><span class="s1">) </span><span class="s2">as </span><span class="s1">w:</span>
        <span class="s1">mod = ExponentialSmoothing(</span>
            <span class="s1">hd2</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(w) == </span><span class="s5">1</span>
        <span class="s2">assert </span><span class="s3">&quot;ValueWarning&quot; </span><span class="s2">in </span><span class="s1">str(w[</span><span class="s5">0</span><span class="s1">])</span>
    <span class="s2">assert </span><span class="s1">mod.seasonal_periods == </span><span class="s5">12</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">TRENDS)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">SEASONALS)</span>
<span class="s2">def </span><span class="s1">test_start_params(trend</span><span class="s2">, </span><span class="s1">seasonal):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">res2 = mod.fit(</span>
        <span class="s1">method=</span><span class="s3">&quot;basinhopping&quot;</span><span class="s2">,</span>
        <span class="s1">minimize_kwargs={</span><span class="s3">&quot;minimizer_kwargs&quot;</span><span class="s1">: {</span><span class="s3">&quot;method&quot;</span><span class="s1">: </span><span class="s3">&quot;SLSQP&quot;</span><span class="s1">}}</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s2">assert </span><span class="s1">res2.sse &lt; </span><span class="s5">1.01 </span><span class="s1">* res.sse</span>
    <span class="s2">assert </span><span class="s1">isinstance(res2.params</span><span class="s2">, </span><span class="s1">dict)</span>


<span class="s2">def </span><span class="s1">test_no_params_to_optimize():</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">,</span>
        <span class="s1">initial_level=housing_data.iloc[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">mod.fit(smoothing_level=</span><span class="s5">0.5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_invalid_start_param_length():</span>
    <span class="s1">mod = ExponentialSmoothing(housing_data</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(start_params=np.array([</span><span class="s5">0.5</span><span class="s1">]))</span>


<span class="s2">def </span><span class="s1">test_basin_hopping(reset_randomstate):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">res2 = mod.fit(method=</span><span class="s3">&quot;basinhopping&quot;</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res2.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s4"># Basin hopping occasionally produces a slightly larger objective</span>
    <span class="s1">tol = </span><span class="s5">1e-5</span>
    <span class="s2">assert </span><span class="s1">res2.sse &lt;= res.sse + tol</span>
    <span class="s1">res3 = mod.fit(method=</span><span class="s3">&quot;basinhopping&quot;</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(res2.sse</span><span class="s2">, </span><span class="s1">res3.sse</span><span class="s2">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_debiased():</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">res2 = mod.fit(remove_bias=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">np.any(res.fittedvalues != res2.fittedvalues)</span>
    <span class="s1">err2 = housing_data.iloc[:</span><span class="s2">, </span><span class="s5">0</span><span class="s1">] - res2.fittedvalues</span>
    <span class="s1">assert_almost_equal(err2.mean()</span><span class="s2">, </span><span class="s5">0.0</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res2.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s1">@pytest.mark.smoke</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">TRENDS)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">SEASONALS)</span>
<span class="s2">def </span><span class="s1">test_float_boxcox(trend</span><span class="s2">, </span><span class="s1">seasonal):</span>
    <span class="s1">res = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">use_boxcox=</span><span class="s5">0.5</span><span class="s2">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">assert_allclose(res.params[</span><span class="s3">&quot;use_boxcox&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.5</span><span class="s1">)</span>
    <span class="s1">res = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">use_boxcox=</span><span class="s5">0.5</span><span class="s2">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">assert_allclose(res.params[</span><span class="s3">&quot;use_boxcox&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.5</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">TRENDS)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">SEASONALS)</span>
<span class="s2">def </span><span class="s1">test_equivalence_cython_python(trend</span><span class="s2">, </span><span class="s1">seasonal):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>

    <span class="s4"># Overflow in mul-mul case fixed</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

    <span class="s1">params = res.params</span>
    <span class="s1">nobs = housing_data.shape[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">y = np.squeeze(np.asarray(housing_data))</span>
    <span class="s1">m = </span><span class="s5">12 </span><span class="s2">if </span><span class="s1">seasonal </span><span class="s2">else </span><span class="s5">0</span>
    <span class="s1">p = np.zeros(</span><span class="s5">6 </span><span class="s1">+ m)</span>
    <span class="s1">alpha = params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span>
    <span class="s1">beta = params[</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">]</span>
    <span class="s1">gamma = params[</span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">]</span>
    <span class="s1">phi = params[</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">]</span>
    <span class="s1">phi = </span><span class="s5">1.0 </span><span class="s2">if </span><span class="s1">np.isnan(phi) </span><span class="s2">else </span><span class="s1">phi</span>
    <span class="s1">l0 = params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span>
    <span class="s1">b0 = params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span>
    <span class="s1">p[:</span><span class="s5">6</span><span class="s1">] = alpha</span><span class="s2">, </span><span class="s1">beta</span><span class="s2">, </span><span class="s1">gamma</span><span class="s2">, </span><span class="s1">l0</span><span class="s2">, </span><span class="s1">b0</span><span class="s2">, </span><span class="s1">phi</span>
    <span class="s2">if </span><span class="s1">seasonal:</span>
        <span class="s1">p[</span><span class="s5">6</span><span class="s1">:] = params[</span><span class="s3">&quot;initial_seasons&quot;</span><span class="s1">]</span>
    <span class="s1">xi = np.ones_like(p).astype(int)</span>

    <span class="s1">p_copy = p.copy()</span>

    <span class="s1">bounds = np.array([[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">]] * </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">py_func = PY_SMOOTHERS[(seasonal</span><span class="s2">, </span><span class="s1">trend)]</span>
    <span class="s1">cy_func = SMOOTHERS[(seasonal</span><span class="s2">, </span><span class="s1">trend)]</span>
    <span class="s1">py_hw_args = PyHoltWintersArgs(xi</span><span class="s2">, </span><span class="s1">p_copy</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">nobs</span><span class="s2">, False</span><span class="s1">)</span>
    <span class="s1">cy_hw_args = HoltWintersArgs(xi</span><span class="s2">, </span><span class="s1">p_copy</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">nobs</span><span class="s2">, False</span><span class="s1">)</span>

    <span class="s1">sse_cy = cy_func(p</span><span class="s2">, </span><span class="s1">cy_hw_args)</span>
    <span class="s1">sse_py = py_func(p</span><span class="s2">, </span><span class="s1">py_hw_args)</span>
    <span class="s1">assert_allclose(sse_py</span><span class="s2">, </span><span class="s1">sse_cy)</span>
    <span class="s1">sse_py = py_func(p</span><span class="s2">, </span><span class="s1">cy_hw_args)</span>
    <span class="s1">assert_allclose(sse_py</span><span class="s2">, </span><span class="s1">sse_cy)</span>


<span class="s2">def </span><span class="s1">test_direct_holt_add():</span>
    <span class="s1">mod = SimpleExpSmoothing(housing_data</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s1">x = np.squeeze(np.asarray(mod.endog))</span>
    <span class="s1">alpha = res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span>
    <span class="s1">l</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">xhat = _simple_dbl_exp_smoother(</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">, </span><span class="s1">beta=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">l0=res.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">b0=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">nforecast=</span><span class="s5">5</span>
    <span class="s1">)</span>

    <span class="s1">assert_allclose(l</span><span class="s2">, </span><span class="s1">res.level)</span>
    <span class="s1">assert_allclose(f</span><span class="s2">, </span><span class="s1">res.level.iloc[-</span><span class="s5">1</span><span class="s1">] * np.ones(</span><span class="s5">5</span><span class="s1">))</span>
    <span class="s1">assert_allclose(f</span><span class="s2">, </span><span class="s1">res.forecast(</span><span class="s5">5</span><span class="s1">))</span>

    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">housing_data</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">x = np.squeeze(np.asarray(mod.endog))</span>
    <span class="s1">alpha = res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span>
    <span class="s1">beta = res.params[</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">]</span>
    <span class="s1">l</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">xhat = _simple_dbl_exp_smoother(</span>
        <span class="s1">x</span><span class="s2">,</span>
        <span class="s1">alpha</span><span class="s2">,</span>
        <span class="s1">beta=beta</span><span class="s2">,</span>
        <span class="s1">l0=res.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">b0=res.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">nforecast=</span><span class="s5">5</span><span class="s2">,</span>
    <span class="s1">)</span>

    <span class="s1">assert_allclose(xhat</span><span class="s2">, </span><span class="s1">res.fittedvalues)</span>
    <span class="s1">assert_allclose(l + b</span><span class="s2">, </span><span class="s1">res.level + res.trend)</span>
    <span class="s1">assert_allclose(l</span><span class="s2">, </span><span class="s1">res.level)</span>
    <span class="s1">assert_allclose(b</span><span class="s2">, </span><span class="s1">res.trend)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">f</span><span class="s2">, </span><span class="s1">res.level.iloc[-</span><span class="s5">1</span><span class="s1">] + res.trend.iloc[-</span><span class="s5">1</span><span class="s1">] * np.array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s1">])</span>
    <span class="s1">)</span>
    <span class="s1">assert_allclose(f</span><span class="s2">, </span><span class="s1">res.forecast(</span><span class="s5">5</span><span class="s1">))</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_integer_array(reset_randomstate):</span>
    <span class="s1">rs = np.random.RandomState(</span><span class="s5">12345</span><span class="s1">)</span>
    <span class="s1">e = </span><span class="s5">10 </span><span class="s1">* rs.standard_normal((</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">2</span><span class="s1">))</span>
    <span class="s1">y_star = np.cumsum(e[:</span><span class="s2">, </span><span class="s5">0</span><span class="s1">])</span>
    <span class="s1">y = y_star + e[:</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">y = y.astype(int)</span>
    <span class="s1">res = ExponentialSmoothing(</span>
        <span class="s1">y</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">).fit()</span>
    <span class="s2">assert </span><span class="s1">res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">] != </span><span class="s5">0.0</span>


<span class="s2">def </span><span class="s1">test_damping_trend_zero():</span>
    <span class="s1">endog = np.arange(</span><span class="s5">10</span><span class="s1">)</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">endog</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">damped_trend=</span><span class="s2">True,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">res1 = mod.fit(smoothing_level=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">smoothing_trend=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">damping_trend=</span><span class="s5">1e-20</span><span class="s1">)</span>
    <span class="s1">pred1 = res1.predict(start=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">assert_allclose(pred1</span><span class="s2">, </span><span class="s1">np.r_[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s5">9</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-10</span><span class="s1">)</span>

    <span class="s1">res2 = mod.fit(smoothing_level=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">smoothing_trend=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">damping_trend=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">pred2 = res2.predict(start=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">assert_allclose(pred2</span><span class="s2">, </span><span class="s1">np.r_[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s5">9</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-10</span><span class="s1">)</span>

    <span class="s1">assert_allclose(pred1</span><span class="s2">, </span><span class="s1">pred2</span><span class="s2">, </span><span class="s1">atol=</span><span class="s5">1e-10</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_different_inputs():</span>
    <span class="s1">array_input_add = [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">40</span><span class="s2">, </span><span class="s5">50</span><span class="s1">]</span>
    <span class="s1">series_index_add = pd.date_range(</span>
        <span class="s1">start=</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=len(array_input_add)</span>
    <span class="s1">)</span>
    <span class="s1">series_input_add = pd.Series(array_input_add</span><span class="s2">, </span><span class="s1">series_index_add)</span>

    <span class="s1">array_input_mul = [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">32</span><span class="s1">]</span>
    <span class="s1">series_index_mul = pd.date_range(</span>
        <span class="s1">start=</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=len(array_input_mul)</span>
    <span class="s1">)</span>
    <span class="s1">series_input_mul = pd.Series(array_input_mul</span><span class="s2">, </span><span class="s1">series_index_mul)</span>

    <span class="s1">fit1 = ExponentialSmoothing(array_input_add</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s1">).fit()</span>
    <span class="s1">fit2 = ExponentialSmoothing(series_input_add</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s1">).fit()</span>
    <span class="s1">fit3 = ExponentialSmoothing(array_input_mul</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;mul&quot;</span><span class="s1">).fit()</span>
    <span class="s1">fit4 = ExponentialSmoothing(series_input_mul</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;mul&quot;</span><span class="s1">).fit()</span>

    <span class="s1">assert_almost_equal(fit1.predict()</span><span class="s2">, </span><span class="s1">[</span><span class="s5">60</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(fit1.predict(start=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">end=</span><span class="s5">7</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">70</span><span class="s2">, </span><span class="s5">80</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(fit2.predict()</span><span class="s2">, </span><span class="s1">[</span><span class="s5">60</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">fit2.predict(start=</span><span class="s3">&quot;2000-1-6&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s3">&quot;2000-1-8&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">70</span><span class="s2">, </span><span class="s5">80</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span>
    <span class="s1">)</span>
    <span class="s1">assert_almost_equal(fit3.predict()</span><span class="s2">, </span><span class="s1">[</span><span class="s5">64</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(fit3.predict(start=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">end=</span><span class="s5">7</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">64</span><span class="s2">, </span><span class="s5">128</span><span class="s2">, </span><span class="s5">256</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(fit4.predict()</span><span class="s2">, </span><span class="s1">[</span><span class="s5">64</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">fit4.predict(start=</span><span class="s3">&quot;2000-1-6&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s3">&quot;2000-1-8&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s5">64</span><span class="s2">, </span><span class="s5">128</span><span class="s2">, </span><span class="s5">256</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span>
    <span class="s1">)</span>


<span class="s1">@pytest.fixture</span>
<span class="s2">def </span><span class="s1">austourists():</span>
    <span class="s4"># austourists dataset from fpp2 package</span>
    <span class="s4"># https://cran.r-project.org/web/packages/fpp2/index.html</span>
    <span class="s1">data = [</span>
        <span class="s5">30.05251</span><span class="s2">,</span>
        <span class="s5">19.14850</span><span class="s2">,</span>
        <span class="s5">25.31769</span><span class="s2">,</span>
        <span class="s5">27.59144</span><span class="s2">,</span>
        <span class="s5">32.07646</span><span class="s2">,</span>
        <span class="s5">23.48796</span><span class="s2">,</span>
        <span class="s5">28.47594</span><span class="s2">,</span>
        <span class="s5">35.12375</span><span class="s2">,</span>
        <span class="s5">36.83848</span><span class="s2">,</span>
        <span class="s5">25.00702</span><span class="s2">,</span>
        <span class="s5">30.72223</span><span class="s2">,</span>
        <span class="s5">28.69376</span><span class="s2">,</span>
        <span class="s5">36.64099</span><span class="s2">,</span>
        <span class="s5">23.82461</span><span class="s2">,</span>
        <span class="s5">29.31168</span><span class="s2">,</span>
        <span class="s5">31.77031</span><span class="s2">,</span>
        <span class="s5">35.17788</span><span class="s2">,</span>
        <span class="s5">19.77524</span><span class="s2">,</span>
        <span class="s5">29.60175</span><span class="s2">,</span>
        <span class="s5">34.53884</span><span class="s2">,</span>
        <span class="s5">41.27360</span><span class="s2">,</span>
        <span class="s5">26.65586</span><span class="s2">,</span>
        <span class="s5">28.27986</span><span class="s2">,</span>
        <span class="s5">35.19115</span><span class="s2">,</span>
        <span class="s5">42.20566</span><span class="s2">,</span>
        <span class="s5">24.64917</span><span class="s2">,</span>
        <span class="s5">32.66734</span><span class="s2">,</span>
        <span class="s5">37.25735</span><span class="s2">,</span>
        <span class="s5">45.24246</span><span class="s2">,</span>
        <span class="s5">29.35048</span><span class="s2">,</span>
        <span class="s5">36.34421</span><span class="s2">,</span>
        <span class="s5">41.78208</span><span class="s2">,</span>
        <span class="s5">49.27660</span><span class="s2">,</span>
        <span class="s5">31.27540</span><span class="s2">,</span>
        <span class="s5">37.85063</span><span class="s2">,</span>
        <span class="s5">38.83704</span><span class="s2">,</span>
        <span class="s5">51.23690</span><span class="s2">,</span>
        <span class="s5">31.83855</span><span class="s2">,</span>
        <span class="s5">41.32342</span><span class="s2">,</span>
        <span class="s5">42.79900</span><span class="s2">,</span>
        <span class="s5">55.70836</span><span class="s2">,</span>
        <span class="s5">33.40714</span><span class="s2">,</span>
        <span class="s5">42.31664</span><span class="s2">,</span>
        <span class="s5">45.15712</span><span class="s2">,</span>
        <span class="s5">59.57608</span><span class="s2">,</span>
        <span class="s5">34.83733</span><span class="s2">,</span>
        <span class="s5">44.84168</span><span class="s2">,</span>
        <span class="s5">46.97125</span><span class="s2">,</span>
        <span class="s5">60.01903</span><span class="s2">,</span>
        <span class="s5">38.37118</span><span class="s2">,</span>
        <span class="s5">46.97586</span><span class="s2">,</span>
        <span class="s5">50.73380</span><span class="s2">,</span>
        <span class="s5">61.64687</span><span class="s2">,</span>
        <span class="s5">39.29957</span><span class="s2">,</span>
        <span class="s5">52.67121</span><span class="s2">,</span>
        <span class="s5">54.33232</span><span class="s2">,</span>
        <span class="s5">66.83436</span><span class="s2">,</span>
        <span class="s5">40.87119</span><span class="s2">,</span>
        <span class="s5">51.82854</span><span class="s2">,</span>
        <span class="s5">57.49191</span><span class="s2">,</span>
        <span class="s5">65.25147</span><span class="s2">,</span>
        <span class="s5">43.06121</span><span class="s2">,</span>
        <span class="s5">54.76076</span><span class="s2">,</span>
        <span class="s5">59.83447</span><span class="s2">,</span>
        <span class="s5">73.25703</span><span class="s2">,</span>
        <span class="s5">47.69662</span><span class="s2">,</span>
        <span class="s5">61.09777</span><span class="s2">,</span>
        <span class="s5">66.05576</span><span class="s2">,</span>
    <span class="s1">]</span>
    <span class="s1">index = pd.date_range(</span><span class="s3">&quot;1999-03-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2015-12-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;3MS&quot;</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">pd.Series(data</span><span class="s2">, </span><span class="s1">index)</span>


<span class="s1">@pytest.fixture</span>
<span class="s2">def </span><span class="s1">simulate_expected_results_r():</span>
    <span class="s0">&quot;&quot;&quot; 
    obtained from ets.simulate in the R package forecast, data is from fpp2 
    package. 
 
    library(magrittr) 
    library(fpp2) 
    library(forecast) 
    concat &lt;- function(...) { 
      return(paste(..., sep=&quot;&quot;)) 
    } 
    error &lt;- c(&quot;A&quot;, &quot;M&quot;) 
    trend &lt;- c(&quot;A&quot;, &quot;M&quot;, &quot;N&quot;) 
    seasonal &lt;- c(&quot;A&quot;, &quot;M&quot;, &quot;N&quot;) 
    models &lt;- outer(error, trend, FUN = &quot;concat&quot;) %&gt;% 
      outer(seasonal, FUN = &quot;concat&quot;) %&gt;% as.vector 
    # innov from np.random.seed(0); np.random.randn(4) 
    innov &lt;- c(1.76405235, 0.40015721, 0.97873798, 2.2408932) 
    params &lt;- expand.grid(models, c(TRUE, FALSE)) 
    results &lt;- apply(params, 1, FUN = function(p) { 
      tryCatch( 
        simulate(ets(austourists, model = p[1], damped = as.logical(p[2])), 
                 innov = innov), 
        error = function(e) c(NA, NA, NA, NA)) 
    }) %&gt;% t 
    rownames(results) &lt;- apply(params, 1, FUN = function(x) paste(x[1], x[2])) 
    &quot;&quot;&quot;</span>
    <span class="s1">damped = {</span>
        <span class="s3">&quot;AAA&quot;</span><span class="s1">: [</span><span class="s5">77.84173</span><span class="s2">, </span><span class="s5">52.69818</span><span class="s2">, </span><span class="s5">65.83254</span><span class="s2">, </span><span class="s5">71.85204</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAA&quot;</span><span class="s1">: [</span><span class="s5">207.81653</span><span class="s2">, </span><span class="s5">136.97700</span><span class="s2">, </span><span class="s5">253.56234</span><span class="s2">, </span><span class="s5">588.95800</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAM&quot;</span><span class="s1">: [</span><span class="s5">215.83822</span><span class="s2">, </span><span class="s5">127.17132</span><span class="s2">, </span><span class="s5">269.09483</span><span class="s2">, </span><span class="s5">704.32105</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MMM&quot;</span><span class="s1">: [</span><span class="s5">216.52591</span><span class="s2">, </span><span class="s5">132.47637</span><span class="s2">, </span><span class="s5">283.04889</span><span class="s2">, </span><span class="s5">759.08043</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;AAN&quot;</span><span class="s1">: [</span><span class="s5">62.51423</span><span class="s2">, </span><span class="s5">61.87381</span><span class="s2">, </span><span class="s5">63.14735</span><span class="s2">, </span><span class="s5">65.11360</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAN&quot;</span><span class="s1">: [</span><span class="s5">168.25189</span><span class="s2">, </span><span class="s5">90.46201</span><span class="s2">, </span><span class="s5">133.54769</span><span class="s2">, </span><span class="s5">232.81738</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MMN&quot;</span><span class="s1">: [</span><span class="s5">167.97747</span><span class="s2">, </span><span class="s5">90.59675</span><span class="s2">, </span><span class="s5">134.20300</span><span class="s2">, </span><span class="s5">235.64502</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">}</span>
    <span class="s1">undamped = {</span>
        <span class="s3">&quot;AAA&quot;</span><span class="s1">: [</span><span class="s5">77.10860</span><span class="s2">, </span><span class="s5">51.51669</span><span class="s2">, </span><span class="s5">64.46857</span><span class="s2">, </span><span class="s5">70.36349</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAA&quot;</span><span class="s1">: [</span><span class="s5">209.23158</span><span class="s2">, </span><span class="s5">149.62943</span><span class="s2">, </span><span class="s5">270.65579</span><span class="s2">, </span><span class="s5">637.03828</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;ANA&quot;</span><span class="s1">: [</span><span class="s5">77.09320</span><span class="s2">, </span><span class="s5">51.52384</span><span class="s2">, </span><span class="s5">64.36231</span><span class="s2">, </span><span class="s5">69.84786</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MNA&quot;</span><span class="s1">: [</span><span class="s5">207.86986</span><span class="s2">, </span><span class="s5">169.42706</span><span class="s2">, </span><span class="s5">313.97960</span><span class="s2">, </span><span class="s5">793.97948</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAM&quot;</span><span class="s1">: [</span><span class="s5">214.45750</span><span class="s2">, </span><span class="s5">106.19605</span><span class="s2">, </span><span class="s5">211.61304</span><span class="s2">, </span><span class="s5">492.12223</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MMM&quot;</span><span class="s1">: [</span><span class="s5">221.01861</span><span class="s2">, </span><span class="s5">158.55914</span><span class="s2">, </span><span class="s5">403.22625</span><span class="s2">, </span><span class="s5">1389.33384</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MNM&quot;</span><span class="s1">: [</span><span class="s5">215.00997</span><span class="s2">, </span><span class="s5">140.93035</span><span class="s2">, </span><span class="s5">309.92465</span><span class="s2">, </span><span class="s5">875.07985</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;AAN&quot;</span><span class="s1">: [</span><span class="s5">63.66619</span><span class="s2">, </span><span class="s5">63.09571</span><span class="s2">, </span><span class="s5">64.45832</span><span class="s2">, </span><span class="s5">66.51967</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MAN&quot;</span><span class="s1">: [</span><span class="s5">172.37584</span><span class="s2">, </span><span class="s5">91.51932</span><span class="s2">, </span><span class="s5">134.11221</span><span class="s2">, </span><span class="s5">230.98970</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MMN&quot;</span><span class="s1">: [</span><span class="s5">169.88595</span><span class="s2">, </span><span class="s5">97.33527</span><span class="s2">, </span><span class="s5">142.97017</span><span class="s2">, </span><span class="s5">252.51834</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;ANN&quot;</span><span class="s1">: [</span><span class="s5">60.53589</span><span class="s2">, </span><span class="s5">59.51851</span><span class="s2">, </span><span class="s5">60.17570</span><span class="s2">, </span><span class="s5">61.63011</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s3">&quot;MNN&quot;</span><span class="s1">: [</span><span class="s5">163.01575</span><span class="s2">, </span><span class="s5">112.58317</span><span class="s2">, </span><span class="s5">172.21992</span><span class="s2">, </span><span class="s5">338.93918</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">{</span><span class="s2">True</span><span class="s1">: damped</span><span class="s2">, False</span><span class="s1">: undamped}</span>


<span class="s1">@pytest.fixture</span>
<span class="s2">def </span><span class="s1">simulate_fit_state_r():</span>
    <span class="s0">&quot;&quot;&quot; 
    The final state from the R model fits to get an exact comparison 
    Obtained with this R script: 
 
    library(magrittr) 
    library(fpp2) 
    library(forecast) 
 
    concat &lt;- function(...) { 
      return(paste(..., sep=&quot;&quot;)) 
    } 
 
    as_dict_string &lt;- function(named) { 
      string &lt;- '{' 
      for (name in names(named)) { 
        string &lt;- concat(string, &quot;\&quot;&quot;, name, &quot;\&quot;: &quot;, named[name], &quot;, &quot;) 
      } 
      string &lt;- concat(string, '}') 
      return(string) 
    } 
 
    get_var &lt;- function(named, name) { 
      if (name %in% names(named)) 
        val &lt;- c(named[name]) 
      else 
        val &lt;- c(NaN) 
      names(val) &lt;- c(name) 
      return(val) 
    } 
 
    error &lt;- c(&quot;A&quot;, &quot;M&quot;) 
    trend &lt;- c(&quot;A&quot;, &quot;M&quot;, &quot;N&quot;) 
    seasonal &lt;- c(&quot;A&quot;, &quot;M&quot;, &quot;N&quot;) 
    models &lt;- outer(error, trend, FUN = &quot;concat&quot;) %&gt;% 
      outer(seasonal, FUN = &quot;concat&quot;) %&gt;% as.vector 
 
    # innov from np.random.seed(0); np.random.randn(4) 
    innov &lt;- c(1.76405235, 0.40015721, 0.97873798, 2.2408932) 
    n &lt;- length(austourists) + 1 
 
    # print fit parameters and final states 
    for (damped in c(TRUE, FALSE)) { 
      print(paste(&quot;damped =&quot;, damped)) 
      for (model in models) { 
        state &lt;- tryCatch((function(){ 
          fit &lt;- ets(austourists, model = model, damped = damped) 
          pars &lt;- c() 
          # alpha, beta, gamma, phi 
          for (name in c(&quot;alpha&quot;, &quot;beta&quot;, &quot;gamma&quot;, &quot;phi&quot;)) { 
            pars &lt;- c(pars, get_var(fit$par, name)) 
          } 
          # l, b, s1, s2, s3, s4 
          states &lt;- c() 
          for (name in c(&quot;l&quot;, &quot;b&quot;, &quot;s1&quot;, &quot;s2&quot;, &quot;s3&quot;, &quot;s4&quot;)) 
            states &lt;- c(states, get_var(fit$states[n,], name)) 
          c(pars, states) 
        })(), 
        error = function(e) rep(NA, 10)) 
        cat(concat(&quot;\&quot;&quot;, model, &quot;\&quot;: &quot;, as_dict_string(state), &quot;,\n&quot;)) 
      } 
    } 
    &quot;&quot;&quot;</span>
    <span class="s1">damped = {</span>
        <span class="s3">&quot;AAA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.35445427317618</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0320074905894167</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.399933869627979</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.979999965983533</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">62.003405788717</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.706524957599738</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">3.58786406600866</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: -</span><span class="s5">0.0747450283892903</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">11.7569356589817</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">13.3818805055271</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.31114284033284</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0472138763848083</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.309502324693322</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.870889202791893</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">59.2902342851514</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.62538315801909</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">5.66660224738038</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">2.16097311633352</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">9.20020909069337</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">15.3505801601698</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAM&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.483975835390643</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.00351728130401287</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.00011309784353818</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.979999998322032</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">63.0042707536293</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.275035160634846</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">1.03531670491486</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">0.960515682506077</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: </span><span class="s5">0.770086097577864</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">1.23412213281709</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MMM&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.523526123191035</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.000100021136675999</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.000100013723372502</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.971025672907157</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">63.2030316675533</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">1.00458391644788</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">1.03476354353096</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">0.959953222294316</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: </span><span class="s5">0.771346403552048</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">1.23394845160922</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;AAN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.014932817259302</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0149327068053362</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.979919958387887</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">60.0651024395378</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.699112782133822</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.0144217343786778</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0144216994589862</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.979999719878659</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">60.1870032363649</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.698421913047609</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MMN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.015489181776072</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0154891632646377</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: </span><span class="s5">0.975139118496093</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">60.1855946424729</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">1.00999589024928</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
    <span class="s1">}</span>
    <span class="s1">undamped = {</span>
        <span class="s3">&quot;AAA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.20281951627363</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.000169786227368617</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.464523797585052</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">62.5598121416791</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.578091734736357</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">2.61176734723357</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: -</span><span class="s5">1.24386240029203</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">12.9575427049515</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">12.2066400808086</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.416371920801538</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.000100008012920072</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.352943901103959</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">62.0497742976079</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.450130087198346</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">3.50368220490457</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: -</span><span class="s5">0.0544297321113539</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">11.6971093199679</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">13.1974985095916</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;ANA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.54216694759434</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.392030170511872</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">57.606831186929</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">8.29613785790501</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">4.6033791939889</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">7.43956343440823</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">17.722316385643</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MNA&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.532842556756286</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.346387433608713</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">58.0372808528325</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">7.70802088750111</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">4.14885814748503</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: -</span><span class="s5">7.72115936226225</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">17.1674660340923</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAM&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.315621390571192</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.000100011993615961</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.000100051297784532</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">62.4082004238551</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.513327867101983</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">1.03713425342421</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">0.959607104686072</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: </span><span class="s5">0.770172817592091</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">1.23309264451638</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MMM&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.546068965886</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0737816453485457</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.000100031693302807</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">63.8203866275649</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">1.01833305374778</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">1.03725227137871</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">0.961177239042923</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: </span><span class="s5">0.771173487523454</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">1.23036313932852</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MNM&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.608993139624813</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: </span><span class="s5">0.000167258612971303</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">63.1472153330648</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: </span><span class="s5">1.0384840572776</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: </span><span class="s5">0.961456755855531</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: </span><span class="s5">0.768427399477366</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: </span><span class="s5">1.23185085956321</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;AAN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.0097430554119077</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.00974302759255084</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">61.1430969243248</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.759041621012503</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MAN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.0101749952821338</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.0101749138539332</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">61.6020426238699</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">0.761407500773051</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MMN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.0664382968951546</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: </span><span class="s5">0.000100001678373356</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">60.7206911970871</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s5">1.01221899136391</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;ANN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.196432515825523</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">58.7718395431632</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
        <span class="s3">&quot;MNN&quot;</span><span class="s1">: {</span>
            <span class="s3">&quot;alpha&quot;</span><span class="s1">: </span><span class="s5">0.205985314333856</span><span class="s2">,</span>
            <span class="s3">&quot;beta&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;gamma&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;phi&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;l&quot;</span><span class="s1">: </span><span class="s5">58.9770839944419</span><span class="s2">,</span>
            <span class="s3">&quot;b&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s1&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s2&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s3&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
            <span class="s3">&quot;s4&quot;</span><span class="s1">: np.nan</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">{</span><span class="s2">True</span><span class="s1">: damped</span><span class="s2">, False</span><span class="s1">: undamped}</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">TRENDS)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">SEASONALS)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;damped&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s2">True, False</span><span class="s1">))</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;error&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">test_simulate_expected_r(</span>
    <span class="s1">trend</span><span class="s2">,</span>
    <span class="s1">seasonal</span><span class="s2">,</span>
    <span class="s1">damped</span><span class="s2">,</span>
    <span class="s1">error</span><span class="s2">,</span>
    <span class="s1">austourists</span><span class="s2">,</span>
    <span class="s1">simulate_expected_results_r</span><span class="s2">,</span>
    <span class="s1">simulate_fit_state_r</span><span class="s2">,</span>
<span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Test for :meth:``statsmodels.tsa.holtwinters.HoltWintersResults``. 
 
    The tests are using the implementation in the R package ``forecast`` as 
    reference, and example data is taken from ``fpp2`` (package and book). 
    &quot;&quot;&quot;</span>

    <span class="s1">short_name = {</span><span class="s3">&quot;add&quot;</span><span class="s1">: </span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;mul&quot;</span><span class="s1">: </span><span class="s3">&quot;M&quot;</span><span class="s2">, None</span><span class="s1">: </span><span class="s3">&quot;N&quot;</span><span class="s1">}</span>
    <span class="s1">model_name = short_name[error] + short_name[trend] + short_name[seasonal]</span>
    <span class="s2">if </span><span class="s1">model_name </span><span class="s2">in </span><span class="s1">simulate_expected_results_r[damped]:</span>
        <span class="s1">expected = np.asarray(simulate_expected_results_r[damped][model_name])</span>
        <span class="s1">state = simulate_fit_state_r[damped][model_name]</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s2">return</span>

    <span class="s4"># create HoltWintersResults object with same parameters as in R</span>
    <span class="s1">fit = ExponentialSmoothing(</span>
        <span class="s1">austourists</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">damped_trend=damped</span><span class="s2">,</span>
    <span class="s1">).fit(</span>
        <span class="s1">smoothing_level=state[</span><span class="s3">&quot;alpha&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">smoothing_trend=state[</span><span class="s3">&quot;beta&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">smoothing_seasonal=state[</span><span class="s3">&quot;gamma&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">damping_trend=state[</span><span class="s3">&quot;phi&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">optimized=</span><span class="s2">False,</span>
    <span class="s1">)</span>

    <span class="s4"># set the same final state as in R</span>
    <span class="s1">fit._level[-</span><span class="s5">1</span><span class="s1">] = state[</span><span class="s3">&quot;l&quot;</span><span class="s1">]</span>
    <span class="s1">fit._trend[-</span><span class="s5">1</span><span class="s1">] = state[</span><span class="s3">&quot;b&quot;</span><span class="s1">]</span>
    <span class="s1">fit._season[-</span><span class="s5">1</span><span class="s1">] = state[</span><span class="s3">&quot;s1&quot;</span><span class="s1">]</span>
    <span class="s1">fit._season[-</span><span class="s5">2</span><span class="s1">] = state[</span><span class="s3">&quot;s2&quot;</span><span class="s1">]</span>
    <span class="s1">fit._season[-</span><span class="s5">3</span><span class="s1">] = state[</span><span class="s3">&quot;s3&quot;</span><span class="s1">]</span>
    <span class="s1">fit._season[-</span><span class="s5">4</span><span class="s1">] = state[</span><span class="s3">&quot;s4&quot;</span><span class="s1">]</span>

    <span class="s4"># for MMM with damped trend the fit fails</span>
    <span class="s2">if </span><span class="s1">np.any(np.isnan(fit.fittedvalues)):</span>
        <span class="s2">return</span>

    <span class="s1">innov = np.asarray([[</span><span class="s5">1.76405235</span><span class="s2">, </span><span class="s5">0.40015721</span><span class="s2">, </span><span class="s5">0.97873798</span><span class="s2">, </span><span class="s5">2.2408932</span><span class="s1">]]).T</span>
    <span class="s1">sim = fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">error=error</span><span class="s2">, </span><span class="s1">random_errors=innov)</span>

    <span class="s1">assert_almost_equal(expected</span><span class="s2">, </span><span class="s1">sim.values</span><span class="s2">, </span><span class="s5">5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_simulate_keywords(austourists):</span>
    <span class="s0">&quot;&quot;&quot; 
    check whether all keywords are accepted and work without throwing errors. 
    &quot;&quot;&quot;</span>
    <span class="s1">fit = ExponentialSmoothing(</span>
        <span class="s1">austourists</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">damped_trend=</span><span class="s2">True,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">).fit()</span>

    <span class="s4"># test anchor</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s3">&quot;2015-12-01&quot;</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_almost_equal(</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s3">&quot;end&quot;</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
        <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s3">&quot;2016-03-01&quot;</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span><span class="s2">,</span>
    <span class="s1">)</span>

    <span class="s4"># test different random error options</span>
    <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_errors=scipy.stats.norm)</span>
    <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_errors=scipy.stats.norm())</span>

    <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_errors=np.random.randn(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s1">))</span>
    <span class="s1">fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_errors=</span><span class="s3">&quot;bootstrap&quot;</span><span class="s1">)</span>

    <span class="s4"># test seeding</span>
    <span class="s1">res = fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">10</span><span class="s1">).values</span>
    <span class="s1">res2 = fit.simulate(</span>
        <span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_state=np.random.RandomState(</span><span class="s5">10</span><span class="s1">)</span>
    <span class="s1">).values</span>
    <span class="s2">assert </span><span class="s1">np.all(res == res2)</span>


<span class="s2">def </span><span class="s1">test_simulate_boxcox(austourists):</span>
    <span class="s0">&quot;&quot;&quot; 
    check if simulation results with boxcox fits are reasonable 
    &quot;&quot;&quot;</span>
    <span class="s1">fit = ExponentialSmoothing(</span>
        <span class="s1">austourists</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
        <span class="s1">damped_trend=</span><span class="s2">False,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">use_boxcox=</span><span class="s2">True,</span>
    <span class="s1">).fit()</span>
    <span class="s1">expected = fit.forecast(</span><span class="s5">4</span><span class="s1">).values</span>

    <span class="s1">res = fit.simulate(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">repetitions=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s5">0</span><span class="s1">).values</span>
    <span class="s1">mean = np.mean(res</span><span class="s2">, </span><span class="s1">axis=</span><span class="s5">1</span><span class="s1">)</span>

    <span class="s2">assert </span><span class="s1">np.all(np.abs(mean - expected) &lt; </span><span class="s5">5</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ix&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">, </span><span class="s5">2000</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_forecast_index(ix):</span>
    <span class="s4"># GH 6549</span>
    <span class="s1">ts_1 = pd.Series(</span>
        <span class="s1">[</span><span class="s5">85601</span><span class="s2">, </span><span class="s5">89662</span><span class="s2">, </span><span class="s5">85122</span><span class="s2">, </span><span class="s5">84400</span><span class="s2">, </span><span class="s5">78250</span><span class="s2">, </span><span class="s5">84434</span><span class="s2">, </span><span class="s5">71072</span><span class="s2">, </span><span class="s5">70357</span><span class="s2">, </span><span class="s5">72635</span><span class="s2">, </span><span class="s5">73210</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">index=range(ix</span><span class="s2">, </span><span class="s1">ix + </span><span class="s5">10</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.warns(ConvergenceWarning):</span>
        <span class="s1">model = ExponentialSmoothing(</span>
            <span class="s1">ts_1</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">damped_trend=</span><span class="s2">False</span>
        <span class="s1">).fit()</span>
    <span class="s1">index = model.forecast(steps=</span><span class="s5">10</span><span class="s1">).index</span>
    <span class="s2">assert </span><span class="s1">index[</span><span class="s5">0</span><span class="s1">] == ix + </span><span class="s5">10</span>
    <span class="s2">assert </span><span class="s1">index[-</span><span class="s5">1</span><span class="s1">] == ix + </span><span class="s5">19</span>


<span class="s2">def </span><span class="s1">test_error_dampen():</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Can only dampen the&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(np.ones(</span><span class="s5">100</span><span class="s1">)</span><span class="s2">, </span><span class="s1">damped_trend=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_error_boxcox():</span>
    <span class="s1">y = np.random.standard_normal(</span><span class="s5">100</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;use_boxcox must be True&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(y</span><span class="s2">, </span><span class="s1">use_boxcox=</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s1">)</span>

    <span class="s1">mod = ExponentialSmoothing(y**</span><span class="s5">2</span><span class="s2">, </span><span class="s1">use_boxcox=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(mod</span><span class="s2">, </span><span class="s1">ExponentialSmoothing)</span>

    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">y**</span><span class="s5">2</span><span class="s2">, </span><span class="s1">use_boxcox=</span><span class="s2">True, </span><span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;use_boxcox was set&quot;</span><span class="s1">):</span>
        <span class="s1">mod.fit(use_boxcox=</span><span class="s2">False</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_error_initialization(ses):</span>
    <span class="s2">with </span><span class="s1">pytest.raises(</span>
        <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;initialization is 'known' but initial_level&quot;</span>
    <span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;initial_trend set but model&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
            <span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s2">,</span>
            <span class="s1">initial_trend=</span><span class="s5">1.0</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;initial_seasonal set but model&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
            <span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s2">,</span>
            <span class="s1">initial_seasonal=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initial_trend=</span><span class="s5">1.0</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initial_seasonal=[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">4</span><span class="s1">])</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
            <span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
            <span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s2">,</span>
            <span class="s1">initial_trend=</span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">, </span><span class="s1">initial_level=</span><span class="s5">1.0</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(initial_level=</span><span class="s5">2.0</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(use_basinhopping=</span><span class="s2">True, </span><span class="s1">method=</span><span class="s3">&quot;least_squares&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method&quot;</span><span class="s2">,</span>
    <span class="s1">[</span>
        <span class="s3">&quot;least_squares&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;basinhopping&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;L-BFGS-B&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;TNC&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;SLSQP&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;Powell&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;trust-constr&quot;</span><span class="s2">,</span>
    <span class="s1">]</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_alternative_minimizers(method</span><span class="s2">, </span><span class="s1">ses):</span>
    <span class="s1">sv = np.array([</span><span class="s5">0.77</span><span class="s2">, </span><span class="s5">11.00</span><span class="s1">])</span>
    <span class="s1">minimize_kwargs = {}</span>
    <span class="s1">mod = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s1">res = mod.fit(</span>
        <span class="s1">method=method</span><span class="s2">, </span><span class="s1">start_params=sv</span><span class="s2">, </span><span class="s1">minimize_kwargs=minimize_kwargs</span>
    <span class="s1">)</span>
    <span class="s1">assert_allclose(res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">0.77232545</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s5">1e-3</span><span class="s1">)</span>
    <span class="s1">assert_allclose(res.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">11.00359693</span><span class="s2">, </span><span class="s1">rtol=</span><span class="s5">1e-3</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_minimizer_kwargs_error(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s1">kwargs = {</span><span class="s3">&quot;args&quot;</span><span class="s1">: </span><span class="s3">&quot;anything&quot;</span><span class="s1">}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(minimize_kwargs=kwargs)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(method=</span><span class="s3">&quot;least_squares&quot;</span><span class="s2">, </span><span class="s1">minimize_kwargs=kwargs)</span>
    <span class="s1">kwargs = {</span><span class="s3">&quot;minimizer_kwargs&quot;</span><span class="s1">: {</span><span class="s3">&quot;args&quot;</span><span class="s1">: </span><span class="s3">&quot;anything&quot;</span><span class="s1">}}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mod.fit(method=</span><span class="s3">&quot;basinhopping&quot;</span><span class="s2">, </span><span class="s1">minimize_kwargs=kwargs)</span>
    <span class="s1">kwargs = {</span><span class="s3">&quot;minimizer_kwargs&quot;</span><span class="s1">: {</span><span class="s3">&quot;method&quot;</span><span class="s1">: </span><span class="s3">&quot;SLSQP&quot;</span><span class="s1">}}</span>
    <span class="s1">res = mod.fit(method=</span><span class="s3">&quot;basinhopping&quot;</span><span class="s2">, </span><span class="s1">minimize_kwargs=kwargs)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.params</span><span class="s2">, </span><span class="s1">dict)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;params&quot;</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">0.2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">, </span><span class="s5">0.6</span><span class="s1">]]</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_to_restricted_equiv(params):</span>
    <span class="s1">params = np.array(params)</span>
    <span class="s1">sel = np.array([</span><span class="s2">True</span><span class="s1">] * </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">bounds = np.array([[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">]] * </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">to_restricted(params</span><span class="s2">, </span><span class="s1">sel</span><span class="s2">, </span><span class="s1">bounds)</span><span class="s2">,</span>
        <span class="s1">_test_to_restricted(params</span><span class="s2">, </span><span class="s1">sel.astype(int)</span><span class="s2">, </span><span class="s1">bounds)</span><span class="s2">,</span>
    <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;params&quot;</span><span class="s2">, </span><span class="s1">[[</span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s1">]]</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_restricted_round_tip(params):</span>
    <span class="s1">params = np.array(params)</span>
    <span class="s1">sel = np.array([</span><span class="s2">True</span><span class="s1">] * </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">bounds = np.array([[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">]] * </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">params</span><span class="s2">,</span>
        <span class="s1">to_unrestricted(to_restricted(params</span><span class="s2">, </span><span class="s1">sel</span><span class="s2">, </span><span class="s1">bounds)</span><span class="s2">, </span><span class="s1">sel</span><span class="s2">, </span><span class="s1">bounds)</span><span class="s2">,</span>
    <span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_bad_bounds(ses):</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;bad_key&quot;</span><span class="s1">: (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(KeyError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">bounds=bounds)</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: [</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">]}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">bounds=bounds)</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">bounds=bounds)</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">bounds=bounds)</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">bounds=bounds)</span>


<span class="s2">def </span><span class="s1">test_valid_bounds(ses):</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">1.0</span><span class="s1">)}</span>
    <span class="s1">res = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">bounds=bounds</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">).fit(method=</span><span class="s3">&quot;least_squares&quot;</span><span class="s1">)</span>
    <span class="s1">res2 = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">).fit(</span>
        <span class="s1">method=</span><span class="s3">&quot;least_squares&quot;</span>
    <span class="s1">)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">res2.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">rtol=</span><span class="s5">1e-4</span><span class="s2">,</span>
    <span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_fixed_basic(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.3</span><span class="s1">}):</span>
        <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">] == </span><span class="s5">0.3</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">damped_trend=</span><span class="s2">True, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">: </span><span class="s5">0.98</span><span class="s1">}):</span>
        <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">res.params[</span><span class="s3">&quot;damping_trend&quot;</span><span class="s1">] == </span><span class="s5">0.98</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>

    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">: </span><span class="s5">0.1</span><span class="s2">, </span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.2</span><span class="s1">}):</span>
        <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">res.params[</span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">] == </span><span class="s5">0.1</span>
    <span class="s2">assert </span><span class="s1">res.params[</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">] == </span><span class="s5">0.2</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_fixed_errors(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(KeyError):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">: </span><span class="s5">0.3</span><span class="s1">}):</span>
            <span class="s2">pass</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: -</span><span class="s5">0.3</span><span class="s1">}):</span>
            <span class="s2">pass</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.3</span><span class="s2">, </span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">: </span><span class="s5">0.4</span><span class="s1">}):</span>
            <span class="s2">pass</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params(</span>
            <span class="s1">{</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.3</span><span class="s2">, </span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">: </span><span class="s5">0.8</span><span class="s1">}</span>
        <span class="s1">):</span>
            <span class="s2">pass</span>

    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.8</span><span class="s1">)</span><span class="s2">, </span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">: (</span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.9</span><span class="s1">)}</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">bounds=bounds</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;After adjusting for user-provided&quot;</span><span class="s1">):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params(</span>
            <span class="s1">{</span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">: </span><span class="s5">0.3</span><span class="s2">, </span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">: </span><span class="s5">0.6</span><span class="s1">}</span>
        <span class="s1">):</span>
            <span class="s1">mod.fit()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;add&quot;</span><span class="s2">, None</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;add&quot;</span><span class="s2">, None</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_brute(ses</span><span class="s2">, </span><span class="s1">trend</span><span class="s2">, </span><span class="s1">seasonal):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=trend</span><span class="s2">, </span><span class="s1">seasonal=seasonal</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit(use_brute=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">res.mle_retvals.success</span>

    <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.1</span><span class="s1">}):</span>
        <span class="s1">res = mod.fit(use_brute=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">res.mle_retvals.success</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_fix_set_parameters(ses):</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">, </span><span class="s1">initial_level=</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initial_trend=</span><span class="s5">1.0</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;legacy-heuristic&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initial_seasonal=np.ones(</span><span class="s5">12</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_fix_unfixable(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot fix a parameter&quot;</span><span class="s1">):</span>
        <span class="s2">with </span><span class="s1">mod.fix_params({</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: </span><span class="s5">0.25</span><span class="s1">}):</span>
            <span class="s1">mod.fit(smoothing_level=</span><span class="s5">0.2</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_infeasible_bounds(ses):</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s1">)</span><span class="s2">, </span><span class="s3">&quot;smoothing_trend&quot;</span><span class="s1">: (</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.4</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;The bounds for smoothing_trend&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">, </span><span class="s1">bounds=bounds</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span>
        <span class="s1">).fit()</span>
    <span class="s1">bounds = {</span><span class="s3">&quot;smoothing_level&quot;</span><span class="s1">: (</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.5</span><span class="s1">)</span><span class="s2">, </span><span class="s3">&quot;smoothing_seasonal&quot;</span><span class="s1">: (</span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.8</span><span class="s1">)}</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;The bounds for smoothing_seasonal&quot;</span><span class="s1">):</span>
        <span class="s1">ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">bounds=bounds</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
        <span class="s1">).fit()</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;estimated&quot;</span><span class="s2">, </span><span class="s3">&quot;heuristic&quot;</span><span class="s2">, </span><span class="s3">&quot;legacy-heuristic&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;add&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;add&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_initialization_methods(ses</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">trend</span><span class="s2">, </span><span class="s1">seasonal):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses</span><span class="s2">, </span><span class="s1">trend=trend</span><span class="s2">, </span><span class="s1">seasonal=seasonal</span><span class="s2">, </span><span class="s1">initialization_method=method</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">res.mle_retvals.success</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_attributes(ses):</span>
    <span class="s1">res = ExponentialSmoothing(ses</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s1">).fit()</span>
    <span class="s2">assert </span><span class="s1">res.k &gt; </span><span class="s5">0</span>
    <span class="s2">assert </span><span class="s1">res.resid.shape[</span><span class="s5">0</span><span class="s1">] == ses.shape[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">assert_allclose(res.fcastvalues</span><span class="s2">, </span><span class="s1">res.fittedfcast[-</span><span class="s5">1</span><span class="s1">:])</span>


<span class="s2">def </span><span class="s1">test_summary_boxcox(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses**</span><span class="s5">2</span><span class="s2">, </span><span class="s1">use_boxcox=</span><span class="s2">True, </span><span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;use_boxcox was set at model&quot;</span><span class="s1">):</span>
        <span class="s1">mod.fit(use_boxcox=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s1">summ = str(res.summary())</span>
    <span class="s2">assert </span><span class="s1">re.findall(</span><span class="s3">r&quot;Box-Cox:[\s]*True&quot;</span><span class="s2">, </span><span class="s1">summ)</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>


<span class="s2">def </span><span class="s1">test_simulate(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">np.asarray(ses)</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;error must be&quot;</span><span class="s1">):</span>
        <span class="s1">res.simulate(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;unknown&quot;</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;If random&quot;</span><span class="s1">):</span>
        <span class="s1">res.simulate(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;additive&quot;</span><span class="s2">, </span><span class="s1">random_errors=np.empty((</span><span class="s5">20</span><span class="s2">, </span><span class="s5">20</span><span class="s1">)))</span>
    <span class="s1">res.simulate(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;additive&quot;</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">100</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot anchor&quot;</span><span class="s1">):</span>
        <span class="s1">res.simulate(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;additive&quot;</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">2000</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Argument random_state&quot;</span><span class="s1">):</span>
        <span class="s1">res.simulate(</span>
            <span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;additive&quot;</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">100</span><span class="s2">, </span><span class="s1">random_state=</span><span class="s3">&quot;bad_value&quot;</span>
        <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Argument random_errors&quot;</span><span class="s1">):</span>
        <span class="s1">res.simulate(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">error=</span><span class="s3">&quot;additive&quot;</span><span class="s2">, </span><span class="s1">random_errors=</span><span class="s3">&quot;bad_values&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;index_typ&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;date_range&quot;</span><span class="s2">, </span><span class="s3">&quot;period&quot;</span><span class="s2">, </span><span class="s3">&quot;range&quot;</span><span class="s2">, </span><span class="s3">&quot;irregular&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_forecast_index_types(ses</span><span class="s2">, </span><span class="s1">index_typ):</span>
    <span class="s1">nobs = ses.shape[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">kwargs = {}</span>
    <span class="s1">warning = </span><span class="s2">None</span>
    <span class="s1">fcast_index = </span><span class="s2">None</span>
    <span class="s2">if </span><span class="s1">index_typ == </span><span class="s3">&quot;period&quot;</span><span class="s1">:</span>
        <span class="s1">index = pd.period_range(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=nobs + </span><span class="s5">36</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s2">elif </span><span class="s1">index_typ == </span><span class="s3">&quot;date_range&quot;</span><span class="s1">:</span>
        <span class="s1">index = pd.date_range(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods=nobs + </span><span class="s5">36</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s2">elif </span><span class="s1">index_typ == </span><span class="s3">&quot;range&quot;</span><span class="s1">:</span>
        <span class="s1">index = pd.RangeIndex(nobs + </span><span class="s5">36</span><span class="s1">)</span>
        <span class="s1">kwargs[</span><span class="s3">&quot;seasonal_periods&quot;</span><span class="s1">] = </span><span class="s5">12</span>
    <span class="s2">elif </span><span class="s1">index_typ == </span><span class="s3">&quot;irregular&quot;</span><span class="s1">:</span>
        <span class="s1">rs = np.random.RandomState(</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">index = pd.Index(np.cumsum(rs.randint(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">size=nobs + </span><span class="s5">36</span><span class="s1">)))</span>
        <span class="s1">warning = ValueWarning</span>
        <span class="s1">kwargs[</span><span class="s3">&quot;seasonal_periods&quot;</span><span class="s1">] = </span><span class="s5">12</span>
        <span class="s1">fcast_index = pd.RangeIndex(start=</span><span class="s5">1000</span><span class="s2">, </span><span class="s1">stop=</span><span class="s5">1036</span><span class="s2">, </span><span class="s1">step=</span><span class="s5">1</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">fcast_index </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s1">fcast_index = index[-</span><span class="s5">36</span><span class="s1">:]</span>
    <span class="s1">ses = ses.copy()</span>
    <span class="s1">ses.index = index[:-</span><span class="s5">36</span><span class="s1">]</span>

    <span class="s2">with </span><span class="s1">pytest_warns(warning):</span>
        <span class="s1">res = ExponentialSmoothing(</span>
            <span class="s1">ses</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span><span class="s2">,</span>
            <span class="s1">**kwargs</span>
        <span class="s1">).fit()</span>
    <span class="s2">with </span><span class="s1">pytest_warns(warning):</span>
        <span class="s1">fcast = res.forecast(</span><span class="s5">36</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">isinstance(fcast</span><span class="s2">, </span><span class="s1">pd.Series)</span>
    <span class="s1">pd.testing.assert_index_equal(fcast.index</span><span class="s2">, </span><span class="s1">fcast_index)</span>


<span class="s2">def </span><span class="s1">test_boxcox_components(ses):</span>
    <span class="s1">mod = ExponentialSmoothing(</span>
        <span class="s1">ses + </span><span class="s5">1 </span><span class="s1">- ses.min()</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">, </span><span class="s1">use_boxcox=</span><span class="s2">True</span>
    <span class="s1">)</span>
    <span class="s1">res = mod.fit()</span>
    <span class="s2">assert </span><span class="s1">isinstance(res.summary().as_text()</span><span class="s2">, </span><span class="s1">str)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(AssertionError):</span>
        <span class="s4"># Must be different since level is not transformed</span>
        <span class="s1">assert_allclose(res.level</span><span class="s2">, </span><span class="s1">res.fittedvalues)</span>
    <span class="s2">assert not </span><span class="s1">hasattr(res</span><span class="s2">, </span><span class="s3">&quot;_untransformed_level&quot;</span><span class="s1">)</span>
    <span class="s2">assert not </span><span class="s1">hasattr(res</span><span class="s2">, </span><span class="s3">&quot;_untransformed_trend&quot;</span><span class="s1">)</span>
    <span class="s2">assert not </span><span class="s1">hasattr(res</span><span class="s2">, </span><span class="s3">&quot;_untransformed_seasonal&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;repetitions&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;random_errors&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;bootstrap&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_forecast_1_simulation(austourists</span><span class="s2">, </span><span class="s1">random_errors</span><span class="s2">, </span><span class="s1">repetitions):</span>
    <span class="s4"># GH 7053</span>
    <span class="s1">fit = ExponentialSmoothing(</span>
        <span class="s1">austourists</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">damped_trend=</span><span class="s2">True,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">).fit()</span>

    <span class="s1">sim = fit.simulate(</span>
        <span class="s5">1</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">random_errors=random_errors</span><span class="s2">, </span><span class="s1">repetitions=repetitions</span>
    <span class="s1">)</span>
    <span class="s1">expected_shape = (</span><span class="s5">1</span><span class="s2">,</span><span class="s1">) </span><span class="s2">if </span><span class="s1">repetitions == </span><span class="s5">1 </span><span class="s2">else </span><span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">repetitions)</span>
    <span class="s2">assert </span><span class="s1">sim.shape == expected_shape</span>
    <span class="s1">sim = fit.simulate(</span>
        <span class="s5">10</span><span class="s2">, </span><span class="s1">anchor=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">random_errors=random_errors</span><span class="s2">, </span><span class="s1">repetitions=repetitions</span>
    <span class="s1">)</span>
    <span class="s1">expected_shape = (</span><span class="s5">10</span><span class="s2">,</span><span class="s1">) </span><span class="s2">if </span><span class="s1">repetitions == </span><span class="s5">1 </span><span class="s2">else </span><span class="s1">(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">repetitions)</span>
    <span class="s2">assert </span><span class="s1">sim.shape == expected_shape</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;trend&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;add&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;seasonal&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;add&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;nobs&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_estimated_initialization_short_data(ses</span><span class="s2">, </span><span class="s1">trend</span><span class="s2">, </span><span class="s1">seasonal</span><span class="s2">, </span><span class="s1">nobs):</span>
    <span class="s4"># GH 7319</span>
    <span class="s1">res = ExponentialSmoothing(</span>
        <span class="s1">ses[:nobs]</span><span class="s2">,</span>
        <span class="s1">trend=trend</span><span class="s2">,</span>
        <span class="s1">seasonal=seasonal</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">).fit()</span>
    <span class="s2">assert </span><span class="s1">res.mle_retvals.success</span>


<span class="s2">def </span><span class="s1">test_invalid_index(reset_randomstate):</span>
    <span class="s1">y = np.random.standard_normal(</span><span class="s5">12 </span><span class="s1">* </span><span class="s5">200</span><span class="s1">)</span>
    <span class="s1">df_y = pd.DataFrame(data=y)</span>
    <span class="s4"># Can't have a freq here</span>
    <span class="s1">df_y.index.freq = </span><span class="s3">&quot;d&quot;</span>

    <span class="s1">model = ExponentialSmoothing(</span>
        <span class="s1">df_y</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">12</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">fitted = model.fit(optimized=</span><span class="s2">True, </span><span class="s1">use_brute=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s1">fcast = fitted.forecast(steps=</span><span class="s5">157200</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">fcast.shape[</span><span class="s5">0</span><span class="s1">] == </span><span class="s5">157200</span>

    <span class="s1">index = pd.date_range(</span><span class="s3">&quot;2020-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">2 </span><span class="s1">* y.shape[</span><span class="s5">0</span><span class="s1">])</span>
    <span class="s1">index = np.random.choice(index</span><span class="s2">, </span><span class="s1">size=df_y.shape[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">replace=</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">index = sorted(index)</span>
    <span class="s1">df_y.index = index</span>
    <span class="s2">assert </span><span class="s1">isinstance(df_y.index</span><span class="s2">, </span><span class="s1">pd.DatetimeIndex)</span>
    <span class="s2">assert </span><span class="s1">df_y.index.freq </span><span class="s2">is None</span>
    <span class="s2">assert </span><span class="s1">df_y.index.inferred_freq </span><span class="s2">is None</span>
    <span class="s2">with </span><span class="s1">pytest.warns(ValueWarning</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;A date index has been provided&quot;</span><span class="s1">):</span>
        <span class="s1">model = ExponentialSmoothing(</span>
            <span class="s1">df_y</span><span class="s2">,</span>
            <span class="s1">seasonal_periods=</span><span class="s5">12</span><span class="s2">,</span>
            <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">seasonal=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
            <span class="s1">initialization_method=</span><span class="s3">&quot;heuristic&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">fitted = model.fit(optimized=</span><span class="s2">True, </span><span class="s1">use_brute=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.warns(ValueWarning</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;No supported&quot;</span><span class="s1">):</span>
        <span class="s1">fitted.forecast(steps=</span><span class="s5">157200</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_initial_level():</span>
    <span class="s4"># GH 8634</span>
    <span class="s1">series = [</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">100.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s1">]</span>
    <span class="s1">es = ExponentialSmoothing(</span>
        <span class="s1">series</span><span class="s2">, </span><span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">, </span><span class="s1">initial_level=</span><span class="s5">20.0</span>
    <span class="s1">)</span>
    <span class="s1">es_fit = es.fit()</span>
    <span class="s1">es_fit.params</span>
    <span class="s1">assert_allclose(es_fit.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">20.0</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_all_initial_values():</span>
    <span class="s1">fit1 = ExponentialSmoothing(</span>
        <span class="s1">aust</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;estimated&quot;</span><span class="s2">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">lvl = np.round(fit1.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">])</span>
    <span class="s1">trend = np.round(fit1.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">seas = np.round(fit1.params[</span><span class="s3">&quot;initial_seasons&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">fit2 = ExponentialSmoothing(</span>
        <span class="s1">aust</span><span class="s2">,</span>
        <span class="s1">seasonal_periods=</span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">trend=</span><span class="s3">&quot;add&quot;</span><span class="s2">,</span>
        <span class="s1">seasonal=</span><span class="s3">&quot;mul&quot;</span><span class="s2">,</span>
        <span class="s1">initialization_method=</span><span class="s3">&quot;known&quot;</span><span class="s2">,</span>
        <span class="s1">initial_level=lvl</span><span class="s2">,</span>
        <span class="s1">initial_trend=trend</span><span class="s2">,</span>
        <span class="s1">initial_seasonal=seas</span><span class="s2">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">assert_allclose(fit2.params[</span><span class="s3">&quot;initial_level&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">lvl)</span>
    <span class="s1">assert_allclose(fit2.params[</span><span class="s3">&quot;initial_trend&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">trend)</span>
    <span class="s1">assert_allclose(fit2.params[</span><span class="s3">&quot;initial_seasons&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">seas)</span>
</pre>
</body>
</html>
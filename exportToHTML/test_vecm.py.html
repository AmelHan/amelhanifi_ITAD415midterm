<html>
<head>
<title>test_vecm.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_vecm.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">,</span>
    <span class="s1">assert_allclose</span><span class="s0">,</span>
    <span class="s1">assert_array_equal</span><span class="s0">,</span>
    <span class="s1">assert_raises</span><span class="s0">,</span>
    <span class="s1">assert_raises_regex</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">statsmodels.datasets.interest_inflation.data </span><span class="s0">as </span><span class="s1">e6</span>
<span class="s0">from </span><span class="s1">statsmodels.tools.testing </span><span class="s0">import </span><span class="s1">assert_equal</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.vector_ar.tests.JMulTi_results.parse_jmulti_vecm_output </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">dt_s_tup_to_string</span><span class="s0">,</span>
    <span class="s1">load_results_jmulti</span><span class="s0">,</span>
    <span class="s1">sublists</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.vector_ar.util </span><span class="s0">import </span><span class="s1">seasonal_dummies</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.vector_ar.var_model </span><span class="s0">import </span><span class="s1">VARProcess</span>
<span class="s0">from </span><span class="s1">statsmodels.tsa.vector_ar.vecm </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">VECM</span><span class="s0">,</span>
    <span class="s1">select_coint_rank</span><span class="s0">,</span>
    <span class="s1">select_order</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s1">pytestmark = pytest.mark.filterwarnings(</span><span class="s2">&quot;ignore:in the future np.array_split&quot;</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">DataSet:</span>
    <span class="s3">&quot;&quot;&quot; 
    A class for representing the data in a data module. 
 
    Parameters 
    ---------- 
    data_module : module 
        A module contained in the statsmodels/datasets directory. 
    n_seasons : list 
        A list of integers. Each int represents a number of seasons to test the 
        model with. 
    first_season : list 
        A list of integers. Each int corresponds to the int with the same index 
        in the n_seasons list and declares to which season the first data entry 
        belongs. 
    variable_names : list 
        A list of strings. Each string names a variable. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">data_module</span><span class="s0">, </span><span class="s1">n_seasons</span><span class="s0">, </span><span class="s1">first_season</span><span class="s0">, </span><span class="s1">variable_names):</span>
        <span class="s1">self.data_module = data_module</span>
        <span class="s1">self.seasons = n_seasons</span>
        <span class="s1">self.first_season = first_season</span>
        <span class="s1">self.dt_s_list = [</span>
            <span class="s1">(det</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">self.first_season[i])</span>
            <span class="s0">for </span><span class="s1">det </span><span class="s0">in </span><span class="s1">deterministic_terms_list</span>
            <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">s </span><span class="s0">in </span><span class="s1">enumerate(self.seasons)</span>
        <span class="s1">]</span>
        <span class="s1">self.variable_names = variable_names</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s1">self.data_module.__str__()</span>


<span class="s1">atol = </span><span class="s4">0.0005  </span><span class="s5"># absolute tolerance</span>
<span class="s1">rtol = </span><span class="s4">0  </span><span class="s5"># relative tolerance</span>
<span class="s1">datasets = []</span>
<span class="s1">data = {}</span>
<span class="s1">results_ref = {}</span>
<span class="s1">results_sm = {}</span>
<span class="s1">results_sm_exog = {}</span>
<span class="s1">results_sm_exog_coint = {}</span>
<span class="s1">coint_rank = </span><span class="s4">1</span>

<span class="s1">debug_mode = </span><span class="s0">False</span>
<span class="s1">dont_test_se_t_p = </span><span class="s0">False</span>
<span class="s1">deterministic_terms_list = [</span><span class="s2">&quot;nc&quot;</span><span class="s0">, </span><span class="s2">&quot;co&quot;</span><span class="s0">, </span><span class="s2">&quot;colo&quot;</span><span class="s0">, </span><span class="s2">&quot;ci&quot;</span><span class="s0">, </span><span class="s2">&quot;cili&quot;</span><span class="s1">]</span>

<span class="s1">all_tests = [</span>
    <span class="s2">&quot;Gamma&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;alpha&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;beta&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;C&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;det_coint&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;Sigma_u&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;VAR repr. A&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;VAR to VEC representation&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;log_like&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;fc&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;granger&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;inst. causality&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;impulse-response&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;lag order&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;test_norm&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;whiteness&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;summary&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;exceptions&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;select_coint_rank&quot;</span><span class="s0">,</span>
<span class="s1">]</span>
<span class="s1">to_test = all_tests  </span><span class="s5"># [&quot;beta&quot;]</span>


<span class="s0">def </span><span class="s1">load_data(dataset</span><span class="s0">, </span><span class="s1">data_dict):</span>
    <span class="s1">dtset = dataset.data_module.load_pandas()</span>
    <span class="s1">variables = dataset.variable_names</span>
    <span class="s1">loaded = dtset.data[variables].astype(float).values</span>
    <span class="s1">data_dict[dataset] = loaded.reshape((-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">len(variables)))</span>


<span class="s0">def </span><span class="s1">load_results_statsmodels(dataset):</span>
    <span class="s1">results_per_deterministic_terms = dict.fromkeys(dataset.dt_s_list)</span>

    <span class="s0">for </span><span class="s1">dt_s_tup </span><span class="s0">in </span><span class="s1">dataset.dt_s_list:</span>
        <span class="s1">model = VECM(</span>
            <span class="s1">data[dataset]</span><span class="s0">,</span>
            <span class="s1">k_ar_diff=</span><span class="s4">3</span><span class="s0">,</span>
            <span class="s1">coint_rank=coint_rank</span><span class="s0">,</span>
            <span class="s1">deterministic=dt_s_tup[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">seasons=dt_s_tup[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">first_season=dt_s_tup[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">results_per_deterministic_terms[dt_s_tup] = model.fit(method=</span><span class="s2">&quot;ml&quot;</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">results_per_deterministic_terms</span>


<span class="s0">def </span><span class="s1">load_results_statsmodels_exog(dataset):</span>
    <span class="s3">&quot;&quot;&quot; 
    Load data with seasonal terms in `exog`. 
 
    Same as load_results_statsmodels() except that the seasonal term is 
    provided to :class:`VECM`'s `__init__()` method via the `eoxg` parameter. 
    This is to check whether the same results are produced no matter whether 
    `exog` or `seasons` is being used. 
 
    Parameters 
    ---------- 
    dataset : DataSet 
    &quot;&quot;&quot;</span>
    <span class="s1">results_per_deterministic_terms = dict.fromkeys(dataset.dt_s_list)</span>
    <span class="s1">endog = data[dataset]</span>
    <span class="s0">for </span><span class="s1">dt_s_tup </span><span class="s0">in </span><span class="s1">dataset.dt_s_list:</span>
        <span class="s1">det_string = dt_s_tup[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">seasons = dt_s_tup[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">first_season = dt_s_tup[</span><span class="s4">2</span><span class="s1">]</span>
        <span class="s0">if </span><span class="s1">seasons == </span><span class="s4">0</span><span class="s1">:</span>
            <span class="s1">exog = </span><span class="s0">None</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">exog = seasonal_dummies(</span>
                <span class="s1">seasons</span><span class="s0">, </span><span class="s1">len(data[dataset])</span><span class="s0">, </span><span class="s1">first_season</span><span class="s0">, </span><span class="s1">centered=</span><span class="s0">True</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_s_tup[</span><span class="s4">0</span><span class="s1">]:</span>
                <span class="s1">exog = np.hstack(</span>
                    <span class="s1">(exog</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">+ np.arange(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
                <span class="s1">)</span>
                <span class="s5"># remove &quot;lo&quot; since it's now already in exog.</span>
                <span class="s1">det_string = det_string[:-</span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">model = VECM(</span>
            <span class="s1">endog</span><span class="s0">,</span>
            <span class="s1">exog</span><span class="s0">,</span>
            <span class="s1">k_ar_diff=</span><span class="s4">3</span><span class="s0">,</span>
            <span class="s1">coint_rank=coint_rank</span><span class="s0">,</span>
            <span class="s1">deterministic=det_string</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">results_per_deterministic_terms[dt_s_tup] = model.fit(method=</span><span class="s2">&quot;ml&quot;</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">results_per_deterministic_terms</span>


<span class="s0">def </span><span class="s1">load_results_statsmodels_exog_coint(dataset):</span>
    <span class="s3">&quot;&quot;&quot; 
    Load data with deterministic terms in `exog_coint`. 
 
    Same as load_results_statsmodels() except that deterministic terms inside 
    the cointegration relation are provided to :class:`VECM`'s `__init__()` 
    method via the `eoxg_coint` parameter. This is to check whether the same 
    results are produced no matter whether `exog_coint` or the `deterministic` 
    argument is being used. 
 
    Parameters 
    ---------- 
    dataset : DataSet 
    &quot;&quot;&quot;</span>
    <span class="s1">results_per_deterministic_terms = dict.fromkeys(dataset.dt_s_list)</span>
    <span class="s1">endog = data[dataset]</span>
    <span class="s0">for </span><span class="s1">dt_s_tup </span><span class="s0">in </span><span class="s1">dataset.dt_s_list:</span>
        <span class="s1">det_string = dt_s_tup[</span><span class="s4">0</span><span class="s1">]</span>

        <span class="s0">if </span><span class="s2">&quot;ci&quot; </span><span class="s0">not in </span><span class="s1">det_string </span><span class="s0">and </span><span class="s2">&quot;li&quot; </span><span class="s0">not in </span><span class="s1">det_string:</span>
            <span class="s1">exog_coint = </span><span class="s0">None</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">exog_coint = []</span>
            <span class="s0">if </span><span class="s2">&quot;li&quot; </span><span class="s0">in </span><span class="s1">det_string:</span>
                <span class="s1">exog_coint.append(</span><span class="s4">1 </span><span class="s1">+ np.arange(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
                <span class="s1">det_string = det_string[:-</span><span class="s4">2</span><span class="s1">]</span>
            <span class="s0">if </span><span class="s2">&quot;ci&quot; </span><span class="s0">in </span><span class="s1">det_string:</span>
                <span class="s1">exog_coint.append(np.ones(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
                <span class="s1">det_string = det_string[:-</span><span class="s4">2</span><span class="s1">]</span>
            <span class="s5"># reversing (such that constant is first and linear is second)</span>
            <span class="s1">exog_coint = exog_coint[::-</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">exog_coint = np.hstack(exog_coint)</span>
        <span class="s1">model = VECM(</span>
            <span class="s1">endog</span><span class="s0">,</span>
            <span class="s1">exog=</span><span class="s0">None,</span>
            <span class="s1">exog_coint=exog_coint</span><span class="s0">,</span>
            <span class="s1">k_ar_diff=</span><span class="s4">3</span><span class="s0">,</span>
            <span class="s1">coint_rank=coint_rank</span><span class="s0">,</span>
            <span class="s1">deterministic=det_string</span><span class="s0">,</span>
            <span class="s1">seasons=dt_s_tup[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">first_season=dt_s_tup[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">results_per_deterministic_terms[dt_s_tup] = model.fit(method=</span><span class="s2">&quot;ml&quot;</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">results_per_deterministic_terms</span>


<span class="s0">def </span><span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt_s</span><span class="s0">, </span><span class="s1">parameter_str):</span>
    <span class="s1">dt = dt_s_tup_to_string(dt_s)</span>
    <span class="s1">seasons = dt_s[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">err_msg = </span><span class="s2">&quot;Error in &quot; </span><span class="s1">+ parameter_str + </span><span class="s2">&quot; for:</span><span class="s0">\n</span><span class="s2">&quot;</span>
    <span class="s1">err_msg += </span><span class="s2">&quot;- Dataset: &quot; </span><span class="s1">+ ds.__str__() + </span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span>
    <span class="s1">err_msg += </span><span class="s2">&quot;- Deterministic terms: &quot;</span>
    <span class="s1">err_msg += dt_s[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">if </span><span class="s1">dt != </span><span class="s2">&quot;n&quot; </span><span class="s0">else </span><span class="s2">&quot;no det. terms&quot;</span>
    <span class="s0">if </span><span class="s1">seasons &gt; </span><span class="s4">0</span><span class="s1">:</span>
        <span class="s1">err_msg += </span><span class="s2">&quot;, seasons: &quot; </span><span class="s1">+ str(seasons)</span>
    <span class="s0">return </span><span class="s1">err_msg</span>


<span class="s0">def </span><span class="s1">setup():</span>
    <span class="s1">datasets.append(</span>
        <span class="s1">DataSet(e6</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;Dp&quot;</span><span class="s0">, </span><span class="s2">&quot;R&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s5"># DataSet(...) TODO: append more data sets for more test cases.</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s1">load_data(ds</span><span class="s0">, </span><span class="s1">data)</span>
        <span class="s1">results_ref[ds] = load_results_jmulti(ds)</span>
        <span class="s1">results_sm[ds] = load_results_statsmodels(ds)</span>
        <span class="s1">results_sm_exog[ds] = load_results_statsmodels_exog(ds)</span>
        <span class="s1">results_sm_exog_coint[ds] = load_results_statsmodels_exog_coint(ds)</span>


<span class="s1">setup()</span>


<span class="s0">def </span><span class="s1">test_ml_gamma():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;Gamma&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">GAMMA&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s5"># estimated parameter vector</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;Gamma&quot;</span><span class="s1">)</span>
            <span class="s1">obtained = results_sm[ds][dt].gamma</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].gamma</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].gamma</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;Gamma&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>

            <span class="s0">if </span><span class="s1">debug_mode </span><span class="s0">and </span><span class="s1">dont_test_se_t_p:  </span><span class="s5"># pragma: no cover</span>
                <span class="s0">continue</span>
            <span class="s5"># standard errors</span>
            <span class="s1">obt = results_sm[ds][dt].stderr_gamma</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].stderr_gamma</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].stderr_gamma</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;se&quot;</span><span class="s1">][</span><span class="s2">&quot;Gamma&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;STANDARD ERRORS</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># t-values</span>
            <span class="s1">obt = results_sm[ds][dt].tvalues_gamma</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].tvalues_gamma</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].tvalues_gamma</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;t&quot;</span><span class="s1">][</span><span class="s2">&quot;Gamma&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;t-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># p-values</span>
            <span class="s1">obt = results_sm[ds][dt].pvalues_gamma</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].pvalues_gamma</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].pvalues_gamma</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span><span class="s2">&quot;Gamma&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;p-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_ml_alpha():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;alpha&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">ALPHA&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;alpha&quot;</span><span class="s1">)</span>
            <span class="s1">obtained = results_sm[ds][dt].alpha</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].alpha</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].alpha</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;alpha&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>

            <span class="s0">if </span><span class="s1">debug_mode </span><span class="s0">and </span><span class="s1">dont_test_se_t_p:  </span><span class="s5"># pragma: no cover</span>
                <span class="s0">continue</span>
            <span class="s5"># standard errors</span>
            <span class="s1">obt = results_sm[ds][dt].stderr_alpha</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].stderr_alpha</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].stderr_alpha</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;se&quot;</span><span class="s1">][</span><span class="s2">&quot;alpha&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;STANDARD ERRORS</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># t-values</span>
            <span class="s1">obt = results_sm[ds][dt].tvalues_alpha</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].tvalues_alpha</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].tvalues_alpha</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;t&quot;</span><span class="s1">][</span><span class="s2">&quot;alpha&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;t-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># p-values</span>
            <span class="s1">obt = results_sm[ds][dt].pvalues_alpha</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].pvalues_alpha</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].pvalues_alpha</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span><span class="s2">&quot;alpha&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;p-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_ml_beta():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;beta&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">BETA&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;beta&quot;</span><span class="s1">)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;beta&quot;</span><span class="s1">]</span>
            <span class="s1">rows = desired.shape[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s5"># - first coint_rank rows in JMulTi output have se=t_val=p_val=0</span>
            <span class="s5"># - beta includes deterministic terms in cointegration relation in</span>
            <span class="s5">#   sm, so we compare only the elements belonging to beta.</span>
            <span class="s1">obtained = results_sm[ds][dt].beta[coint_rank:rows]</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].beta[coint_rank:rows]</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].beta[</span>
                <span class="s1">coint_rank:rows</span>
            <span class="s1">]</span>
            <span class="s1">desired = desired[coint_rank:]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>

            <span class="s0">if </span><span class="s1">debug_mode </span><span class="s0">and </span><span class="s1">dont_test_se_t_p:  </span><span class="s5"># pragma: no cover</span>
                <span class="s0">continue</span>
            <span class="s5"># standard errors</span>
            <span class="s1">obt = results_sm[ds][dt].stderr_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].stderr_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].stderr_beta[</span>
                <span class="s1">coint_rank:rows</span>
            <span class="s1">]</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;se&quot;</span><span class="s1">][</span><span class="s2">&quot;beta&quot;</span><span class="s1">][coint_rank:]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;STANDARD ERRORS</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># t-values</span>
            <span class="s1">obt = results_sm[ds][dt].tvalues_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].tvalues_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].tvalues_beta[</span>
                <span class="s1">coint_rank:rows</span>
            <span class="s1">]</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;t&quot;</span><span class="s1">][</span><span class="s2">&quot;beta&quot;</span><span class="s1">][coint_rank:]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;t-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># p-values</span>
            <span class="s1">obt = results_sm[ds][dt].pvalues_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog = results_sm_exog[ds][dt].pvalues_beta[coint_rank:rows]</span>
            <span class="s1">obt_exog_coint = results_sm_exog_coint[ds][dt].pvalues_beta[</span>
                <span class="s1">coint_rank:rows</span>
            <span class="s1">]</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span><span class="s2">&quot;beta&quot;</span><span class="s1">][coint_rank:]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s2">&quot;p-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_ml_c():  </span><span class="s5"># test deterministic terms outside coint relation</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;C&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">DET_COEF&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">C_obt = results_sm[ds][dt].det_coef</span>
            <span class="s1">C_obt_exog = results_sm_exog[ds][dt].det_coef</span>
            <span class="s1">C_obt_exog_coint = results_sm_exog_coint[ds][dt].det_coef</span>
            <span class="s1">se_C_obt = results_sm[ds][dt].stderr_det_coef</span>
            <span class="s1">se_C_obt_exog = results_sm_exog[ds][dt].stderr_det_coef</span>
            <span class="s1">se_C_obt_exog_coint = results_sm_exog_coint[ds][dt].stderr_det_coef</span>
            <span class="s1">t_C_obt = results_sm[ds][dt].tvalues_det_coef</span>
            <span class="s1">t_C_obt_exog = results_sm_exog[ds][dt].tvalues_det_coef</span>
            <span class="s1">t_C_obt_exog_coint = results_sm_exog_coint[ds][dt].tvalues_det_coef</span>
            <span class="s1">p_C_obt = results_sm[ds][dt].pvalues_det_coef</span>
            <span class="s1">p_C_obt_exog = results_sm_exog[ds][dt].pvalues_det_coef</span>
            <span class="s1">p_C_obt_exog_coint = results_sm_exog_coint[ds][dt].pvalues_det_coef</span>

            <span class="s0">if </span><span class="s2">&quot;C&quot; </span><span class="s0">not in </span><span class="s1">results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">].keys():</span>
                <span class="s5"># case: there are no deterministic terms</span>
                <span class="s0">if </span><span class="s1">(</span>
                    <span class="s1">C_obt.size == </span><span class="s4">0</span>
                    <span class="s0">and </span><span class="s1">se_C_obt.size == </span><span class="s4">0</span>
                    <span class="s0">and </span><span class="s1">t_C_obt.size == </span><span class="s4">0</span>
                    <span class="s0">and </span><span class="s1">p_C_obt.size == </span><span class="s4">0</span>
                <span class="s1">):</span>
                    <span class="s1">assert_(</span><span class="s0">True</span><span class="s1">)</span>
                    <span class="s0">continue</span>

            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;C&quot;</span><span class="s1">]</span>
            <span class="s1">dt_string = dt_s_tup_to_string(dt)</span>
            <span class="s0">if </span><span class="s2">&quot;co&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;CONST&quot;</span><span class="s1">)</span>
                <span class="s1">const_obt = C_obt[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">const_obt_exog = C_obt_exog[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">const_obt_exog_coint = C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">const_des = desired[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">C_obt = C_obt[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">C_obt_exog = C_obt_exog[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">C_obt_exog_coint = C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">desired = desired[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">const_obt</span><span class="s0">, </span><span class="s1">const_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">const_obt_exog</span><span class="s0">, </span><span class="s1">const_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">const_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">const_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;s&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;SEASONAL&quot;</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                    <span class="s1">seas_obt = C_obt[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">seas_obt_exog = C_obt_exog[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">seas_obt_exog_coint = C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">seas_des = desired[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">seas_obt = C_obt</span>
                    <span class="s1">seas_obt_exog = C_obt_exog</span>
                    <span class="s1">seas_obt_exog_coint = C_obt_exog_coint</span>
                    <span class="s1">seas_des = desired</span>
                <span class="s1">assert_allclose(seas_obt</span><span class="s0">, </span><span class="s1">seas_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">seas_obt_exog</span><span class="s0">, </span><span class="s1">seas_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">seas_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">seas_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;LINEAR TREND&quot;</span><span class="s1">)</span>
                <span class="s1">lt_obt = C_obt[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">lt_obt_exog = C_obt_exog[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">lt_obt_exog_coint = C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">lt_des = desired[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(lt_obt</span><span class="s0">, </span><span class="s1">lt_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(lt_obt_exog</span><span class="s0">, </span><span class="s1">lt_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">lt_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">lt_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">debug_mode </span><span class="s0">and </span><span class="s1">dont_test_se_t_p:  </span><span class="s5"># pragma: no cover</span>
                <span class="s0">continue</span>
            <span class="s5"># standard errors</span>
            <span class="s1">se_desired = results_ref[ds][dt][</span><span class="s2">&quot;se&quot;</span><span class="s1">][</span><span class="s2">&quot;C&quot;</span><span class="s1">]</span>
            <span class="s0">if </span><span class="s2">&quot;co&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;SE CONST&quot;</span><span class="s1">)</span>
                <span class="s1">se_const_obt = se_C_obt[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">se_C_obt = se_C_obt[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">se_const_obt_exog = se_C_obt_exog[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">se_C_obt_exog = se_C_obt_exog[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">se_const_obt_exog_coint = se_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">se_C_obt_exog_coint = se_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">se_const_des = se_desired[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">se_desired = se_desired[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">se_const_obt</span><span class="s0">, </span><span class="s1">se_const_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">se_const_obt_exog</span><span class="s0">,</span>
                        <span class="s1">se_const_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">se_const_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">se_const_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;s&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;SE SEASONAL&quot;</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                    <span class="s1">se_seas_obt = se_C_obt[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">se_seas_obt_exog = se_C_obt_exog[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">se_seas_obt_exog_coint = se_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">se_seas_des = se_desired[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">se_seas_obt = se_C_obt</span>
                    <span class="s1">se_seas_obt_exog = se_C_obt_exog</span>
                    <span class="s1">se_seas_obt_exog_coint = se_C_obt_exog_coint</span>
                    <span class="s1">se_seas_des = se_desired</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">se_seas_obt</span><span class="s0">, </span><span class="s1">se_seas_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">se_seas_obt_exog</span><span class="s0">, </span><span class="s1">se_seas_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">se_seas_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">se_seas_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                    <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;SE LIN. TREND&quot;</span><span class="s1">)</span>
                    <span class="s1">se_lt_obt = se_C_obt[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                    <span class="s1">se_lt_obt_exog = se_C_obt_exog[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                    <span class="s1">se_lt_obt_exog_coint = se_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                    <span class="s1">se_lt_des = se_desired[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">se_lt_obt</span><span class="s0">, </span><span class="s1">se_lt_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
                    <span class="s1">)</span>
                    <span class="s0">if </span><span class="s1">exog:</span>
                        <span class="s1">assert_equal(</span>
                            <span class="s1">se_lt_obt_exog</span><span class="s0">, </span><span class="s1">se_lt_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span>
                        <span class="s1">)</span>
                    <span class="s0">if </span><span class="s1">exog_coint:</span>
                        <span class="s1">assert_equal(</span>
                            <span class="s1">se_lt_obt_exog_coint</span><span class="s0">,</span>
                            <span class="s1">se_lt_obt</span><span class="s0">,</span>
                            <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                        <span class="s1">)</span>
            <span class="s5"># t-values</span>
            <span class="s1">t_desired = results_ref[ds][dt][</span><span class="s2">&quot;t&quot;</span><span class="s1">][</span><span class="s2">&quot;C&quot;</span><span class="s1">]</span>
            <span class="s0">if </span><span class="s2">&quot;co&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">t_const_obt = t_C_obt[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">t_C_obt = t_C_obt[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_const_obt_exog = t_C_obt_exog[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">t_C_obt_exog = t_C_obt_exog[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_const_obt_exog_coint = t_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">t_C_obt_exog_coint = t_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_const_des = t_desired[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">t_desired = t_desired[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">t_const_obt</span><span class="s0">,</span>
                    <span class="s1">t_const_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;T CONST&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_const_obt_exog</span><span class="s0">, </span><span class="s1">t_const_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG: &quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_const_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">t_const_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT: &quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;s&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                    <span class="s1">t_seas_obt = t_C_obt[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">t_seas_obt_exog = t_C_obt_exog[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">t_seas_obt_exog_coint = t_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">t_seas_des = t_desired[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">t_seas_obt = t_C_obt</span>
                    <span class="s1">t_seas_obt_exog = t_C_obt_exog</span>
                    <span class="s1">t_seas_obt_exog_coint = t_C_obt_exog_coint</span>
                    <span class="s1">t_seas_des = t_desired</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">t_seas_obt</span><span class="s0">,</span>
                    <span class="s1">t_seas_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;T SEASONAL&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_seas_obt_exog</span><span class="s0">, </span><span class="s1">t_seas_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_seas_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">t_seas_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">t_lt_obt = t_C_obt[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_lt_obt_exog = t_C_obt_exog[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_lt_obt_exog_coint = t_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">t_lt_des = t_desired[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">t_lt_obt</span><span class="s0">,</span>
                    <span class="s1">t_lt_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;T LIN. TREND&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_lt_obt_exog</span><span class="s0">, </span><span class="s1">t_lt_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">t_lt_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">t_lt_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s5"># p-values</span>
            <span class="s1">p_desired = results_ref[ds][dt][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span><span class="s2">&quot;C&quot;</span><span class="s1">]</span>
            <span class="s0">if </span><span class="s2">&quot;co&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">p_const_obt = p_C_obt[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">p_C_obt = p_C_obt[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_const_obt_exog = p_C_obt_exog[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">p_C_obt_exog = p_C_obt_exog[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_const_obt_exog_coint = p_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">p_C_obt_exo_cointg = p_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_const_des = p_desired[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
                <span class="s1">p_desired = p_desired[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">p_const_obt</span><span class="s0">,</span>
                    <span class="s1">p_const_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;P CONST&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_const_obt</span><span class="s0">, </span><span class="s1">p_const_obt_exog</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_const_obt</span><span class="s0">,</span>
                        <span class="s1">p_const_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;s&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                    <span class="s1">p_seas_obt = p_C_obt[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">p_seas_obt_exog = p_C_obt_exog[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">p_seas_obt_exog_coint = p_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                    <span class="s1">p_seas_des = p_desired[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">p_seas_obt = p_C_obt</span>
                    <span class="s1">p_seas_obt_exog = p_C_obt_exog</span>
                    <span class="s1">p_seas_obt_exog_coint = p_C_obt_exog_coint</span>
                    <span class="s1">p_seas_des = p_desired</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">p_seas_obt</span><span class="s0">,</span>
                    <span class="s1">p_seas_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;P SEASONAL&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_seas_obt_exog</span><span class="s0">, </span><span class="s1">p_seas_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_seas_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">p_seas_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">dt_string:</span>
                <span class="s1">p_lt_obt = p_C_obt[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_lt_obt_exog = p_C_obt_exog[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_lt_obt_exog_coint = p_C_obt_exog_coint[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">p_lt_des = p_desired[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">:]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">p_lt_obt</span><span class="s0">,</span>
                    <span class="s1">p_lt_des</span><span class="s0">,</span>
                    <span class="s1">rtol</span><span class="s0">,</span>
                    <span class="s1">atol</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;P LIN. TREND&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_lt_obt_exog</span><span class="s0">, </span><span class="s1">p_lt_obt</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">p_lt_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">p_lt_obt</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_ml_det_terms_in_coint_relation():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;det_coint&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">DET_COEF_COINT&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;det terms in coint relation&quot;</span><span class="s1">)</span>
            <span class="s1">dt_string = dt_s_tup_to_string(dt)</span>
            <span class="s1">obtained = results_sm[ds][dt].det_coef_coint</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].det_coef_coint</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].det_coef_coint</span>
            <span class="s0">if </span><span class="s2">&quot;ci&quot; </span><span class="s0">not in </span><span class="s1">dt_string </span><span class="s0">and </span><span class="s2">&quot;li&quot; </span><span class="s0">not in </span><span class="s1">dt_string:</span>
                <span class="s0">if </span><span class="s1">obtained.size &gt; </span><span class="s4">0</span><span class="s1">:</span>
                    <span class="s1">assert_(</span>
                        <span class="s0">False,</span>
                        <span class="s1">build_err_msg(</span>
                            <span class="s1">ds</span><span class="s0">,</span>
                            <span class="s1">dt</span><span class="s0">,</span>
                            <span class="s2">&quot;There should not be any det terms in &quot;</span>
                            <span class="s1">+ </span><span class="s2">&quot;cointegration for deterministic terms &quot;</span>
                            <span class="s1">+ dt_string</span><span class="s0">,</span>
                        <span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">assert_(</span><span class="s0">True</span><span class="s1">)</span>
                <span class="s0">continue</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;det_coint&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s5"># standard errors</span>
            <span class="s1">se_obtained = results_sm[ds][dt].stderr_det_coef_coint</span>
            <span class="s1">se_obtained_exog = results_sm_exog[ds][dt].stderr_det_coef_coint</span>
            <span class="s1">se_obtained_exog_coint = results_sm_exog_coint[ds][</span>
                <span class="s1">dt</span>
            <span class="s1">].stderr_det_coef_coint</span>
            <span class="s1">se_desired = results_ref[ds][dt][</span><span class="s2">&quot;se&quot;</span><span class="s1">][</span><span class="s2">&quot;det_coint&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">se_obtained</span><span class="s0">,</span>
                <span class="s1">se_desired</span><span class="s0">,</span>
                <span class="s1">rtol</span><span class="s0">,</span>
                <span class="s1">atol</span><span class="s0">,</span>
                <span class="s0">False,</span>
                <span class="s2">&quot;STANDARD ERRORS</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">se_obtained_exog</span><span class="s0">, </span><span class="s1">se_obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">se_obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">se_obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># t-values</span>
            <span class="s1">t_obtained = results_sm[ds][dt].tvalues_det_coef_coint</span>
            <span class="s1">t_obtained_exog = results_sm_exog[ds][dt].tvalues_det_coef_coint</span>
            <span class="s1">t_obtained_exog_coint = results_sm_exog_coint[ds][</span>
                <span class="s1">dt</span>
            <span class="s1">].tvalues_det_coef_coint</span>
            <span class="s1">t_desired = results_ref[ds][dt][</span><span class="s2">&quot;t&quot;</span><span class="s1">][</span><span class="s2">&quot;det_coint&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">t_obtained</span><span class="s0">,</span>
                <span class="s1">t_desired</span><span class="s0">,</span>
                <span class="s1">rtol</span><span class="s0">,</span>
                <span class="s1">atol</span><span class="s0">,</span>
                <span class="s0">False,</span>
                <span class="s2">&quot;t-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">t_obtained_exog</span><span class="s0">, </span><span class="s1">t_obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">t_obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">t_obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># p-values</span>
            <span class="s1">p_obtained = results_sm[ds][dt].pvalues_det_coef_coint</span>
            <span class="s1">p_obtained_exog = results_sm_exog[ds][dt].pvalues_det_coef_coint</span>
            <span class="s1">p_obtained_exog_coint = results_sm_exog_coint[ds][</span>
                <span class="s1">dt</span>
            <span class="s1">].pvalues_det_coef_coint</span>
            <span class="s1">p_desired = results_ref[ds][dt][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span><span class="s2">&quot;det_coint&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">p_obtained</span><span class="s0">,</span>
                <span class="s1">p_desired</span><span class="s0">,</span>
                <span class="s1">rtol</span><span class="s0">,</span>
                <span class="s1">atol</span><span class="s0">,</span>
                <span class="s0">False,</span>
                <span class="s2">&quot;p-VALUES</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">p_obtained_exog</span><span class="s0">, </span><span class="s1">p_obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">p_obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">p_obtained</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_ml_sigma():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;Sigma_u&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">SIGMA_U&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;Sigma_u&quot;</span><span class="s1">)</span>
            <span class="s1">obtained = results_sm[ds][dt].sigma_u</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].sigma_u</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].sigma_u</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;Sigma_u&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_var_rep():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;VAR repr. A&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">VAR REPRESENTATION&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;VAR repr. A&quot;</span><span class="s1">)</span>
            <span class="s1">obtained = results_sm[ds][dt].var_rep</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].var_rep</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].var_rep</span>
            <span class="s1">p = obtained.shape[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">desired = np.hsplit(results_ref[ds][dt][</span><span class="s2">&quot;est&quot;</span><span class="s1">][</span><span class="s2">&quot;VAR A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">p)</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_var_to_vecm():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;VAR to VEC representation&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">VAR TO VEC&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;VAR to VEC representation&quot;</span><span class="s1">)</span>
            <span class="s1">sigma_u = results_sm[ds][dt].sigma_u</span>
            <span class="s1">coefs = results_sm[ds][dt].var_rep</span>
            <span class="s1">intercept = np.zeros(len(sigma_u))</span>
            <span class="s5"># Note: _params_info k_trend, k_exog, ... is inferred with defaults</span>
            <span class="s1">var = VARProcess(coefs</span><span class="s0">, </span><span class="s1">intercept</span><span class="s0">, </span><span class="s1">sigma_u)</span>
            <span class="s1">vecm_results = var.to_vecm()</span>
            <span class="s1">obtained_pi = vecm_results[</span><span class="s2">&quot;Pi&quot;</span><span class="s1">]</span>
            <span class="s1">obtained_gamma = vecm_results[</span><span class="s2">&quot;Gamma&quot;</span><span class="s1">]</span>

            <span class="s1">desired_pi = np.dot(</span>
                <span class="s1">results_sm[ds][dt].alpha</span><span class="s0">, </span><span class="s1">results_sm[ds][dt].beta.T</span>
            <span class="s1">)</span>
            <span class="s1">desired_gamma = results_sm[ds][dt].gamma</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained_pi</span><span class="s0">, </span><span class="s1">desired_pi</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg + </span><span class="s2">&quot; Pi&quot;</span>
            <span class="s1">)</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained_gamma</span><span class="s0">,</span>
                <span class="s1">desired_gamma</span><span class="s0">,</span>
                <span class="s1">rtol</span><span class="s0">,</span>
                <span class="s1">atol</span><span class="s0">,</span>
                <span class="s0">False,</span>
                <span class="s1">err_msg + </span><span class="s2">&quot; Gamma&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>


<span class="s5"># Commented out since JMulTi shows the same det. terms for both VEC &amp; VAR repr.</span>
<span class="s5"># def test_var_rep_det():</span>
<span class="s5">#     for ds in datasets:</span>
<span class="s5">#         for dt in dt_s_list:</span>
<span class="s5">#             if dt != &quot;n&quot;:</span>
<span class="s5">#                 err_msg = build_err_msg(ds, dt, &quot;VAR repr. deterministic&quot;)</span>
<span class="s5">#                 obtained = 0  # not implemented since the same values as VECM</span>
<span class="s5">#                 desired = results_ref[ds][dt][&quot;est&quot;][&quot;VAR deterministic&quot;]</span>
<span class="s5">#                 assert_allclose(obtained, desired, rtol, atol, False, err_msg)</span>


<span class="s0">def </span><span class="s1">test_log_like():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;log_like&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">LOG LIKELIHOOD&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;Log Likelihood&quot;</span><span class="s1">)</span>
            <span class="s1">obtained = results_sm[ds][dt].llf</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].llf</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].llf</span>
            <span class="s5"># JMulTi's llf seems to have a bug (Stata and tsdyn suggest that</span>
            <span class="s5"># our code is correct). We use nobs to correct this inconsistency.</span>
            <span class="s1">nobs = results_sm[ds][dt].nobs</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;log_like&quot;</span><span class="s1">] * nobs / (nobs - </span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(obtained_exog</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">, </span><span class="s1">obtained</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_fc():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;fc&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">FORECAST&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">STEPS = </span><span class="s4">5</span>
            <span class="s1">ALPHA = </span><span class="s4">0.05</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;FORECAST&quot;</span><span class="s1">)</span>
            <span class="s5"># test point forecast functionality of predict method</span>
            <span class="s1">obtained = results_sm[ds][dt].predict(steps=STEPS)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;fc&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>

            <span class="s5"># -----------------------------------------------------------------</span>
            <span class="s5"># with exog:</span>
            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_fc = </span><span class="s0">None</span>
            <span class="s0">if </span><span class="s1">exog:  </span><span class="s5"># build future values of exog and test:</span>
                <span class="s1">seasons = dt[</span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">exog_model = results_sm_exog[ds][dt].exog</span>
                <span class="s1">exog_seasons_fc = exog_model[-seasons:</span><span class="s0">, </span><span class="s1">: seasons - </span><span class="s4">1</span><span class="s1">]</span>
                <span class="s1">exog_seasons_fc = np.pad(</span>
                    <span class="s1">exog_seasons_fc</span><span class="s0">,</span>
                    <span class="s1">((</span><span class="s4">0</span><span class="s0">, </span><span class="s1">STEPS - exog_seasons_fc.shape[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span><span class="s0">,</span>
                    <span class="s2">&quot;wrap&quot;</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s5"># if linear trend in exog</span>
                <span class="s0">if </span><span class="s1">exog_seasons_fc.shape[</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">1 </span><span class="s1">== exog_model.shape[</span><span class="s4">1</span><span class="s1">]:</span>
                    <span class="s1">exog_lt_fc = exog_model[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">1 </span><span class="s1">+ np.arange(STEPS)</span>
                    <span class="s1">exog_fc = np.column_stack((exog_seasons_fc</span><span class="s0">, </span><span class="s1">exog_lt_fc))</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">exog_fc = exog_seasons_fc</span>
                <span class="s1">obtained_exog = results_sm_exog[ds][dt].predict(</span>
                    <span class="s1">steps=STEPS</span><span class="s0">, </span><span class="s1">exog_fc=exog_fc</span>
                <span class="s1">)</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obtained_exog</span><span class="s0">,</span>
                    <span class="s1">obtained</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># test predict method with confidence interval calculation</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;FORECAST WITH INTERVALS&quot;</span><span class="s1">)</span>
            <span class="s1">obtained_w_intervals = results_sm[ds][dt].predict(</span>
                <span class="s1">steps=STEPS</span><span class="s0">, </span><span class="s1">alpha=ALPHA</span>
            <span class="s1">)</span>
            <span class="s1">obtained_w_intervals_exog = results_sm_exog[ds][dt].predict(</span>
                <span class="s1">steps=STEPS</span><span class="s0">, </span><span class="s1">alpha=ALPHA</span><span class="s0">, </span><span class="s1">exog_fc=exog_fc</span>
            <span class="s1">)</span>
            <span class="s1">obt = obtained_w_intervals[</span><span class="s4">0</span><span class="s1">]  </span><span class="s5"># forecast</span>
            <span class="s1">obt_l = obtained_w_intervals[</span><span class="s4">1</span><span class="s1">]  </span><span class="s5"># lower bound</span>
            <span class="s1">obt_u = obtained_w_intervals[</span><span class="s4">2</span><span class="s1">]  </span><span class="s5"># upper bound</span>
            <span class="s1">obt_exog = obtained_w_intervals_exog[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">obt_exog_l = obtained_w_intervals_exog[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">obt_exog_u = obtained_w_intervals_exog[</span><span class="s4">2</span><span class="s1">]</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;fc&quot;</span><span class="s1">]</span>
            <span class="s1">des_l = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;lower&quot;</span><span class="s1">]</span>
            <span class="s1">des_u = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;upper&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s1">assert_allclose(obt_l</span><span class="s0">, </span><span class="s1">des_l</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s1">assert_allclose(obt_u</span><span class="s0">, </span><span class="s1">des_u</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog</span><span class="s0">, </span><span class="s1">obt</span><span class="s0">, </span><span class="s4">1e-07</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, False, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog_l</span><span class="s0">, </span><span class="s1">obt_l</span><span class="s0">, </span><span class="s4">1e-07</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, False, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog_u</span><span class="s0">, </span><span class="s1">obt_u</span><span class="s0">, </span><span class="s4">1e-07</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, False, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>

            <span class="s5"># -----------------------------------------------------------------</span>
            <span class="s5"># with exog_coint:</span>
            <span class="s1">exog_coint_model = results_sm_exog_coint[ds][dt].exog_coint</span>
            <span class="s1">exog_coint = exog_coint_model </span><span class="s0">is not None</span>
            <span class="s1">exog_coint_fc = </span><span class="s0">None</span>
            <span class="s0">if </span><span class="s1">exog_coint:  </span><span class="s5"># build future values of exog_coint and test:</span>
                <span class="s5"># const is in exog_coint in all tests that have exog_coint</span>
                <span class="s1">exog_coint_fc = np.ones(STEPS - </span><span class="s4">1</span><span class="s1">)</span>
                <span class="s5"># if linear trend in exog_coint</span>
                <span class="s0">if </span><span class="s1">exog_coint_model.shape[</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">2</span><span class="s1">:</span>
                    <span class="s1">exog_coint_fc = np.column_stack(</span>
                        <span class="s1">(</span>
                            <span class="s1">exog_coint_fc</span><span class="s0">,</span>
                            <span class="s1">exog_coint_model[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span>
                            <span class="s1">+ </span><span class="s4">1</span>
                            <span class="s1">+ np.arange(STEPS - </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">)</span>
                    <span class="s1">)</span>
                <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].predict(</span>
                    <span class="s1">steps=STEPS</span><span class="s0">, </span><span class="s1">exog_coint_fc=exog_coint_fc</span>
                <span class="s1">)</span>

                <span class="s1">assert_allclose(</span>
                    <span class="s1">obtained_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obtained</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># test predict method with confidence interval calculation</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;FORECAST WITH INTERVALS&quot;</span><span class="s1">)</span>
            <span class="s1">obtained_w_intervals = results_sm[ds][dt].predict(</span>
                <span class="s1">steps=STEPS</span><span class="s0">, </span><span class="s1">alpha=ALPHA</span>
            <span class="s1">)</span>
            <span class="s1">obtained_w_intervals_exog_coint = results_sm_exog_coint[ds][</span>
                <span class="s1">dt</span>
            <span class="s1">].predict(steps=STEPS</span><span class="s0">, </span><span class="s1">alpha=ALPHA</span><span class="s0">, </span><span class="s1">exog_coint_fc=exog_coint_fc)</span>
            <span class="s1">obt = obtained_w_intervals[</span><span class="s4">0</span><span class="s1">]  </span><span class="s5"># forecast</span>
            <span class="s1">obt_l = obtained_w_intervals[</span><span class="s4">1</span><span class="s1">]  </span><span class="s5"># lower bound</span>
            <span class="s1">obt_u = obtained_w_intervals[</span><span class="s4">2</span><span class="s1">]  </span><span class="s5"># upper bound</span>
            <span class="s1">obt_exog_coint = obtained_w_intervals_exog_coint[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">obt_exog_coint_l = obtained_w_intervals_exog_coint[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">obt_exog_coint_u = obtained_w_intervals_exog_coint[</span><span class="s4">2</span><span class="s1">]</span>
            <span class="s1">des = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;fc&quot;</span><span class="s1">]</span>
            <span class="s1">des_l = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;lower&quot;</span><span class="s1">]</span>
            <span class="s1">des_u = results_ref[ds][dt][</span><span class="s2">&quot;fc&quot;</span><span class="s1">][</span><span class="s2">&quot;upper&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obt</span><span class="s0">, </span><span class="s1">des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s1">assert_allclose(obt_l</span><span class="s0">, </span><span class="s1">des_l</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s1">assert_allclose(obt_u</span><span class="s0">, </span><span class="s1">des_u</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obt</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog_coint_l</span><span class="s0">,</span>
                    <span class="s1">obt_l</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">obt_exog_coint_u</span><span class="s0">,</span>
                    <span class="s1">obt_u</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_granger_causality():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;granger&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">GRANGER&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg_g_p = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;GRANGER CAUS. - p-VALUE&quot;</span><span class="s1">)</span>
            <span class="s1">err_msg_g_t = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;GRANGER CAUS. - TEST STAT.&quot;</span><span class="s1">)</span>

            <span class="s1">v_ind = range(len(ds.variable_names))</span>
            <span class="s0">for </span><span class="s1">causing_ind </span><span class="s0">in </span><span class="s1">sublists(v_ind</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">len(v_ind) - </span><span class="s4">1</span><span class="s1">):</span>
                <span class="s1">causing_names = [</span><span class="s2">&quot;y&quot; </span><span class="s1">+ str(i + </span><span class="s4">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">causing_ind]</span>
                <span class="s1">causing_key = tuple(ds.variable_names[i] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">causing_ind)</span>

                <span class="s1">caused_ind = [i </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">v_ind </span><span class="s0">if </span><span class="s1">i </span><span class="s0">not in </span><span class="s1">causing_ind]</span>
                <span class="s1">caused_names = [</span><span class="s2">&quot;y&quot; </span><span class="s1">+ str(i + </span><span class="s4">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">caused_ind]</span>
                <span class="s1">caused_key = tuple(ds.variable_names[i] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">caused_ind)</span>

                <span class="s1">granger_sm_ind = results_sm[ds][dt].test_granger_causality(</span>
                    <span class="s1">caused_ind</span><span class="s0">, </span><span class="s1">causing_ind</span>
                <span class="s1">)</span>
                <span class="s1">granger_sm_ind_exog = results_sm_exog[ds][</span>
                    <span class="s1">dt</span>
                <span class="s1">].test_granger_causality(caused_ind</span><span class="s0">, </span><span class="s1">causing_ind)</span>
                <span class="s1">granger_sm_ind_exog_coint = results_sm_exog_coint[ds][</span>
                    <span class="s1">dt</span>
                <span class="s1">].test_granger_causality(caused_ind</span><span class="s0">, </span><span class="s1">causing_ind)</span>
                <span class="s1">granger_sm_str = results_sm[ds][dt].test_granger_causality(</span>
                    <span class="s1">caused_names</span><span class="s0">, </span><span class="s1">causing_names</span>
                <span class="s1">)</span>

                <span class="s5"># call methods to assure they do not raise exceptions</span>
                <span class="s1">granger_sm_ind.summary()</span>
                <span class="s1">str(granger_sm_ind)  </span><span class="s5"># __str__()</span>
                <span class="s1">assert_(granger_sm_ind == granger_sm_str)  </span><span class="s5"># __eq__()</span>

                <span class="s5"># test test-statistic for Granger non-causality:</span>
                <span class="s1">g_t_obt = granger_sm_ind.test_statistic</span>
                <span class="s1">g_t_obt_exog = granger_sm_ind_exog.test_statistic</span>
                <span class="s1">g_t_obt_exog_coint = granger_sm_ind_exog_coint.test_statistic</span>
                <span class="s1">g_t_des = results_ref[ds][dt][</span><span class="s2">&quot;granger_caus&quot;</span><span class="s1">][</span><span class="s2">&quot;test_stat&quot;</span><span class="s1">][</span>
                    <span class="s1">(causing_key</span><span class="s0">, </span><span class="s1">caused_key)</span>
                <span class="s1">]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">g_t_obt</span><span class="s0">, </span><span class="s1">g_t_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg_g_t</span>
                <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">g_t_obt_exog</span><span class="s0">,</span>
                        <span class="s1">g_t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg_g_t</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">g_t_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">g_t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg_g_t</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s5"># check whether string sequences as args work in the same way:</span>
                <span class="s1">g_t_obt_str = granger_sm_str.test_statistic</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">g_t_obt_str</span><span class="s0">,</span>
                    <span class="s1">g_t_obt</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">err_msg_g_t</span>
                    <span class="s1">+ </span><span class="s2">&quot; - sequences of integers and &quot;</span><span class="s1">.upper()</span>
                    <span class="s1">+ </span><span class="s2">&quot;strings as arguments do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s5"># check if int (e.g. 0) as index and list of int ([0]) yield</span>
                <span class="s5"># the same result:</span>
                <span class="s0">if </span><span class="s1">len(causing_ind) == </span><span class="s4">1 </span><span class="s0">or </span><span class="s1">len(caused_ind) == </span><span class="s4">1</span><span class="s1">:</span>
                    <span class="s1">ci = (</span>
                        <span class="s1">causing_ind[</span><span class="s4">0</span><span class="s1">]</span>
                        <span class="s0">if </span><span class="s1">len(causing_ind) == </span><span class="s4">1</span>
                        <span class="s0">else </span><span class="s1">causing_ind</span>
                    <span class="s1">)</span>
                    <span class="s1">ce = caused_ind[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">if </span><span class="s1">len(caused_ind) == </span><span class="s4">1 </span><span class="s0">else </span><span class="s1">caused_ind</span>
                    <span class="s1">granger_sm_single_ind = results_sm[ds][</span>
                        <span class="s1">dt</span>
                    <span class="s1">].test_granger_causality(ce</span><span class="s0">, </span><span class="s1">ci)</span>
                    <span class="s1">g_t_obt_single = granger_sm_single_ind.test_statistic</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">g_t_obt_single</span><span class="s0">,</span>
                        <span class="s1">g_t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s1">err_msg_g_t</span>
                        <span class="s1">+ </span><span class="s2">&quot; - list of int and int as &quot;</span><span class="s1">.upper()</span>
                        <span class="s1">+ </span><span class="s2">&quot;argument do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                    <span class="s1">)</span>

                <span class="s5"># test p-value for Granger non-causality:</span>
                <span class="s1">g_p_obt = granger_sm_ind.pvalue</span>
                <span class="s1">g_p_des = results_ref[ds][dt][</span><span class="s2">&quot;granger_caus&quot;</span><span class="s1">][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span>
                    <span class="s1">(causing_key</span><span class="s0">, </span><span class="s1">caused_key)</span>
                <span class="s1">]</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">g_p_obt</span><span class="s0">, </span><span class="s1">g_p_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg_g_p</span>
                <span class="s1">)</span>
                <span class="s5"># check whether string sequences as args work in the same way:</span>
                <span class="s1">g_p_obt_str = granger_sm_str.pvalue</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">g_p_obt_str</span><span class="s0">,</span>
                    <span class="s1">g_p_obt</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">err_msg_g_t</span>
                    <span class="s1">+ </span><span class="s2">&quot; - sequences of integers and &quot;</span><span class="s1">.upper()</span>
                    <span class="s1">+ </span><span class="s2">&quot;strings as arguments do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s5"># check if int (e.g. 0) as index and list of int ([0]) yield</span>
                <span class="s5"># the same result:</span>
                <span class="s0">if </span><span class="s1">len(causing_ind) == </span><span class="s4">1</span><span class="s1">:</span>
                    <span class="s1">g_p_obt_single = granger_sm_single_ind.pvalue</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">g_p_obt_single</span><span class="s0">,</span>
                        <span class="s1">g_p_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s1">err_msg_g_t</span>
                        <span class="s1">+ </span><span class="s2">&quot; - list of int and int as &quot;</span><span class="s1">.upper()</span>
                        <span class="s1">+ </span><span class="s2">&quot;argument do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_inst_causality():  </span><span class="s5"># test instantaneous causality</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;inst. causality&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">INST. CAUSALITY&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg_i_p = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;INSTANT. CAUS. - p-VALUE&quot;</span><span class="s1">)</span>
            <span class="s1">err_msg_i_t = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;INSTANT. CAUS. - TEST STAT.&quot;</span><span class="s1">)</span>

            <span class="s1">v_ind = range(len(ds.variable_names))</span>
            <span class="s0">for </span><span class="s1">causing_ind </span><span class="s0">in </span><span class="s1">sublists(v_ind</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">len(v_ind) - </span><span class="s4">1</span><span class="s1">):</span>
                <span class="s1">causing_names = [</span><span class="s2">&quot;y&quot; </span><span class="s1">+ str(i + </span><span class="s4">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">causing_ind]</span>
                <span class="s1">causing_key = tuple(ds.variable_names[i] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">causing_ind)</span>

                <span class="s1">caused_ind = [i </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">v_ind </span><span class="s0">if </span><span class="s1">i </span><span class="s0">not in </span><span class="s1">causing_ind]</span>
                <span class="s1">caused_key = tuple(ds.variable_names[i] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">caused_ind)</span>
                <span class="s1">inst_sm_ind = results_sm[ds][dt].test_inst_causality(</span>
                    <span class="s1">causing_ind</span>
                <span class="s1">)</span>
                <span class="s1">inst_sm_ind_exog = results_sm_exog[ds][dt].test_inst_causality(</span>
                    <span class="s1">causing_ind</span>
                <span class="s1">)</span>
                <span class="s1">inst_sm_ind_exog_coint = results_sm_exog_coint[ds][</span>
                    <span class="s1">dt</span>
                <span class="s1">].test_inst_causality(causing_ind)</span>
                <span class="s1">inst_sm_str = results_sm[ds][dt].test_inst_causality(</span>
                    <span class="s1">causing_names</span>
                <span class="s1">)</span>
                <span class="s5"># call methods to assure they do not raise exceptions</span>
                <span class="s1">inst_sm_ind.summary()</span>
                <span class="s1">str(inst_sm_ind)  </span><span class="s5"># __str__()</span>
                <span class="s1">assert_(inst_sm_ind == inst_sm_str)  </span><span class="s5"># __eq__()</span>
                <span class="s5"># test test-statistic for instantaneous non-causality</span>
                <span class="s1">t_obt = inst_sm_ind.test_statistic</span>
                <span class="s1">t_obt_exog = inst_sm_ind_exog.test_statistic</span>
                <span class="s1">t_obt_exog_coint = inst_sm_ind_exog_coint.test_statistic</span>
                <span class="s1">t_des = results_ref[ds][dt][</span><span class="s2">&quot;inst_caus&quot;</span><span class="s1">][</span><span class="s2">&quot;test_stat&quot;</span><span class="s1">][</span>
                    <span class="s1">(causing_key</span><span class="s0">, </span><span class="s1">caused_key)</span>
                <span class="s1">]</span>
                <span class="s1">assert_allclose(t_obt</span><span class="s0">, </span><span class="s1">t_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg_i_t)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">t_obt_exog</span><span class="s0">,</span>
                        <span class="s1">t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg_i_t</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">t_obt_exog_coint</span><span class="s0">,</span>
                        <span class="s1">t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg_i_t</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s5"># check whether string sequences as args work in the same way:</span>
                <span class="s1">t_obt_str = inst_sm_str.test_statistic</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">t_obt_str</span><span class="s0">,</span>
                    <span class="s1">t_obt</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">err_msg_i_t</span>
                    <span class="s1">+ </span><span class="s2">&quot; - sequences of integers and &quot;</span><span class="s1">.upper()</span>
                    <span class="s1">+ </span><span class="s2">&quot;strings as arguments do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s5"># check if int (e.g. 0) as index and list of int ([0]) yield</span>
                <span class="s5"># the same result:</span>
                <span class="s0">if </span><span class="s1">len(causing_ind) == </span><span class="s4">1</span><span class="s1">:</span>
                    <span class="s1">inst_sm_single_ind = results_sm[ds][</span>
                        <span class="s1">dt</span>
                    <span class="s1">].test_inst_causality(causing_ind[</span><span class="s4">0</span><span class="s1">])</span>
                    <span class="s1">t_obt_single = inst_sm_single_ind.test_statistic</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">t_obt_single</span><span class="s0">,</span>
                        <span class="s1">t_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s1">err_msg_i_t</span>
                        <span class="s1">+ </span><span class="s2">&quot; - list of int and int as &quot;</span><span class="s1">.upper()</span>
                        <span class="s1">+ </span><span class="s2">&quot;argument do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                    <span class="s1">)</span>

                <span class="s5"># test p-value for instantaneous non-causality</span>
                <span class="s1">p_obt = (</span>
                    <span class="s1">results_sm[ds][dt].test_inst_causality(causing_ind).pvalue</span>
                <span class="s1">)</span>
                <span class="s1">p_des = results_ref[ds][dt][</span><span class="s2">&quot;inst_caus&quot;</span><span class="s1">][</span><span class="s2">&quot;p&quot;</span><span class="s1">][</span>
                    <span class="s1">(causing_key</span><span class="s0">, </span><span class="s1">caused_key)</span>
                <span class="s1">]</span>
                <span class="s1">assert_allclose(p_obt</span><span class="s0">, </span><span class="s1">p_des</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg_i_p)</span>
                <span class="s5"># check whether string sequences as args work in the same way:</span>
                <span class="s1">p_obt_str = inst_sm_str.pvalue</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">p_obt_str</span><span class="s0">,</span>
                    <span class="s1">p_obt</span><span class="s0">,</span>
                    <span class="s4">1e-07</span><span class="s0">,</span>
                    <span class="s4">0</span><span class="s0">,</span>
                    <span class="s0">False,</span>
                    <span class="s1">err_msg_i_p</span>
                    <span class="s1">+ </span><span class="s2">&quot; - sequences of integers and &quot;</span><span class="s1">.upper()</span>
                    <span class="s1">+ </span><span class="s2">&quot;strings as arguments do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s5"># check if int (e.g. 0) as index and list of int ([0]) yield</span>
                <span class="s5"># the same result:</span>
                <span class="s0">if </span><span class="s1">len(causing_ind) == </span><span class="s4">1</span><span class="s1">:</span>
                    <span class="s1">inst_sm_single_ind = results_sm[ds][</span>
                        <span class="s1">dt</span>
                    <span class="s1">].test_inst_causality(causing_ind[</span><span class="s4">0</span><span class="s1">])</span>
                    <span class="s1">p_obt_single = inst_sm_single_ind.pvalue</span>
                    <span class="s1">assert_allclose(</span>
                        <span class="s1">p_obt_single</span><span class="s0">,</span>
                        <span class="s1">p_obt</span><span class="s0">,</span>
                        <span class="s4">1e-07</span><span class="s0">,</span>
                        <span class="s4">0</span><span class="s0">,</span>
                        <span class="s0">False,</span>
                        <span class="s1">err_msg_i_p</span>
                        <span class="s1">+ </span><span class="s2">&quot; - list of int and int as &quot;</span><span class="s1">.upper()</span>
                        <span class="s1">+ </span><span class="s2">&quot;argument do not yield the same result!&quot;</span><span class="s1">.upper()</span><span class="s0">,</span>
                    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_impulse_response():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;impulse-response&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">IMPULSE-RESPONSE&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;IMULSE-RESPONSE&quot;</span><span class="s1">)</span>
            <span class="s1">periods = </span><span class="s4">20</span>
            <span class="s1">obtained_all = results_sm[ds][dt].irf(periods=periods).irfs</span>
            <span class="s1">obtained_all_exog = (</span>
                <span class="s1">results_sm_exog[ds][dt].irf(periods=periods).irfs</span>
            <span class="s1">)</span>
            <span class="s1">obtained_all_exog_coint = (</span>
                <span class="s1">results_sm_exog_coint[ds][dt].irf(periods=periods).irfs</span>
            <span class="s1">)</span>
            <span class="s5"># flatten inner arrays to make them comparable to parsed results:</span>
            <span class="s1">obtained_all = obtained_all.reshape(periods + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">obtained_all_exog = obtained_all_exog.reshape(periods + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">obtained_all_exog_coint = obtained_all_exog_coint.reshape(</span>
                <span class="s1">periods + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span>
            <span class="s1">)</span>
            <span class="s1">desired_all = results_ref[ds][dt][</span><span class="s2">&quot;ir&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained_all</span><span class="s0">, </span><span class="s1">desired_all</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_all_exog</span><span class="s0">, </span><span class="s1">obtained_all</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_all_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obtained_all</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_lag_order_selection():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;lag order&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">LAG ORDER SELECTION&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">deterministic = dt[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">endog_tot = data[ds]</span>

            <span class="s1">trend = </span><span class="s2">&quot;n&quot; </span><span class="s0">if </span><span class="s1">dt[</span><span class="s4">0</span><span class="s1">] == </span><span class="s2">&quot;nc&quot; </span><span class="s0">else </span><span class="s1">dt[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">obtained_all = select_order(</span>
                <span class="s1">endog_tot</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s1">deterministic=dt[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">seasons=dt[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">)</span>
            <span class="s1">deterministic_outside_exog = </span><span class="s2">&quot;&quot;</span>
            <span class="s5"># &quot;co&quot; is not in exog in any test case</span>
            <span class="s0">if </span><span class="s2">&quot;co&quot; </span><span class="s0">in </span><span class="s1">deterministic:</span>
                <span class="s1">deterministic_outside_exog += </span><span class="s2">&quot;co&quot;</span>
            <span class="s5"># &quot;lo&quot; is is in exog only in test cases with seasons&gt;0</span>
            <span class="s0">if </span><span class="s2">&quot;lo&quot; </span><span class="s0">in </span><span class="s1">deterministic </span><span class="s0">and </span><span class="s1">dt[</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">0</span><span class="s1">:</span>
                <span class="s1">deterministic_outside_exog += </span><span class="s2">&quot;lo&quot;</span>

            <span class="s1">exog_model = results_sm_exog[ds][dt].exog</span>
            <span class="s1">exog = exog_model </span><span class="s0">is not None</span>
            <span class="s1">exog_coint_model = results_sm_exog_coint[ds][dt].exog_coint</span>
            <span class="s1">exog_coint = exog_coint_model </span><span class="s0">is not None</span>

            <span class="s1">obtained_all_exog = select_order(</span>
                <span class="s1">endog_tot</span><span class="s0">,</span>
                <span class="s4">10</span><span class="s0">,</span>
                <span class="s1">deterministic_outside_exog</span><span class="s0">,</span>
                <span class="s1">seasons=</span><span class="s4">0</span><span class="s0">,</span>
                <span class="s1">exog=exog_model</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s5"># &quot;ci&quot; and &quot;li&quot; are always in exog_coint, so pass &quot;n&quot; as det. term</span>
            <span class="s1">obtained_all_exog_coint = select_order(</span>
                <span class="s1">endog_tot</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s2">&quot;n&quot;</span><span class="s0">, </span><span class="s1">seasons=dt[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">exog_coint=exog_coint_model</span>
            <span class="s1">)</span>
            <span class="s0">for </span><span class="s1">ic </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;aic&quot;</span><span class="s0">, </span><span class="s2">&quot;fpe&quot;</span><span class="s0">, </span><span class="s2">&quot;hqic&quot;</span><span class="s0">, </span><span class="s2">&quot;bic&quot;</span><span class="s1">]:</span>
                <span class="s1">err_msg = build_err_msg(</span>
                    <span class="s1">ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;LAG ORDER SELECTION - &quot; </span><span class="s1">+ ic.upper()</span>
                <span class="s1">)</span>
                <span class="s1">obtained = getattr(obtained_all</span><span class="s0">, </span><span class="s1">ic)</span>
                <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;lagorder&quot;</span><span class="s1">][ic]</span>
                <span class="s1">assert_allclose(obtained</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
                <span class="s0">if </span><span class="s1">exog:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">getattr(obtained_all_exog</span><span class="s0">, </span><span class="s1">ic)</span><span class="s0">,</span>
                        <span class="s1">getattr(obtained_all</span><span class="s0">, </span><span class="s1">ic)</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
                <span class="s0">if </span><span class="s1">exog_coint:</span>
                    <span class="s1">assert_equal(</span>
                        <span class="s1">getattr(obtained_all_exog_coint</span><span class="s0">, </span><span class="s1">ic)</span><span class="s0">,</span>
                        <span class="s1">getattr(obtained_all</span><span class="s0">, </span><span class="s1">ic)</span><span class="s0">,</span>
                        <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                    <span class="s1">)</span>
            <span class="s5"># call methods to assure they do not raise exceptions</span>
            <span class="s1">obtained_all.summary()</span>
            <span class="s1">str(obtained_all)  </span><span class="s5"># __str__()</span>


<span class="s0">def </span><span class="s1">test_normality():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;test_norm&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">TEST NON-NORMALITY&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">obtained = results_sm[ds][dt].test_normality(signif=</span><span class="s4">0.05</span><span class="s1">)</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].test_normality(signif=</span><span class="s4">0.05</span><span class="s1">)</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].test_normality(</span>
                <span class="s1">signif=</span><span class="s4">0.05</span>
            <span class="s1">)</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;TEST NON-NORMALITY - STATISTIC&quot;</span><span class="s1">)</span>
            <span class="s1">obt_statistic = obtained.test_statistic</span>
            <span class="s1">obt_statistic_exog = obtained_exog.test_statistic</span>
            <span class="s1">obt_statistic_exog_coint = obtained_exog_coint.test_statistic</span>
            <span class="s1">des_statistic = results_ref[ds][dt][</span><span class="s2">&quot;test_norm&quot;</span><span class="s1">][</span>
                <span class="s2">&quot;joint_test_statistic&quot;</span>
            <span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obt_statistic</span><span class="s0">, </span><span class="s1">des_statistic</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_statistic_exog</span><span class="s0">, </span><span class="s1">obt_statistic</span><span class="s0">, </span><span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obt_statistic_exog_coint</span><span class="s0">,</span>
                    <span class="s1">obt_statistic</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s1">err_msg = build_err_msg(ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;TEST NON-NORMALITY - P-VALUE&quot;</span><span class="s1">)</span>
            <span class="s1">obt_pvalue = obtained.pvalue</span>
            <span class="s1">des_pvalue = results_ref[ds][dt][</span><span class="s2">&quot;test_norm&quot;</span><span class="s1">][</span><span class="s2">&quot;joint_pvalue&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(obt_pvalue</span><span class="s0">, </span><span class="s1">des_pvalue</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg)</span>
            <span class="s5"># call methods to assure they do not raise exceptions</span>
            <span class="s1">obtained.summary()</span>
            <span class="s1">str(obtained)  </span><span class="s5"># __str__()</span>
            <span class="s1">assert_(obtained == obtained_exog)  </span><span class="s5"># __eq__()</span>


<span class="s0">def </span><span class="s1">test_whiteness():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;whiteness&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">TEST WHITENESS OF RESIDUALS&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>

            <span class="s1">lags = results_ref[ds][dt][</span><span class="s2">&quot;whiteness&quot;</span><span class="s1">][</span><span class="s2">&quot;tested order&quot;</span><span class="s1">]</span>

            <span class="s1">obtained = results_sm[ds][dt].test_whiteness(nlags=lags)</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].test_whiteness(nlags=lags)</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].test_whiteness(</span>
                <span class="s1">nlags=lags</span>
            <span class="s1">)</span>
            <span class="s5"># test statistic</span>
            <span class="s1">err_msg = build_err_msg(</span>
                <span class="s1">ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;WHITENESS OF RESIDUALS - &quot; &quot;TEST STATISTIC&quot;</span>
            <span class="s1">)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;whiteness&quot;</span><span class="s1">][</span><span class="s2">&quot;test statistic&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained.test_statistic</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog.test_statistic</span><span class="s0">,</span>
                    <span class="s1">obtained.test_statistic</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint.test_statistic</span><span class="s0">,</span>
                    <span class="s1">obtained.test_statistic</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># p-value</span>
            <span class="s1">err_msg = build_err_msg(</span>
                <span class="s1">ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;WHITENESS OF RESIDUALS - &quot; &quot;P-VALUE&quot;</span>
            <span class="s1">)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;whiteness&quot;</span><span class="s1">][</span><span class="s2">&quot;p-value&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained.pvalue</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>

            <span class="s1">obtained = results_sm[ds][dt].test_whiteness(</span>
                <span class="s1">nlags=lags</span><span class="s0">, </span><span class="s1">adjusted=</span><span class="s0">True</span>
            <span class="s1">)</span>
            <span class="s1">obtained_exog = results_sm_exog[ds][dt].test_whiteness(</span>
                <span class="s1">nlags=lags</span><span class="s0">, </span><span class="s1">adjusted=</span><span class="s0">True</span>
            <span class="s1">)</span>
            <span class="s1">obtained_exog_coint = results_sm_exog_coint[ds][dt].test_whiteness(</span>
                <span class="s1">nlags=lags</span><span class="s0">, </span><span class="s1">adjusted=</span><span class="s0">True</span>
            <span class="s1">)</span>
            <span class="s5"># test statistic (adjusted Portmanteau test)</span>
            <span class="s1">err_msg = build_err_msg(</span>
                <span class="s1">ds</span><span class="s0">,</span>
                <span class="s1">dt</span><span class="s0">,</span>
                <span class="s2">&quot;WHITENESS OF RESIDUALS - &quot; &quot;TEST STATISTIC (ADJUSTED TEST)&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;whiteness&quot;</span><span class="s1">][</span><span class="s2">&quot;test statistic adj.&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained.test_statistic</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog.test_statistic</span><span class="s0">,</span>
                    <span class="s1">obtained.test_statistic</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s0">if </span><span class="s1">exog_coint:</span>
                <span class="s1">assert_equal(</span>
                    <span class="s1">obtained_exog_coint.test_statistic</span><span class="s0">,</span>
                    <span class="s1">obtained.test_statistic</span><span class="s0">,</span>
                    <span class="s2">&quot;WITH EXOG_COINT&quot; </span><span class="s1">+ err_msg</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s5"># p-value (adjusted Portmanteau test)</span>
            <span class="s1">err_msg = build_err_msg(</span>
                <span class="s1">ds</span><span class="s0">, </span><span class="s1">dt</span><span class="s0">, </span><span class="s2">&quot;WHITENESS OF RESIDUALS - &quot; &quot;P-VALUE (ADJUSTED TEST)&quot;</span>
            <span class="s1">)</span>
            <span class="s1">desired = results_ref[ds][dt][</span><span class="s2">&quot;whiteness&quot;</span><span class="s1">][</span><span class="s2">&quot;p-value adjusted&quot;</span><span class="s1">]</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">obtained.pvalue</span><span class="s0">, </span><span class="s1">desired</span><span class="s0">, </span><span class="s1">rtol</span><span class="s0">, </span><span class="s1">atol</span><span class="s0">, False, </span><span class="s1">err_msg</span>
            <span class="s1">)</span>
            <span class="s5"># call methods to assure they do not raise exceptions</span>
            <span class="s1">obtained.summary()</span>
            <span class="s1">str(obtained)  </span><span class="s5"># __str__()</span>
            <span class="s1">assert_(obtained == obtained_exog)  </span><span class="s5"># __eq__()</span>


<span class="s0">def </span><span class="s1">test_summary():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;summary&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">SUMMARY&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ds </span><span class="s0">in </span><span class="s1">datasets:</span>
        <span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">ds.dt_s_list:</span>
            <span class="s0">if </span><span class="s1">debug_mode:</span>
                <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ dt_s_tup_to_string(dt) + </span><span class="s2">&quot;: &quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

            <span class="s5"># see if summary gets printed</span>
            <span class="s1">results_sm[ds][dt].summary(alpha=</span><span class="s4">0.05</span><span class="s1">)</span>

            <span class="s1">exog = results_sm_exog[ds][dt].exog </span><span class="s0">is not None</span>
            <span class="s0">if </span><span class="s1">exog </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">results_sm_exog[ds][dt].summary(alpha=</span><span class="s4">0.05</span><span class="s1">)</span>

            <span class="s1">exog_coint = results_sm_exog_coint[ds][dt].exog_coint </span><span class="s0">is not None</span>
            <span class="s0">if </span><span class="s1">exog_coint </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">results_sm_exog_coint[ds][dt].summary(alpha=</span><span class="s4">0.05</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_exceptions():</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;exceptions&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">EXCEPTIONS</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">ds = datasets[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">dt = ds.dt_s_list[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">endog = data[datasets[</span><span class="s4">0</span><span class="s1">]]</span>

    <span class="s5"># select_coint_rank:</span>
    <span class="s5"># method argument cannot be &quot;my_method&quot;</span>
    <span class="s1">assert_raises(</span>
        <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">select_coint_rank</span><span class="s0">, </span><span class="s1">endog</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s2">&quot;my_method&quot;</span><span class="s0">, </span><span class="s4">0.05</span>
    <span class="s1">)</span>
    <span class="s5"># det_order has to be -1, 0, or 1:</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">select_coint_rank</span><span class="s0">, </span><span class="s1">endog</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">select_coint_rank</span><span class="s0">, </span><span class="s1">endog</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s5"># 0.025 is not possible (must be 0.1, 0.05, or 0.01)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">select_coint_rank</span><span class="s0">, </span><span class="s1">endog</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s2">&quot;trace&quot;</span><span class="s0">, </span><span class="s4">0.025</span><span class="s1">)</span>

    <span class="s5"># Granger_causality:</span>
    <span class="s5"># ### 0&lt;signif&lt;1</span>
    <span class="s5"># this means signif=0</span>
    <span class="s1">assert_raises(</span>
        <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">results_sm[ds][dt].test_granger_causality</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, None, </span><span class="s4">0</span>
    <span class="s1">)</span>
    <span class="s5"># ### caused must be int, str or iterable of int or str</span>
    <span class="s5"># 0.5 not int</span>
    <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">results_sm[ds][dt].test_granger_causality</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.5</span><span class="s1">])</span>
    <span class="s5"># ### causing must be None, int, str or iterable of int or str</span>
    <span class="s5"># .5 not int</span>
    <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">results_sm[ds][dt].test_granger_causality</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s5"># exceptions in VECM class</span>
    <span class="s5"># ### choose only one of the two: &quot;co&quot; and &quot;ci&quot;</span>
    <span class="s1">model = VECM(endog</span><span class="s0">, </span><span class="s1">k_ar_diff=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">deterministic=</span><span class="s2">&quot;cico&quot;</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">model.fit)</span>
    <span class="s5"># ### we analyze multiple time series</span>
    <span class="s1">univariate_data = endog[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">VECM</span><span class="s0">, </span><span class="s1">univariate_data)</span>
    <span class="s5"># ### fit only allowed with known method</span>
    <span class="s1">model = VECM(endog</span><span class="s0">, </span><span class="s1">k_ar_diff=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">deterministic=</span><span class="s2">&quot;n&quot;</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">model.fit</span><span class="s0">, </span><span class="s2">&quot;abc&quot;</span><span class="s1">)  </span><span class="s5"># no &quot;abc&quot; estim.-method</span>

    <span class="s5"># pass a shorter array than endog as exog_coint argument</span>
    <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">VECM</span><span class="s0">, </span><span class="s1">endog</span><span class="s0">, None, </span><span class="s1">np.ones(len(endog) - </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s5"># forecasting: argument checks</span>
    <span class="s1">STEPS = </span><span class="s4">5</span>
    <span class="s5"># ### with exog</span>
    <span class="s1">exog = seasonal_dummies(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">len(endog)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">centered=</span><span class="s0">True</span><span class="s1">)  </span><span class="s5"># seasonal...</span>
    <span class="s1">exog = np.hstack((exog</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">+ np.arange(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)))  </span><span class="s5"># &amp; lin</span>
    <span class="s1">vecm_res = VECM(</span>
        <span class="s1">endog</span><span class="s0">, </span><span class="s1">exog</span><span class="s0">, </span><span class="s1">k_ar_diff=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">coint_rank=coint_rank</span><span class="s0">, </span><span class="s1">deterministic=</span><span class="s2">&quot;co&quot;</span>
    <span class="s1">).fit()</span>
    <span class="s5"># ##### exog_fc not passed as argument:</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s2">&quot;exog_fc is None.*&quot;</span><span class="s0">, </span><span class="s1">vecm_res.predict)</span>
    <span class="s5"># ##### exog_fc is too short:</span>
    <span class="s1">exog_fc = np.ones(STEPS)</span>
    <span class="s1">assert_raises_regex(</span>
        <span class="s1">ValueError</span><span class="s0">,</span>
        <span class="s2">&quot;.*exog_fc must have at least steps elements.*&quot;</span><span class="s0">,</span>
        <span class="s1">vecm_res.predict</span><span class="s0">,</span>
        <span class="s4">5</span><span class="s0">,</span>
        <span class="s0">None,</span>
        <span class="s1">exog_fc[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)  </span><span class="s5"># [:2] shortens exog_fc</span>
    <span class="s5"># ##### exog_coint_fc (NOT exog_fc) is passed when there is no exog_coint</span>
    <span class="s1">assert_raises_regex(</span>
        <span class="s1">ValueError</span><span class="s0">,</span>
        <span class="s2">&quot;.*exog_coint attribute is None.*&quot;</span><span class="s0">,</span>
        <span class="s1">vecm_res.predict</span><span class="s0">,</span>
        <span class="s4">5</span><span class="s0">,</span>
        <span class="s0">None,</span>
        <span class="s1">exog_fc</span><span class="s0">,</span>
        <span class="s1">exog_fc</span><span class="s0">,</span>
    <span class="s1">)  </span><span class="s5"># passed as exog_coint_fc-argument!</span>
    <span class="s5"># ### with exog_coint</span>
    <span class="s1">exog_coint = []</span>
    <span class="s1">exog_coint.append(np.ones(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">exog_coint.append(</span><span class="s4">1 </span><span class="s1">+ np.arange(len(endog)).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">exog_coint = np.hstack(exog_coint)</span>
    <span class="s1">vecm_res = VECM(</span>
        <span class="s1">endog</span><span class="s0">, </span><span class="s1">k_ar_diff=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">deterministic=</span><span class="s2">&quot;n&quot;</span><span class="s0">, </span><span class="s1">exog_coint=exog_coint</span>
    <span class="s1">).fit()</span>
    <span class="s5"># ##### exog_coint_fc not passed as argument:</span>
    <span class="s1">assert_raises_regex(</span>
        <span class="s1">ValueError</span><span class="s0">, </span><span class="s2">&quot;exog_coint_fc is None.*&quot;</span><span class="s0">, </span><span class="s1">vecm_res.predict</span>
    <span class="s1">)</span>
    <span class="s5"># ##### exog_coint_fc is too short:</span>
    <span class="s1">exog_coint_fc = np.ones(STEPS)</span>
    <span class="s1">assert_raises_regex(</span>
        <span class="s1">ValueError</span><span class="s0">,</span>
        <span class="s2">&quot;.*exog_coint_fc must have at least steps elements.*&quot;</span><span class="s0">,</span>
        <span class="s1">vecm_res.predict</span><span class="s0">,</span>
        <span class="s4">5</span><span class="s0">,</span>
        <span class="s0">None,</span>
        <span class="s0">None,</span>
        <span class="s1">exog_coint_fc[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)  </span><span class="s5"># [:2] shortens</span>
    <span class="s5"># ##### exog_fc (NOT exog_coint_fc) is passed when there is no exog</span>
    <span class="s1">assert_raises_regex(</span>
        <span class="s1">ValueError</span><span class="s0">,</span>
        <span class="s2">&quot;.*exog attribute is None.*&quot;</span><span class="s0">,</span>
        <span class="s1">vecm_res.predict</span><span class="s0">,</span>
        <span class="s4">5</span><span class="s0">,</span>
        <span class="s0">None,</span>
        <span class="s1">exog_coint_fc</span><span class="s0">,</span>
    <span class="s1">)  </span><span class="s5"># passed as exog_fc-argument!</span>


<span class="s0">def </span><span class="s1">test_select_coint_rank():  </span><span class="s5"># This is only a smoke test.</span>
    <span class="s0">if </span><span class="s1">debug_mode:</span>
        <span class="s0">if </span><span class="s2">&quot;select_coint_rank&quot; </span><span class="s0">not in </span><span class="s1">to_test:  </span><span class="s5"># pragma: no cover</span>
            <span class="s0">return</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">SELECT_COINT_RANK</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">endog = data[datasets[</span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">neqs = endog.shape[</span><span class="s4">1</span><span class="s1">]</span>

    <span class="s1">trace_result = select_coint_rank(endog</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;trace&quot;</span><span class="s1">)</span>
    <span class="s1">rank = trace_result.rank</span>
    <span class="s1">r_1 = trace_result.r_1</span>
    <span class="s1">test_stats = trace_result.test_stats</span>
    <span class="s1">crit_vals = trace_result.crit_vals</span>
    <span class="s0">if </span><span class="s1">rank &gt; </span><span class="s4">0</span><span class="s1">:</span>
        <span class="s1">assert_equal(r_1[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">r_1[</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(rank):</span>
            <span class="s1">assert_(test_stats[i] &gt; crit_vals[i])</span>
    <span class="s0">if </span><span class="s1">rank &lt; neqs:</span>
        <span class="s1">assert_(test_stats[rank] &lt; crit_vals[rank])</span>

    <span class="s1">maxeig_result = select_coint_rank(endog</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;maxeig&quot;</span><span class="s0">, </span><span class="s1">signif=</span><span class="s4">0.1</span><span class="s1">)</span>
    <span class="s1">rank = maxeig_result.rank</span>
    <span class="s1">r_1 = maxeig_result.r_1</span>
    <span class="s1">test_stats = maxeig_result.test_stats</span>
    <span class="s1">crit_vals = maxeig_result.crit_vals</span>
    <span class="s0">if </span><span class="s1">maxeig_result.rank &gt; </span><span class="s4">0</span><span class="s1">:</span>
        <span class="s1">assert_equal(r_1[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">r_1[</span><span class="s4">1</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(rank):</span>
            <span class="s1">assert_(test_stats[i] &gt; crit_vals[i])</span>
    <span class="s0">if </span><span class="s1">rank &lt; neqs:</span>
        <span class="s1">assert_(test_stats[rank] &lt; crit_vals[rank])</span>


<span class="s0">def </span><span class="s1">test_VECM_seasonal_forecast():</span>
    <span class="s5"># timing of seasonal dummies, VAR forecast horizon</span>
    <span class="s1">np.random.seed(</span><span class="s4">964255</span><span class="s1">)</span>
    <span class="s1">nobs = </span><span class="s4">200</span>
    <span class="s1">seasons = </span><span class="s4">6</span>
    <span class="s1">fact = np.cumsum(</span><span class="s4">0.1 </span><span class="s1">+ np.random.randn(nobs</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">xx = np.random.randn(nobs + </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">xx = xx[</span><span class="s4">2</span><span class="s1">:] + </span><span class="s4">0.6 </span><span class="s1">* xx[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">] + </span><span class="s4">0.25 </span><span class="s1">* xx[:-</span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">xx[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">2</span><span class="s1">] += fact[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
    <span class="s1">xx[:</span><span class="s0">, </span><span class="s4">2</span><span class="s1">:] += fact[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">][:</span><span class="s0">, None</span><span class="s1">]</span>
    <span class="s5"># add large seasonal effect</span>
    <span class="s1">xx += </span><span class="s4">3 </span><span class="s1">* np.log(</span><span class="s4">0.1 </span><span class="s1">+ (np.arange(nobs)[:</span><span class="s0">, None</span><span class="s1">] % seasons))</span>

    <span class="s1">res0 = VECM(</span>
        <span class="s1">xx</span><span class="s0">,</span>
        <span class="s1">k_ar_diff=</span><span class="s4">0</span><span class="s0">,</span>
        <span class="s1">coint_rank=</span><span class="s4">2</span><span class="s0">,</span>
        <span class="s1">deterministic=</span><span class="s2">&quot;co&quot;</span><span class="s0">,</span>
        <span class="s1">seasons=seasons</span><span class="s0">,</span>
        <span class="s1">first_season=</span><span class="s4">0</span><span class="s0">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">res2 = VECM(</span>
        <span class="s1">xx</span><span class="s0">,</span>
        <span class="s1">k_ar_diff=</span><span class="s4">2</span><span class="s0">,</span>
        <span class="s1">coint_rank=</span><span class="s4">2</span><span class="s0">,</span>
        <span class="s1">deterministic=</span><span class="s2">&quot;co&quot;</span><span class="s0">,</span>
        <span class="s1">seasons=seasons</span><span class="s0">,</span>
        <span class="s1">first_season=</span><span class="s4">0</span><span class="s0">,</span>
    <span class="s1">).fit()</span>
    <span class="s1">res4 = VECM(</span>
        <span class="s1">xx</span><span class="s0">,</span>
        <span class="s1">k_ar_diff=</span><span class="s4">4</span><span class="s0">,</span>
        <span class="s1">coint_rank=</span><span class="s4">2</span><span class="s0">,</span>
        <span class="s1">deterministic=</span><span class="s2">&quot;co&quot;</span><span class="s0">,</span>
        <span class="s1">seasons=seasons</span><span class="s0">,</span>
        <span class="s1">first_season=</span><span class="s4">0</span><span class="s0">,</span>
    <span class="s1">).fit()</span>

    <span class="s5"># check that seasonal dummy are independent of number of lags</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">res2._delta_x.T[-</span><span class="s4">2 </span><span class="s1">* seasons :</span><span class="s0">, </span><span class="s1">-seasons:]</span><span class="s0">,</span>
        <span class="s1">res0._delta_x.T[-</span><span class="s4">2 </span><span class="s1">* seasons :</span><span class="s0">, </span><span class="s1">-seasons:]</span><span class="s0">,</span>
        <span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">assert_allclose(</span>
        <span class="s1">res4._delta_x.T[-</span><span class="s4">2 </span><span class="s1">* seasons :</span><span class="s0">, </span><span class="s1">-seasons:]</span><span class="s0">,</span>
        <span class="s1">res0._delta_x.T[-</span><span class="s4">2 </span><span class="s1">* seasons :</span><span class="s0">, </span><span class="s1">-seasons:]</span><span class="s0">,</span>
        <span class="s1">rtol=</span><span class="s4">1e-10</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s5"># check location of smallest seasonal coefficient</span>
    <span class="s1">assert_array_equal(np.argmin(res0.det_coef</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">assert_array_equal(np.argmin(res2.det_coef</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">assert_array_equal(np.argmin(res4.det_coef</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s5"># predict 3 cycles, check location of dips</span>
    <span class="s1">dips_true = np.array([[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">16</span><span class="s0">, </span><span class="s4">16</span><span class="s1">]])</span>
    <span class="s0">for </span><span class="s1">res </span><span class="s0">in </span><span class="s1">[res0</span><span class="s0">, </span><span class="s1">res2</span><span class="s0">, </span><span class="s1">res4]:</span>
        <span class="s1">forecast = res.predict(steps=</span><span class="s4">3 </span><span class="s1">* seasons)</span>
        <span class="s1">dips = np.sort(np.argsort(forecast</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)[:</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(dips</span><span class="s0">, </span><span class="s1">dips_true)</span>

    <span class="s5"># res2.plot_forecast(steps=18, alpha=0.1, n_last_obs=4*seasons)</span>
</pre>
</body>
</html>
<html>
<head>
<title>test_ndgriddata.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_ndgriddata.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_allclose</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy.interpolate </span><span class="s0">import </span><span class="s1">(griddata</span><span class="s0">, </span><span class="s1">NearestNDInterpolator</span><span class="s0">,</span>
                               <span class="s1">LinearNDInterpolator</span><span class="s0">,</span>
                               <span class="s1">CloughTocher2DInterpolator)</span>


<span class="s1">parametrize_interpolators = pytest.mark.parametrize(</span>
    <span class="s2">&quot;interpolator&quot;</span><span class="s0">, </span><span class="s1">[NearestNDInterpolator</span><span class="s0">, </span><span class="s1">LinearNDInterpolator</span><span class="s0">,</span>
                     <span class="s1">CloughTocher2DInterpolator]</span>
<span class="s1">)</span>

<span class="s0">class </span><span class="s1">TestGriddata:</span>
    <span class="s0">def </span><span class="s1">test_fill_value(self):</span>
        <span class="s1">x = [(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)]</span>
        <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>

        <span class="s1">yi = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">fill_value=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(yi</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

        <span class="s1">yi = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)])</span>
        <span class="s1">assert_array_equal(yi</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_alternative_call(self):</span>
        <span class="s1">x = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=np.double)</span>
        <span class="s1">y = (np.arange(x.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)[:</span><span class="s0">,None</span><span class="s1">]</span>
             <span class="s1">+ np.array([</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s1">])[</span><span class="s0">None,</span><span class="s1">:])</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">rescale </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">msg = repr((method</span><span class="s0">, </span><span class="s1">rescale))</span>
                <span class="s1">yi = griddata((x[:</span><span class="s0">,</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[:</span><span class="s0">,</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">(x[:</span><span class="s0">,</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[:</span><span class="s0">,</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">method=method</span><span class="s0">,</span>
                              <span class="s1">rescale=rescale)</span>
                <span class="s1">assert_allclose(y</span><span class="s0">, </span><span class="s1">yi</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>

    <span class="s0">def </span><span class="s1">test_multivalue_2d(self):</span>
        <span class="s1">x = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=np.double)</span>
        <span class="s1">y = (np.arange(x.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)[:</span><span class="s0">,None</span><span class="s1">]</span>
             <span class="s1">+ np.array([</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s1">])[</span><span class="s0">None,</span><span class="s1">:])</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">rescale </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">msg = repr((method</span><span class="s0">, </span><span class="s1">rescale))</span>
                <span class="s1">yi = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">method=method</span><span class="s0">, </span><span class="s1">rescale=rescale)</span>
                <span class="s1">assert_allclose(y</span><span class="s0">, </span><span class="s1">yi</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>

    <span class="s0">def </span><span class="s1">test_multipoint_2d(self):</span>
        <span class="s1">x = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=np.double)</span>
        <span class="s1">y = np.arange(x.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>

        <span class="s1">xi = x[:</span><span class="s0">,None,</span><span class="s1">:] + np.array([</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">])[</span><span class="s0">None,</span><span class="s1">:</span><span class="s0">,None</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">rescale </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">msg = repr((method</span><span class="s0">, </span><span class="s1">rescale))</span>
                <span class="s1">yi = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">, </span><span class="s1">method=method</span><span class="s0">, </span><span class="s1">rescale=rescale)</span>

                <span class="s1">assert_equal(yi.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>
                <span class="s1">assert_allclose(yi</span><span class="s0">, </span><span class="s1">np.tile(y[:</span><span class="s0">,None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">atol=</span><span class="s3">1e-14</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>

    <span class="s0">def </span><span class="s1">test_complex_2d(self):</span>
        <span class="s1">x = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=np.double)</span>
        <span class="s1">y = np.arange(x.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>
        <span class="s1">y = y - </span><span class="s3">2j</span><span class="s1">*y[::-</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">xi = x[:</span><span class="s0">,None,</span><span class="s1">:] + np.array([</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">])[</span><span class="s0">None,</span><span class="s1">:</span><span class="s0">,None</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s0">for </span><span class="s1">rescale </span><span class="s0">in </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">):</span>
                <span class="s1">msg = repr((method</span><span class="s0">, </span><span class="s1">rescale))</span>
                <span class="s1">yi = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">, </span><span class="s1">method=method</span><span class="s0">, </span><span class="s1">rescale=rescale)</span>

                <span class="s1">assert_equal(yi.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>
                <span class="s1">assert_allclose(yi</span><span class="s0">, </span><span class="s1">np.tile(y[:</span><span class="s0">,None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">atol=</span><span class="s3">1e-14</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>

    <span class="s0">def </span><span class="s1">test_1d(self):</span>
        <span class="s1">x = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4.5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3.9</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s1">assert_allclose(griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>
            <span class="s1">assert_allclose(griddata(x.reshape(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>
            <span class="s1">assert_allclose(griddata((x</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">(x</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_1d_borders(self):</span>
        <span class="s4"># Test for nearest neighbor case with xi outside</span>
        <span class="s4"># the range of the values.</span>
        <span class="s1">x = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4.5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3.9</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">xi = np.array([</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">6.5</span><span class="s1">])</span>
        <span class="s1">yi_should = np.array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>

        <span class="s1">method = </span><span class="s2">'nearest'</span>
        <span class="s1">assert_allclose(griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">,</span>
                                 <span class="s1">method=method)</span><span class="s0">, </span><span class="s1">yi_should</span><span class="s0">,</span>
                        <span class="s1">err_msg=method</span><span class="s0">,</span>
                        <span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(griddata(x.reshape(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">,</span>
                                 <span class="s1">method=method)</span><span class="s0">, </span><span class="s1">yi_should</span><span class="s0">,</span>
                        <span class="s1">err_msg=method</span><span class="s0">,</span>
                        <span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>
        <span class="s1">assert_allclose(griddata((x</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">(xi</span><span class="s0">, </span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">method=method)</span><span class="s0">, </span><span class="s1">yi_should</span><span class="s0">,</span>
                        <span class="s1">err_msg=method</span><span class="s0">,</span>
                        <span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_1d_unsorted(self):</span>
        <span class="s1">x = np.array([</span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4.5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3.9</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s1">assert_allclose(griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-10</span><span class="s1">)</span>
            <span class="s1">assert_allclose(griddata(x.reshape(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-10</span><span class="s1">)</span>
            <span class="s1">assert_allclose(griddata((x</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">(x</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">method=method)</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                            <span class="s1">err_msg=method</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-10</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_square_rescale_manual(self):</span>
        <span class="s1">points = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10</span><span class="s0">,</span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>
        <span class="s1">points_rescaled = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>
        <span class="s1">values = np.array([</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3.</span><span class="s0">, </span><span class="s3">5.</span><span class="s0">, </span><span class="s3">9.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>

        <span class="s1">xx</span><span class="s0">, </span><span class="s1">yy = np.broadcast_arrays(np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)[:</span><span class="s0">,None</span><span class="s1">]</span><span class="s0">,</span>
                                     <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)[</span><span class="s0">None,</span><span class="s1">:])</span>
        <span class="s1">xx = xx.ravel()</span>
        <span class="s1">yy = yy.ravel()</span>
        <span class="s1">xi = np.array([xx</span><span class="s0">, </span><span class="s1">yy]).T.copy()</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s1">msg = method</span>
            <span class="s1">zi = griddata(points_rescaled</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">xi/np.array([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100.</span><span class="s1">])</span><span class="s0">,</span>
                          <span class="s1">method=method)</span>
            <span class="s1">zi_rescaled = griddata(points</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">, </span><span class="s1">method=method</span><span class="s0">,</span>
                                   <span class="s1">rescale=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">assert_allclose(zi</span><span class="s0">, </span><span class="s1">zi_rescaled</span><span class="s0">, </span><span class="s1">err_msg=msg</span><span class="s0">,</span>
                            <span class="s1">atol=</span><span class="s3">1e-12</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_xi_1d(self):</span>
        <span class="s4"># Check that 1-D xi is interpreted as a coordinate</span>
        <span class="s1">x = np.array([(</span><span class="s3">0</span><span class="s0">,</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s1">-</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">,</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=np.double)</span>
        <span class="s1">y = np.arange(x.shape[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.double)</span>
        <span class="s1">y = y - </span><span class="s3">2j</span><span class="s1">*y[::-</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">xi = np.array([</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>

        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'nearest'</span><span class="s0">, </span><span class="s2">'linear'</span><span class="s0">, </span><span class="s2">'cubic'</span><span class="s1">):</span>
            <span class="s1">p1 = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi</span><span class="s0">, </span><span class="s1">method=method)</span>
            <span class="s1">p2 = griddata(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi[</span><span class="s0">None,</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">method=method)</span>
            <span class="s1">assert_allclose(p1</span><span class="s0">, </span><span class="s1">p2</span><span class="s0">, </span><span class="s1">err_msg=method)</span>

            <span class="s1">xi1 = np.array([</span><span class="s3">0.5</span><span class="s1">])</span>
            <span class="s1">xi3 = np.array([</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">griddata</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi1</span><span class="s0">,</span>
                          <span class="s1">method=method)</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">griddata</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xi3</span><span class="s0">,</span>
                          <span class="s1">method=method)</span>


<span class="s0">class </span><span class="s1">TestNearestNDInterpolator:</span>
    <span class="s0">def </span><span class="s1">test_nearest_options(self):</span>
        <span class="s4"># smoke test that NearestNDInterpolator accept cKDTree options</span>
        <span class="s1">npts</span><span class="s0">, </span><span class="s1">nd = </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span>
        <span class="s1">x = np.arange(npts*nd).reshape((npts</span><span class="s0">, </span><span class="s1">nd))</span>
        <span class="s1">y = np.arange(npts)</span>
        <span class="s1">nndi = NearestNDInterpolator(x</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s1">opts = {</span><span class="s2">'balanced_tree'</span><span class="s1">: </span><span class="s0">False, </span><span class="s2">'compact_nodes'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span>
        <span class="s1">nndi_o = NearestNDInterpolator(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">tree_options=opts)</span>
        <span class="s1">assert_allclose(nndi(x)</span><span class="s0">, </span><span class="s1">nndi_o(x)</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">1e-14</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_nearest_list_argument(self):</span>
        <span class="s1">nd = np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                       <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                       <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]])</span>
        <span class="s1">d = nd[:</span><span class="s0">, </span><span class="s3">3</span><span class="s1">:]</span>

        <span class="s4"># z is np.array</span>
        <span class="s1">NI = NearestNDInterpolator((d[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">d[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">d[</span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(NI([</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>

        <span class="s4"># z is list</span>
        <span class="s1">NI = NearestNDInterpolator((d[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">d[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">list(d[</span><span class="s3">2</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(NI([</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>


<span class="s0">class </span><span class="s1">TestNDInterpolators:</span>
    <span class="s1">@parametrize_interpolators</span>
    <span class="s0">def </span><span class="s1">test_broadcastable_input(self</span><span class="s0">, </span><span class="s1">interpolator):</span>
        <span class="s4"># input data</span>
        <span class="s1">np.random.seed(</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">x = np.random.random(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">y = np.random.random(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">z = np.hypot(x</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s4"># x-y grid for interpolation</span>
        <span class="s1">X = np.linspace(min(x)</span><span class="s0">, </span><span class="s1">max(x))</span>
        <span class="s1">Y = np.linspace(min(y)</span><span class="s0">, </span><span class="s1">max(y))</span>
        <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(X</span><span class="s0">, </span><span class="s1">Y)</span>
        <span class="s1">XY = np.vstack((X.ravel()</span><span class="s0">, </span><span class="s1">Y.ravel())).T</span>
        <span class="s1">interp = interpolator(list(zip(x</span><span class="s0">, </span><span class="s1">y))</span><span class="s0">, </span><span class="s1">z)</span>
        <span class="s4"># single array input</span>
        <span class="s1">interp_points0 = interp(XY)</span>
        <span class="s4"># tuple input</span>
        <span class="s1">interp_points1 = interp((X</span><span class="s0">, </span><span class="s1">Y))</span>
        <span class="s1">interp_points2 = interp((X</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">))</span>
        <span class="s4"># broadcastable input</span>
        <span class="s1">interp_points3 = interp(X</span><span class="s0">, </span><span class="s1">Y)</span>
        <span class="s1">interp_points4 = interp(X</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">)</span>

        <span class="s1">assert_equal(interp_points0.size ==</span>
                     <span class="s1">interp_points1.size ==</span>
                     <span class="s1">interp_points2.size ==</span>
                     <span class="s1">interp_points3.size ==</span>
                     <span class="s1">interp_points4.size</span><span class="s0">, True</span><span class="s1">)</span>

    <span class="s1">@parametrize_interpolators</span>
    <span class="s0">def </span><span class="s1">test_read_only(self</span><span class="s0">, </span><span class="s1">interpolator):</span>
        <span class="s4"># input data</span>
        <span class="s1">np.random.seed(</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">xy = np.random.random((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = xy[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xy[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">z = np.hypot(x</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s4"># interpolation points</span>
        <span class="s1">XY = np.random.random((</span><span class="s3">50</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>

        <span class="s1">xy.setflags(write=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">z.setflags(write=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">XY.setflags(write=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">interp = interpolator(xy</span><span class="s0">, </span><span class="s1">z)</span>
        <span class="s1">interp(XY)</span>
</pre>
</body>
</html>
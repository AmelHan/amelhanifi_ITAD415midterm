<html>
<head>
<title>test__linprog_clean_inputs.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test__linprog_clean_inputs.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Unit test for Linear Programming via Simplex Algorithm. 
&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_equal</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>
<span class="s2">from </span><span class="s1">scipy.optimize._linprog_util </span><span class="s2">import </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem</span>
<span class="s2">from </span><span class="s1">copy </span><span class="s2">import </span><span class="s1">deepcopy</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">date</span>


<span class="s2">def </span><span class="s1">test_aliasing():</span>
    <span class="s0">&quot;&quot;&quot; 
    Test for ensuring that no objects referred to by `lp` attributes, 
    `c`, `A_ub`, `b_ub`, `A_eq`, `b_eq`, `bounds`, have been modified 
    by `_clean_inputs` as a side effect. 
    &quot;&quot;&quot;</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=</span><span class="s3">1</span><span class="s2">,</span>
        <span class="s1">A_ub=[[</span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_ub=[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">A_eq=[[</span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_eq=[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">bounds=(-np.inf</span><span class="s2">, </span><span class="s1">np.inf)</span>
    <span class="s1">)</span>
    <span class="s1">lp_copy = deepcopy(lp)</span>

    <span class="s1">_clean_inputs(lp)</span>

    <span class="s1">assert_(lp.c == lp_copy.c</span><span class="s2">, </span><span class="s4">&quot;c modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.A_ub == lp_copy.A_ub</span><span class="s2">, </span><span class="s4">&quot;A_ub modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.b_ub == lp_copy.b_ub</span><span class="s2">, </span><span class="s4">&quot;b_ub modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.A_eq == lp_copy.A_eq</span><span class="s2">, </span><span class="s4">&quot;A_eq modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.b_eq == lp_copy.b_eq</span><span class="s2">, </span><span class="s4">&quot;b_eq modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.bounds == lp_copy.bounds</span><span class="s2">, </span><span class="s4">&quot;bounds modified by _clean_inputs&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_aliasing2():</span>
    <span class="s0">&quot;&quot;&quot; 
    Similar purpose as `test_aliasing` above. 
    &quot;&quot;&quot;</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">A_ub=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_ub=np.array([[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">A_eq=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_eq=np.array([</span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">bounds=[(-np.inf</span><span class="s2">, </span><span class="s1">np.inf)</span><span class="s2">, </span><span class="s1">(</span><span class="s2">None, </span><span class="s3">1</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">lp_copy = deepcopy(lp)</span>

    <span class="s1">_clean_inputs(lp)</span>

    <span class="s1">assert_allclose(lp.c</span><span class="s2">, </span><span class="s1">lp_copy.c</span><span class="s2">, </span><span class="s1">err_msg=</span><span class="s4">&quot;c modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_allclose(lp.A_ub</span><span class="s2">, </span><span class="s1">lp_copy.A_ub</span><span class="s2">, </span><span class="s1">err_msg=</span><span class="s4">&quot;A_ub modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_allclose(lp.b_ub</span><span class="s2">, </span><span class="s1">lp_copy.b_ub</span><span class="s2">, </span><span class="s1">err_msg=</span><span class="s4">&quot;b_ub modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_allclose(lp.A_eq</span><span class="s2">, </span><span class="s1">lp_copy.A_eq</span><span class="s2">, </span><span class="s1">err_msg=</span><span class="s4">&quot;A_eq modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_allclose(lp.b_eq</span><span class="s2">, </span><span class="s1">lp_copy.b_eq</span><span class="s2">, </span><span class="s1">err_msg=</span><span class="s4">&quot;b_eq modified by _clean_inputs&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp.bounds == lp_copy.bounds</span><span class="s2">, </span><span class="s4">&quot;bounds modified by _clean_inputs&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_missing_inputs():</span>
    <span class="s1">c = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">A_ub = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span>
    <span class="s1">b_ub = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">A_eq = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span>
    <span class="s1">b_eq = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>

    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs)</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=</span><span class="s2">None</span><span class="s1">))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_ub=A_ub))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_ub=A_ub</span><span class="s2">, </span><span class="s1">b_ub=</span><span class="s2">None</span><span class="s1">))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">b_ub=b_ub))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_ub=</span><span class="s2">None, </span><span class="s1">b_ub=b_ub))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_eq=A_eq))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_eq=A_eq</span><span class="s2">, </span><span class="s1">b_eq=</span><span class="s2">None</span><span class="s1">))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">b_eq=b_eq))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_eq=</span><span class="s2">None, </span><span class="s1">b_eq=b_eq))</span>


<span class="s2">def </span><span class="s1">test_too_many_dimensions():</span>
    <span class="s1">cb = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span>
    <span class="s1">A = np.random.rand(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">bad2D = [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]]</span>
    <span class="s1">bad3D = np.random.rand(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=bad2D</span><span class="s2">, </span><span class="s1">A_ub=A</span><span class="s2">, </span><span class="s1">b_ub=cb))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_ub=bad3D</span><span class="s2">, </span><span class="s1">b_ub=cb))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_ub=A</span><span class="s2">, </span><span class="s1">b_ub=bad2D))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_eq=bad3D</span><span class="s2">, </span><span class="s1">b_eq=cb))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_eq=A</span><span class="s2">, </span><span class="s1">b_eq=bad2D))</span>


<span class="s2">def </span><span class="s1">test_too_few_dimensions():</span>
    <span class="s1">bad = np.random.rand(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s1">).ravel()</span>
    <span class="s1">cb = np.random.rand(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_ub=bad</span><span class="s2">, </span><span class="s1">b_ub=cb))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=cb</span><span class="s2">, </span><span class="s1">A_eq=bad</span><span class="s2">, </span><span class="s1">b_eq=cb))</span>


<span class="s2">def </span><span class="s1">test_inconsistent_dimensions():</span>
    <span class="s1">m = </span><span class="s3">2</span>
    <span class="s1">n = </span><span class="s3">4</span>
    <span class="s1">c = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span>

    <span class="s1">Agood = np.random.rand(m</span><span class="s2">, </span><span class="s1">n)</span>
    <span class="s1">Abad = np.random.rand(m</span><span class="s2">, </span><span class="s1">n + </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">bgood = np.random.rand(m)</span>
    <span class="s1">bbad = np.random.rand(m + </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">boundsbad = [(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)] * (n + </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_ub=Abad</span><span class="s2">, </span><span class="s1">b_ub=bgood))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_ub=Agood</span><span class="s2">, </span><span class="s1">b_ub=bbad))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_eq=Abad</span><span class="s2">, </span><span class="s1">b_eq=bgood))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">A_eq=Agood</span><span class="s2">, </span><span class="s1">b_eq=bbad))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">bounds=boundsbad))</span>
    <span class="s2">with </span><span class="s1">np.testing.suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
        <span class="s1">sup.filter(np.VisibleDeprecationWarning</span><span class="s2">, </span><span class="s4">&quot;Creating an ndarray from ragged&quot;</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">,</span>
                      <span class="s1">_LPProblem(c=c</span><span class="s2">, </span><span class="s1">bounds=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s1">]]))</span>


<span class="s2">def </span><span class="s1">test_type_errors():</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">A_ub=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_ub=np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">A_eq=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_eq=np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">bounds=[(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">bad = </span><span class="s4">&quot;hello&quot;</span>

    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(c=bad))</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(A_ub=bad))</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(b_ub=bad))</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(A_eq=bad))</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(b_eq=bad))</span>

    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=bad))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=</span><span class="s4">&quot;hi&quot;</span><span class="s1">))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[</span><span class="s4">&quot;hi&quot;</span><span class="s1">]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s4">&quot;hi&quot;</span><span class="s1">)]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)]))</span>
    <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">date(</span><span class="s3">2020</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">29</span><span class="s1">))]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]]]))</span>


<span class="s2">def </span><span class="s1">test_non_finite_errors():</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">A_ub=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_ub=np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">A_eq=np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span><span class="s2">,</span>
        <span class="s1">b_eq=np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">bounds=[(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(c=[</span><span class="s3">0</span><span class="s2">, None</span><span class="s1">]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(c=[np.inf</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(c=[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">-np.inf]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(c=[np.nan</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(A_ub=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">1</span><span class="s1">]]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(b_ub=[np.inf</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(A_eq=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-np.inf]]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(b_eq=[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.nan]))</span>


<span class="s2">def </span><span class="s1">test__clean_inputs1():</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">A_ub=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_ub=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">A_eq=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_eq=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">bounds=</span><span class="s2">None</span>
    <span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp)</span>

    <span class="s1">assert_allclose(lp_cleaned.c</span><span class="s2">, </span><span class="s1">np.array(lp.c))</span>
    <span class="s1">assert_allclose(lp_cleaned.A_ub</span><span class="s2">, </span><span class="s1">np.array(lp.A_ub))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_ub</span><span class="s2">, </span><span class="s1">np.array(lp.b_ub))</span>
    <span class="s1">assert_allclose(lp_cleaned.A_eq</span><span class="s2">, </span><span class="s1">np.array(lp.A_eq))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_eq</span><span class="s2">, </span><span class="s1">np.array(lp.b_eq))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_(lp_cleaned.c.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.A_ub.shape == (</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_ub.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.A_eq.shape == (</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_eq.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test__clean_inputs2():</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=</span><span class="s3">1</span><span class="s2">,</span>
        <span class="s1">A_ub=[[</span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_ub=</span><span class="s3">1</span><span class="s2">,</span>
        <span class="s1">A_eq=[[</span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">b_eq=</span><span class="s3">1</span><span class="s2">,</span>
        <span class="s1">bounds=(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp)</span>

    <span class="s1">assert_allclose(lp_cleaned.c</span><span class="s2">, </span><span class="s1">np.array(lp.c))</span>
    <span class="s1">assert_allclose(lp_cleaned.A_ub</span><span class="s2">, </span><span class="s1">np.array(lp.A_ub))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_ub</span><span class="s2">, </span><span class="s1">np.array(lp.b_ub))</span>
    <span class="s1">assert_allclose(lp_cleaned.A_eq</span><span class="s2">, </span><span class="s1">np.array(lp.A_eq))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_eq</span><span class="s2">, </span><span class="s1">np.array(lp.b_eq))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)])</span>

    <span class="s1">assert_(lp_cleaned.c.shape == (</span><span class="s3">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.A_ub.shape == (</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_ub.shape == (</span><span class="s3">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.A_eq.shape == (</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_eq.shape == (</span><span class="s3">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test__clean_inputs3():</span>
    <span class="s1">lp = _LPProblem(</span>
        <span class="s1">c=[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">A_ub=np.random.rand(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">b_ub=[[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">A_eq=np.random.rand(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">b_eq=[[</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">bounds=[(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)]</span>
    <span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp)</span>

    <span class="s1">assert_allclose(lp_cleaned.c</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_ub</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]))</span>
    <span class="s1">assert_allclose(lp_cleaned.b_eq</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">assert_(lp_cleaned.c.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_ub.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">assert_(lp_cleaned.b_eq.shape == (</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_bad_bounds():</span>
    <span class="s1">lp = _LPProblem(c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">])</span>

    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)]))</span>
    <span class="s2">with </span><span class="s1">np.testing.suppress_warnings() </span><span class="s2">as </span><span class="s1">sup:</span>
        <span class="s1">sup.filter(np.VisibleDeprecationWarning</span><span class="s2">, </span><span class="s4">&quot;Creating an ndarray from ragged&quot;</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">,</span>
                      <span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)]))</span>
    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)]))</span>

    <span class="s1">lp = _LPProblem(c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">])</span>

    <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">_clean_inputs</span><span class="s2">, </span><span class="s1">lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)]))</span>


<span class="s2">def </span><span class="s1">test_good_bounds():</span>
    <span class="s1">lp = _LPProblem(c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">])</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp)  </span><span class="s5"># lp.bounds is None by default</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[[]]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, None</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s2">None, </span><span class="s3">1</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(-np.inf</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s2">None, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(-np.inf</span><span class="s2">, None</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(-np.inf</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">lp = _LPProblem(c=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">])</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp)  </span><span class="s5"># lp.bounds is None by default</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)] * </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)] * </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s3">1</span><span class="s2">, None</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s2">None, </span><span class="s3">1</span><span class="s1">)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(-np.inf</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)] * </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">lp_cleaned = _clean_inputs(lp._replace(bounds=[(</span><span class="s2">None, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(-np.inf</span><span class="s2">, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s2">None, </span><span class="s1">np.inf)</span><span class="s2">, </span><span class="s1">(-np.inf</span><span class="s2">, </span><span class="s1">np.inf)]))</span>
    <span class="s1">assert_equal(lp_cleaned.bounds</span><span class="s2">, </span><span class="s1">[(-np.inf</span><span class="s2">, </span><span class="s1">np.inf)] * </span><span class="s3">4</span><span class="s1">)</span>
</pre>
</body>
</html>
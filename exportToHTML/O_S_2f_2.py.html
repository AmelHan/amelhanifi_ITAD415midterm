<html>
<head>
<title>O_S_2f_2.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
O_S_2f_2.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">fontTools.misc </span><span class="s0">import </span><span class="s1">sstruct</span>
<span class="s0">from </span><span class="s1">fontTools.misc.roundTools </span><span class="s0">import </span><span class="s1">otRound</span>
<span class="s0">from </span><span class="s1">fontTools.misc.textTools </span><span class="s0">import </span><span class="s1">safeEval</span><span class="s0">, </span><span class="s1">num2binary</span><span class="s0">, </span><span class="s1">binary2num</span>
<span class="s0">from </span><span class="s1">fontTools.ttLib.tables </span><span class="s0">import </span><span class="s1">DefaultTable</span>
<span class="s0">import </span><span class="s1">bisect</span>
<span class="s0">import </span><span class="s1">logging</span>


<span class="s1">log = logging.getLogger(__name__)</span>

<span class="s2"># panose classification</span>

<span class="s1">panoseFormat = </span><span class="s3">&quot;&quot;&quot; 
    bFamilyType:        B 
    bSerifStyle:        B 
    bWeight:            B 
    bProportion:        B 
    bContrast:          B 
    bStrokeVariation:   B 
    bArmStyle:          B 
    bLetterForm:        B 
    bMidline:           B 
    bXHeight:           B 
&quot;&quot;&quot;</span>


<span class="s0">class </span><span class="s1">Panose(object):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s1">_</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">_ = sstruct.getformat(panoseFormat)</span>
        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
            <span class="s1">setattr(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">kwargs.pop(name</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">kwargs:</span>
            <span class="s0">raise </span><span class="s1">TypeError(</span><span class="s3">f&quot;Panose() got an unexpected keyword argument </span><span class="s0">{</span><span class="s1">k</span><span class="s0">!r}</span><span class="s3">&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">toXML(self</span><span class="s0">, </span><span class="s1">writer</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s1">formatstring</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">fixes = sstruct.getformat(panoseFormat)</span>
        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
            <span class="s1">writer.simpletag(name</span><span class="s0">, </span><span class="s1">value=getattr(self</span><span class="s0">, </span><span class="s1">name))</span>
            <span class="s1">writer.newline()</span>

    <span class="s0">def </span><span class="s1">fromXML(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">attrs</span><span class="s0">, </span><span class="s1">content</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s1">setattr(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">safeEval(attrs[</span><span class="s3">&quot;value&quot;</span><span class="s1">]))</span>


<span class="s2"># 'sfnt' OS/2 and Windows Metrics table - 'OS/2'</span>

<span class="s1">OS2_format_0 = </span><span class="s3">&quot;&quot;&quot; 
    &gt;   # big endian 
    version:                H       # version 
    xAvgCharWidth:          h       # average character width 
    usWeightClass:          H       # degree of thickness of strokes 
    usWidthClass:           H       # aspect ratio 
    fsType:                 H       # type flags 
    ySubscriptXSize:        h       # subscript horizontal font size 
    ySubscriptYSize:        h       # subscript vertical font size 
    ySubscriptXOffset:      h       # subscript x offset 
    ySubscriptYOffset:      h       # subscript y offset 
    ySuperscriptXSize:      h       # superscript horizontal font size 
    ySuperscriptYSize:      h       # superscript vertical font size 
    ySuperscriptXOffset:    h       # superscript x offset 
    ySuperscriptYOffset:    h       # superscript y offset 
    yStrikeoutSize:         h       # strikeout size 
    yStrikeoutPosition:     h       # strikeout position 
    sFamilyClass:           h       # font family class and subclass 
    panose:                 10s     # panose classification number 
    ulUnicodeRange1:        L       # character range 
    ulUnicodeRange2:        L       # character range 
    ulUnicodeRange3:        L       # character range 
    ulUnicodeRange4:        L       # character range 
    achVendID:              4s      # font vendor identification 
    fsSelection:            H       # font selection flags 
    usFirstCharIndex:       H       # first unicode character index 
    usLastCharIndex:        H       # last unicode character index 
    sTypoAscender:          h       # typographic ascender 
    sTypoDescender:         h       # typographic descender 
    sTypoLineGap:           h       # typographic line gap 
    usWinAscent:            H       # Windows ascender 
    usWinDescent:           H       # Windows descender 
&quot;&quot;&quot;</span>

<span class="s1">OS2_format_1_addition = </span><span class="s3">&quot;&quot;&quot; 
    ulCodePageRange1:   L 
    ulCodePageRange2:   L 
&quot;&quot;&quot;</span>

<span class="s1">OS2_format_2_addition = (</span>
    <span class="s1">OS2_format_1_addition</span>
    <span class="s1">+ </span><span class="s3">&quot;&quot;&quot; 
    sxHeight:           h 
    sCapHeight:         h 
    usDefaultChar:      H 
    usBreakChar:        H 
    usMaxContext:       H 
&quot;&quot;&quot;</span>
<span class="s1">)</span>

<span class="s1">OS2_format_5_addition = (</span>
    <span class="s1">OS2_format_2_addition</span>
    <span class="s1">+ </span><span class="s3">&quot;&quot;&quot; 
    usLowerOpticalPointSize:    H 
    usUpperOpticalPointSize:    H 
&quot;&quot;&quot;</span>
<span class="s1">)</span>

<span class="s1">bigendian = </span><span class="s3">&quot; &gt;   # big endian</span><span class="s0">\n</span><span class="s3">&quot;</span>

<span class="s1">OS2_format_1 = OS2_format_0 + OS2_format_1_addition</span>
<span class="s1">OS2_format_2 = OS2_format_0 + OS2_format_2_addition</span>
<span class="s1">OS2_format_5 = OS2_format_0 + OS2_format_5_addition</span>
<span class="s1">OS2_format_1_addition = bigendian + OS2_format_1_addition</span>
<span class="s1">OS2_format_2_addition = bigendian + OS2_format_2_addition</span>
<span class="s1">OS2_format_5_addition = bigendian + OS2_format_5_addition</span>


<span class="s0">class </span><span class="s1">table_O_S_2f_2(DefaultTable.DefaultTable):</span>

    <span class="s5">&quot;&quot;&quot;the OS/2 table&quot;&quot;&quot;</span>

    <span class="s1">dependencies = [</span><span class="s3">&quot;head&quot;</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">decompile(self</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s1">dummy</span><span class="s0">, </span><span class="s1">data = sstruct.unpack2(OS2_format_0</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">self)</span>

        <span class="s0">if </span><span class="s1">self.version == </span><span class="s4">1</span><span class="s1">:</span>
            <span class="s1">dummy</span><span class="s0">, </span><span class="s1">data = sstruct.unpack2(OS2_format_1_addition</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">self)</span>
        <span class="s0">elif </span><span class="s1">self.version </span><span class="s0">in </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">):</span>
            <span class="s1">dummy</span><span class="s0">, </span><span class="s1">data = sstruct.unpack2(OS2_format_2_addition</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">self)</span>
        <span class="s0">elif </span><span class="s1">self.version == </span><span class="s4">5</span><span class="s1">:</span>
            <span class="s1">dummy</span><span class="s0">, </span><span class="s1">data = sstruct.unpack2(OS2_format_5_addition</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">self)</span>
            <span class="s1">self.usLowerOpticalPointSize /= </span><span class="s4">20</span>
            <span class="s1">self.usUpperOpticalPointSize /= </span><span class="s4">20</span>
        <span class="s0">elif </span><span class="s1">self.version != </span><span class="s4">0</span><span class="s1">:</span>
            <span class="s0">from </span><span class="s1">fontTools </span><span class="s0">import </span><span class="s1">ttLib</span>

            <span class="s0">raise </span><span class="s1">ttLib.TTLibError(</span>
                <span class="s3">&quot;unknown format for OS/2 table: version %s&quot; </span><span class="s1">% self.version</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">len(data):</span>
            <span class="s1">log.warning(</span><span class="s3">&quot;too much 'OS/2' table data&quot;</span><span class="s1">)</span>

        <span class="s1">self.panose = sstruct.unpack(panoseFormat</span><span class="s0">, </span><span class="s1">self.panose</span><span class="s0">, </span><span class="s1">Panose())</span>

    <span class="s0">def </span><span class="s1">compile(self</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s1">self.updateFirstAndLastCharIndex(ttFont)</span>
        <span class="s1">panose = self.panose</span>
        <span class="s1">head = ttFont[</span><span class="s3">&quot;head&quot;</span><span class="s1">]</span>
        <span class="s0">if </span><span class="s1">(self.fsSelection &amp; </span><span class="s4">1</span><span class="s1">) </span><span class="s0">and not </span><span class="s1">(head.macStyle &amp; </span><span class="s4">1 </span><span class="s1">&lt;&lt; </span><span class="s4">1</span><span class="s1">):</span>
            <span class="s1">log.warning(</span>
                <span class="s3">&quot;fsSelection bit 0 (italic) and &quot;</span>
                <span class="s3">&quot;head table macStyle bit 1 (italic) should match&quot;</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">(self.fsSelection &amp; </span><span class="s4">1 </span><span class="s1">&lt;&lt; </span><span class="s4">5</span><span class="s1">) </span><span class="s0">and not </span><span class="s1">(head.macStyle &amp; </span><span class="s4">1</span><span class="s1">):</span>
            <span class="s1">log.warning(</span>
                <span class="s3">&quot;fsSelection bit 5 (bold) and &quot;</span>
                <span class="s3">&quot;head table macStyle bit 0 (bold) should match&quot;</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">(self.fsSelection &amp; </span><span class="s4">1 </span><span class="s1">&lt;&lt; </span><span class="s4">6</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(self.fsSelection &amp; </span><span class="s4">1 </span><span class="s1">+ (</span><span class="s4">1 </span><span class="s1">&lt;&lt; </span><span class="s4">5</span><span class="s1">)):</span>
            <span class="s1">log.warning(</span>
                <span class="s3">&quot;fsSelection bit 6 (regular) is set, &quot;</span>
                <span class="s3">&quot;bits 0 (italic) and 5 (bold) must be clear&quot;</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">self.version &lt; </span><span class="s4">4 </span><span class="s0">and </span><span class="s1">self.fsSelection &amp; </span><span class="s4">0b1110000000</span><span class="s1">:</span>
            <span class="s1">log.warning(</span>
                <span class="s3">&quot;fsSelection bits 7, 8 and 9 are only defined in &quot;</span>
                <span class="s3">&quot;OS/2 table version 4 and up: version %s&quot;</span><span class="s0">,</span>
                <span class="s1">self.version</span><span class="s0">,</span>
            <span class="s1">)</span>
        <span class="s1">self.panose = sstruct.pack(panoseFormat</span><span class="s0">, </span><span class="s1">self.panose)</span>
        <span class="s0">if </span><span class="s1">self.version == </span><span class="s4">0</span><span class="s1">:</span>
            <span class="s1">data = sstruct.pack(OS2_format_0</span><span class="s0">, </span><span class="s1">self)</span>
        <span class="s0">elif </span><span class="s1">self.version == </span><span class="s4">1</span><span class="s1">:</span>
            <span class="s1">data = sstruct.pack(OS2_format_1</span><span class="s0">, </span><span class="s1">self)</span>
        <span class="s0">elif </span><span class="s1">self.version </span><span class="s0">in </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">):</span>
            <span class="s1">data = sstruct.pack(OS2_format_2</span><span class="s0">, </span><span class="s1">self)</span>
        <span class="s0">elif </span><span class="s1">self.version == </span><span class="s4">5</span><span class="s1">:</span>
            <span class="s1">d = self.__dict__.copy()</span>
            <span class="s1">d[</span><span class="s3">&quot;usLowerOpticalPointSize&quot;</span><span class="s1">] = round(self.usLowerOpticalPointSize * </span><span class="s4">20</span><span class="s1">)</span>
            <span class="s1">d[</span><span class="s3">&quot;usUpperOpticalPointSize&quot;</span><span class="s1">] = round(self.usUpperOpticalPointSize * </span><span class="s4">20</span><span class="s1">)</span>
            <span class="s1">data = sstruct.pack(OS2_format_5</span><span class="s0">, </span><span class="s1">d)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">from </span><span class="s1">fontTools </span><span class="s0">import </span><span class="s1">ttLib</span>

            <span class="s0">raise </span><span class="s1">ttLib.TTLibError(</span>
                <span class="s3">&quot;unknown format for OS/2 table: version %s&quot; </span><span class="s1">% self.version</span>
            <span class="s1">)</span>
        <span class="s1">self.panose = panose</span>
        <span class="s0">return </span><span class="s1">data</span>

    <span class="s0">def </span><span class="s1">toXML(self</span><span class="s0">, </span><span class="s1">writer</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s1">writer.comment(</span>
            <span class="s3">&quot;The fields 'usFirstCharIndex' and 'usLastCharIndex'</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;will be recalculated by the compiler&quot;</span>
        <span class="s1">)</span>
        <span class="s1">writer.newline()</span>
        <span class="s0">if </span><span class="s1">self.version == </span><span class="s4">1</span><span class="s1">:</span>
            <span class="s1">format = OS2_format_1</span>
        <span class="s0">elif </span><span class="s1">self.version </span><span class="s0">in </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">):</span>
            <span class="s1">format = OS2_format_2</span>
        <span class="s0">elif </span><span class="s1">self.version == </span><span class="s4">5</span><span class="s1">:</span>
            <span class="s1">format = OS2_format_5</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">format = OS2_format_0</span>
        <span class="s1">formatstring</span><span class="s0">, </span><span class="s1">names</span><span class="s0">, </span><span class="s1">fixes = sstruct.getformat(format)</span>
        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
            <span class="s1">value = getattr(self</span><span class="s0">, </span><span class="s1">name)</span>
            <span class="s0">if </span><span class="s1">name == </span><span class="s3">&quot;panose&quot;</span><span class="s1">:</span>
                <span class="s1">writer.begintag(</span><span class="s3">&quot;panose&quot;</span><span class="s1">)</span>
                <span class="s1">writer.newline()</span>
                <span class="s1">value.toXML(writer</span><span class="s0">, </span><span class="s1">ttFont)</span>
                <span class="s1">writer.endtag(</span><span class="s3">&quot;panose&quot;</span><span class="s1">)</span>
            <span class="s0">elif </span><span class="s1">name </span><span class="s0">in </span><span class="s1">(</span>
                <span class="s3">&quot;ulUnicodeRange1&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ulUnicodeRange2&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ulUnicodeRange3&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ulUnicodeRange4&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ulCodePageRange1&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ulCodePageRange2&quot;</span><span class="s0">,</span>
            <span class="s1">):</span>
                <span class="s1">writer.simpletag(name</span><span class="s0">, </span><span class="s1">value=num2binary(value))</span>
            <span class="s0">elif </span><span class="s1">name </span><span class="s0">in </span><span class="s1">(</span><span class="s3">&quot;fsType&quot;</span><span class="s0">, </span><span class="s3">&quot;fsSelection&quot;</span><span class="s1">):</span>
                <span class="s1">writer.simpletag(name</span><span class="s0">, </span><span class="s1">value=num2binary(value</span><span class="s0">, </span><span class="s4">16</span><span class="s1">))</span>
            <span class="s0">elif </span><span class="s1">name == </span><span class="s3">&quot;achVendID&quot;</span><span class="s1">:</span>
                <span class="s1">writer.simpletag(name</span><span class="s0">, </span><span class="s1">value=repr(value)[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">writer.simpletag(name</span><span class="s0">, </span><span class="s1">value=value)</span>
            <span class="s1">writer.newline()</span>

    <span class="s0">def </span><span class="s1">fromXML(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">attrs</span><span class="s0">, </span><span class="s1">content</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s0">if </span><span class="s1">name == </span><span class="s3">&quot;panose&quot;</span><span class="s1">:</span>
            <span class="s1">self.panose = panose = Panose()</span>
            <span class="s0">for </span><span class="s1">element </span><span class="s0">in </span><span class="s1">content:</span>
                <span class="s0">if </span><span class="s1">isinstance(element</span><span class="s0">, </span><span class="s1">tuple):</span>
                    <span class="s1">name</span><span class="s0">, </span><span class="s1">attrs</span><span class="s0">, </span><span class="s1">content = element</span>
                    <span class="s1">panose.fromXML(name</span><span class="s0">, </span><span class="s1">attrs</span><span class="s0">, </span><span class="s1">content</span><span class="s0">, </span><span class="s1">ttFont)</span>
        <span class="s0">elif </span><span class="s1">name </span><span class="s0">in </span><span class="s1">(</span>
            <span class="s3">&quot;ulUnicodeRange1&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;ulUnicodeRange2&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;ulUnicodeRange3&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;ulUnicodeRange4&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;ulCodePageRange1&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;ulCodePageRange2&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;fsType&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;fsSelection&quot;</span><span class="s0">,</span>
        <span class="s1">):</span>
            <span class="s1">setattr(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">binary2num(attrs[</span><span class="s3">&quot;value&quot;</span><span class="s1">]))</span>
        <span class="s0">elif </span><span class="s1">name == </span><span class="s3">&quot;achVendID&quot;</span><span class="s1">:</span>
            <span class="s1">setattr(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">safeEval(</span><span class="s3">&quot;'''&quot; </span><span class="s1">+ attrs[</span><span class="s3">&quot;value&quot;</span><span class="s1">] + </span><span class="s3">&quot;'''&quot;</span><span class="s1">))</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">setattr(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">safeEval(attrs[</span><span class="s3">&quot;value&quot;</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">updateFirstAndLastCharIndex(self</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s0">if </span><span class="s3">&quot;cmap&quot; </span><span class="s0">not in </span><span class="s1">ttFont:</span>
            <span class="s0">return</span>
        <span class="s1">codes = set()</span>
        <span class="s0">for </span><span class="s1">table </span><span class="s0">in </span><span class="s1">getattr(ttFont[</span><span class="s3">&quot;cmap&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;tables&quot;</span><span class="s0">, </span><span class="s1">[]):</span>
            <span class="s0">if </span><span class="s1">table.isUnicode():</span>
                <span class="s1">codes.update(table.cmap.keys())</span>
        <span class="s0">if </span><span class="s1">codes:</span>
            <span class="s1">minCode = min(codes)</span>
            <span class="s1">maxCode = max(codes)</span>
            <span class="s2"># USHORT cannot hold codepoints greater than 0xFFFF</span>
            <span class="s1">self.usFirstCharIndex = min(</span><span class="s4">0xFFFF</span><span class="s0">, </span><span class="s1">minCode)</span>
            <span class="s1">self.usLastCharIndex = min(</span><span class="s4">0xFFFF</span><span class="s0">, </span><span class="s1">maxCode)</span>

    <span class="s2"># misspelled attributes kept for legacy reasons</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">usMaxContex(self):</span>
        <span class="s0">return </span><span class="s1">self.usMaxContext</span>

    <span class="s1">@usMaxContex.setter</span>
    <span class="s0">def </span><span class="s1">usMaxContex(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self.usMaxContext = value</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">fsFirstCharIndex(self):</span>
        <span class="s0">return </span><span class="s1">self.usFirstCharIndex</span>

    <span class="s1">@fsFirstCharIndex.setter</span>
    <span class="s0">def </span><span class="s1">fsFirstCharIndex(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self.usFirstCharIndex = value</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">fsLastCharIndex(self):</span>
        <span class="s0">return </span><span class="s1">self.usLastCharIndex</span>

    <span class="s1">@fsLastCharIndex.setter</span>
    <span class="s0">def </span><span class="s1">fsLastCharIndex(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self.usLastCharIndex = value</span>

    <span class="s0">def </span><span class="s1">getUnicodeRanges(self):</span>
        <span class="s5">&quot;&quot;&quot;Return the set of 'ulUnicodeRange*' bits currently enabled.&quot;&quot;&quot;</span>
        <span class="s1">bits = set()</span>
        <span class="s1">ul1</span><span class="s0">, </span><span class="s1">ul2 = self.ulUnicodeRange1</span><span class="s0">, </span><span class="s1">self.ulUnicodeRange2</span>
        <span class="s1">ul3</span><span class="s0">, </span><span class="s1">ul4 = self.ulUnicodeRange3</span><span class="s0">, </span><span class="s1">self.ulUnicodeRange4</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">32</span><span class="s1">):</span>
            <span class="s0">if </span><span class="s1">ul1 &amp; (</span><span class="s4">1 </span><span class="s1">&lt;&lt; i):</span>
                <span class="s1">bits.add(i)</span>
            <span class="s0">if </span><span class="s1">ul2 &amp; (</span><span class="s4">1 </span><span class="s1">&lt;&lt; i):</span>
                <span class="s1">bits.add(i + </span><span class="s4">32</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">ul3 &amp; (</span><span class="s4">1 </span><span class="s1">&lt;&lt; i):</span>
                <span class="s1">bits.add(i + </span><span class="s4">64</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">ul4 &amp; (</span><span class="s4">1 </span><span class="s1">&lt;&lt; i):</span>
                <span class="s1">bits.add(i + </span><span class="s4">96</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">bits</span>

    <span class="s0">def </span><span class="s1">setUnicodeRanges(self</span><span class="s0">, </span><span class="s1">bits):</span>
        <span class="s5">&quot;&quot;&quot;Set the 'ulUnicodeRange*' fields to the specified 'bits'.&quot;&quot;&quot;</span>
        <span class="s1">ul1</span><span class="s0">, </span><span class="s1">ul2</span><span class="s0">, </span><span class="s1">ul3</span><span class="s0">, </span><span class="s1">ul4 = </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span>
        <span class="s0">for </span><span class="s1">bit </span><span class="s0">in </span><span class="s1">bits:</span>
            <span class="s0">if </span><span class="s4">0 </span><span class="s1">&lt;= bit &lt; </span><span class="s4">32</span><span class="s1">:</span>
                <span class="s1">ul1 |= </span><span class="s4">1 </span><span class="s1">&lt;&lt; bit</span>
            <span class="s0">elif </span><span class="s4">32 </span><span class="s1">&lt;= bit &lt; </span><span class="s4">64</span><span class="s1">:</span>
                <span class="s1">ul2 |= </span><span class="s4">1 </span><span class="s1">&lt;&lt; (bit - </span><span class="s4">32</span><span class="s1">)</span>
            <span class="s0">elif </span><span class="s4">64 </span><span class="s1">&lt;= bit &lt; </span><span class="s4">96</span><span class="s1">:</span>
                <span class="s1">ul3 |= </span><span class="s4">1 </span><span class="s1">&lt;&lt; (bit - </span><span class="s4">64</span><span class="s1">)</span>
            <span class="s0">elif </span><span class="s4">96 </span><span class="s1">&lt;= bit &lt; </span><span class="s4">123</span><span class="s1">:</span>
                <span class="s1">ul4 |= </span><span class="s4">1 </span><span class="s1">&lt;&lt; (bit - </span><span class="s4">96</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;expected 0 &lt;= int &lt;= 122, found: %r&quot; </span><span class="s1">% bit)</span>
        <span class="s1">self.ulUnicodeRange1</span><span class="s0">, </span><span class="s1">self.ulUnicodeRange2 = ul1</span><span class="s0">, </span><span class="s1">ul2</span>
        <span class="s1">self.ulUnicodeRange3</span><span class="s0">, </span><span class="s1">self.ulUnicodeRange4 = ul3</span><span class="s0">, </span><span class="s1">ul4</span>

    <span class="s0">def </span><span class="s1">recalcUnicodeRanges(self</span><span class="s0">, </span><span class="s1">ttFont</span><span class="s0">, </span><span class="s1">pruneOnly=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s5">&quot;&quot;&quot;Intersect the codepoints in the font's Unicode cmap subtables with 
        the Unicode block ranges defined in the OpenType specification (v1.7), 
        and set the respective 'ulUnicodeRange*' bits if there is at least ONE 
        intersection. 
        If 'pruneOnly' is True, only clear unused bits with NO intersection. 
        &quot;&quot;&quot;</span>
        <span class="s1">unicodes = set()</span>
        <span class="s0">for </span><span class="s1">table </span><span class="s0">in </span><span class="s1">ttFont[</span><span class="s3">&quot;cmap&quot;</span><span class="s1">].tables:</span>
            <span class="s0">if </span><span class="s1">table.isUnicode():</span>
                <span class="s1">unicodes.update(table.cmap.keys())</span>
        <span class="s0">if </span><span class="s1">pruneOnly:</span>
            <span class="s1">empty = intersectUnicodeRanges(unicodes</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">bits = self.getUnicodeRanges() - empty</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">bits = intersectUnicodeRanges(unicodes)</span>
        <span class="s1">self.setUnicodeRanges(bits)</span>
        <span class="s0">return </span><span class="s1">bits</span>

    <span class="s0">def </span><span class="s1">recalcAvgCharWidth(self</span><span class="s0">, </span><span class="s1">ttFont):</span>
        <span class="s5">&quot;&quot;&quot;Recalculate xAvgCharWidth using metrics from ttFont's 'hmtx' table. 
 
        Set it to 0 if the unlikely event 'hmtx' table is not found. 
        &quot;&quot;&quot;</span>
        <span class="s1">avg_width = </span><span class="s4">0</span>
        <span class="s1">hmtx = ttFont.get(</span><span class="s3">&quot;hmtx&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">hmtx </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">widths = [width </span><span class="s0">for </span><span class="s1">width</span><span class="s0">, </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">hmtx.metrics.values() </span><span class="s0">if </span><span class="s1">width &gt; </span><span class="s4">0</span><span class="s1">]</span>
            <span class="s0">if </span><span class="s1">widths:</span>
                <span class="s1">avg_width = otRound(sum(widths) / len(widths))</span>
        <span class="s1">self.xAvgCharWidth = avg_width</span>
        <span class="s0">return </span><span class="s1">avg_width</span>


<span class="s2"># Unicode ranges data from the OpenType OS/2 table specification v1.7</span>

<span class="s1">OS2_UNICODE_RANGES = (</span>
    <span class="s1">((</span><span class="s3">&quot;Basic Latin&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0000</span><span class="s0">, </span><span class="s4">0x007F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Latin-1 Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0080</span><span class="s0">, </span><span class="s4">0x00FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Latin Extended-A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0100</span><span class="s0">, </span><span class="s4">0x017F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Latin Extended-B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0180</span><span class="s0">, </span><span class="s4">0x024F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;IPA Extensions&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0250</span><span class="s0">, </span><span class="s4">0x02AF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Phonetic Extensions&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D00</span><span class="s0">, </span><span class="s4">0x1D7F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Phonetic Extensions Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D80</span><span class="s0">, </span><span class="s4">0x1DBF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Spacing Modifier Letters&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x02B0</span><span class="s0">, </span><span class="s4">0x02FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Modifier Tone Letters&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA700</span><span class="s0">, </span><span class="s4">0xA71F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Combining Diacritical Marks&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0300</span><span class="s0">, </span><span class="s4">0x036F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Combining Diacritical Marks Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1DC0</span><span class="s0">, </span><span class="s4">0x1DFF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Greek and Coptic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0370</span><span class="s0">, </span><span class="s4">0x03FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Coptic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2C80</span><span class="s0">, </span><span class="s4">0x2CFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Cyrillic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0400</span><span class="s0">, </span><span class="s4">0x04FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Cyrillic Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0500</span><span class="s0">, </span><span class="s4">0x052F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Cyrillic Extended-A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2DE0</span><span class="s0">, </span><span class="s4">0x2DFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Cyrillic Extended-B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA640</span><span class="s0">, </span><span class="s4">0xA69F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Armenian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0530</span><span class="s0">, </span><span class="s4">0x058F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Hebrew&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0590</span><span class="s0">, </span><span class="s4">0x05FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Vai&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA500</span><span class="s0">, </span><span class="s4">0xA63F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Arabic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0600</span><span class="s0">, </span><span class="s4">0x06FF</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Arabic Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0750</span><span class="s0">, </span><span class="s4">0x077F</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;NKo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x07C0</span><span class="s0">, </span><span class="s4">0x07FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Devanagari&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0900</span><span class="s0">, </span><span class="s4">0x097F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Bengali&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0980</span><span class="s0">, </span><span class="s4">0x09FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Gurmukhi&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0A00</span><span class="s0">, </span><span class="s4">0x0A7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Gujarati&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0A80</span><span class="s0">, </span><span class="s4">0x0AFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Oriya&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0B00</span><span class="s0">, </span><span class="s4">0x0B7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tamil&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0B80</span><span class="s0">, </span><span class="s4">0x0BFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Telugu&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0C00</span><span class="s0">, </span><span class="s4">0x0C7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Kannada&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0C80</span><span class="s0">, </span><span class="s4">0x0CFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Malayalam&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0D00</span><span class="s0">, </span><span class="s4">0x0D7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Thai&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0E00</span><span class="s0">, </span><span class="s4">0x0E7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Lao&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0E80</span><span class="s0">, </span><span class="s4">0x0EFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Georgian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10A0</span><span class="s0">, </span><span class="s4">0x10FF</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Georgian Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2D00</span><span class="s0">, </span><span class="s4">0x2D2F</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Balinese&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1B00</span><span class="s0">, </span><span class="s4">0x1B7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Hangul Jamo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1100</span><span class="s0">, </span><span class="s4">0x11FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Latin Extended Additional&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1E00</span><span class="s0">, </span><span class="s4">0x1EFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Latin Extended-C&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2C60</span><span class="s0">, </span><span class="s4">0x2C7F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Latin Extended-D&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA720</span><span class="s0">, </span><span class="s4">0xA7FF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Greek Extended&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1F00</span><span class="s0">, </span><span class="s4">0x1FFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;General Punctuation&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2000</span><span class="s0">, </span><span class="s4">0x206F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Supplemental Punctuation&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2E00</span><span class="s0">, </span><span class="s4">0x2E7F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Superscripts And Subscripts&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2070</span><span class="s0">, </span><span class="s4">0x209F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Currency Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x20A0</span><span class="s0">, </span><span class="s4">0x20CF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Combining Diacritical Marks For Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x20D0</span><span class="s0">, </span><span class="s4">0x20FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Letterlike Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2100</span><span class="s0">, </span><span class="s4">0x214F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Number Forms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2150</span><span class="s0">, </span><span class="s4">0x218F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Arrows&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2190</span><span class="s0">, </span><span class="s4">0x21FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Supplemental Arrows-A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x27F0</span><span class="s0">, </span><span class="s4">0x27FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Supplemental Arrows-B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2900</span><span class="s0">, </span><span class="s4">0x297F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Miscellaneous Symbols and Arrows&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2B00</span><span class="s0">, </span><span class="s4">0x2BFF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Mathematical Operators&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2200</span><span class="s0">, </span><span class="s4">0x22FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Supplemental Mathematical Operators&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2A00</span><span class="s0">, </span><span class="s4">0x2AFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Miscellaneous Mathematical Symbols-A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x27C0</span><span class="s0">, </span><span class="s4">0x27EF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Miscellaneous Mathematical Symbols-B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2980</span><span class="s0">, </span><span class="s4">0x29FF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Miscellaneous Technical&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2300</span><span class="s0">, </span><span class="s4">0x23FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Control Pictures&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2400</span><span class="s0">, </span><span class="s4">0x243F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Optical Character Recognition&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2440</span><span class="s0">, </span><span class="s4">0x245F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Enclosed Alphanumerics&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2460</span><span class="s0">, </span><span class="s4">0x24FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Box Drawing&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2500</span><span class="s0">, </span><span class="s4">0x257F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Block Elements&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2580</span><span class="s0">, </span><span class="s4">0x259F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Geometric Shapes&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x25A0</span><span class="s0">, </span><span class="s4">0x25FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Miscellaneous Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2600</span><span class="s0">, </span><span class="s4">0x26FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Dingbats&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2700</span><span class="s0">, </span><span class="s4">0x27BF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;CJK Symbols And Punctuation&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3000</span><span class="s0">, </span><span class="s4">0x303F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Hiragana&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3040</span><span class="s0">, </span><span class="s4">0x309F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Katakana&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x30A0</span><span class="s0">, </span><span class="s4">0x30FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Katakana Phonetic Extensions&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x31F0</span><span class="s0">, </span><span class="s4">0x31FF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Bopomofo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3100</span><span class="s0">, </span><span class="s4">0x312F</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Bopomofo Extended&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x31A0</span><span class="s0">, </span><span class="s4">0x31BF</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Hangul Compatibility Jamo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3130</span><span class="s0">, </span><span class="s4">0x318F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Phags-pa&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA840</span><span class="s0">, </span><span class="s4">0xA87F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Enclosed CJK Letters And Months&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3200</span><span class="s0">, </span><span class="s4">0x32FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;CJK Compatibility&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3300</span><span class="s0">, </span><span class="s4">0x33FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Hangul Syllables&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xAC00</span><span class="s0">, </span><span class="s4">0xD7AF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Non-Plane 0 *&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xD800</span><span class="s0">, </span><span class="s4">0xDFFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Phoenician&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10900</span><span class="s0">, </span><span class="s4">0x1091F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Unified Ideographs&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x4E00</span><span class="s0">, </span><span class="s4">0x9FFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Radicals Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2E80</span><span class="s0">, </span><span class="s4">0x2EFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Kangxi Radicals&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2F00</span><span class="s0">, </span><span class="s4">0x2FDF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Ideographic Description Characters&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2FF0</span><span class="s0">, </span><span class="s4">0x2FFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Unified Ideographs Extension A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3400</span><span class="s0">, </span><span class="s4">0x4DBF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Unified Ideographs Extension B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x20000</span><span class="s0">, </span><span class="s4">0x2A6DF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Kanbun&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x3190</span><span class="s0">, </span><span class="s4">0x319F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Private Use Area (plane 0)&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xE000</span><span class="s0">, </span><span class="s4">0xF8FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Strokes&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x31C0</span><span class="s0">, </span><span class="s4">0x31EF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Compatibility Ideographs&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xF900</span><span class="s0">, </span><span class="s4">0xFAFF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Compatibility Ideographs Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2F800</span><span class="s0">, </span><span class="s4">0x2FA1F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Alphabetic Presentation Forms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFB00</span><span class="s0">, </span><span class="s4">0xFB4F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Arabic Presentation Forms-A&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFB50</span><span class="s0">, </span><span class="s4">0xFDFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Combining Half Marks&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE20</span><span class="s0">, </span><span class="s4">0xFE2F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Vertical Forms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE10</span><span class="s0">, </span><span class="s4">0xFE1F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;CJK Compatibility Forms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE30</span><span class="s0">, </span><span class="s4">0xFE4F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Small Form Variants&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE50</span><span class="s0">, </span><span class="s4">0xFE6F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Arabic Presentation Forms-B&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE70</span><span class="s0">, </span><span class="s4">0xFEFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Halfwidth And Fullwidth Forms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFF00</span><span class="s0">, </span><span class="s4">0xFFEF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Specials&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFFF0</span><span class="s0">, </span><span class="s4">0xFFFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tibetan&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0F00</span><span class="s0">, </span><span class="s4">0x0FFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Syriac&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0700</span><span class="s0">, </span><span class="s4">0x074F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Thaana&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0780</span><span class="s0">, </span><span class="s4">0x07BF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Sinhala&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x0D80</span><span class="s0">, </span><span class="s4">0x0DFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Myanmar&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1000</span><span class="s0">, </span><span class="s4">0x109F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Ethiopic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1200</span><span class="s0">, </span><span class="s4">0x137F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Ethiopic Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1380</span><span class="s0">, </span><span class="s4">0x139F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Ethiopic Extended&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2D80</span><span class="s0">, </span><span class="s4">0x2DDF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Cherokee&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x13A0</span><span class="s0">, </span><span class="s4">0x13FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Unified Canadian Aboriginal Syllabics&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1400</span><span class="s0">, </span><span class="s4">0x167F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Ogham&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1680</span><span class="s0">, </span><span class="s4">0x169F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Runic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x16A0</span><span class="s0">, </span><span class="s4">0x16FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Khmer&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1780</span><span class="s0">, </span><span class="s4">0x17FF</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Khmer Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x19E0</span><span class="s0">, </span><span class="s4">0x19FF</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Mongolian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1800</span><span class="s0">, </span><span class="s4">0x18AF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Braille Patterns&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2800</span><span class="s0">, </span><span class="s4">0x28FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Yi Syllables&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA000</span><span class="s0">, </span><span class="s4">0xA48F</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Yi Radicals&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA490</span><span class="s0">, </span><span class="s4">0xA4CF</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Tagalog&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1700</span><span class="s0">, </span><span class="s4">0x171F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Hanunoo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1720</span><span class="s0">, </span><span class="s4">0x173F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Buhid&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1740</span><span class="s0">, </span><span class="s4">0x175F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Tagbanwa&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1760</span><span class="s0">, </span><span class="s4">0x177F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Old Italic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10300</span><span class="s0">, </span><span class="s4">0x1032F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Gothic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10330</span><span class="s0">, </span><span class="s4">0x1034F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Deseret&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10400</span><span class="s0">, </span><span class="s4">0x1044F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Byzantine Musical Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D000</span><span class="s0">, </span><span class="s4">0x1D0FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Musical Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D100</span><span class="s0">, </span><span class="s4">0x1D1FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Ancient Greek Musical Notation&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D200</span><span class="s0">, </span><span class="s4">0x1D24F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Mathematical Alphanumeric Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D400</span><span class="s0">, </span><span class="s4">0x1D7FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Private Use (plane 15)&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xF0000</span><span class="s0">, </span><span class="s4">0xFFFFD</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Private Use (plane 16)&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x100000</span><span class="s0">, </span><span class="s4">0x10FFFD</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Variation Selectors&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xFE00</span><span class="s0">, </span><span class="s4">0xFE0F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Variation Selectors Supplement&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xE0100</span><span class="s0">, </span><span class="s4">0xE01EF</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tags&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xE0000</span><span class="s0">, </span><span class="s4">0xE007F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Limbu&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1900</span><span class="s0">, </span><span class="s4">0x194F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tai Le&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1950</span><span class="s0">, </span><span class="s4">0x197F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;New Tai Lue&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1980</span><span class="s0">, </span><span class="s4">0x19DF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Buginese&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1A00</span><span class="s0">, </span><span class="s4">0x1A1F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Glagolitic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2C00</span><span class="s0">, </span><span class="s4">0x2C5F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tifinagh&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x2D30</span><span class="s0">, </span><span class="s4">0x2D7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Yijing Hexagram Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x4DC0</span><span class="s0">, </span><span class="s4">0x4DFF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Syloti Nagri&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA800</span><span class="s0">, </span><span class="s4">0xA82F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Linear B Syllabary&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10000</span><span class="s0">, </span><span class="s4">0x1007F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Linear B Ideograms&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10080</span><span class="s0">, </span><span class="s4">0x100FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Aegean Numbers&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10100</span><span class="s0">, </span><span class="s4">0x1013F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Ancient Greek Numbers&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10140</span><span class="s0">, </span><span class="s4">0x1018F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Ugaritic&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10380</span><span class="s0">, </span><span class="s4">0x1039F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Old Persian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x103A0</span><span class="s0">, </span><span class="s4">0x103DF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Shavian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10450</span><span class="s0">, </span><span class="s4">0x1047F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Osmanya&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10480</span><span class="s0">, </span><span class="s4">0x104AF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Cypriot Syllabary&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10800</span><span class="s0">, </span><span class="s4">0x1083F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Kharoshthi&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10A00</span><span class="s0">, </span><span class="s4">0x10A5F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Tai Xuan Jing Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D300</span><span class="s0">, </span><span class="s4">0x1D35F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Cuneiform&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x12000</span><span class="s0">, </span><span class="s4">0x123FF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Cuneiform Numbers and Punctuation&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x12400</span><span class="s0">, </span><span class="s4">0x1247F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Counting Rod Numerals&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1D360</span><span class="s0">, </span><span class="s4">0x1D37F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Sundanese&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1B80</span><span class="s0">, </span><span class="s4">0x1BBF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Lepcha&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1C00</span><span class="s0">, </span><span class="s4">0x1C4F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Ol Chiki&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1C50</span><span class="s0">, </span><span class="s4">0x1C7F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Saurashtra&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA880</span><span class="s0">, </span><span class="s4">0xA8DF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Kayah Li&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA900</span><span class="s0">, </span><span class="s4">0xA92F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Rejang&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xA930</span><span class="s0">, </span><span class="s4">0xA95F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Cham&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0xAA00</span><span class="s0">, </span><span class="s4">0xAA5F</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Ancient Symbols&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10190</span><span class="s0">, </span><span class="s4">0x101CF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Phaistos Disc&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x101D0</span><span class="s0">, </span><span class="s4">0x101FF</span><span class="s1">))</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span>
        <span class="s1">(</span><span class="s3">&quot;Carian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x102A0</span><span class="s0">, </span><span class="s4">0x102DF</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Lycian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10280</span><span class="s0">, </span><span class="s4">0x1029F</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;Lydian&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x10920</span><span class="s0">, </span><span class="s4">0x1093F</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">&quot;Domino Tiles&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1F030</span><span class="s0">, </span><span class="s4">0x1F09F</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Mahjong Tiles&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0x1F000</span><span class="s0">, </span><span class="s4">0x1F02F</span><span class="s1">)))</span><span class="s0">,</span>
<span class="s1">)</span>


<span class="s1">_unicodeStarts = []</span>
<span class="s1">_unicodeValues = [</span><span class="s0">None</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">_getUnicodeRanges():</span>
    <span class="s2"># build the ranges of codepoints for each unicode range bit, and cache result</span>
    <span class="s0">if not </span><span class="s1">_unicodeStarts:</span>
        <span class="s1">unicodeRanges = [</span>
            <span class="s1">(start</span><span class="s0">, </span><span class="s1">(stop</span><span class="s0">, </span><span class="s1">bit))</span>
            <span class="s0">for </span><span class="s1">bit</span><span class="s0">, </span><span class="s1">blocks </span><span class="s0">in </span><span class="s1">enumerate(OS2_UNICODE_RANGES)</span>
            <span class="s0">for </span><span class="s1">_</span><span class="s0">, </span><span class="s1">(start</span><span class="s0">, </span><span class="s1">stop) </span><span class="s0">in </span><span class="s1">blocks</span>
        <span class="s1">]</span>
        <span class="s0">for </span><span class="s1">start</span><span class="s0">, </span><span class="s1">(stop</span><span class="s0">, </span><span class="s1">bit) </span><span class="s0">in </span><span class="s1">sorted(unicodeRanges):</span>
            <span class="s1">_unicodeStarts.append(start)</span>
            <span class="s1">_unicodeValues.append((stop</span><span class="s0">, </span><span class="s1">bit))</span>
    <span class="s0">return </span><span class="s1">_unicodeStarts</span><span class="s0">, </span><span class="s1">_unicodeValues</span>


<span class="s0">def </span><span class="s1">intersectUnicodeRanges(unicodes</span><span class="s0">, </span><span class="s1">inverse=</span><span class="s0">False</span><span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot;Intersect a sequence of (int) Unicode codepoints with the Unicode block 
    ranges defined in the OpenType specification v1.7, and return the set of 
    'ulUnicodeRanges' bits for which there is at least ONE intersection. 
    If 'inverse' is True, return the the bits for which there is NO intersection. 
 
    &gt;&gt;&gt; intersectUnicodeRanges([0x0410]) == {9} 
    True 
    &gt;&gt;&gt; intersectUnicodeRanges([0x0410, 0x1F000]) == {9, 57, 122} 
    True 
    &gt;&gt;&gt; intersectUnicodeRanges([0x0410, 0x1F000], inverse=True) == ( 
    ...     set(range(len(OS2_UNICODE_RANGES))) - {9, 57, 122}) 
    True 
    &quot;&quot;&quot;</span>
    <span class="s1">unicodes = set(unicodes)</span>
    <span class="s1">unicodestarts</span><span class="s0">, </span><span class="s1">unicodevalues = _getUnicodeRanges()</span>
    <span class="s1">bits = set()</span>
    <span class="s0">for </span><span class="s1">code </span><span class="s0">in </span><span class="s1">unicodes:</span>
        <span class="s1">stop</span><span class="s0">, </span><span class="s1">bit = unicodevalues[bisect.bisect(unicodestarts</span><span class="s0">, </span><span class="s1">code)]</span>
        <span class="s0">if </span><span class="s1">code &lt;= stop:</span>
            <span class="s1">bits.add(bit)</span>
    <span class="s2"># The spec says that bit 57 (&quot;Non Plane 0&quot;) implies that there's</span>
    <span class="s2"># at least one codepoint beyond the BMP; so I also include all</span>
    <span class="s2"># the non-BMP codepoints here</span>
    <span class="s0">if </span><span class="s1">any(</span><span class="s4">0x10000 </span><span class="s1">&lt;= code &lt; </span><span class="s4">0x110000 </span><span class="s0">for </span><span class="s1">code </span><span class="s0">in </span><span class="s1">unicodes):</span>
        <span class="s1">bits.add(</span><span class="s4">57</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">set(range(len(OS2_UNICODE_RANGES))) - bits </span><span class="s0">if </span><span class="s1">inverse </span><span class="s0">else </span><span class="s1">bits</span>


<span class="s0">if </span><span class="s1">__name__ == </span><span class="s3">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s0">import </span><span class="s1">doctest</span><span class="s0">, </span><span class="s1">sys</span>

    <span class="s1">sys.exit(doctest.testmod().failed)</span>
</pre>
</body>
</html>
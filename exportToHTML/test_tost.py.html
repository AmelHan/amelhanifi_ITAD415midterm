<html>
<head>
<title>test_tost.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6897bb;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_tost.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">&quot;&quot;&quot; 
 
Created on Wed Oct 17 09:48:34 2012 
 
Author: Josef Perktold 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">from </span><span class="s1">numpy.testing </span><span class="s3">import </span><span class="s1">assert_almost_equal</span><span class="s3">, </span><span class="s1">assert_equal</span><span class="s3">, </span><span class="s1">assert_</span>
<span class="s3">import </span><span class="s1">pytest</span>

<span class="s3">import </span><span class="s1">statsmodels.stats.weightstats </span><span class="s3">as </span><span class="s1">smws</span>


<span class="s3">from </span><span class="s1">statsmodels.tools.testing </span><span class="s3">import </span><span class="s1">Holder</span>


<span class="s3">def </span><span class="s1">assert_almost_equal_inf(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">6</span><span class="s3">, </span><span class="s1">msg=</span><span class="s3">None</span><span class="s1">):</span>
    <span class="s1">x = np.atleast_1d(x)</span>
    <span class="s1">y = np.atleast_1d(y)</span>
    <span class="s1">assert_equal(np.isposinf(x)</span><span class="s3">, </span><span class="s1">np.isposinf(y))</span>
    <span class="s1">assert_equal(np.isneginf(x)</span><span class="s3">, </span><span class="s1">np.isneginf(y))</span>
    <span class="s1">assert_equal(np.isnan(x)</span><span class="s3">, </span><span class="s1">np.isnan(y))</span>
    <span class="s1">assert_almost_equal(x[np.isfinite(x)]</span><span class="s3">, </span><span class="s1">y[np.isfinite(y)])</span>


<span class="s1">raw_clinic = </span><span class="s5">'''</span><span class="s3">\ 
</span><span class="s5">1     1 2.84 4.00 3.45 2.55 2.46 
2     1 2.51 3.26 3.10 2.82 2.48 
3     1 2.41 4.14 3.37 2.99 3.04 
4     1 2.95 3.42 2.82 3.37 3.35 
5     1 3.14 3.25 3.31 2.87 3.41 
6     1 3.79 4.34 3.88 3.40 3.16 
7     1 4.14 4.97 4.25 3.43 3.06 
8     1 3.85 4.31 3.92 3.58 3.91 
9     1 3.02 3.11 2.20 2.24 2.28 
10    1 3.45 3.41 3.80 3.86 3.91 
11    1 5.37 5.02 4.59 3.99 4.27 
12    1 3.81 4.21 4.08 3.18 1.86 
13    1 4.19 4.59 4.79 4.17 2.60 
14    1 3.16 5.30 4.69 4.83 4.51 
15    1 3.84 4.32 4.25 3.87 2.93 
16    2 2.60 3.76 2.86 2.41 2.71 
17    2 2.82 3.66 3.20 2.49 2.49 
18    2 2.18 3.65 3.87 3.00 2.65 
19    2 3.46 3.60 2.97 1.80 1.74 
20    2 4.01 3.48 4.42 3.06 2.76 
21    2 3.04 2.87 2.87 2.71 2.87 
22    2 3.47 3.24 3.47 3.26 3.14 
23    2 4.06 3.92 3.18 3.06 1.74 
24    2 2.91 3.99 3.06 2.02 3.18 
25    2 3.59 4.21 4.02 3.26 2.85 
26    2 4.51 4.21 3.78 2.63 1.92 
27    2 3.16 3.31 3.28 3.25 3.52 
28    2 3.86 3.61 3.28 3.19 3.09 
29    2 3.31 2.97 3.76 3.18 2.60 
30    2 3.02 2.73 3.87 3.50 2.93'''</span><span class="s1">.split()</span>
<span class="s1">clinic = np.array(raw_clinic</span><span class="s3">, </span><span class="s1">float).reshape(-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">7</span><span class="s1">)</span>


<span class="s0">#t = tost(-clinic$var2[16:30] + clinic$var2[1:15], eps=0.6)</span>
<span class="s1">tost_clinic_paired = Holder()</span>
<span class="s1">tost_clinic_paired.sample = </span><span class="s5">'paired'</span>
<span class="s1">tost_clinic_paired.mean_diff = </span><span class="s4">0.5626666666666665</span>
<span class="s1">tost_clinic_paired.se_diff = </span><span class="s4">0.2478276410785118</span>
<span class="s1">tost_clinic_paired.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_paired.ci_diff = (</span><span class="s4">0.1261653305099018</span><span class="s3">, </span><span class="s4">0.999168002823431</span><span class="s1">)</span>
<span class="s1">tost_clinic_paired.df = </span><span class="s4">14</span>
<span class="s1">tost_clinic_paired.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_paired.result = </span><span class="s5">'not rejected'</span>
<span class="s1">tost_clinic_paired.p_value = </span><span class="s4">0.4412034046017588</span>
<span class="s1">tost_clinic_paired.check_me = (</span><span class="s4">0.525333333333333</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">)</span>

<span class="s0">#&gt; t = tost(-clinic$var1[16:30] + clinic$var1[1:15], eps=0.6)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_paired_1.&quot;)</span>
<span class="s1">tost_clinic_paired_1 = Holder()</span>
<span class="s1">tost_clinic_paired_1.mean_diff = </span><span class="s4">0.1646666666666667</span>
<span class="s1">tost_clinic_paired_1.se_diff = </span><span class="s4">0.1357514067862445</span>
<span class="s1">tost_clinic_paired_1.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_paired_1.ci_diff = (-</span><span class="s4">0.0744336620516462</span><span class="s3">, </span><span class="s4">0.4037669953849797</span><span class="s1">)</span>
<span class="s1">tost_clinic_paired_1.df = </span><span class="s4">14</span>
<span class="s1">tost_clinic_paired_1.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_paired_1.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_clinic_paired_1.p_value = </span><span class="s4">0.003166881489265175</span>
<span class="s1">tost_clinic_paired_1.check_me = (-</span><span class="s4">0.2706666666666674</span><span class="s3">, </span><span class="s4">0.600000000000001</span><span class="s1">)</span>


<span class="s0">#&gt; t = tost(clinic$var2[1:15], clinic$var2[16:30], eps=0.6)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_indep.&quot;)</span>
<span class="s1">tost_clinic_indep = Holder()</span>
<span class="s1">tost_clinic_indep.sample = </span><span class="s5">'independent'</span>
<span class="s1">tost_clinic_indep.mean_diff = </span><span class="s4">0.562666666666666</span>
<span class="s1">tost_clinic_indep.se_diff = </span><span class="s4">0.2149871904637392</span>
<span class="s1">tost_clinic_indep.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_indep.ci_diff = (</span><span class="s4">0.194916250699966</span><span class="s3">, </span><span class="s4">0.930417082633366</span><span class="s1">)</span>
<span class="s1">tost_clinic_indep.df = </span><span class="s4">24.11000151062728</span>
<span class="s1">tost_clinic_indep.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_indep.result = </span><span class="s5">'not rejected'</span>
<span class="s1">tost_clinic_indep.p_value = </span><span class="s4">0.4317936812594803</span>
<span class="s1">tost_clinic_indep.check_me = (</span><span class="s4">0.525333333333332</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">)</span>

<span class="s0">#&gt; t = tost(clinic$var1[1:15], clinic$var1[16:30], eps=0.6)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_indep_1.&quot;)</span>
<span class="s1">tost_clinic_indep_1 = Holder()</span>
<span class="s1">tost_clinic_indep_1.sample = </span><span class="s5">'independent'</span>
<span class="s1">tost_clinic_indep_1.mean_diff = </span><span class="s4">0.1646666666666667</span>
<span class="s1">tost_clinic_indep_1.se_diff = </span><span class="s4">0.2531625991083627</span>
<span class="s1">tost_clinic_indep_1.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_indep_1.ci_diff = (-</span><span class="s4">0.2666862980722534</span><span class="s3">, </span><span class="s4">0.596019631405587</span><span class="s1">)</span>
<span class="s1">tost_clinic_indep_1.df = </span><span class="s4">26.7484787582315</span>
<span class="s1">tost_clinic_indep_1.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_indep_1.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_clinic_indep_1.p_value = </span><span class="s4">0.04853083976236974</span>
<span class="s1">tost_clinic_indep_1.check_me = (-</span><span class="s4">0.2706666666666666</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">)</span>

<span class="s0">#pooled variance</span>
<span class="s0">#&gt; t = tost(clinic$var1[1:15], clinic$var1[16:30], eps=0.6, var.equal = TRUE)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_indep_1_pooled.&quot;)</span>
<span class="s1">tost_clinic_indep_1_pooled = Holder()</span>
<span class="s1">tost_clinic_indep_1_pooled.mean_diff = </span><span class="s4">0.1646666666666667</span>
<span class="s1">tost_clinic_indep_1_pooled.se_diff = </span><span class="s4">0.2531625991083628</span>
<span class="s1">tost_clinic_indep_1_pooled.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_indep_1_pooled.ci_diff = (-</span><span class="s4">0.2659960620757337</span><span class="s3">, </span><span class="s4">0.595329395409067</span><span class="s1">)</span>
<span class="s1">tost_clinic_indep_1_pooled.df = </span><span class="s4">28</span>
<span class="s1">tost_clinic_indep_1_pooled.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_indep_1_pooled.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_clinic_indep_1_pooled.p_value = </span><span class="s4">0.04827315100761467</span>
<span class="s1">tost_clinic_indep_1_pooled.check_me = (-</span><span class="s4">0.2706666666666666</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">)</span>

<span class="s0">#&gt; t = tost(clinic$var2[1:15], clinic$var2[16:30], eps=0.6, var.equal = TRUE)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_indep_2_pooled.&quot;)</span>
<span class="s1">tost_clinic_indep_2_pooled = Holder()</span>
<span class="s1">tost_clinic_indep_2_pooled.mean_diff = </span><span class="s4">0.562666666666666</span>
<span class="s1">tost_clinic_indep_2_pooled.se_diff = </span><span class="s4">0.2149871904637392</span>
<span class="s1">tost_clinic_indep_2_pooled.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_indep_2_pooled.ci_diff = (</span><span class="s4">0.1969453064978777</span><span class="s3">, </span><span class="s4">0.928388026835454</span><span class="s1">)</span>
<span class="s1">tost_clinic_indep_2_pooled.df = </span><span class="s4">28</span>
<span class="s1">tost_clinic_indep_2_pooled.epsilon = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_indep_2_pooled.result = </span><span class="s5">'not rejected'</span>
<span class="s1">tost_clinic_indep_2_pooled.p_value = </span><span class="s4">0.43169347692374</span>
<span class="s1">tost_clinic_indep_2_pooled.check_me = (</span><span class="s4">0.525333333333332</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">)</span>


<span class="s0">#tost ratio, log transformed</span>
<span class="s0">#&gt; t = tost(log(clinic$var1[1:15]), log(clinic$var1[16:30]), eps=log(1.25), paired=TRUE)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_1_paired.&quot;)</span>
<span class="s1">tost_clinic_1_paired = Holder()</span>
<span class="s1">tost_clinic_1_paired.mean_diff = </span><span class="s4">0.0431223318225235</span>
<span class="s1">tost_clinic_1_paired.se_diff = </span><span class="s4">0.03819576328421437</span>
<span class="s1">tost_clinic_1_paired.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_1_paired.ci_diff = (-</span><span class="s4">0.02415225319362176</span><span class="s3">, </span><span class="s4">0.1103969168386687</span><span class="s1">)</span>
<span class="s1">tost_clinic_1_paired.df = </span><span class="s4">14</span>
<span class="s1">tost_clinic_1_paired.epsilon = </span><span class="s4">0.2231435513142098</span>
<span class="s1">tost_clinic_1_paired.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_clinic_1_paired.p_value = </span><span class="s4">0.0001664157928976468</span>
<span class="s1">tost_clinic_1_paired.check_me = (-</span><span class="s4">0.1368988876691603</span><span class="s3">, </span><span class="s4">0.2231435513142073</span><span class="s1">)</span>

<span class="s0">#&gt; t = tost(log(clinic$var1[1:15]), log(clinic$var1[16:30]), eps=log(1.25), paired=FALSE)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_clinic_1_indep.&quot;)</span>
<span class="s1">tost_clinic_1_indep = Holder()</span>
<span class="s1">tost_clinic_1_indep.mean_diff = </span><span class="s4">0.04312233182252334</span>
<span class="s1">tost_clinic_1_indep.se_diff = </span><span class="s4">0.073508371131806</span>
<span class="s1">tost_clinic_1_indep.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_clinic_1_indep.ci_diff = (-</span><span class="s4">0.0819851930203655</span><span class="s3">, </span><span class="s4">0.1682298566654122</span><span class="s1">)</span>
<span class="s1">tost_clinic_1_indep.df = </span><span class="s4">27.61177037646526</span>
<span class="s1">tost_clinic_1_indep.epsilon = </span><span class="s4">0.2231435513142098</span>
<span class="s1">tost_clinic_1_indep.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_clinic_1_indep.p_value = </span><span class="s4">0.01047085593138891</span>
<span class="s1">tost_clinic_1_indep.check_me = (-</span><span class="s4">0.1368988876691633</span><span class="s3">, </span><span class="s4">0.22314355131421</span><span class="s1">)</span>

<span class="s0">#&gt; t = tost(log(y), log(x), eps=log(1.25), paired=TRUE)</span>
<span class="s0">#&gt; cat_items(t, prefix=&quot;tost_s_paired.&quot;)</span>
<span class="s1">tost_s_paired = Holder()</span>
<span class="s1">tost_s_paired.mean_diff = </span><span class="s4">0.06060076667771316</span>
<span class="s1">tost_s_paired.se_diff = </span><span class="s4">0.04805826005366752</span>
<span class="s1">tost_s_paired.alpha = </span><span class="s4">0.05</span>
<span class="s1">tost_s_paired.ci_diff = (-</span><span class="s4">0.0257063329659993</span><span class="s3">, </span><span class="s4">0.1469078663214256</span><span class="s1">)</span>
<span class="s1">tost_s_paired.df = </span><span class="s4">11</span>
<span class="s1">tost_s_paired.epsilon = </span><span class="s4">0.2231435513142098</span>
<span class="s1">tost_s_paired.result = </span><span class="s5">'rejected'</span>
<span class="s1">tost_s_paired.p_value = </span><span class="s4">0.003059338540563293</span>
<span class="s1">tost_s_paired.check_me = (-</span><span class="s4">0.1019420179587835</span><span class="s3">, </span><span class="s4">0.2231435513142098</span><span class="s1">)</span>

<span class="s0">#multiple endpoints</span>
<span class="s0">#&gt; compvall &lt;- multeq.diff(data=clinic,grp=&quot;fact&quot;,method=&quot;step.up&quot;,margin.up=rep(0.6,5), margin.lo=c(-1.0, -1.0, -1.5, -1.5, -1.5))</span>
<span class="s0">#&gt; cat_items(compvall, prefix=&quot;tost_clinic_all_no_multi.&quot;)</span>
<span class="s1">tost_clinic_all_no_multi = Holder()</span>
<span class="s1">tost_clinic_all_no_multi.comp_name = </span><span class="s5">'2-1'</span>
<span class="s1">tost_clinic_all_no_multi.estimate = np.array([</span>
     <span class="s1">-</span><span class="s4">0.1646666666666667</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.562666666666666</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.3073333333333332</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">0.5553333333333335</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.469333333333333</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.degr_fr = np.array([</span>
     <span class="s4">26.74847875823152</span><span class="s3">, </span><span class="s4">24.1100015106273</span><span class="s3">, </span><span class="s4">23.90046331918926</span><span class="s3">,</span>
     <span class="s4">25.71678948210178</span><span class="s3">, </span><span class="s4">24.88436709341423</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.test_stat = np.array([</span>
     <span class="s4">3.020456692101513</span><span class="s3">, </span><span class="s4">2.034229724989578</span><span class="s3">, </span><span class="s4">4.052967897750272</span><span class="s3">,</span>
     <span class="s4">4.37537447933403</span><span class="s3">, </span><span class="s4">4.321997343344</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.p_value = np.array([</span>
     <span class="s4">0.00274867705173331</span><span class="s3">, </span><span class="s4">0.02653543052872217</span><span class="s3">, </span><span class="s4">0.0002319468040526358</span><span class="s3">,</span>
     <span class="s4">8.916466517494902e-05</span><span class="s3">, </span><span class="s4">0.00010890038649094043</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.lower = np.array([</span>
     <span class="s1">-</span><span class="s4">0.596019631405587</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.930417082633366</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.690410573009442</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">0.92373513818557</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.876746448909633</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.upper = np.array([</span>
     <span class="s4">0.2666862980722534</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.194916250699966</span><span class="s3">, </span><span class="s4">0.07574390634277595</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">0.186931528481097</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.06192021775703377</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.margin_lo = np.array([</span>
     <span class="s1">-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.margin_up = np.array([</span>
     <span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_no_multi.base = </span><span class="s4">1</span>
<span class="s1">tost_clinic_all_no_multi.method = </span><span class="s5">'step.up'</span>
<span class="s1">tost_clinic_all_no_multi.var_equal = </span><span class="s5">'''FALSE'''</span>
<span class="s1">tost_clinic_all_no_multi.FWER = </span><span class="s4">0.05</span>



<span class="s0">#&gt; comp &lt;- multeq.diff(data=clinic,grp=&quot;fact&quot;, resp=c(&quot;var1&quot;),method=&quot;step.up&quot;,margin.up=rep(0.6), margin.lo=rep(-1.5))</span>
<span class="s0">#&gt; cat_items(comp, prefix=&quot;tost_clinic_1_asym.&quot;)</span>
<span class="s1">tost_clinic_1_asym = Holder</span>
<span class="s1">tost_clinic_1_asym.comp_name = </span><span class="s5">'2-1'</span>
<span class="s1">tost_clinic_1_asym.estimate = -</span><span class="s4">0.1646666666666667</span>
<span class="s1">tost_clinic_1_asym.degr_fr = </span><span class="s4">26.74847875823152</span>
<span class="s1">tost_clinic_1_asym.test_stat = </span><span class="s4">3.020456692101513</span>
<span class="s1">tost_clinic_1_asym.p_value = </span><span class="s4">0.00274867705173331</span>
<span class="s1">tost_clinic_1_asym.lower = -</span><span class="s4">0.596019631405587</span>
<span class="s1">tost_clinic_1_asym.upper = </span><span class="s4">0.2666862980722534</span>
<span class="s1">tost_clinic_1_asym.margin_lo = -</span><span class="s4">1.5</span>
<span class="s1">tost_clinic_1_asym.margin_up = </span><span class="s4">0.6</span>
<span class="s1">tost_clinic_1_asym.base = </span><span class="s4">1</span>
<span class="s1">tost_clinic_1_asym.method = </span><span class="s5">'step.up'</span>
<span class="s1">tost_clinic_1_asym.var_equal = </span><span class="s5">'''FALSE'''</span>
<span class="s1">tost_clinic_1_asym.FWER = </span><span class="s4">0.05</span>

<span class="s0">#TODO: not used yet, some p-values are multi-testing adjusted</span>
<span class="s0">#      not implemented</span>
<span class="s0">#&gt; compvall &lt;- multeq.diff(data=clinic,grp=&quot;fact&quot;,method=&quot;step.up&quot;,margin.up=rep(0.6,5), margin.lo=c(-0.5, -0.5, -1.5, -1.5, -1.5))</span>
<span class="s0">#&gt; cat_items(compvall, prefix=&quot;tost_clinic_all_multi.&quot;)</span>
<span class="s1">tost_clinic_all_multi = Holder()</span>
<span class="s1">tost_clinic_all_multi.comp_name = </span><span class="s5">'2-1'</span>
<span class="s1">tost_clinic_all_multi.estimate = np.array([</span>
     <span class="s1">-</span><span class="s4">0.1646666666666667</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.562666666666666</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.3073333333333332</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">0.5553333333333335</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.469333333333333</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.degr_fr = np.array([</span>
     <span class="s4">26.74847875823152</span><span class="s3">, </span><span class="s4">24.1100015106273</span><span class="s3">, </span><span class="s4">23.90046331918926</span><span class="s3">,</span>
     <span class="s4">25.71678948210178</span><span class="s3">, </span><span class="s4">24.88436709341423</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.test_stat = np.array([</span>
     <span class="s4">1.324576910311299</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.2914902349832590</span><span class="s3">, </span><span class="s4">4.052967897750272</span><span class="s3">,</span>
     <span class="s4">4.37537447933403</span><span class="s3">, </span><span class="s4">4.321997343344</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.p_value = np.array([</span>
     <span class="s4">0.0982588867413542</span><span class="s3">, </span><span class="s4">0.6134151998456164</span><span class="s3">, </span><span class="s4">0.0006958404121579073</span><span class="s3">,</span>
     <span class="s4">0.0002674939955248471</span><span class="s3">, </span><span class="s4">0.0003267011594728213</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.lower = np.array([</span>
     <span class="s1">-</span><span class="s4">0.596019631405587</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.930417082633366</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.812901144055456</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">1.040823983574101</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.006578759345919</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.upper = np.array([</span>
     <span class="s4">0.2666862980722534</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.194916250699966</span><span class="s3">, </span><span class="s4">0.1982344773887895</span><span class="s3">,</span>
     <span class="s1">-</span><span class="s4">0.0698426830925655</span><span class="s3">, </span><span class="s4">0.0679120926792529</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.margin_lo = np.array([</span>
     <span class="s1">-</span><span class="s4">0.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.margin_up = np.array([</span>
     <span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s1">])</span>
<span class="s1">tost_clinic_all_multi.base = </span><span class="s4">1</span>
<span class="s1">tost_clinic_all_multi.method = </span><span class="s5">'step.up'</span>
<span class="s1">tost_clinic_all_multi.var_equal = </span><span class="s5">'''FALSE'''</span>
<span class="s1">tost_clinic_all_multi.FWER = </span><span class="s4">0.05</span>


<span class="s0">#t-tests</span>

<span class="s0">#&gt; tt = t.test(clinic$var1[16:30], clinic$var1[1:15], data=clinic, mu=-0., alternative=&quot;two.sided&quot;, paired=TRUE)</span>
<span class="s0">#&gt; cat_items(tt, prefix=&quot;ttest_clinic_paired_1.&quot;)</span>
<span class="s1">ttest_clinic_paired_1 = Holder()</span>
<span class="s1">ttest_clinic_paired_1.statistic = </span><span class="s4">1.213001548676048</span>
<span class="s1">ttest_clinic_paired_1.parameter = </span><span class="s4">14</span>
<span class="s1">ttest_clinic_paired_1.p_value = </span><span class="s4">0.245199929713149</span>
<span class="s1">ttest_clinic_paired_1.conf_int = (-</span><span class="s4">0.1264911434745851</span><span class="s3">, </span><span class="s4">0.4558244768079186</span><span class="s1">)</span>
<span class="s1">ttest_clinic_paired_1.estimate = </span><span class="s4">0.1646666666666667</span>
<span class="s1">ttest_clinic_paired_1.null_value = </span><span class="s4">0</span>
<span class="s1">ttest_clinic_paired_1.alternative = </span><span class="s5">'two.sided'</span>
<span class="s1">ttest_clinic_paired_1.method = </span><span class="s5">'Paired t-test'</span>
<span class="s1">ttest_clinic_paired_1.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>



<span class="s0">#&gt; ttless = t.test(clinic$var1[1:15], clinic$var1[16:30],, data=clinic, mu=-0., alternative=&quot;less&quot;, paired=FALSE)</span>
<span class="s0">#&gt; cat_items(ttless, prefix=&quot;ttest_clinic_paired_1_l.&quot;)</span>
<span class="s1">ttest_clinic_paired_1_l = Holder()</span>
<span class="s1">ttest_clinic_paired_1_l.statistic = </span><span class="s4">0.650438363512706</span>
<span class="s1">ttest_clinic_paired_1_l.parameter = </span><span class="s4">26.7484787582315</span>
<span class="s1">ttest_clinic_paired_1_l.p_value = </span><span class="s4">0.739521349864458</span>
<span class="s1">ttest_clinic_paired_1_l.conf_int = (-np.inf</span><span class="s3">, </span><span class="s4">0.596019631405587</span><span class="s1">)</span>
<span class="s1">ttest_clinic_paired_1_l.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_paired_1_l.null_value = </span><span class="s4">0</span>
<span class="s1">ttest_clinic_paired_1_l.alternative = </span><span class="s5">'less'</span>
<span class="s1">ttest_clinic_paired_1_l.method = </span><span class="s5">'Welch Two Sample t-test'</span>
<span class="s1">ttest_clinic_paired_1_l.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>

<span class="s0">#&gt; cat_items(tt, prefix=&quot;ttest_clinic_indep_1_g.&quot;)</span>
<span class="s1">ttest_clinic_indep_1_g = Holder()</span>
<span class="s1">ttest_clinic_indep_1_g.statistic = </span><span class="s4">0.650438363512706</span>
<span class="s1">ttest_clinic_indep_1_g.parameter = </span><span class="s4">26.7484787582315</span>
<span class="s1">ttest_clinic_indep_1_g.p_value = </span><span class="s4">0.2604786501355416</span>
<span class="s1">ttest_clinic_indep_1_g.conf_int = (-</span><span class="s4">0.2666862980722534</span><span class="s3">, </span><span class="s1">np.inf)</span>
<span class="s1">ttest_clinic_indep_1_g.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_g.null_value = </span><span class="s4">0</span>
<span class="s1">ttest_clinic_indep_1_g.alternative = </span><span class="s5">'greater'</span>
<span class="s1">ttest_clinic_indep_1_g.method = </span><span class="s5">'Welch Two Sample t-test'</span>
<span class="s1">ttest_clinic_indep_1_g.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>

<span class="s0">#&gt; cat_items(ttless, prefix=&quot;ttest_clinic_indep_1_l.&quot;)</span>
<span class="s1">ttest_clinic_indep_1_l = Holder()</span>
<span class="s1">ttest_clinic_indep_1_l.statistic = </span><span class="s4">0.650438363512706</span>
<span class="s1">ttest_clinic_indep_1_l.parameter = </span><span class="s4">26.7484787582315</span>
<span class="s1">ttest_clinic_indep_1_l.p_value = </span><span class="s4">0.739521349864458</span>
<span class="s1">ttest_clinic_indep_1_l.conf_int = (-np.inf</span><span class="s3">, </span><span class="s4">0.596019631405587</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_l.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_l.null_value = </span><span class="s4">0</span>
<span class="s1">ttest_clinic_indep_1_l.alternative = </span><span class="s5">'less'</span>
<span class="s1">ttest_clinic_indep_1_l.method = </span><span class="s5">'Welch Two Sample t-test'</span>
<span class="s1">ttest_clinic_indep_1_l.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>

<span class="s0">#&gt; ttless = t.test(clinic$var1[1:15], clinic$var1[16:30],, data=clinic, mu=1., alternative=&quot;less&quot;, paired=FALSE)</span>
<span class="s0">#&gt; cat_items(ttless, prefix=&quot;ttest_clinic_indep_1_l_mu.&quot;)</span>
<span class="s1">ttest_clinic_indep_1_l_mu = Holder()</span>
<span class="s1">ttest_clinic_indep_1_l_mu.statistic = -</span><span class="s4">3.299592184135306</span>
<span class="s1">ttest_clinic_indep_1_l_mu.parameter = </span><span class="s4">26.7484787582315</span>
<span class="s1">ttest_clinic_indep_1_l_mu.p_value = </span><span class="s4">0.001372434925571605</span>
<span class="s1">ttest_clinic_indep_1_l_mu.conf_int = (-np.inf</span><span class="s3">, </span><span class="s4">0.596019631405587</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_l_mu.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_l_mu.null_value = </span><span class="s4">1</span>
<span class="s1">ttest_clinic_indep_1_l_mu.alternative = </span><span class="s5">'less'</span>
<span class="s1">ttest_clinic_indep_1_l_mu.method = </span><span class="s5">'Welch Two Sample t-test'</span>
<span class="s1">ttest_clinic_indep_1_l_mu.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>


<span class="s0">#&gt; tt2 = t.test(clinic$var1[1:15], clinic$var1[16:30],, data=clinic, mu=1, alternative=&quot;two.sided&quot;, paired=FALSE)</span>
<span class="s0">#&gt; cat_items(tt2, prefix=&quot;ttest_clinic_indep_1_two_mu.&quot;)</span>
<span class="s1">ttest_clinic_indep_1_two_mu = Holder()</span>
<span class="s1">ttest_clinic_indep_1_two_mu.statistic = -</span><span class="s4">3.299592184135306</span>
<span class="s1">ttest_clinic_indep_1_two_mu.parameter = </span><span class="s4">26.7484787582315</span>
<span class="s1">ttest_clinic_indep_1_two_mu.p_value = </span><span class="s4">0.00274486985114321</span>
<span class="s1">ttest_clinic_indep_1_two_mu.conf_int = (-</span><span class="s4">0.3550087243406</span><span class="s3">, </span><span class="s4">0.6843420576739336</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_two_mu.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_two_mu.null_value = </span><span class="s4">1</span>
<span class="s1">ttest_clinic_indep_1_two_mu.alternative = </span><span class="s5">'two.sided'</span>
<span class="s1">ttest_clinic_indep_1_two_mu.method = </span><span class="s5">'Welch Two Sample t-test'</span>
<span class="s1">ttest_clinic_indep_1_two_mu.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>

<span class="s0">#&gt; tt2 = t.test(clinic$var1[1:15], clinic$var1[16:30],, data=clinic, mu=1, alternative=&quot;two.sided&quot;, paired=FALSE, var.equal=TRUE)</span>
<span class="s0">#&gt; cat_items(tt2, prefix=&quot;ttest_clinic_indep_1_two_mu_pooled.&quot;)</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled = Holder()</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.statistic = -</span><span class="s4">3.299592184135305</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.parameter = </span><span class="s4">28</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.p_value = </span><span class="s4">0.002643203760742494</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.conf_int = (-</span><span class="s4">0.35391340938235</span><span class="s3">, </span><span class="s4">0.6832467427156834</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.estimate = (</span><span class="s4">3.498</span><span class="s3">, </span><span class="s4">3.333333333333333</span><span class="s1">)</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.null_value = </span><span class="s4">1</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.alternative = </span><span class="s5">'two.sided'</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.method = </span><span class="s5">' Two Sample t-test'</span>
<span class="s1">ttest_clinic_indep_1_two_mu_pooled.data_name = </span><span class="s5">'clinic$var1[1:15] and clinic$var1[16:30]'</span>




<span class="s1">res1 = smws.ttost_paired(clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">transform=</span><span class="s3">None</span><span class="s1">)</span>
<span class="s1">res2 = smws.ttost_paired(clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">transform=</span><span class="s3">None</span><span class="s1">)</span>
<span class="s1">res = smws.ttost_ind(clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">CheckTostMixin:</span>

    <span class="s3">def </span><span class="s1">test_pval(self):</span>
        <span class="s1">assert_almost_equal(self.res1.pvalue</span><span class="s3">, </span><span class="s1">self.res2.p_value</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s0">#assert_almost_equal(self.res1.df, self.res2.df, decimal=13)</span>

<span class="s3">class </span><span class="s1">TestTostp1(CheckTostMixin):</span>
    <span class="s0">#paired var1</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_paired_1</span>
        <span class="s1">x1</span><span class="s3">, </span><span class="s1">x2 = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_paired(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">transform=</span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s0">#cls.res1.df = res[1][-1] not yet</span>
        <span class="s1">res_ds = smws.DescrStatsW(x1 - x2</span><span class="s3">, </span><span class="s1">weights=</span><span class="s3">None, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">#tost confint 2*alpha TODO: check again</span>
        <span class="s1">cls.res1.tconfint_diff = res_ds.tconfint_mean(</span><span class="s4">0.1</span><span class="s1">)</span>
        <span class="s1">cls.res1.confint_05 = res_ds.tconfint_mean(</span><span class="s4">0.05</span><span class="s1">)</span>
        <span class="s1">cls.res1.mean_diff = res_ds.mean</span>
        <span class="s1">cls.res1.std_mean_diff = res_ds.std_mean</span>

        <span class="s1">cls.res2b = ttest_clinic_paired_1</span>

    <span class="s3">def </span><span class="s1">test_special(self):</span>
        <span class="s0">#TODO: add attributes to other cases and move to superclass</span>
        <span class="s1">assert_almost_equal(self.res1.tconfint_diff</span><span class="s3">, </span><span class="s1">self.res2.ci_diff</span><span class="s3">,</span>
                            <span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(self.res1.mean_diff</span><span class="s3">, </span><span class="s1">self.res2.mean_diff</span><span class="s3">,</span>
                            <span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(self.res1.std_mean_diff</span><span class="s3">, </span><span class="s1">self.res2.se_diff</span><span class="s3">,</span>
                            <span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s0">#compare with ttest</span>
        <span class="s1">assert_almost_equal(self.res1.confint_05</span><span class="s3">, </span><span class="s1">self.res2b.conf_int</span><span class="s3">,</span>
                            <span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">TestTostp2(CheckTostMixin):</span>
    <span class="s0">#paired var2</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_paired</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_paired(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">transform=</span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s3">class </span><span class="s1">TestTosti1(CheckTostMixin):</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_indep_1</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_ind(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s3">class </span><span class="s1">TestTosti2(CheckTostMixin):</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_indep</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_ind(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s3">class </span><span class="s1">TestTostip1(CheckTostMixin):</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_indep_1_pooled</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_ind(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'pooled'</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s3">class </span><span class="s1">TestTostip2(CheckTostMixin):</span>
    <span class="s1">@classmethod</span>
    <span class="s3">def </span><span class="s1">setup_class(cls):</span>
        <span class="s1">cls.res2 = tost_clinic_indep_2_pooled</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">cls.res1 = Holder()</span>
        <span class="s1">res = smws.ttost_ind(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'pooled'</span><span class="s1">)</span>
        <span class="s1">cls.res1.pvalue = res[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s0">#transform=np.log</span>
<span class="s0">#class TestTostp1_log(CheckTost):</span>
<span class="s3">def </span><span class="s1">test_tost_log():</span>
    <span class="s1">x1</span><span class="s3">, </span><span class="s1">x2 = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>

    <span class="s1">resp = smws.ttost_paired(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.25</span><span class="s3">, </span><span class="s1">transform=np.log)</span>
    <span class="s1">assert_almost_equal(resp[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">tost_clinic_1_paired.p_value</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>

    <span class="s1">resi = smws.ttost_ind(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.25</span><span class="s3">, </span><span class="s1">transform=np.log</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(resi[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">tost_clinic_1_indep.p_value</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>

<span class="s3">def </span><span class="s1">test_tost_asym():</span>
    <span class="s1">x1</span><span class="s3">, </span><span class="s1">x2 = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s0">#Note: x1, x2 reversed by definition in multeq.dif</span>
    <span class="s1">assert_almost_equal(x2.mean() - x1.mean()</span><span class="s3">, </span><span class="s1">tost_clinic_1_asym.estimate</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>
    <span class="s1">resa = smws.ttost_ind(x2</span><span class="s3">, </span><span class="s1">x1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(resa[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">tost_clinic_1_asym.p_value</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>

    <span class="s0">#multi-endpoints, asymmetric bounds, vectorized</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">,</span>
                           <span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(resall[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">tost_clinic_all_no_multi.p_value</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>

    <span class="s0">#SMOKE tests: foe multi-endpoint vectorized, k on k</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">np.exp([-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">])</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">,</span>
                           <span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s3">, </span><span class="s1">transform=np.log)</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">,</span>
                           <span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s3">, </span><span class="s1">transform=np.exp)</span>

    <span class="s1">resall = smws.ttost_paired(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                              <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">,</span>
                              <span class="s1">transform=np.log)</span>
    <span class="s1">resall = smws.ttost_paired(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                              <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">,</span>
                              <span class="s1">transform=np.exp)</span>

    <span class="s1">resall = smws.ttest_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">,</span>
                              <span class="s1">value=[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">])</span>

    <span class="s0">#k on 1: compare all with reference</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">resa3_2 = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">3</span><span class="s1">:</span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">:</span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(resall[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">resa3_2[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">resall = smws.ttost_ind(clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">[-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">0.7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s3">,</span>
                           <span class="s1">np.repeat(</span><span class="s4">0.6</span><span class="s3">,</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>

<span class="s3">def </span><span class="s1">test_ttest():</span>
    <span class="s1">x1</span><span class="s3">, </span><span class="s1">x2 = clinic[:</span><span class="s4">15</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">clinic[</span><span class="s4">15</span><span class="s1">:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">all_tests = []</span>
    <span class="s1">t1 = smws.ttest_ind(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s1">alternative=</span><span class="s5">'larger'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">all_tests.append((t1</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_g))</span>
    <span class="s1">t2 = smws.ttest_ind(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s1">alternative=</span><span class="s5">'smaller'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">all_tests.append((t2</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_l))</span>
    <span class="s1">t3 = smws.ttest_ind(x1</span><span class="s3">, </span><span class="s1">x2</span><span class="s3">, </span><span class="s1">alternative=</span><span class="s5">'smaller'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s3">,</span>
                        <span class="s1">value=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">all_tests.append((t3</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_l_mu))</span>

    <span class="s3">for </span><span class="s1">res1</span><span class="s3">, </span><span class="s1">res2 </span><span class="s3">in </span><span class="s1">all_tests:</span>
        <span class="s1">assert_almost_equal(res1[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">res2.statistic</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(res1[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">res2.p_value</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
        <span class="s0">#assert_almost_equal(res1[2], res2.df, decimal=13)</span>

    <span class="s1">cm = smws.CompareMeans(smws.DescrStatsW(x1)</span><span class="s3">, </span><span class="s1">smws.DescrStatsW(x2))</span>
    <span class="s1">ci = cm.tconfint_diff(alternative=</span><span class="s5">'two-sided'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(ci</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_two_mu.conf_int</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
    <span class="s1">ci = cm.tconfint_diff(alternative=</span><span class="s5">'two-sided'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'pooled'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(ci</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_two_mu_pooled.conf_int</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
    <span class="s1">ci = cm.tconfint_diff(alternative=</span><span class="s5">'smaller'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal_inf(ci</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_l.conf_int</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>
    <span class="s1">ci = cm.tconfint_diff(alternative=</span><span class="s5">'larger'</span><span class="s3">, </span><span class="s1">usevar=</span><span class="s5">'unequal'</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal_inf(ci</span><span class="s3">, </span><span class="s1">ttest_clinic_indep_1_g.conf_int</span><span class="s3">, </span><span class="s1">decimal=</span><span class="s4">13</span><span class="s1">)</span>


    <span class="s0">#test get_compare</span>
    <span class="s1">cm = smws.CompareMeans(smws.DescrStatsW(x1)</span><span class="s3">, </span><span class="s1">smws.DescrStatsW(x2))</span>
    <span class="s1">cm1 = cm.d1.get_compare(cm.d2)</span>
    <span class="s1">cm2 = cm.d1.get_compare(x2)</span>
    <span class="s1">cm3 = cm.d1.get_compare(np.hstack((x2</span><span class="s3">,</span><span class="s1">x2)))</span>
    <span class="s0">#all use the same d1, no copying</span>
    <span class="s1">assert_(cm.d1 </span><span class="s3">is </span><span class="s1">cm1.d1)</span>
    <span class="s1">assert_(cm.d1 </span><span class="s3">is </span><span class="s1">cm2.d1)</span>
    <span class="s1">assert_(cm.d1 </span><span class="s3">is </span><span class="s1">cm3.d1)</span>


<span class="s1">@pytest.mark.xfail(reason=</span><span class="s5">&quot;shape mismatch between res1[1:] and res_sas[1:]&quot;</span><span class="s3">,</span>
                   <span class="s1">raises=AssertionError</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
<span class="s3">def </span><span class="s1">test_tost_transform_paired():</span>
    <span class="s1">raw = np.array(</span><span class="s5">'''</span><span class="s3">\ 
       </span><span class="s5">103.4 90.11  59.92 77.71  68.17 77.71  94.54 97.51 
       69.48 58.21  72.17 101.3  74.37 79.84  84.44 96.06 
       96.74 89.30  94.26 97.22  48.52 61.62  95.68 85.80'''</span><span class="s1">.split()</span><span class="s3">, </span><span class="s1">float)</span>

    <span class="s1">x</span><span class="s3">, </span><span class="s1">y = raw.reshape(-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s1">).T</span>

    <span class="s1">res1 = smws.ttost_paired(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.25</span><span class="s3">, </span><span class="s1">transform=np.log)</span>
    <span class="s1">res_sas = (</span><span class="s4">0.0031</span><span class="s3">, </span><span class="s1">(</span><span class="s4">3.38</span><span class="s3">, </span><span class="s4">0.0031</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(-</span><span class="s4">5.90</span><span class="s3">, </span><span class="s4">0.00005</span><span class="s1">))</span>
    <span class="s1">assert_almost_equal(res1[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">res_sas[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">assert_almost_equal(res1[</span><span class="s4">1</span><span class="s1">:]</span><span class="s3">, </span><span class="s1">res_sas[</span><span class="s4">1</span><span class="s1">:]</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">#result R tost</span>
    <span class="s1">assert_almost_equal(res1[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">tost_s_paired.p_value</span><span class="s3">, </span><span class="s4">13</span><span class="s1">)</span>
</pre>
</body>
</html>